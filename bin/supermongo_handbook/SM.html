<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
<!-- This HTML file has been created by %M% %I%
     from sm.txi on 7 May 2002 -->

<title>SM</title>
</head>
<body>
<h1>SM</h1>
<h2>Edition 2.4.16 (or later if we didn't update this page)</h2>
<address>by Robert Lupton and Patricia Monger</address>
<p>
</p><p></p><hr><p>
</p><h1>Table of Contents</h1>
<ul>
<li><a name="TOC1" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC1">Introduction</a>
</li><li><a name="TOC2" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC2">Description of SM</a>
</li><li><a name="TOC3" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC3">A simple plot</a>
</li><li><a name="TOC4" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC4">Facilities within the Command Interpreter</a>
</li><li><a name="TOC5" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC5">String Variables</a>
</li><li><a name="TOC6" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC6">Command History</a>
</li><li><a name="TOC7" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC7">Changing Key-Bindings</a>
</li><li><a name="TOC8" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC8">Talking to the Operating System</a>
</li><li><a name="TOC9" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC9">Macros</a>
</li><li><a name="TOC10" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC10">DO and FOREACH loops, WHILE loops, and IF statements</a>
</li><li><a name="TOC11" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC11">The Help Command</a>
</li><li><a name="TOC12" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC12">Saving and Restoring a Session</a>
</li><li><a name="TOC13" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC13">Vectors and Arithmetic</a>
</li><li><a name="TOC14" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC14">Drawing Labels and SM's TeX Emulation</a>
<ul>
<li><a name="TOC15" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC15">An Introduction to TeX</a>
</li><li><a name="TOC16" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC16">Available Fonts</a>
</li><li><a name="TOC17" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC17">SM's TeX Control Sequences</a>
</li><li><a name="TOC18" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC18">SM's Extensions to TeX</a>
</li><li><a name="TOC19" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC19">Caveats and Cautions when using TeX</a>
</li><li><a name="TOC20" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC20">How to Stop the Device using its Fonts</a>
</li><li><a name="TOC21" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC21">Old-style Labels</a>
</li></ul>
</li><li><a name="TOC22" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC22">Getting Hardcopies of Plots</a>
</li><li><a name="TOC23" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC23">Overloading Keywords</a>
</li><li><a name="TOC24" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC24">Examples of Useful Macros</a>
</li><li><a name="TOC25" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC25">More Examples of Macros</a>
</li><li><a name="TOC26" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC26">What Quotes What When</a>
</li><li><a name="TOC27" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC27">Reserved Keywords</a>
</li><li><a name="TOC28" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC28">Glossary of Terms used in this Manual</a>
</li><li><a name="TOC29" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">Command Reference</a>
<ul>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN1">Abort</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN2">Angle</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN3">Apropos</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN4">Aspect</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN5">Arithmetic</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN6">Axis</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN7">Box</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN8">Break</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN9">Chdir</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN10">Connect</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN11">Contour</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN12">Ctype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN13">Cursor</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN14">Data</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN15">Define</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN16">Delete</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN17">Device</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN18">Dither</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN19">Do</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN20">Dot</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN21">Draw</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN22">Edit</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN23">Environment Variables</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN24">Erase</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN25">Errorbar</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN26">Expand</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN27">Fft</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN28">Foreach</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN29">Format</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN30">Grid</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN31">Help</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN32">Histogram</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN33">History</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN34">Identification</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN35">If</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN36">Image</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN37">Key</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN38">Label</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN39">Levels</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN40">Limits</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN41">Lines</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN42">List</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN43">Local</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN44">Location</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN45">Logical</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN46">Ltype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN47">Lweight</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN48">Macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN49">Meta</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN50">Minmax</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN51">Notation</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN52">Overload</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN53">Page</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN54">Points</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN55">Print</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN56">Prompt</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN57">Ptype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN58">Putlabel</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN59">Quit</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN60">Range</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN61">Read</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN62">Relocate</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN63">Restore</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN64">Return</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN65">Save</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN66">Set</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN67">Shade</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN68">Show</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN69">Sort</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN70">Spline</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN71">Strings</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN72">Surface</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN73">Table</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN74">Termtype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN75">Ticksize</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN76">User</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN77">Verbose</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN78">Version</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN79">Viewpoint</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN80">Whatis</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN81">Window</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN82">While</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN83">Write</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN84">Xlabel</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN85">Ylabel</a>
</li></ul>
</li><li><a name="TOC30" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC30">Appendices</a>
<ul>
<li><a name="TOC31" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC31">The Command Interpreter</a>
<ul>
<li><a name="TOC32" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC32">Token Generation</a>
</li><li><a name="TOC33" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC33">Peculiarities of the Grammar</a>
</li><li><a name="TOC34" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC34">The Macro Processor</a>
</li><li><a name="TOC35" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC35">The DO, FOREACH, and IF commands</a>
</li><li><a name="TOC36" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC36">Examples of How SM Parses Input</a>
</li></ul>
</li><li><a name="TOC37" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">The Stdgraph Graphics Kernel</a>
</li><li><a name="TOC38" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC38">The Graphcap File</a>
</li><li><a name="TOC39" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC39">Stdgraph's Binary Encoder</a>
</li><li><a name="TOC40" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC40">Examples of Graphcap Entries</a>
</li><li><a name="TOC41" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC41">Using Cursors with Graphcap</a>
</li><li><a name="TOC42" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC42">Using Colours with Graphcap</a>
</li><li><a name="TOC43" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC43">How to Modify a Graphcap Entry</a>
</li><li><a name="TOC44" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC44">Writing a New Graphcap Entry</a>
</li><li><a name="TOC45" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC45">Support for Raster Devices</a>
</li><li><a name="TOC46" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC46">Compiling Graphcap</a>
</li><li><a name="TOC47" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC47">Index to Graphcap Capabilities</a>
</li><li><a name="TOC48" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC48">Calling SM from Programmes</a>
<ul>
<li><a name="TOC49" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC49">Introduction to Callable SM</a>
</li><li><a name="TOC50" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC50">Example of Calling SM Functions</a>
</li><li><a name="TOC51" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC51">Function Definitions: 1-D</a>
</li><li><a name="TOC52" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC52">Function Definitions: 2-D</a>
</li><li><a name="TOC53" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC53">Calling the SM interactive Parser from Programmes</a>
</li><li><a name="TOC54" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC54">Why do I have to call <code>sm_alpha</code>, <code>sm_graphics</code>, <code>sm_gflush</code>, and <code>sm_redraw</code>?</a>
</li><li><a name="TOC55" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC55">How to Choose the Name for Fortran Subroutines</a>
</li></ul>
</li><li><a name="TOC56" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC56">The SM Grammar</a>
</li><li><a name="TOC57" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC57">Two-Dimensional Graphics</a>
<ul>
<li><a name="TOC58" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC58">Filecap</a>
</li></ul>
</li><li><a name="TOC59" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC59">Termcap -- A Terminal Database</a>
</li><li><a name="TOC60" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC60">New Devices and New Machines</a>
<ul>
<li><a name="TOC61" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC61">Adding New Devices</a>
</li><li><a name="TOC62" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC62">Porting to New Machines</a>
</li></ul>
</li><li><a name="TOC63" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC63">The System Macro Libraries</a>
</li><li><a name="TOC64" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC64">Tips for Mongo Users</a>
<ul>
<li><a name="TOC65" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC65">Differences from Mongo</a>
</li><li><a name="TOC66" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC66">The READ OLD command</a>
</li><li><a name="TOC67" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC67">The compatibility macro</a>
</li></ul>
</li><li><a name="TOC68" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC68">SM's Fonts</a>
</li><li><a name="TOC69" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC69">Using SM to write Japanese</a>
</li></ul>
</li><li><a name="TOC70" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC70">General Index</a>
</li><li><a name="TOC71" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC71">Command Index</a>
</li></ul>
<p></p><hr><p>


</p><h1><a name="SEC1" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC1">Introduction</a></h1>

<p>
SM is still evolving slowly, and this documentation may not be 
true, helpful, or complete. In order of increasing plausibility, 
information may be obtained from the HELP command, this document, the 
authors, and the source code. RHL is prepared to guarantee that the 
executable code has not been patched. 

</p>
<p>
If you find bugs, (reasonable) features that you want, wrong documentation,
or anything else that inspires you please let us know. At least under
Unix the macro <code>gripe</code> should be a convenient way to send us mail.
Please also send us any clever macros that you would like to share.

</p>
<p>
Next a disclaimer: SM is copyright (C)1987, 1989, 1990, 1991,
1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000
Robert Lupton and Patricia Monger. 
This programme is not public domain, except where specifically stated
to the contrary, either in the code, or in the manual. If you have a
legally acquired copy you may use it on any computer "on the same site",
but you may <em>not</em> give it away or sell it. If you have a legal copy we
will provide some support and allow you with as many upgrades
as you provide tapes for (or wish to retrieve with <code>ftp</code>).

</p>
<p>
SM is provided `as is' with no warranty, and we are not responsible for any
losses resulting from its use.

</p>
<p>
In addition to this manual there is a tutorial introduction which you
might find less intimidating.
See section `The SM Tutorial' in <cite>The SM Tutorial</cite>.

</p>
<p>
This should be unimportant, but in case it isn't you can submit SM
bug reports (or requests for new features) using the URL
<code>http://www.astro.princeton.edu/cgi-bin/gnatsweb.pl</code>;
you want to query on category <code>sm</code> (and maybe <code>smdoc)</code> from
<code>advanced query</code>; note that you can save this query, set a bookmark,
and so forth. 
<a name="IDX1"></a>
<a name="IDX2"></a>

</p>


<h1><a name="SEC2" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC2">Description of SM</a></h1>

<p>
SM is an interactive plotting programme with a flexible
command language.  The plot data may be defined to SM in a number of ways.
There is also a powerful mechanism for defining and editing plot <tt>`macros'</tt>
(sets of SM plot commands that are defined and
invoked as plot "subprogrammes").   

</p>
<p>
The 
features of SM are described fully in the next few sections, but
let us start with a description of how to produce your first SM
plot. Before you start, notice that SM is case sensitive.
Keywords may be typed in lower or uppercase (as we do in this manual),
but we would recommend using lowercase. It is in fact possible to change
the meanings of lowercase keywords, but this can be confusing. If you are
interested, see the section on "overloading".
See `uppercase' in the index
if you really want to use your shift key.

</p>


<h1><a name="SEC3" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC3">A simple plot</a></h1>
<p>
<a name="IDX3"></a>

</p>
<p>
Let us assume that you have a file called <code>mydata</code>, which looks
like this:

</p><pre>This is an example file

1 1 1
2 4 8
3 9 27
4 16 64
5 25 125
6 36 216
7 49 343
8 64 512
</pre>

<p>
SM has a history mechanism, so
first type <code>DELETE 0 10000</code> to tell SM to forget any
commands that it has remembered. Then choose a device to plot on. You
do this with a command like <code>dev tek4010</code>. If you don't know what
to call your terminal, use the <code>LIST DEVICE</code> command, ask some local
expert, look at the description
of <code>DEVICE</code>, or (if desperate) read the manual (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">The Stdgraph Graphics Kernel</a>).
You'll know that
you have succeeded if typing <code>BOX</code> draws a box.

</p>
<p>
You should now have successfully chosen a graphics terminal. To actually
plot something, use the following set of commands. The text after the
<code>#</code> is a comment, you don't have to type this (or the <code>#</code>).

</p><pre>DATA mydata             # Specify desired datafile
LINES 3 100             # Choose which lines to use
READ i 1                # Read column 1 into `i'
READ { ii 2 iii 3 }     # Read column 2 into `ii' and 3 into `iii'
LIMITS i ii             # Choose limits, based on i and ii
BOX                     # Draw the axes
PTYPE 4 0               # Choose square point markers
POINTS i ii             # Plot i against ii
CONNECT i ii            # and connect the points
XLABEL This is i        # Label the X-axis
YLABEL This is ii       # And the Y
</pre>

<p>
<a name="IDX4"></a>

</p>
<p>
You should now have a graph. If you had wanted to plot the third
column instead of the second
you could have typed <code>LIMITS i iii POINTS i iii</code> instead.
And of course you could plot <code>ii</code> against <code>iii</code> as a third
alternative. You 
were not limited to only use squares as markers or solid lines to
connect them - see <code>PTYPE</code> and <code>LTYPE</code> for details.

</p>
<p>
If you want a logarithmic plot, SM makes that easy for you.
You can take logs of a vector using the <code>LG</code> (or <code>LN</code>) commands
on vectors; try it - <code>SET x=1,10 SET y=x**3 set ly=LG(y) LIMITS x ly
CON x ly box</code>. You might have wanted the axes to reflect the fact that you
had logged the y axis. The <code>TICKSIZE</code> command allows you to do this, and
this is in fact the commonest use of it. Try <code>TICKSIZE 0 0 -1 0</code>, and
then repeating the x-y plot.
<a name="IDX5"></a>

</p>

<p>
What if you want hard copy of your hard-earned graph? There is a
command (actually a macro) called <code>playback</code> which will repeat all
the commands that you have typed. Type <code>ERASE</code> to clear the screen, then
<code>HISTORY</code> to see the commands that you have issued. You probably
don't want the <code>ERASE</code> command to be repeated, so type <code>DELETE</code>
to delete it<a name="DOCF1" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT1">(1)</a>.
<a name="IDX6"></a>

</p>
<p>
If there are any other mistakes use <code>DELETE m n</code> to delete
the lines m to n containing them.
Now type <code>playback</code> and your plot should reappear. But we wanted a
hardcopy, so type <code>dev laser lqueue</code> (or whatever your friendly Guru
recommends as a hardcopy device), then <code>playback</code>. This time, those
plotting commands will appear on the laser printer not your terminal. To
make them actually appear, type <code>hardcopy</code> or issue another <code>
dev</code> command.
Be sure to say <code>dev tek4010</code> (or whatever device you chose)
before you read any more of this
document. It is possible to edit the playback buffer, rather than
simply deleting lines from within it. The section on `examples'
describes how to do this.

</p>
<p>
In fact, the same plot could have been produced from a data file which
just contained the first column. After saying <code>READ i 1</code>, you could
have said <code>SET ii = i*i SET iii = i**3</code> and proceeded from there, or
even skipped the file altogether by saying <code>set i = 1,8</code> instead of
<code>READ</code>ing it at all. Such possibilities, and a good deal more, are
described in greater detail in the rest of this manual.

</p>
<p>
What we just did was to define a simple `macro', in this case the
special one called <code>all</code> which <code>playback</code> manipulates. A more
explicit use of a macro would be to define a macro to square a vector,
that is to square each element of a vector.
To do this say<a name="DOCF2" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT2">(2)</a>

</p><pre>MACRO square 2 { SET $1 = $2*$2 } 
</pre>

<p>
So to calculate the vector <code>ii</code> we could now say

</p><pre>square ii i
</pre>

<p>
which is the same as saying

</p><pre>SET ii = i*i 
</pre>

<p>
So now that you have met macros, how do you save them? The simplest
and least reliable way is to use SM's history, and hope that
the next time that you use SM it remembers the <code>MACRO</code>
command that you used to define <code>square</code>, so you can re-issue it.
(Try exiting SM, then starting it up again and typing 
<code>HISTORY</code>, then <code>^nnn</code> where <code>nnn</code> is the number
which is next to the desired command in the resulting list.)
<a name="IDX7"></a>

</p>
<p>
A brute force way is to say <code>SAVE filename</code> which will save almost
all of your SM environment, to be recovered using the
<code>RESTORE filename</code> command at some later time, or later SM
session.
Specifically, <code>SAVE</code> will save all your macros, variables, and
vectors, along with your history buffer. This is a very convenient
way in practice but it does mean that you tend to carry around
lots of long-forgotten
macros, variables, and vectors.

</p>
<p>
Another way is to write the macros to a disk file, using the
<code>MACRO WRITE</code> command (see `Macros'). Then you can retrieve
your macros with <code>MACRO READ</code>. You should note that your macro
<code>all</code> will simply be a macro - to put it onto the history list
say <code>DELETE 0 10000 WRITE HISTORY all</code>. (Of course, you could
write a macro to do this for you).
Maybe saving your
playback buffer is something better done with <code>SAVE</code>, which will
restore your playback buffer, while
preparing files of useful macros is a use for <code>MACRO READ</code>.
Once the idea of macros gets into your blood, you can of course use
an editor to create your own files of macros, to be read with 
<code>MACRO READ</code>.


</p><h1><a name="SEC4" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC4">Facilities within the Command Interpreter</a></h1>

<p>
This is a guide to the use of SM variables, the macro processor,
the help command, and the history facilities.
The vector arithmetic and plotting facilities are described below.  Various
examples are scattered throughout the text, to give some guidance on the
use of SM's capabilities.
<a name="IDX8"></a>

</p>
<p>
Perhaps the most important thing to know is how to escape from
SM. If you have a prompt, simply type <code>QUIT</code><a name="DOCF3" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT3">(3)</a>.
If you are running some command, try <kbd>control-C</kbd> to get a prompt.
Most commands will eventually return control to the keyboard following a
<kbd>control-C</kbd>. In addition, the parser is reset, and the input buffer cleared.
Sometimes <kbd>control-C</kbd> leaves a } on the buffer if it thinks that it'll
help get back to the prompt, which can generate an irrelevant syntax error.
Occasionally it can still be confused -- try typing a few characters
and maybe a }.
<a name="IDX9"></a>

</p>
<p>
When you have interrupted SM with a <kbd>control-C</kbd>, a
macro called <code>error_handler</code> is executed, if it is defined. The one
that we provide does things like setting the expansion back to 1, and
resetting any window commands that you might have issued, and then
prints a message <code>handler...</code> to tell you that it's done its work.
If you don't like this, 
see `private initialisation' in the index for how to get your own
handler loaded automatically.
<a name="IDX10"></a>
<a name="IDX11"></a>
<a name="IDX12"></a>

</p>
<p>
If you make a mistake, and SM notices a syntax error, it'll
print a message indicating where you were and which macro you were
running. It is possible for the wrong macro to be reported (if
SM has finished reading the macro before detecting the error),
in which case you'll be told that the error occurred in a macro that
called the offender. Setting <code>VERBOSE</code> (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN77">Verbose</a>)
to 3 or 4 provides a
more direct way of finding the true location of the error.
<a name="IDX13"></a>
<a name="IDX14"></a>

</p>
<p>
If you define the variable <code>traceback</code> to be 1 (maybe with the line
<code>traceback 1</code> in your <tt>`.sm'</tt> file)
<a name="IDX15"></a>
<a name="IDX16"></a>
<a name="IDX17"></a>
you'll get a traceback of what macros were active when the error occurred;
the same caveats about the wrong macro being reported apply.
In addition, the usual interrupt capabilities of your operating system will
work under SM, with a couple of quirks.
<a name="IDX18"></a>

</p>
<p>
Under Unix, in case of emergency, type <kbd>control-\</kbd>, and SM
will ask you if you want to return to the prompt, and if you
don't it'll offer a core dump, and then exit. As
usual, typing <kbd>control-Z</kbd> (from the C-shell) will interrupt the process, which may
be restarted later.
Under VMS, <kbd>control-Z</kbd> will interrupt SM, and return you to the command
interpreter (DCL). Typing <code>CONTINUE</code> will then allow you to restart
SM<a name="DOCF4" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT4">(4)</a>.
<a name="IDX19"></a>
<a name="IDX20"></a>

</p>
<p>
If SM is running in a SPAWNed sub-process, then <kbd>control-Z</kbd> will
reATTACH you to its parent. To continue SM, use the DCL ATTACH
command.
We strongly suggest that you learn how to do this, it makes life much
easier -- all you have to do is SPAWN a process from DCL and start SM
from there.  Do check with your VMS system manager to ensure that you have the
right quotas for SPAWNing (Process limit must be at least 3, because SM
will use one for itself and one for hardcopies). An especially simple
way to do all this is is to use the command file <tt>`kept_SM.com'</tt> in the
main SM directory. It'll handle the spawning and attaching for you.
<a name="IDX21"></a>

</p>
<p>
Another fact to bear in mind is that the characters <kbd>^</kbd>, <kbd>$</kbd>, and
<kbd>#</kbd> are special, as <kbd>^</kbd> is used by the history system, 
<a name="IDX22"></a>
<a name="IDX23"></a>
<a name="IDX24"></a>
<a name="IDX25"></a>
<a name="IDX26"></a>
<a name="IDX27"></a>
<kbd>$</kbd> introduces a
variable, and <kbd>#</kbd> starts a comment.  The special meanings of all of 
these characters
except ^ can be turned off by preceding them with a \. To type a ^,
use the quote_next character
(initially <kbd>control-Q</kbd> or ESC-q) to quote the ^; i.e. type
<code>ESC-q</code>.<a name="DOCF5" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT5">(5)</a>
A <code>\n</code> is interpreted as a carriage return, and a <kbd>\</kbd> as the
last character on a line escapes the newline, so that the line and the one
following it are treated as one long line.
A <kbd>\</kbd> preceding any other character
(except a <kbd>"</kbd>; see next paragraph) is simply a <kbd>\</kbd>.  This character
is used to set font types in the <code>LABEL</code> commands, so it has no 
special meaning to the command interpreter, which simplifies the entering of
strings for <code>LABEL</code> commands.

</p>
<p>
<a name="IDX28"></a>
A further problem is that symbols such as <kbd>+</kbd>, <kbd>-</kbd>, <kbd>*</kbd>,
and <kbd>/</kbd> are used
to separate words, which is what you want for mathematics, but maybe not what
you had in mind for filenames.
<a name="IDX29"></a>
<a name="IDX30"></a>
<a name="IDX31"></a>
<a name="IDX32"></a>
Enclosing a word
in double quotes turns off all special meanings except <kbd>^</kbd>; an embedded
<kbd>"</kbd> may be escaped with a <kbd>\</kbd>.
Single quotes are used quite differently; enclosing a word in 'single quotes'
makes it into a string so <code>'12'</code> is a two-character string and not
an integer at all. There are times when this is important; for example
<code>if(y == 'yes')</code> tests if the vector <code>y</code> is equal to the
string `yes', whereas <code>if('yes' == 'yes')</code> asks whether two
identical strings are equal (they are). When you remember that I can
legally say <code>set yes='no'</code> you'll appreciate the distinction.
<a name="IDX33"></a>
<a name="IDX34"></a>

</p>
<p>
The characters <code>{}</code> also perform quoting, turning off the special
meanings of all characters (including single and double quotes, but not
<code>^</code>). The difference between double quotes and braces is that
the latter have grammatical value; they are part of the syntax that
SM understands. In most cases you can use angle brackets instead of
curly ones if the grammar needs the brackets but you don't want to
turn off expansions (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC5">String Variables</a>).
<a name="IDX35"></a>
<a name="IDX36"></a>

</p>
<p>
SM is case-sensitive. It will
accept keywords in either upper or lower case, but this is a special
dispensation on its part. If you insist on typing in uppercase say
<code>load uppercase</code> when you first start SM, or put the line
<code>uppercase 1</code> in your <tt>`.sm'</tt> file.
<a name="IDX37"></a>
Furthermore keywords may not be abbreviated.
This is not a great hardship as it is easy to define macros which
make the minimum abbreviation a synonym for the full command. Many such
macros are predefined for you when you first use SM; see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC63">The System Macro Libraries</a>
for details.  In particular, certain common
abbreviations of  commands have been predefined by the 
SM startup file.
<a name="IDX38"></a>
<a name="IDX39"></a>
<a name="IDX40"></a>

</p>
<p>
Every time that SM is started, it looks for an environment file
called <tt>`.sm'</tt> which consists of names of variables and their
values. From # to the end of a line is taken to be a comment. A list
of directories to be searched in order for <tt>`.sm'</tt> files
is compiled into SM, it usually
consists of the current directory, then your home directory, and then
some system directory. The system default can be over-ridden by
defining the environment variable <code>SMPATH</code> which is
a list of directories separated by single spaces. Each directory on the
search path is tried in turn until a file is found containing the desired
variable, which allows your choices to take preference over those of the
system administrator. In the list of directories
<code>.</code> is taken to be the current directory, and <code>~</code> is 
your home directory unless you specified a command line <code>-u name</code>
option, in which case it is taken to be name's home directory instead. This
means that <code>sm -u name</code> will usually run SM as if you were <code>name</code>.
If <code>name</code> is <code>null</code>, then SM won't look for a <tt>`.sm'</tt> file in
anyones home directory.
<a name="IDX41"></a>
<a name="IDX42"></a>
<a name="IDX43"></a>
The default path is equivalent to an <code>SMPATH</code> of

</p><pre>export SMPATH=". ~ /u/sm/lib/"
</pre>

<p>
(or an equivalent incantation). Note
that the directory <code>/u/sm/lib/</code> ends in a <code>/</code> so that a filename
can be directly appended (on a VMS system it would probably end in a <code>:</code>
or <code>]</code>).
<a name="IDX44"></a>
<a name="IDX45"></a>

</p>
<p>
An example file would be (the filenames are written in Unix)

</p><pre># I'm a comment line
fonts       /users/sm/fonts.bin
graphcap    /users/sm/graphcap
help        /users/sm/help/
macro       /users/sm/macros/
name        Robert         # Or alternatively `Dr._Lupton'
</pre>

<p>
<a name="IDX46"></a>
<a name="IDX47"></a>
The <code>fonts</code> file contains the SM fonts (in a binary form),
<a name="IDX48"></a>
<a name="IDX49"></a>
the <code>graphcap</code> entry is used to
define the file used to describe graphics terminals (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">The Stdgraph Graphics Kernel</a>),
<a name="IDX50"></a>
<a name="IDX51"></a>
<code>help</code> is the directory used by the help command,
<a name="IDX52"></a>
<a name="IDX53"></a>
<code>macro</code> is the default directory where macros reside,
<a name="IDX54"></a>
and <code>name</code> is what SM will call you (you can put spaces
into your name by using underscores, e.g. <code>My_Lord</code> will be
referred to as <code>My Lord</code>).
You can access
entries in the environment file yourself, as described
in the section on variables. See the section section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC63">The System Macro Libraries</a>
to see how entries in the <tt>`.sm'</tt> file are used to influence the 
behaviour of SM, or consult your local expert. You might want
to borrow someones <tt>`.sm'</tt> file when you first use
SM, although you should do fine without one. For more detail, and
further special entries, see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN23">Environment Variables</a>.
<a name="IDX55"></a>
<a name="IDX56"></a>
The name of the <tt>`.sm'</tt> file can be specified on the command line as
"<code>-f name</code>" or you can ask to use <code>name</code>'s .sm file with
<code>-u name</code>.
VMS users should ensure that SM has been installed
as a foreign command to take advantage of these capabilities.
<a name="IDX57"></a>

</p>
<p>
<a name="IDX58"></a>
<a name="IDX59"></a>
<a name="IDX60"></a>
SM then tries to read in any macros
in the file <tt>`default'</tt> in the directory <tt>`macro'</tt>
and attempts to execute the macro <code>startup</code> if it exists.
<a name="IDX61"></a>
<a name="IDX62"></a>
If <code>-m filename</code> appears on the command line, this is taken to be the
name of another file of macros and these are read, and the eponymous macro
is executed (after any pre- or suf- fix has been removed. For instance if
you start
SM with the command <code>sm -m /home/tst.m</code>, it will first read
the file <code>/home/tst.m</code>, and then attempt to execute the
macro <code>tst</code>).<a name="DOCF6" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT6">(6)</a>
<a name="IDX63"></a>
<a name="IDX64"></a>

</p>
<p>
Anything left on the command line is treated as if it had been typed
at the prompt, for example <code>sm restore vital.save</code> will start
by <code>RESTOR</code>ing from the file <code>vital.save</code> (see <code>RESTORE</code>
if you want to know what this means). The <code>-m</code> option is not
really a good way to personalise SM. The <code>startup</code> macro
discussed under `useful macros', which is run every time that you start
SM, looks for a directory <code>macro2</code> in your <tt>`.sm'</tt>
file, and if it is there reads a file <tt>`default'</tt> from it, and
executes the macro <code>startup2</code> which it expects to find there.
On case-insensitive operating systems, such as VMS, you may need to
quote the command line to prevent it being translated to upper case.
SM then
<a name="IDX65"></a>
attempts to read a set of history commands from a file in
the current working directory, passes control to the input routine
and issues a prompt.
The file is given by the entry <code>hist_file</code> in your <tt>`.sm'</tt>
file, and if it isn't present then no history will be remembered.
<a name="IDX66"></a>

</p>
<p>
You are then able to type commands, as many as
will fit on one line<a name="DOCF7" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT7">(7)</a>,
and use the features described below.

</p>
<p>
You can use a combination of these features to run SM in `batch' mode.
If you had a history file that you just wanted to run, then you could
start SM, say <code>playback</code>, and quit. You could have a macro
called <code>batch</code> in <code>batch.m</code> that did just that, and say
<code>sm -m batch.m</code> to execute it. In fact, you don't even need your own
macro as one is pre-defined for you so <code>sm batch</code> is sufficient.
You could write your own macros along this lines to do more complex tasks.
<a name="IDX67"></a>
A more convenient alternative (under unix) would be <code>sm -S &lt; history_file</code>
where the <code>-S</code> is explained in the next paragraph.

</p>
<p>
For completeness, we should mention the other command line flags,
<code>-h</code>, <code>-l logfile</code>, <code>-n</code>, <code>-q</code>,
<code>-s</code>, <code>-S</code>, <code>-v#</code>, and <code>-V</code>.
<a name="IDX68"></a>
<a name="IDX69"></a>
<a name="IDX70"></a>
<a name="IDX71"></a>
<a name="IDX72"></a>
<a name="IDX73"></a>
The <code>-h</code> prints a summary of command line options,
if you specify a logfile with <code>-l</code> everything that you type at the
keyboard is copied into the logfile (except editing commands). When you
start SM it usually runs a macro <code>startup</code>; <code>-n</code> prevents this.
The <code>-s</code> (for `stupid', or `silent' or `suppress') flag disables the
command line editor (although the history list is still saved, so commands
like <code>playback</code> will work),
<code>-q</code> suppresses the initial `Hello' message,
and <code>-S</code> is like <code>-s</code> but it also suppresses the prompt
and stops SM from intercepting <kbd>control-c</kbd>. You can get the same effect
as <code>-s</code> from inside SM with the command <code>TERMTYPE none</code>.
If you are reading from a file or pipe SM behaves as if you had
invoked it with the <code>-S</code> flag.
<a name="IDX74"></a>
This is useful if SM is 
being run from inside another programme, via a pipe (VMS: mailbox), or
on a <em>very</em> stupid terminal.
<a name="IDX75"></a>
If you want to set a particular value of verbose, use <code>-v</code> for example
<code>-v-3</code> is equivalent to the <code>VERBOSE -3</code> command given interactively.
If you want to know SM's version string without starting SM, you can use
the <code>-V</code> flag.

</p>


<h1><a name="SEC5" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC5">String Variables</a></h1>
<p>
<a name="IDX76"></a>
<a name="IDX77"></a>

</p>
<p>
Some SM users seem to be confused by variables and vectors; if you are one
of these, the section on quoting (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC26">What Quotes What When</a>) might help.

</p>
<p>
SM maintains a set of variables which are defined with one of the statements

</p><pre>DEFINE name value
</pre>

<p>
or

</p><pre>DEFINE name { value_list }
</pre>

<p>
or

</p><pre>DEFINE name ( expression )
</pre>

<p>
where <code>name</code> must consist of digits, letters and `_' (but must not start
with a digit), and may be a keyword.
<a name="IDX78"></a>

</p>
<p>
<code>Value</code> may be a word or a number. <code>Value_list</code> has no such
restrictions
and may contain many words. Note that due to the presence of the {},
variables are not expanded (i.e. replaced by their value) in <code>value_list</code>,
whereas they are in <code>value</code>. In fact, the list can be delimited by
<code>&lt;&gt;</code> rather than <code>{}</code>; see <code>DEFINE</code> for details.

</p>
<p>
The expression in <code>DEFINE variable ( expr )</code> should be
a scalar; if it is not, the first element of the vector will be used and
you will be warned, if <code>VERBOSE</code>
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN77">Verbose</a>) is one or greater.
<a name="IDX79"></a>
Sometimes you just want to evaluate an expression and treat the answer
as a string; in this case use the special vector form <code>$(expr)</code>
which is replaced by the value of the expression -- for example
<code>echo e is $(exp(1))</code>.
Expressions are further discussed under `Vectors and Arithmetic'.

</p>
<p>
There are a number of special variables whose value is always the current
value of some internal SM variable such as the current position or the
point type. The variable "date" is also special and expands to give
the current time and date, -- try typing <code>echo $date</code>. You can freeze
these variables at their current value by saying <code>define name |</code>
(see below).
<a name="IDX80"></a>
<a name="IDX81"></a>

</p>
<p>
Each time SM reads <code>$name</code> it replaces it by its
value, considered as a character string. For example,

</p><pre>DEFINE hi hello
WRITE STANDARD $hi
</pre>

<p>
will print <code>hello</code>. This expansion is done before even the lowest level
of lex analysis, so if a command is attempting to read a value
it is possible to give it the name of a SM variable. An example
would be the <code>XLABEL</code> command, which writes a string as the x-axis label
of a graph,

</p><pre>DEFINE name Aelfred
</pre>


<pre>XLABEL My name is $name
</pre>

<p>
will invoke the <code>XLABEL</code> command, and write <code>My name is Aelfred</code> below
the x-axis. (Incidentally, <code>DEFINE Aelfred Aethelstan YLABEL $$name</code>
will write <code>Aethelstan</code> as the y-axis label, which can be handy in macros.
The use of the double $$ indicates to SM to do a double
translation, as it first expands to <code>$Aelfred</code> which then expands to
<code>Aethelstan</code>).

</p>
<p>
<a name="IDX82"></a>
A variable can be deleted by <code>DEFINE name DELETE</code> so for example the macro

</p><pre>MACRO undef 1 { DEFINE $1 DELETE }
</pre>

<p>
invoked as

</p><pre>undef name
</pre>

<p>
will undefine the variable <code>name</code> (see the section on macros if you are
confused). 

</p>
<p>
<a name="IDX83"></a>
<a name="IDX84"></a>
<a name="IDX85"></a>
<a name="IDX86"></a>
There are also three special <code>values</code>, <code>:</code>, <code>|</code>, and
<code>?</code>. The command <code>define name :</code> means `get the
value of name from the environment file'. If this fails, and if the
variable is all uppercase, SM will then try to use the value of an
environment (VMS: logical) variable of the same name.
Using <code>define name ?</code> means
`read the value of name from the keyboard'. You can specify a prompt to be
used, see <code>DEFINE</code> for details.
The form with <code>|</code> has changed a little with version 2.1.1. The variables
that you can use with <code>|</code> have not changed, but their usage has
slightly. They are all defined for you when SM starts and each is always
correct, tracking the current value of the corresponding internal variable.
For example, try <code>echo $angle angle 45 echo $angle</code>. If you now
say <code>define angle |</code>, <code>$angle</code> will cease to track the internal
value and will remain fixed (the same effect can be achieved with
<code>define angle 45</code>). When you say <code>define angle delete</code> it will
once more track the internal value. Your old code will continue to work,
but in many cases it is possible to remove the explicit definition
with <code>|</code>. This special sort of variable will not be <code>SAVE</code>d,
and will not show up if you list the currently defined variables.
A list of the <code>|</code> variables is given in the section on <code>DEFINE</code>.

</p>
<p>
So using the example <tt>`.sm'</tt> environment file listed in the previous
section of the manual, <code>DEFINE name :</code> will define
<code>name</code> to be <code>Robert</code>, <code>DEFINE angle |</code> will give the last
value set by the <code>ANGLE</code> command, and <code>DEFINE datafile ?</code> will ask you
for the value of `datafile', which can be useful in macros. For example,

</p><pre>DEFINE noise ? { Ring bell? } IF('$noise' != 'n') { bell }
</pre>

<p>
will execute the macro <code>bell</code> if you type anything but n in reply
to the question `Ring bell?'.

</p>
<p>
<a name="IDX87"></a>
<a name="IDX88"></a>
When writing macros, it is also sometimes useful to know if a variable
has been defined. The variable <code>$?name</code> has the value 1 if <code>name</code> 
is defined, otherwise it is 0. For instance, there is a line

</p><pre>define term : if($?term) { termtype $term } 
</pre>

<p>
in the startup file, to set a termtype if present in the environment
file.

</p>
<p>
<a name="IDX89"></a>
There are also commands to read the values of variables from data
files defined with the <code>DATA</code> command.
</p><dl compact="compact">

<dt><code>DEFINE name READ i</code>
</dt><dd>
or
</dd><dt><code>DEFINE name READ i j</code>
</dt><dd>
</dd></dl>
<p>
will set <code>name</code> to be the i'th line of the file (or the j'th word
of the i'th line). An example is given in the section on `useful macros'.
You can read variables from the headers of binary files (specified
with the <code>IMAGE</code> command) using
<code>DEFINE name IMAGE</code>, although this is only supported for a limited
class of <code>file_type</code>'s (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC57">Two-Dimensional Graphics</a>).

</p>
<p>
All currently defined variables may be listed with
<a name="IDX90"></a>
<a name="IDX91"></a>

</p><pre>LIST DEFINE [ begin end ]
</pre>

<p>
where the optional <code>begin</code> and <code>end</code> define the range of variables
(alphabetically) to be listed. You might prefer to use the macro <code>lsv</code>
which won't appear on your history list.

</p>
<p>
<a name="IDX92"></a>
Variables are usually not expanded within double quotes or { }. If
for some reason you need to force expansion within double quotes, it can be
done with <code>$!name</code>.
<a name="IDX93"></a>
The macro `load' discussed under useful macros gives an
example of this mechanism. If you need to expand a variable, with no questions
asked (and even within {}), use <code>$!!name</code>.

</p>
<p>
<a name="IDX94"></a>
Sometimes you may want to terminate a variable name where SM doesn't
want to, and this can be done with a trick involving
double quotes. Say you are writing a macro to find all the stars redder
than B-V = 1.0 in a set of data vectors, and you want to rename them with
a trailing "_red", so <code>star</code> goes to <code>star_red</code>. So you 
write a foreach loop,

</p><pre>FOREACH x ( U B V R I J K ) { SET $x_red = $x IF(B-V &gt;1)}
</pre>

<p>
Well, that won't work because SM thinks that you are referring
to a previously defined variable named <code>x_red</code>, so it will
complain that <code>x_red</code> is not 
defined. But if you write it as <code>$x""_red</code> the <code>""</code> separate
the <code>x</code> from the <code>_red</code> until <code>$x</code> is expanded,
and then disappear, and all is well. When a variable is read, SM
skips over all whitespace before the definition, and this can cause
problems if you hit <kbd>control-C</kbd> in the middle, as the rest of the command
will be thrown away. If you ever hit a <kbd>control-C</kbd>, and can't get a
prompt, try typing any non-whitespace character.
<a name="IDX95"></a>

</p>
<p>
<a name="IDX96"></a>
<a name="IDX97"></a>
Variables are <em>string</em>-variables, and are not primarily designed
for doing arithmetic (that's what vectors are for). This is a common source
of confusion so let's consider some examples (at the risk of anticipating
some later sections of the manual).

</p><pre>DEFINE a 12
</pre>

<p>
defines a variable <code>a</code> which consists of the two characters `1' and `2',
and which can be used <em>anywhere</em> -- for example
<code>xlabel $a</code>. What about vectors? Consider

</p><pre>SET x=10
</pre>

<p>
which defines a single-element vector whose value is ten, ready to be used in
expressions such as

</p><pre>SET y=$a + x*12
</pre>

<p>
Note that the <code>$a</code> is <em>still</em> just the two characters `1' and `0',
but in this context that is interpreted as the number ten. So what does

</p><pre>DEFINE y $a+x*12
</pre>

<p>
do? Well, actually it results in a syntax error (the `+' ends a word), so try

</p><pre>DEFINE y &lt;$a+x*12&gt;
</pre>

<p>
This defines the variable <code>y</code> as the string `10+x*12', it doesn't evaluate
the expression. You can evaluate the expression if you want with

</p><pre>DEFINE y ( $a+x*12 )
</pre>

<p>
which defines <code>y</code> as the string `130'. Incidently, you can sometimes get
away without an explicit variable with the syntax <code>$($a+x*12)</code> which
also expands to the string `130'.

</p>
<p>
The fact that variables are simply strings can be used to build complex
commands; consider for example the macro

</p><pre>readem          # read multiple lines columns with names in row 1
                READ ROW names 1.s
                DEFINE rc &lt;$(names[(0)]) 1&gt;
                DO i=2,DIMEN(names) {
                        DEFINE rc &lt;$rc $(names[($i - 1)]) $i&gt;
                }
                LINES 2 0
                READ &lt; $rc &gt;
</pre>

<p>
<a name="IDX98"></a>
which reads the names of a set of columns from line 1, builds a command
to read the data in the variable <code>rc</code>, and then reads all the data
in one command. You could of course loop through <code>names</code> reading
each column in turn, but this should be a good deal faster.

</p>
<p>
By default variables are global, so if you have a variable <code>$i</code>, and
a macro that you call also uses a variable <code>$i</code>, the macro will change
the value that you so carefully defined. To avoid this, it is possible to
force variables (and also vectors) to be local, using a command like
<code>DEFINE i LOCAL</code>; in this case the variable <code>$i</code> will softly and
suddenly disappear when you leave the current macro (and therefore you
cannot make variables local at the topmost level, i.e. at the command prompt).
In fact, such variables aren't strictly local, they have what's called
nested scope, as they are visible from any macros that you may call -- they
simply do not propagate backwards up the call stack. You are free to make
a variable local in any (or all) macros, there's no restriction on how
deep such local declarations may be nested.
<a name="IDX99"></a>

</p>


<h1><a name="SEC6" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC6">Command History</a></h1>
<p>
<a name="IDX100"></a>

</p>
<p>
It is often very useful to be able to repeat a command, or perhaps correct
a mistake in what you have just typed. Ways of doing this are usually
referred to as `history', and SM has two distinct mechanisms.
One is very similar to that of the Unix C-Shell,
and the other allows you to edit commands using a syntax similar to the popular
editor `emacs', or a generalisation of the DCL history under VMS.
If you are not familiar with Unix, emacs, or VMS don't despair; a
description of the commands and how to invoke them follows in this
document.
Both of these mechanisms are implemented by the routine which reads input
lines. As each line is sent to the parser, it is copied onto a
history list. This list may be printed with <code>HISTORY</code>, and
the commands may be
<a name="IDX101"></a>
<a name="IDX102"></a>
re-used by referring to them by number, as <code>^nn</code>, or by a unique
abbreviation, as <code>^abbrev</code>. In addition, the last command may be
repeated by using <code>^^</code> and the last word of the last command by
<code>^$</code>.<a name="DOCF8" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT8">(8)</a>
These symbols are expanded as soon as they are recognised (see examples,
or experiment), and are then available for modification by the editor.
Sometimes a <code>^string</code> will retrieve a command beginning
<code>string</code>, but not the one that you want. Version 2.1.1 no longer
supports the use of <code>^TAB</code>
to search for the next-most-recent command beginning <code>string</code>,
but you can use the search commands (<kbd>control-R</kbd> and <kbd>control-S</kbd>) instead.
Some people really don't want <code>^</code> to be their
history character, either because they're used to something else (such
as !), or because they want to type lots of real <code>^</code>s (e.g. you are using
TeX-style strings); if this describes you, rebind them -- see the next
section.
If you are considering the history list as a sort of programme to be
repeated you may think that <code>HISTORY</code> lists the commands in the
wrong order; if so use <code>HISTORY -</code>.
<a name="IDX103"></a>

</p>

<p>
For example, if I type:

</p><pre>PROMPT @
echo I like SM
HISTORY
</pre>

<p>
SM will set the prompt to be <code>@</code>, replace the macro <code>echo</code> by
its value <code>WRITE STANDARD</code> and print

</p><pre>I like SM
</pre>

<p>
and then 

</p><pre>3   HISTORY
2   echo I like SM
1   PROMPT @
</pre>

<p>
(The actual numbers will be different, depending on what other commands
you have executed, and also because SM may have read a history
file. In that case
there'll be many more commands on the list, but no matter.) If I then type 

</p><pre>^2 &lt;CR&gt;
</pre>

<p>
(that is ^2 not control-2)
the screen will look like 

</p><pre>@ echo I like SM
I like SM
</pre>

<p>
as if I had just typed it in (<code>@</code> is the prompt) . Typing 

</p><pre>^^ (Yes, ^$ ) &lt;CR&gt;
</pre>

<p>
will now result in SM printing (truthfully)

</p><pre>I like SM (Yes, SM )
</pre>

<p>
<a name="IDX104"></a>

</p>
<p>
It is possible to delete commands from the history buffer with the
<code>DELETE</code> command. If the command is given with zero, one, or two
arguments, then
the specified range is deleted (but their numbers are not re-used). If
no arguments are given, the last command on the buffer is deleted, and
its number is released to be re-used. In other words, the command
<code>DELETE</code> will delete first itself, and then the
previous command from the history list. The command <code>DELETE HISTORY</code>
only removes itself from the history list, and
several of the common commands are defined as macros which use it,
for instance <code>dev</code> is defined as 
<code>DELETE HISTORY DEVICE</code>. This means that the command will not
appear on the history list, to confuse you when you do a playback. But
if you now innocently use <code>dev</code> in a macro, that macro won't appear
on the list either. Still worse, if you use <code>dev</code> twice in one
macro, the previous command will be deleted as well which could be quite
confusing.
<a name="IDX105"></a>
<a name="IDX106"></a>
You can also delete lines of history using <code>ESC-<kbd>control-D</kbd></code> as
described shortly.

</p>
<p>
The numbering is consecutive, starting at zero. Each command retains its
number until you use a <code>HISTORY</code> command to list the remembered
commands, in which case they are all renumbered, and it is these new numbers
that are listed.

</p>
<p>
By default only 80 lines are remembered,
and as you continue typing earlier
ones fall off the list.
<a name="IDX107"></a>

</p>
<p>
Because the history buffer is also used to compose complex commands, this
limit can be aggravating. You may be able to defeat this by
putting many commands on 
each line (you may have to use <code>\n</code> to terminate label
commands explicitly) 
or by writing macros. Alternatively you can define a longer history buffer
when you start SM by including an entry <code>history</code> in your
environment file
<a name="IDX108"></a>

</p>
<p>
which gives the number of commands to be remembered. If you set
<code>history</code> to be <code>0</code> the history list is made infinitely long.
Incidently, it is
the total 
number of commands that matters, not the range of history
numbers present.

</p>
<p>
This limit on the number of history lines isn't enforced while writing a
macro onto the history list (using <code>WRITE HISTORY</code>). You can
use this fact to write a sneaky macro that extends your history; type
<code>HELP extend_history</code> if you are interested.
<a name="IDX109"></a>
<a name="IDX110"></a>

</p>
<p>
Some people seem to like their history editors to remember where they were,
so that after they retrieve and execute a command the next <kbd>control-P</kbd>
or
will retrieve the command one further back on the
history list (that is, if you have just retrieved command number 123
and executed it as command number 234, then <kbd>control-P</kbd> will get you
command number 124; you can execute it as command number 235). If
this describes you, define the variable <code>remember_history_line</code>,
which you can either do directly, or by putting a line
<code>remember_history_line   1</code> in your <tt>`.sm'</tt> file.
<a name="IDX111"></a>
<a name="IDX112"></a>
<a name="IDX113"></a>

</p>
<p>
The editor allows you to modify commands, either as you type them or
as you retrieve them from the history list. The various editing
commands may be bound to keys of your choosing, but the default
bindings are given in this list of possible commands:
<a name="IDX114"></a>
<a name="IDX115"></a>
</p><dl compact="compact">

<dt><code><kbd>control-A</kbd></code>
</dt><dd>
Go to start of line.
</dd><dt><code><kbd>control-B</kbd></code>
</dt><dd>
Go back one character. (Equivalent to
).
</dd><dt><code><kbd>control-C</kbd></code>
</dt><dd>
Interrupt (as usual).
</dd><dt><code><kbd>control-D</kbd></code>
</dt><dd>
Delete character under cursor.
</dd><dt><code><kbd>control-E</kbd></code>
</dt><dd>
Go to end of line.
</dd><dt><code><kbd>control-F</kbd></code>
</dt><dd>
Go forward one character. (Equivalent to
).
</dd><dt><code><kbd>control-H</kbd></code>
</dt><dd>
Identical to <kbd>control-?</kbd> (DEL). Delete character to left of cursor.
</dd><dt><code><kbd>control-I</kbd> (TAB)</code>
</dt><dd>
Insert spaces up to the next tab stop. By default a tab
is taken to be 8 characters wide, but this may be changed by specifying
<code>tabsize</code> in your <tt>`.sm'</tt> file.
<a name="IDX116"></a>
</dd><dt><code><kbd>control-J</kbd> (LF)</code>
</dt><dd>
Equivalent to <kbd>control-M</kbd>.
</dd><dt><code><kbd>control-K</kbd></code>
</dt><dd>
Delete to end of line. The deleted string is stored,
and may be restored using <kbd>control-Y</kbd>, repeatedly if so desired.
</dd><dt><code><kbd>control-L</kbd></code>
</dt><dd>
Redraw the current line.
</dd><dt><code><kbd>control-M</kbd> (CR)</code>
</dt><dd>
Send line to be executed. Some terminals seem to replace
<kbd>control-M</kbd> with a linefeed (<kbd>control-J</kbd>), thereby making it impossible to make
SM obey you. We therefore make <kbd>control-@</kbd> equivalent to <kbd>control-M</kbd> for
emergency use. (This is control-space on many terminals).
<a name="IDX117"></a>
</dd><dt><code><kbd>control-N</kbd></code>
</dt><dd>
Get the next command on the history list, if it exists
(see <kbd>control-P</kbd>). (Equivalent to
).
</dd><dt><code><kbd>control-O</kbd></code>
</dt><dd>
Execute the previous command on the history list.
Equivalent to <kbd>control-P</kbd><kbd>control-E</kbd><kbd>control-M</kbd>.
</dd><dt><code><kbd>control-P</kbd></code>
</dt><dd>
Get the previous command on the history list, if it exists
(see <kbd>control-N</kbd>).(Equivalent to
).
</dd><dt><code><kbd>control-Q</kbd></code>
</dt><dd>
Quote next character; Turn off any special significance to
the editor. <kbd>control-Q</kbd> is often used by the terminal, so we have defined
<kbd>control-[</kbd>-q (that is escape followed by q) as an alternative.
</dd><dt><code><kbd>control-R</kbd></code>
</dt><dd>
Search backwards (reversed) for a string; the opposite of
<kbd>control-S</kbd>. The `string' can actually be any regular expression (see the
manual entry for <code>APROPOS</code>). If you specify a zero-length string
(i.e. simply hit carriage return) the previous search string will be reused.
</dd><dt><code><kbd>control-S</kbd></code>
</dt><dd>
Search forward for a string; the opposite of <kbd>control-R</kbd>.
<kbd>control-S</kbd> is often used by the terminal, so we have defined
<kbd>control-[</kbd>-s (that is escape followed by s) as an alternative.
</dd><dt><code><kbd>control-T</kbd></code>
</dt><dd>
Toggle insert/overwrite. By default, characters are
inserted before
the cursor. If overwrite is set, they replace the character under the
cursor. Note that ESC-u will not correctly restore words deleted
with ESC-d in overwrite mode.
</dd><dt><code><kbd>control-U</kbd></code>
</dt><dd>
Delete from the cursor to the start of the line.
</dd><dt><code><kbd>control-V</kbd></code>
</dt><dd>
Go forward 5 lines.
</dd><dt><code><kbd>control-W</kbd></code>
</dt><dd>
Delete the previous word. Identical to ESC-h
</dd><dt><code><kbd>control-Y</kbd></code>
</dt><dd>
Insert the string most recently deleted with <kbd>control-K</kbd> after the cursor.
</dd><dt><code><kbd>control-Z</kbd></code>
</dt><dd>
Return to the operating system, without killing
SM. (Under VMS, if you are running SM in a spawned
subprocess <kbd>control-Z</kbd> will attach you to DCL. Otherwise, SM returns you
to DCL.)
</dd><dt><code><kbd>control-?</kbd> (DEL)</code>
</dt><dd>
Equivalent to <kbd>control-H</kbd>.
</dd><dt><code>ESC-<kbd>control-D</kbd></code>
</dt><dd>
Delete this line and remove it from the history list.
Note that this is different from just clearing a line with (e.g.) <kbd>control-U</kbd>,
which only erases a <em>copy</em> of the line.
</dd><dt><code>ESC-&lt;</code>
</dt><dd>
Go to the first line of a macro, or the oldest history command.
</dd><dt><code>ESC-&gt;</code>
</dt><dd>
Go to the last line of a macro, or the most recent history command.
</dd><dt><code>ESC-g</code>
</dt><dd>
Go to a given line of a macro, or a given history
command. You'll be prompted for the line number, if you change your mind
you can get out with DEL or <kbd>control-H</kbd>.
</dd><dt><code>ESC-q</code>
</dt><dd>
Quote the next character, turning off any special
significance to the editor. Identical to <kbd>control-Q</kbd>.
</dd><dt><code>ESC-s</code>
</dt><dd>
Search forward for a string. Identical to <kbd>control-S</kbd>.
</dd><dt><code>ESC-v</code>
</dt><dd>
The opposite of <kbd>control-V</kbd>, go back 5 lines.
</dd><dt><code>ESC-y</code>
</dt><dd>
Like <kbd>control-Y</kbd>, except that it gets older deletions, cycling
back through a collection of (currently 5) deleted lines.
</dd></dl>

<p>
Some ESC-letter combinations are available which operate
upon complete words. A word is defined as a whitespace delimited
string, so 2.998e8 is a perfectly good word. In addition, it is possible
to undelete words that have been deleted with an ESC-d or ESC-h.
</p><dl compact="compact">

<dt><code>ESC-b</code>
</dt><dd>
Go to the start of the previous word.
</dd><dt><code>ESC-d</code>
</dt><dd>
Delete to the beginning of the next word. 
</dd><dt><code>ESC-f</code>
</dt><dd>
Go to the beginning of the next word.
</dd><dt><code>ESC-h</code>
</dt><dd>
Delete back to the beginning of the current word.
The same as <kbd>control-W</kbd>.
</dd><dt><code>ESC-u</code>
</dt><dd>
Restore the last word deleted, putting it before the
cursor. Further <code>ESC-u</code>'s will restore more words. When no more are
available, the bell is rung.
</dd></dl>

<p>
Any printing character is inserted before the cursor (unless overwrite
has been set with <kbd>control-T</kbd> ). Illegal characters ring the terminal bell.
If you insert a non-printing character on a line, the cursor may get confused.
<a name="IDX118"></a>

</p>
<p>
If ever you are stuck at the command interpreter, and you want to send
a signal to the operating system (e.g. a <kbd>control-Y</kbd> to DCL), but
SM is catching the key and using it for its own purposes, the
easiest thing to do is to define a macro such as 
<code>MACRO aa {aa} </code>, and then run it. While it is running (i.e.
until you type <kbd>control-C</kbd>) keys should have their usual functions.

</p>


<h1><a name="SEC7" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC7">Changing Key-Bindings</a></h1>
<p>
<a name="IDX119"></a>

</p>
<p>
As mentioned above, it is possible to redefine the meanings of keys to
the history (and macro) editor.
The command <code>EDIT keyword key-sequence</code> will make typing that
sequence of keys correspond to the command <code>keyword</code>. For example,
to make <kbd>control-R</kbd> redraw the current line, you could say <code>EDIT
refresh <kbd>control-R</kbd></code>.
<a name="IDX120"></a>
<a name="IDX121"></a>
The keyword can be any in
the list below, or any single character. Each character in the
key-sequence can be a single character, <kbd>control-c</kbd>, or <code>\nnn</code> where 
<code>nnn</code> is an octal number.
Alternatively, <code>READ EDIT filename</code> will
read a file specifying the new bindings which has two lines of header,
followed by pairs of <code>keyword key-sequence</code>. Lines starting with a
# are comments. An example is the
file for VMS users given below.

</p>
<p>
A problem can come up with multiple-key sequences. Imagine that you have
bound some function to <kbd>control-X</kbd><kbd>control-A</kbd>, for example

</p><pre>        EDIT end_of_line ^X^A
</pre>

<p>
then what happens when you try it? SM sees the <kbd>control-X</kbd> and uses its
default binding, <code>exit_editor</code>, and then sees a <kbd>control-A</kbd> and
goes to the start of the line, which wasn't the desired effect. The solution
is to tell SM that <kbd>control-X</kbd> is not a legal key, in which case it will
either ring the terminal bell (if there are no key-sequences starting with
an <kbd>control-X</kbd>), or wait for the next key. In short, 

</p><pre>        EDIT illegal ^X
        EDIT end_of_line ^X^A
</pre>

<p>
should work.

</p>
<p>
On a somewhat similar topic, the <code>KEY</code> (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN37">Key</a>) command may be
used to define a key to generate a string. See the end of the section on
macros for how this works.

</p>
<p>
All the current key definitions may be listed using <code>LIST EDIT</code>,
including the <code>KEY</code> definitions.
<a name="IDX122"></a>
The names of operators, and their
default bindings, are given in the following table:
<a name="IDX123"></a>
<a name="IDX124"></a>
</p><dl compact="compact">

<dt><code><kbd>control-A</kbd></code>
</dt><dd>
start_of_line
</dd><dt><code><kbd>control-B</kbd></code>
</dt><dd>
previous_char
</dd><dt><code><kbd>control-C</kbd></code>
</dt><dd>
</dd><dt><code><kbd>control-D</kbd></code>
</dt><dd>
delete_char
</dd><dt><code><kbd>control-E</kbd></code>
</dt><dd>
end_of_line
</dd><dt><code><kbd>control-F</kbd></code>
</dt><dd>
next_char
</dd><dt><code><kbd>control-G</kbd></code>
</dt><dd>
illegal
</dd><dt><code><kbd>control-H</kbd>, DEL</code>
</dt><dd>
delete_previous_char
</dd><dt><code><kbd>control-I</kbd></code>
</dt><dd>
tab
</dd><dt><code><kbd>control-J</kbd></code>
</dt><dd>
carriage_return
</dd><dt><code><kbd>control-K</kbd></code>
</dt><dd>
kill_to_end
</dd><dt><code><kbd>control-L</kbd></code>
</dt><dd>
refresh
</dd><dt><code><kbd>control-M</kbd>, <kbd>control-@</kbd></code>
</dt><dd>
carriage_return
</dd><dt><code><kbd>control-N</kbd></code>
</dt><dd>
next_line
</dd><dt><code><kbd>control-O</kbd></code>
</dt><dd>
insert_line_above
</dd><dt><code><kbd>control-P</kbd></code>
</dt><dd>
previous_line
</dd><dt><code><kbd>control-Q</kbd>, ESC-q</code>
</dt><dd>
quote_next
</dd><dt><code><kbd>control-R</kbd></code>
</dt><dd>
search_reverse
</dd><dt><code><kbd>control-S</kbd></code>
</dt><dd>
search_forward
</dd><dt><code><kbd>control-T</kbd></code>
</dt><dd>
toggle_overwrite
</dd><dt><code><kbd>control-U</kbd></code>
</dt><dd>
delete_to_start
</dd><dt><code><kbd>control-V</kbd></code>
</dt><dd>
scroll_forward
</dd><dt><code><kbd>control-W</kbd>, ESC-h</code>
</dt><dd>
delete_previous_word
</dd><dt><code><kbd>control-X</kbd></code>
</dt><dd>
exit_editor
</dd><dt><code><kbd>control-Y</kbd></code>
</dt><dd>
yank_buffer
</dd><dt><code><kbd>control-Z</kbd></code>
</dt><dd>
attach_to_shell
</dd><dt><code>ESC-&lt;</code>
</dt><dd>
first_line
</dd><dt><code>ESC-&gt;</code>
</dt><dd>
last_line
</dd><dt><code>\034</code>
</dt><dd>
escape
</dd><dt><code>ESC-b</code>
</dt><dd>
previous_word
</dd><dt><code>ESC-d</code>
</dt><dd>
delete_next_word
</dd><dt><code>ESC-f</code>
</dt><dd>
next_word
</dd><dt><code>ESC-g</code>
</dt><dd>
goto_line
</dd><dt><code>ESC-u</code>
</dt><dd>
undelete_word
</dd><dt><code>ESC-v</code>
</dt><dd>
scroll_back
</dd><dt><code>ESC-y</code>
</dt><dd>
yank_previous_buffer
</dd><dt><code>ESC-<kbd>control-D</kbd></code>
</dt><dd>
delete_from_history
</dd><dt><code>^</code>
</dt><dd>
history_char
</dd></dl>

<p>
<a name="IDX125"></a>
A simple example of a bindings file for a hardened VMS user might be

</p><pre># This is a set of DCL-ish key maps for SM
# name   key
toggle_overwrite        ^A
start_of_line           ^H
delete_previous_word    ^J
yank_buffer             ^R
search_reverse          ^[r
attach_to_shell         ^Y
</pre>

<p>
Note that that's the two characters
<code>^</code> and <code>A</code> not control-A. It could just as well have been
written <code>\001</code>.
We need a new character for <code>yank_buffer</code> now that <kbd>control-Y</kbd> is
otherwise engaged, and I have chosen <kbd>control-R</kbd> (which means that I
can't use <kbd>control-R</kbd> to search backwards, so I chose <code>ESC-r</code> for
<em>that</em>).
You should be warned that some
terminal protocols map <kbd>control-M</kbd> to <kbd>control-J</kbd>, so this use of <kbd>control-J</kbd> could
render you unable to issue commands. As mentioned above, in an emergency
<kbd>control-@</kbd> can be used instead of <kbd>control-M</kbd>.

</p>
<p>
When SM is started, or whenever the <code>TERMTYPE</code> command is
used to change terminals, the arrow keys are bound to the commands
<code>previous_line</code>, <code>ext_line</code>, <code>previous_char</code>, and
<code>ext_char</code>. For terminals such as a Televideo-912, which uses
characters such as <kbd>control-K</kbd> for arrow motion, these can supersede the
previous meanings (in this case <code>kill_to_end</code>);
The only fix is to use the <code>EDIT</code> or
<code>READ EDIT</code> command to get what you want, probably within a macro.
<a name="IDX126"></a>
<a name="IDX127"></a>

</p>
<p>
If you want to use <code>'</code> as your history character instead of <code>^</code>
you need to say <code>edit history_char ` edit ^ ^</code>. If you try
to use a character special to SM such as ! this won't work
(you'll get a syntax error) and you'll have to use the next alternative,
namely put the commands into a file and say <code>read edit filename</code>,
for example:

</p><pre># Change the history character
# name   key
history_char   !
^              ^
</pre>

<p>
Because this particular change is so common, it's possible to specify
that <code>`</code> be your history character simply by including a line
<code>history_char   `</code> in your <tt>`.sm'</tt> file (or you can choose your
own character. Choosing 0 has the effect of using the default, <code>^</code>).
<a name="IDX128"></a>
<a name="IDX129"></a>

</p>
<p>
<a name="IDX130"></a>
<a name="IDX131"></a>
<a name="IDX132"></a>
<a name="IDX133"></a>
SM needs to know something about the terminal that you are
using, so as to run the history/macro editor. This is entirely
separate from the problem of describing the terminal's graphics. It
will try to discover what sort of terminal you're on by using the value
of <code>term</code> from your <tt>`.sm'</tt> file,
<a name="IDX134"></a>
or failing that the value
of the environment variable <code>TERM</code> (Unix) or the logical variable
<code>TERM</code> (VMS). A <code>term</code> entry of <code>selanar -21</code> is
equivalent to a <code>TERMTYPE selanar -21</code> command.
You can also use the <code>TERMTYPE</code> command directly.
SM then uses the terminal
type specified to look up its properties in the termcap database
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC59">Termcap -- A Terminal Database</a>). You can also use
<code>TERMTYPE</code> to specify the size of the screen, or to turn off
SM's idea of where the cursor is. On some terminals, you can
only send a cursor to an absolute position and this is chosen to be
the bottom of the screen. This is not what you want for, e.g., a VT240
as it will lead to your graph scrolling off the screen. The use of a
negative screen size to <code>TERMTYPE</code> will disable this cursor
motion, but will also make editing lines slower. If a line of your
graph is being deleted when the SM prompt appears, you may
need to use <code>TERMTYPE dumb</code> or <code>TERMTYPE none</code>.
<a name="IDX135"></a>
<a name="IDX136"></a>
<a name="IDX137"></a>

</p>


<h1><a name="SEC8" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC8">Talking to the Operating System</a></h1>
<p>
<a name="IDX138"></a>
<a name="IDX139"></a>
Any line from ! to the newline is passed to your shell (DCL under VMS,
the Bourne shell under unix. If you set the variable <code>SHELL</code> in
either your <tt>`.sm'</tt> file or the environment it will be used instead;
the former takes priority).<a name="DOCF9" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT9">(9)</a>
<a name="IDX140"></a>
For example, <code>!ls</code> or <code>!directory</code> will list the current directory.
The return code from the command is available in the variable
<code>$exit_status</code>, on unix systems it will be 0 for success, for weirder
systems you should look in the system manual for the return value of the
C function <code>system</code>. <code>$exit_status</code> is one of the variables
that can be set with <code>DEFINE exit_status |</code>.
<a name="IDX141"></a>

</p>
<p>
It is also possible to change the directory that SM uses to look
for data or macro files with the <code>CHDIR</code> command - for instance
<code>CHDIR "../more_data"</code><a name="DOCF10" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT10">(10)</a>.
If a directory name starts with `~', <code>CHDIR</code> replaces the  `~'
with your home directory. This is the only place that `~' is treated
specially, for instance it is not interpreted by the <code>DATA</code> command.
Because directory names often contain mathematical
characters such as <code>[</code> or <code>/</code>, it is wise to quote the directory, or
use the macro <code>cd</code> which quotes it for you.
<a name="IDX142"></a>
<a name="IDX143"></a>

</p>


<h1><a name="SEC9" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC9">Macros</a></h1>

<p>
<a name="IDX144"></a>
In SM, it is possible to define sets of plot commands as 
"subprogrammes", which can be used just like a plot command, to generate
a standard plot.  These plot <code>macros</code> allow variables (e.g.
name of the data file, plot label or limits, etc) to be supplied at 
execution time.

</p>
<p>
You can also bind commands to keys to save typing; for example I
usually bind `cursor' to the PF1 key of my terminal. Such keyboard
macros are discussed under <code>KEY</code> and at the bottom of this section.

</p>
<p>
The macro facility consists of commands to define macros,
delete them, write them to disk files, read them from disk files,
delete all those macros defined in a specified disk file and
<a name="IDX145"></a>
<a name="IDX146"></a>
<a name="IDX147"></a>
<a name="IDX148"></a>
list all currently defined macros. In addition, the help command
applied to a macro prints out its definition.
<a name="IDX149"></a>
It is possible to pass up
to 9 arguments to a macro, referred to as $1, ... , $9,
and in addition $0 gives the name of the macro.
While macro arguments are
being read they are treated as if they are in sets of {}, except
that variables <em>are</em> expanded. If you want to include a space in
an argument, enclose it in quotes. If the number of declared arguments is
10 or more, the macro is treated as having a variable number of arguments.
If it is 100 or more the last argument extends to the end of the line.
For further discussion see the discussion of how macros are used.

</p>
<p>
<a name="IDX150"></a>
A macro is defined by the statement

</p><pre>MACRO name nargs { body-of-macro }
</pre>

<p>
or

</p><pre>MACRO name nargs &lt; body-of-macro &gt;
</pre>

<p>
where <code>name</code> may be up to 80 characters, and must not be a
keyword<a name="DOCF11" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT11">(11)</a>,
and <code>body-of-macro</code> is the statements within the macro, and may
be up to 2000 characters long. Macros defined using an editor on a file
may be up to 10000 characters. If <code>nargs</code>, the number of
arguments, is 0 it may 
be omitted. Macros may also be created using the <code>MACRO EDIT</code> command,
which is discussed below, and which is probably easier.  To define the macro
in a disk file, the file format must be: the name of the macro starts in the
<em>first</em> column, followed by a tab or spaces, followed by the number of
arguments, if greater than 0, followed by commands, followed by
comments if any.  The next line and 
any necessary subsequent lines
contain the macro definition <em>(starting in a column other than the first
one)</em>.  Any number of macros may appear in the same file, as long as the macro
name is given in the first column and the definition starts in some other
column. The first two blanks or tabs are deleted in continuation
lines, but any further indentation will survive into the macro definition.
Tabs will be replaced by spaces as the macro is read. By default a tab
is taken to be 8 characters wide, but this may be changed by specifying
<code>tabsize</code> in your <tt>`.sm'</tt> file.
<a name="IDX151"></a>
<a name="IDX152"></a>

</p>
<p>
<a name="IDX153"></a>
When a macro is invoked, by typing its name wherever a command is
valid, for example at a prompt, it first reads its arguments from the
terminal (if they are not in the lookahead buffer, it will prompt you
for them), and defines them as the variables $1, ..., $9,
before executing the commands contained within the macro. The
number of arguments must be declared correctly.
<a name="IDX154"></a>
As an alternative it is possible to declare that a macro has a
variable number of arguments by declaring 10 or more<a name="DOCF12" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT12">(12)</a>.
The macro will
then expect between 0 and the number declared modulo 10 arguments, all
on the same line as the macro itself. (i.e. the argument list is
terminated by a newline, which may either be a `real' one, or an \n).
If the number of arguments is 100 or more it is still reduced modulo 10,
but the last argument is taken to be the rest of the line (which may
consist of many words). 
<a name="IDX155"></a>
The macro may find out if a particular argument is provided by using 
<code>$?</code> to see if the variable is defined. For example the macro <code>check</code>,
in the format in which it would appear in a file,

</p><pre>check  11   if($?1 == 1) { echo Arg 1 is $1 }\n
</pre>

<p>
will echo its argument, if it has one, and

</p><pre>split  102  if($?2 == 0) { DEFINE 2 "(none)" }
</pre>


<pre>echo $1:$2:
</pre>

<p>
if invoked as <code>split word many arguments</code> will print <code>word:many arguments:</code>.
If you add an explicit newline, <code>split word many\n arguments</code>,
you'll get <code>word:many:</code> and then a complaint that <code>arguments</code>
is not a macro.

</p>
<p>
If you try to execute a non-existent macro, if it is defined SM will
call a special macro called <code>macro_error_handler</code>.
It has two arguments; the first is the string
<code>NOT_FOUND</code>, and the second is the name of your non-existent macro.
<a name="IDX156"></a>
<a name="IDX157"></a>
When you start SM, the error handler is:

</p><pre>macro_error_handler 2 ## handle errors associated with macros
		if($?missing_macro_continue) {
		   echo $2 is not a macro
		   RETURN
		}
		if('$1' == 'NOT_FOUND') {
		   del1
		   define 3 "$2 is not a macro; aborting"
		} else {
		   define 3 "Unknown macro error for $2: $1"
		}
		USER ABORT $3
</pre>

<p>
which causes an immediate syntax error (the <code>USER ABORT</code>),
and remove the errant command from the history list (the <code>del1</code>). You
can turn this off by defining the variable <code>$missing_macro_continue</code>,
which you can do in your <tt>`.sm'</tt> file; this was the default in SM versions
2.1.0 and earlier, and is what you get if the macro
<code>macro_error_handler</code> isn't defined.

</p>
<p>
Unfortunately we can get into
trouble with <code>IF</code>'s at the end of macros, for much the same reason
that <code>RETURN</code> can get into trouble (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC31">The Command Interpreter</a>).
The symptoms are that a macro either gets the arguments that were passed to the
macro that called it, or complains that it can't handle numbered
variables at all because it isn't in a macro at all.
To avoid this, there is an explicit \n at the end of the macro <code>check</code>.
<a name="IDX158"></a>
It is possible to redefine the values of arguments (it won't affect
the values you originally specified, arguments are passed by value),
or to <code>DEFINE</code> values for arguments that you didn't declare. The
latter case allows you to have temporary variables, local in scope to
the macro.
<a name="IDX159"></a>
An example is the <code>rel</code> macro, which is defined as

</p><pre>rel  2  DEFINE 1 ($1) DEFINE 2 ($2) RELOCATE $1 $2
</pre>

<p>
which allows you to specify expressions to the relocate command.
For more examples see the `useful macros' section.

</p>
<p>
<a name="IDX160"></a>
<a name="IDX161"></a>
Newlines are allowed within macros, and as usual
any text from a <code>#</code> to the
next newline is taken to be a comment. If a <code>#</code> is needed within a
macro, escape the <code>#</code> with a <code>\</code> or enclose it in double quotes.
If a macro starts with a comment the comment will not affect the
macro's speed of execution. Macros starting with <code>##</code> are
treated specially by <code>SAVE</code> (they are not saved) and <code>MACRO LIST</code>
(they are not listed if <code>VERBOSE</code> is 0).

</p>
<p>
<a name="IDX162"></a>
<a name="IDX163"></a>
If the macro command is given as

</p><pre>MACRO name { DELETE }
</pre>

<p>
or

</p><pre>MACRO name DELETE
</pre>

<p>
the macro will be deleted (you can also delete a macro from the macro
editor by specifying a negative number of arguments).
If the name is already
defined, it will be silently redefined. Macros may be nested freely, and even
called recursively.
For example, the definition

</p><pre>MACRO aa {aa}
</pre>

<p>
is perfectly legal, but SM will go away and think about it
for ever if you ever type <code>aa</code> (or at least until you type <kbd>control-C</kbd>.)
The definition

</p><pre>MACRO zz { zz zz    # comment: not recommended }
</pre>

<p>
is also legal, but in this case if you execute it SM
will fill its call and macro stacks
and complain when it grabs more space. As
before, it will think about it forever. More useful examples of
recursive macros are <code>compatible</code> (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC64">Tips for Mongo Users</a>), which starts

</p><pre>IF($?1 == 0) { compatible 1 RETURN } ...
</pre>

<p>
providing a default value for its argument, and <code>repeat</code> which is
discussed under <code>DO</code>.

</p>
<p>
To find how a particular macro is defined, type <code>HELP macroname</code>.
<a name="IDX164"></a>
<a name="IDX165"></a>
<a name="IDX166"></a>
For
a listing of the first line of all currently defined macros, type

</p><pre>LIST MACRO
</pre>

<p>
or

</p><pre>LIST MACRO x y
</pre>

<p>
The optional <code>x</code> and <code>y</code> are the alphabetical (actually asciial ) range of
macro names to list. As mentioned above, if <code>VERBOSE</code> is 0, macros
starting with <code>##</code> are not listed by this command. There is a
macro <code>ls</code> defined as <code>DELETE HISTORY LIST MACRO</code> which will
list macros without appearing on the history list. (Or you could
overload <code>list</code>; see under overload in the index).
<a name="IDX167"></a>
<a name="IDX168"></a>
<a name="IDX169"></a>

</p>
<p>
<a name="IDX170"></a>
<a name="IDX171"></a>
A related command is <code>APROPOS pattern</code> which lists all macros and
help files<a name="DOCF13" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT13">(13)</a>
whose names or initial comments contain the <code>pattern</code>, for example

</p><pre>APROPOS histogram
</pre>

<p>
would list <code>bar_hist</code> and <code>get_hist</code> as well as the
abbreviations <code>hi</code> and <code>hist</code>. If you wanted to find all
macros starting with a single comment character which mentioned
<code>histogram</code> you could say

</p><pre>APROPOS "^#[^#] .*histogram"
</pre>

<p>
where the double quotes prevent the <code>#</code>'s being interpreted as
comment characters.

</p><pre>APROPOS ^[a-z]
</pre>

<p>
will list all macros beginning with lowercase letters -- this is
similar to <code>MACRO LIST a z</code>, but pays no attention to the value of
<code>VERBOSE</code>.

</p>
<p>
It is also
possible to read macros in from disk, and in fact when SM is started,
it tries to read the file <tt>`default'</tt> in the directory specified by
<code>macro</code> in the environment file <tt>`.sm'</tt>. The command to read a
file of macros is

</p><pre>MACRO READ filename
</pre>

<p>
Any line with a # in the first column is treated as a comment, and is
echoed to the terminal if <code>VERBOSE</code> is greater than zero.
<a name="IDX172"></a>
<a name="IDX173"></a>
<a name="IDX174"></a>
All the currently defined macros may be written to a file with
the command

</p><pre>MACRO WRITE filename
</pre>

<p>
If the file exists, it will be overwritten (under VMS, a new version of
the file will be written).
Macros are written out
in alphabetical order.

</p>
<p>
The command

</p><pre>MACRO WRITE macroname filename
</pre>

<p>
writes the macro <code>macroname</code> to the file <code>filename</code>. 
This command remembers which file it last wrote a macro
to, and if the current filename is the same then it appends the macro
to the end of the file, otherwise it overwrites it (or creates a new 
version under VMS)
unless the <code>filename</code> is preceded by a <code>+</code>,
in which case the macros will always be appended.
This allows a set
of related macros to be written to a file.
<a name="IDX175"></a>

</p><pre>MACRO DELETE filename
</pre>

<p>
undefined all macros which are defined in <code>filename</code>.
This allows a file of macros to be read in, used and forgotten again.
The difference between this command and <code>MACRO macroname DELETE</code>
should be noted.
The <code>SAVE</code> command is probably a better way of saving all current macros.
The format of macros on disk is <code>name nargs text</code>, where
<code>nargs</code> may be omitted if it is 0. Continuation lines start with a
space or tab. See the files in the directory specified by <code>macro</code> in your <tt>`.sm'</tt> file for examples.

</p>
<p>
<a name="IDX176"></a>
<a name="IDX177"></a>
It is possible to define macros from the history list. The command

</p><pre>MACRO name i j
</pre>

<p>
defines a macro <code>name</code> to be lines <code>i</code> to <code>j</code> inclusive of the history list,
as seen using <code>HISTORY</code>.
<a name="IDX178"></a>
<a name="IDX179"></a>
The opposite of this command, which places a macro upon the
history list, is <code>WRITE HISTORY name</code>. Examples of these commands are the
macros <code>playback</code> and <code>edit_hist</code> given in the section `A
Simple Plot'. This way of defining macros can
be convenient if you have created a useful set of commands on the
history buffer, and now want to save it in a macro and go on to other things.
Editing the playback buffer, and then changing its name to something
else (see next paragraph) is a convenient way of saving it that
implicitly uses this command.

</p>
<p>
<a name="IDX180"></a>
<a name="IDX181"></a>
Macros may be edited, using essentially the same keys as described
above for the history editor.
The command <code>MACRO EDIT name</code> starts up the
editor, which works on one line at a time.<a name="DOCF14" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT14">(14)</a>
The zeroth line has the format

</p><pre>0&gt; Macro name : Number of arguments: n
</pre>

<p>
where <code>name</code> is the name of the macro, and <code>n</code> is the number of arguments to the
macro. If this line is
changed, except to change <code>name</code> or <code>n</code>, any changes made to the
macro will be ignored (note that the space after <code>name</code> is
required). This can be useful if you decide that you 
didn't want to make those changes after all. Changing <code>name</code> or
<code>n</code> has the obvious effect, except that if <code>n</code> is negative the
macro is deleted when you exit the editor. An empty macro is also deleted
when you leave the editor (i.e. one with no characters in it, not even
a space).
The first line that you are presented with is the first line in the macro
rather than this special one.
Use <kbd>control-N</kbd> (or
) to get the next line,
<kbd>control-P</kbd> (or
) to get the previous line. Carriage return 
(<kbd>control-M</kbd>) inserts a new line before the cursor, breaking the
line in the process, while <kbd>control-O</kbd> inserts a new line before
the current line.
To save the
changes and return to the command interpreter use <kbd>control-X</kbd>.
All other
keys have the same meaning as for the history editor (e.g. <kbd>control-A</kbd> to
go to the beginning of a line).
Note that <kbd>control-K</kbd> and <kbd>control-Y</kbd> can be used to copy lines, and
that the bindings can be changed with <code>EDIT</code> or <code>READ EDIT</code>.

</p>
<p>
It wouldn't be hard to write a macro that wrote out a macro to a file,
invoked your favourite text editor, then read the new definition back
in; see the macro <code>emacs_all</code> for ideas.

</p>
<p>
<a name="IDX182"></a>
It is sometimes convenient to define a key to be equivalent to typing
some string, such as <code>playback</code> or <code>cursor</code>. This can be done
with the <code>KEY</code> command, whose syntax is <code>KEY key string</code>.
If you just type <code>KEY</code> <kbd>&lt;CR&gt;</kbd> you'll be prompted for the key and
string. In this case you are not using the history editor to read the key,
and you can simply hit the desired key followed by a space and the
desired string, terminated by a carriage return. If you put <code>KEY</code>,
<code>key</code> and <code>string</code> on one line you'll probably have to quote
the <code>key</code> with <kbd>control-Q</kbd> or ESC-q, or write the escape sequences
out in the way used by <code>EDIT</code>. If this sounds confusing, here is
an example. Type <code>KEY</code><kbd>&lt;CR&gt;</kbd>, then hit the PF1 key on your terminal,
type a space, and type <code>"echo Hello World\N"</code>. Now just hit the
PF1 key and see what happens. (The closing \N meant `and put a newline
at the end'). These keyboard macros are not generally terminal
independent, but they can be convenient. Definitions for the `PF' keys
on your keyboard can be made in a terminal-independent way by
specifying the <code>key</code> as <code>pfn</code> or <code>PFn</code> where n is 1, 2, 3,
or 4.
If you always use the same
terminal you might want to put some <code>KEY</code> definitions in your private
startup file (see the discussion of <code>startup2</code> in the section on
useful macros). The current <code>KEY</code> definitions are listed with the
<code>LIST EDIT</code> command, along with the other key bindings.

</p>


<h1><a name="SEC10" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC10">DO and FOREACH loops, WHILE loops, and IF statements</a></h1>

<p>
<a name="IDX183"></a>
Related to the macro facility are the <code>DO</code>, <code>FOREACH</code>,
and <code>WHILE</code> commands.
<code>IF</code> is included here as a flow-of-control keyword. 

</p>
<p>
The syntax for a <code>DO</code> loop is

</p><pre>DO variable = expr1 , expr2 [ , expr3 ] { command_list }
</pre>

<p>
where the third expression is optional, defaulting to 1. The value of variable
(<code>$variable</code>) is in turn set to <code>expr1</code>, <code>expr1+exp3</code>, ..., 
<code>expr2</code>, and the
commands in <code>command_list</code> executed. Changing the value of <code>$variable</code>
within the command list
has no effect upon the loop. Do loops may be nested, but the name of
the variable in each such loop must be distinct. A trivial example
would be

</p><pre>DO val = 123, 123+10, 2 { WRITE STANDARD $val }
</pre>

<p>
while a more interesting example would be
the macro <code>square</code> discussed in the section on examples.

</p>
<p>
For loops within macros, it's often a good idea to make the loop variable
local: DEFINE val LOCAL DO val ... (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN15">Define</a>).

</p>
<p>
Because the body of the loop must be scanned (and parsed) repeatedly, loops
with many circuits are rather slow. If at all possible you should try
to use vector operations rather than <code>DO</code> loops.
<a name="IDX184"></a>
For example the loop

</p><pre>DO i=0,DIMEN(x)-1 {
     IF(x[$i] &gt;= 0) {
        SET x[$i]=SQRT(x[$i])
     } ELSE {
        SET x[$i]=0
     }
}
</pre>

<p>
is better written as

</p><pre>SET x=(x &gt;= 0) ? SQRT(x) : 0
</pre>

<p>
where the ternary operator <code>?:</code> is discussed in the section on vectors
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC13">Vectors and Arithmetic</a>).  If you only wanted the elements with <code>x &gt;= 0</code>,
you'd have said

</p><pre>     SET x=SQRT(x) if(x &gt;= 0)
}
</pre>

<p>
<a name="IDX185"></a>
As an alternative to DO loops, SM also has a general looping command, a
<code>while</code> loop, for example

</p><pre>set i=0
while {i &lt; 10} {
        commands
        set i=i+1
}
</pre>

<p>
is equivalent to a DO loop. In addition to being more flexible,
<a name="IDX186"></a>
<a name="IDX187"></a>
WHILE loops may also be interrupted with the BREAK command, so the
previous example could have been written (using variables instead of
vectors)

</p><pre>define i 0
while{1} {
        echo Hi $i
        define i ($i+1)
        if($i == 10) { break }
}
</pre>

<p>
<a name="IDX188"></a>
Foreach loops are similar to do loops, with syntax

</p><pre>FOREACH variable ( list ) { command_list }
</pre>

<p>
,

</p><pre>FOREACH variable { list } { command_list }
</pre>

<p>
, or

</p><pre>FOREACH variable vector { command_list }
</pre>

<p>
where the list may consist of a number of words or numbers.
a vector.
Each element in the list (or of the vector) is in turn defined to be the
value of
<code>$variable</code>, and then the commands in <code>command_list</code> are executed,
so that for example the commands:

</p><pre>FOREACH i ( one 2 three ) { WRITE STANDARD $i }
SET str = {one 2 three}
FOREACH i str { WRITE STANDARD $i }
</pre>

<p>
will print out:

</p><pre>one
2
three
</pre>

<p>
twice.
Foreach loops may be nested, but again the variables must be distinct.
You can delimit the list with <code>{}</code> so that it can include
keywords (and other things that you want treated as strings such as <code>0.1</code>
or <code>$date</code>), but even then you can't have the word <code>delete</code> in the
list of a foreach. Sorry.
<a name="IDX189"></a>
It's often helpful to make the foreach variable LOCAL (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN66">Set</a>)
inside macros, e.g.

</p><pre>DEFINE var LOCAL  FOREACH var ...
</pre>

<p>
<a name="IDX190"></a>
If statements look similar, with syntax

</p><pre>IF ( expr ) { list } ELSE { list2 }
</pre>

<p>
where the <code>ELSE</code> clause is optional, but if it is omitted the closing
} <em>must</em> be followed by a newline (or explicit \n)
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC31">The Command Interpreter</a>).

</p>
<p>
If the (scalar) expression is true (i.e. non-zero), then the commands
<code>list</code> are executed, otherwise <code>list2</code> is, if present. It is also
possible to use <code>IF</code> statements directly in plotting commands, for
example <code>POINTS x y IF(z &gt; 1/x)</code>.

</p>
<p>
It is possible to write general loops in SM by using of tail-recursive macros.
<a name="DOCF15" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT15">(15)</a>
The simplest example would be

</p><pre>macro aa {echo hello, world\n aa}
</pre>

<p>
which prints <code>hello, world</code> and then calls itself, so it prints
<code>hello, world</code> and then calls itself, and so on until you hit <kbd>control-C</kbd>.
The absence of
a space before the closing brace is very important, as it allows SM to
discard the macro before calling it again, which means that it won't fill
up its call stack and start complaining. A more interesting example is
the macro <code>repeat</code> which repeats a given macro while the given
condition is true. For example, if you say

</p><pre>macro aa { set i=i+1 calc i }
set i=0 repeat aa while i &lt; 10
</pre>

<p>
it will print the integers from 0 to 9. With a few checks, bells, and whistles
the macro looks like:
<a name="IDX191"></a>
<a name="IDX192"></a>
<a name="IDX193"></a>

</p><pre>repeat 103      # Repeat a macro `name' while the condition is true
                # syntax: repeat name while condition
                # Example: set i=0 repeat body while i &lt; 10
                if('$2' != 'while') {
                   echo Syntax: $0 macro while condition
                   return
                }
                if(int((whatis($1)-4*int(whatis($1)/4))/2) == 0) {
                   echo $1 is not a macro
                   return
                }
                macro _$1 {
                   if(($!!3) == 0) { return }
                   $!!1
                   _$!!1}
                _$1
                macro _$1 delete
</pre>

<p>
and is one of SM's default macros (type "help repeat" if you don't
believe me).

</p>


<h1><a name="SEC11" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC11">The Help Command</a></h1>
<p>
<a name="IDX194"></a>
There is an online help command. Typing <code>HELP</code> <kbd>&lt;CR&gt;</kbd>
or <code>HELP HELP</code>
gives a list of the help menu, or <code>HELP keyword</code> gives help with that keyword.
The help menu consists
of any files in the directory specified by the entry <code>help</code> 
in the environment file, so for example <code>HELP data</code> types
the file <code>data</code> in that directory. For all cases except <code>HELP help</code>, the
file is filtered through a version of the Unix utility <tt>`more'</tt> which pages
the file. When <tt>`more'</tt> offers you a <code>`...'</code> prompt, type <code>?</code> to see your
options.
<a name="IDX195"></a>
The same filter is used by e.g. <code>LIST MACRO </code>.
If the command is <code>HELP word</code>, after <code>HELP</code> tries to print the file
<code>word</code>, it looks to see if <code>word</code> is a macro, and if so prints
its definition. If <code>word</code> is a variable, its value is then
printed, and if <code>word</code> is also a vector <code>HELP</code>
<a name="IDX196"></a>
<a name="IDX197"></a>
<a name="IDX198"></a>
<a name="IDX199"></a>
prints the dimension, followed by the help
string associated with the vector
<code>vector_name</code> (see section on vectors).

</p>
<p>
The <code>APROPOS</code> command is also useful when you need help.
<code>APROPOS string</code> scans all the help files (if your operating
system allows SM to do such things) and macro headers looking for the
string. The string may actually be a pattern (see the description
of <code>APROPOS</code> for details). If <code>VERBOSE</code>
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN77">Verbose</a>) is zero only
the lines from the help files matching the pattern are printed; if
it is larger you are given a couple of lines of context on each side.

</p>
<p>
It is worth remembering that the index to this manual has an entry
under <code>weird</code>, wherein are listed all sorts of strange happenings,
with explanations and suggestions for workarounds.


</p><h1><a name="SEC12" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC12">Saving and Restoring a Session</a></h1>

<p>
<a name="IDX200"></a>
<a name="IDX201"></a>
<a name="IDX202"></a>
<a name="IDX203"></a>
<a name="IDX204"></a>
If for some reason you want to stop a SM session for later
resumption, and simply suspending the process, `<kbd>control-Z</kbd>', is not
sufficient, (for instance the machine is going down), then the <code>SAVE</code> command will write a file containing all your currently defined
macros, variables, and vectors, along with your current history buffer
as the macro <code>all</code>. You will be prompted before each class of
objects is saved, or you can put the answers on the command line.
The file is ascii, and can be edited if you so
desire. The filename defaults to <tt>`sm.dmp'</tt> if not specified, or to
the value of <code>save_file</code> from your <tt>`.sm'</tt> file.
<a name="IDX205"></a>
If some bug has crawled unbeknownst to us into SM, and results
in some sort of panic (such as a segmentation violation), a save file
called <tt>`panic.dmp'</tt> is written to your temporary directory, no
questions asked.
<a name="IDX206"></a>

</p>
<p>
To restart, <code>RESTORE filename</code> will read them all back, using the
same default file as for <code>SAVE</code> if no filename is specified, and
<em>replace</em> the current history buffer with the value of <code>all</code>
from the savefile. Of course, you could write a macro to preserve the
current buffer (see the definition of <code>edit_all</code> for hints).
If the file wasn't written by <code>SAVE</code> it is assumed to be a
SM history file, one of those written when you quit SM, and
each line is assumed to be a command and written to the end of the
history buffer. This is generally useful when you started SM
in the wrong directory. It wouldn't be hard to write a macro to use
<code>RESTORE</code> to read a history file into a macro.

</p>
<p>
One problem with <code>SAVE</code> is that it saves lots of macros,
including some of the system ones. Specifically, all macros are saved
except those beginning with "##".
This can be avoided with
the <code>MACRO DELETE filename</code> command, e.g.  <code>MACRO DELETE utils
SAVE 1 1 1 MACRO READ utils</code>.
The macro <code>sav</code> discussed under `useful macros' will do this for
you, and indeed not <code>SAVE</code> any macros that have been read with the
<code>load</code> macro. This is probably the best way to use the <code>SAVE</code>
command. In addition, <code>sav</code> also decides to save variables and
macros, only prompting you about saving vectors. <code>sav</code> is a good
candidate for overloading (as <code>save</code>), and indeed is one of the
macros redefined by the <code>set_overload</code> command.

</p>


<h1><a name="SEC13" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC13">Vectors and Arithmetic</a></h1>

<p>
The basic unit of data in SM is the <tt>`vector'</tt>, a named set of one or
more numbers or strings.  There is no limit to the number of vectors
that may be defined.  SM allows the user to read vectors from files or
define them from the keyboard, to plot them and to perform arithmetic
operations upon them. SM's string-valued vectors are less generally useful,
but can be used
for such purposes as labelling points on a graph.
<a name="IDX207"></a>

</p>
<p>
To read a vector <code>vec</code> from a column of numbers in a file, where the
filename has been specified
using <code>DATA</code> and, possibly, the range of lines in the file to be used
has been specified using the 
<code>LINES</code> command, use <code>READ vec nn</code> where <code>nn</code> is the column number,
or <code>READ { vec1 n1 vec2 n2 ... }</code> to read many vectors.
It is also possible to read a row, using <code>READ ROW vec nn</code>, where nn is
the row number in the file. See <code>READ</code> for how to read a
string-valued vector.

</p>
<p>
Instead of using simple column-oriented input
it is possible to specify a format like those used by C's <code>scanf</code>
functions (Fortran formats are not supported); if you provide your own
format string you can only read numbers.
For example, if your data file has lines like

</p><pre>	1:12:30  -45:30:11
</pre>

<p>
you could read it with
<code>read '%d:%d:%d %f:%f:%f' { hr min sec deg dmin dsec }</code>.

</p>
<p>
A vector may also be defined as <code>SET vec = x1,x2,dx</code> to take on
the values <code>x1,x1+dx,...,x2</code>, where <code>dx</code> defaults to 1
if omitted. If a scalar is
encountered where a vector is expected, it is promoted to be a vector
of the appropriate dimension; all other dimension mismatches are
errors.  Example:
<a name="IDX208"></a>

</p><pre>SET value = 5
SET x = 0, 50, 2
SET y = x
SET y = x*0 + value
SET y[0] = 2*pi
SET y = value
SET x=0,1,.1 SET y=IMAGE(x,1.5)
SET s=str
SET s='str'
SET s[0]=1.23
SET x=1.23
SET s=x
SET s=STRING(x)
</pre>

<p>
will define a scalar, <code>value</code>, with a value of 5, then define a vector,
<code>x</code>, with  26 elements, valued 0, 2, 4, 6,..., 50, then define another
vector, <code>y</code> with size 26 and the same values as <code>x</code>,
set all 26 elements of <code>y</code> to have the value 5,
set the first element of <code>y</code> to be 2 pi,
set <code>y</code>
to be a vector with one element with value <code>5</code>, and finally
set <code>y</code> to be a vector with the values taken from a horizontal
cross-section from 0 to 1 through the current image. Unless a vector
<code>str</code> is defined <code>SET s=str</code> is an error; to make <code>s</code> a
string-valued vector use <code>SET s='str'</code>. 
<code>SET s[0]=1.23</code> makes <code>s[0]</code> have the value <code>"1.23"</code> (a string),
as <code>s</code> is now a pre-existing string vector.
An arithmetic vector <code>x</code> is then
defined, and <code>s</code> is redefined as an arithmetic vector too -- you must
be careful when dealing with string vectors! Finally, we explicitly
convert an arithmetic vector to a string-valued one with the <code>STRING</code>
operator.
This is a somewhat
contrived example, designed mainly to illustrate the convenience of the
<code>SET</code> command. The ability to set particular elements is mostly
used in macros such as <code>smirnov2</code> which calculates the
Kolmogorov-Smirnov statistic from a pair of vectors.

</p>
<p>
If you don't have many data points, rather than type them into a file, and use
<code>READ vec nn</code> to define a vector, you can use the command

</p><pre>SET vec = { list } 
</pre>

<p>
For example

</p><pre>SET r = 0,10 
</pre>

<p>
is equivalent to

</p><pre>SET r = { 0 1 2 3 4 5 6 8 9 10 } 
</pre>

<p>
In fact, <code>{ list }</code> is an expression, so
<code>SET vec = 2*{1 3 1}</code> is also legal.
If the first element of a list is a word, the vector is taken to be
string-valued: <code>SET s={ William William Henry Steven }</code> defines a
4-element string vector, or you can use a string in quotes:
<code>SET s=&lt;'1' 2 3 4&gt;</code> (if you used <code>SET s={'1' 2 3 4}</code> the first
element would be <code>'1'</code> rather than <code>1</code>).
Once a vector is defined, you can write it to a file for later study using the
<code>PRINT</code> command.

</p>
<p>
A scalar may be an integer, a floating point number, a scalar
expression, <code>DIMEN(vector)</code>, or <code>WORD[expr]</code>. The last two are the
dimension of a vector, and an element of the vector with <code>expr</code> a
scalar subscript. <em>Note that subscripts start at 0 and that <code>[ ]</code>
<tt>`not'</tt> <code>()</code> are used to subscript variables</em>.
The expression <code>WORD[expr]</code> is in fact allowed even if <code>expr</code>
is not a scalar, in which case the result is a vector with the same
dimension as <code>expr</code>, and with the values taken from <code>WORD</code> in
the obvious way.

</p>
<p>
Once vectors are defined, they may be combined into expressions using
<a name="IDX209"></a>
the operators <kbd>+</kbd>, <kbd>-</kbd>, <kbd>*</kbd>, <kbd>/</kbd>, <kbd>**</kbd>,
<code>CONCAT</code> and the
functions <code>COS(), SIN(), TAN(), ACOS(),
ASIN(), ATAN(), ATAN2(), ABS(), DIMEN(), INT(), LG(), EXP(), LN(),
SQRT(), STRING(), STRLEN()</code>, and
<code>SUM()</code>. 
The meaning of most of these is obvious, <code>ATAN2</code> is like <code>ATAN</code>
but takes two arguments, <code>x</code> and <code>y</code> and returns an angle in the
proper sector.
<code>DIMEN</code> returns the number of
elements in a vector, <code>SUM</code> gives the sum of all the elements, 
<code>CONCAT</code> concatenates two vectors,
<a name="IDX210"></a>
<code>INT</code> gives the integral part of a vector, <code>STRING</code>
converts a number to a string, and <code>STRLEN</code> gives the length of a string
(in plotting units, not just the number of characters). <code>STRING</code> uses
the same code as the axis-labelling routines, so <code>FORMAT</code> can be used
to modify its behaviour; whether the x- or y-axis formats is used depends
on whether the label is more nearly horizontal or vertical.
An example would be

</p><pre>set x=3.08e16 define s (string(x)) relocate 0.5 0.5 putlabel 5 $s
</pre>

<p>
<a name="IDX211"></a>
<a name="IDX212"></a>
The precedence and binding are
as for C (or Fortran), and may be altered by using parentheses
(<code>CONCAT</code> has a binding just below <kbd>+</kbd> and <kbd>-</kbd>).
All of these operators work element by element, so 

</p><pre>y = 2 + sin(x)
</pre>

<p>
is interpreted as 

</p><pre></pre>

<p>
If there is a size mismatch the operation will only be carried out up
to the length of the shorter vector and a message is printed; if
<code>VERBOSE</code> is 1 or more, the line where the error occurred will
be printed too.
The constant <code>PI</code> is predefined.

</p>
<p>
You can also use <code>WORD([ expr [ , ... ]])</code> as part of
an expression, where <code>WORD</code> is a macro taking zero or more arguments.
<a name="IDX213"></a>
Suppose we define a macro <code>pow</code> with two arguments as

</p><pre>SET $0 = $1**$2 
</pre>

<p>
then the command

</p><pre>SET y = 10 + 2*pow(1 + x,3)
</pre>

<p>
is equivalent to <code>SET y = 10 + 2*(1 + x)**3</code>.

</p>
<p>
In addition to these arithmetic operations, there are also logical
operators <code>==</code> (equals), <code>!=</code> (not equals),
<code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&amp;&amp;</code>
(logical and), and <code>||</code> (logical or). The meanings of the symbols are the
same as in C, and as in C the value 0 is false while all other values are true.

</p>
<p>
String vectors may only be concatenated, added, or tested for (in)equality.
Adding two string-valued vectors concatenates their elements, so

</p><pre>{ a b c } + { x y z }
</pre>

<p>
results in the vector <code>ax by cz</code>.

</p>
<p>
Testing equality for string vectors seems to cause some confusion. Consider

</p><pre>set str=&lt;'a' b c d&gt;
if('a' == 'str') {     # test if the strings `a' and `str' are equal
if('a' == str) {       # test if the string `a' equals the vector `str'
if(a == str) {         # test if the vector `a' equals the vector `str'
</pre>

<p>
The second of these tests will succeed, but if you then try

</p><pre>if('b' == str) {       # try to see if `b' is an element of str
</pre>

<p>
the test will fail as <code>'b' == str</code> is the 4-element vector
<code>{ 0 1 0 1 }</code> and only its first element is used by the <code>if</code> test;
what you want is

</p><pre>if(sum('b' == str)) {  # is `b' an element of str?
</pre>

<p>
There are also a number of less mathematical operations.  If you have an
<code>IMAGE</code> (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN36">Image</a>) defined, you can extract a set of values
using the expression <code>IMAGE(expr,expr)</code>, where the two <code>expr</code>s
give the coordinates where the values are desired. Note that this may be
used as a way of reading large data files that are stored unformatted.
The expression <code>HISTOGRAM(expr : expr) </code> can be used to convert a
vector into a histogram. The second expression is taken to be the
centres of the desired bins: bin boundaries are taken at the mean points
(and points in the first expression lying on a boundary are taken to
fall into the lower bin. Note the use of `:' not `,').

</p>
<p>
Vectors may be assigned to, using the syntax
<a name="IDX214"></a>

</p><pre>SET vec = expr
</pre>

<p>
or

</p><pre>SET vec[ expr ]  = expr
</pre>

<p>
or

</p><pre>SET vec = WORD(expr)
</pre>

<p>
or

</p><pre>SET DIMEN(vec) = number
</pre>

<p>
or

</p><pre>SET vec = expr1 IF(expr2)
</pre>

<p>
or

</p><pre>SET  vec = expr1 ? expr2 : expr3
</pre>

<p>
The first form sets <code>vec</code> to have the value <code>expr</code>, element by
element, <code>vec</code> is the name of the new vector. The form 
<code>vec[expr]</code> may be used to assign to an element of a vector, as usual
the index starts at 0. Before you can use <code>SET</code> to assign values to the 
elements of a vector, you must create it using one of the other forms
of the <code>SET</code> command.

</p>
<p>
If you want to define a vector to which you will subsequently assign values 
using <code>SET vec[ expr ] = expr</code>, you may use <code>SET DIMEN(vec) = number</code>
which declares <code>vec</code> to be a vector of size <code>number</code>, and
initialises it to zero. You can optionally supply a qualifier to the
<code>number</code>, either a <code>.f</code> (the default), or a <code>.s</code> to
specify that the vector is string valued.
<a name="IDX215"></a>

</p>
<p>
<a name="IDX216"></a>
If the <code>IF</code> clause is present, only those
elements of <code>expr1</code> for which the corresponding element of <code>expr2</code> is
true
(non-zero) are copied into <code>vec</code>; in general <code>vec</code> will have a
smaller dimension than <code>expr1</code>. The last <code>SET</code> statement (with ?:)
again borrows
from C. If <code>expr1_i</code> is true, then <code>vec_i</code> is set
to <code>expr2_i</code>, otherwise it is
set to <code>expr3_i</code>.  In this form of conditional assignment, the dimension
of <code>vec</code> is the same as that of the right hand side. It may look
strange, but it can be just what you want.

</p>
<p>
<a name="IDX217"></a>
Each vector also has a help field, which may be used to provide a string
describing the vector. The field is set by 

</p><pre>SET HELP vec str
</pre>

<p>
and
viewed by 

</p><pre>HELP vec
</pre>

<p>
or via the string-valued expression <code>HELP(name)</code>.

</p>
<p>
If <code>VERBOSE</code> is one or more, if a vector is arithmetic or string
will also be noted. Vectors may be printed using the

</p><pre>PRINT [ file ] [format] { vec1, ..., vecn }
</pre>

<p>
command, where if the optional
<code>file</code> is missing, the values are typed to the keyboard; if the
optional <code>format</code> is omitted, a suitable one will be chosen for you.
Any combination of string- and arithmetic-vectors may be printed.
If a value
exceeds 1e36, it is printed as a <kbd>*</kbd>. This is consistent with the
convention used in reading data that a `missing' number is represented
as 1.001e36; see <code>READ</code> for details.
Vectors may be deleted with the command 

</p><pre>DELETE vec
</pre>

<p>
and listed with the command 

</p><pre>LIST SET
</pre>

<p>
<a name="IDX218"></a>
<a name="IDX219"></a>
Vectors are listed in ascii order along with their
dimension, and any help string specified using the <code>SET HELP</code> command

</p>
<p>
Once you start writing (or using) complicated macros you'll get bitten by
the fact that a macro called by a macro called by a friend's macro uses
a scratch vector called <code>x</code> or <code>i</code>, and that this vector quietly
overwrites <em>your</em> vector called <code>x</code> or <code>i</code>. To avoid this,
conscientious macro writers make their vectors LOCAL.
<a name="DOCF16" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT16">(16)</a>.
After the command <code>SET x LOCAL</code> in a macro, any redefinitions of <code>x</code>
within that macro, or any macros called by it, will be discarded when the
macro exits. The vector isn't strictly speaking local to the macro as it's
visible from macros that are more deeply nested, but the effect is similar.
A word on caution: a macro can exit sooner than you expect; the classic
example is

</p><pre>cube     11      # print a vector's cube for people we like
                 define name local  define name :
                 if('$name' != 'Thatcher') {
                        set x local  set x = $1
                        set x = x*x*x
                        print The answer is $(x)
                 }
</pre>

<p>
Because the <code>if</code> might be followed by an <code>else</code>, the macro is
read and popped from the input stack <em>before</em> it's executed, causing
confusion.

</p>
<p>
An <code>IF</code> clause has been
added to the plotting commands, to allow only those elements of a
vector which satisfy some condition to be plotted, for example 

</p><pre>POINTS x y IF(z &gt; 3*x)
</pre>

<p>
Of course, you could have used the <code>IF</code> command and the regular
<code>POINTS</code> command if you had preferred. In fact,

</p><pre>CONNECT x y IF(z &gt; 3*x)
</pre>

<p>
isn't quite the same as

</p><pre>SET log = z &gt; 3*x SET x = x IF(log)  SET y = y IF(log) 
CONNECT x y
</pre>

<p>
as the former will only connect contiguous points.

</p>


<h1><a name="SEC14" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC14">Drawing Labels and SM's TeX Emulation</a></h1>
<p>
<a name="IDX220"></a>

</p>
<p>
There are two separate ways to specify special characters to
SM, by using a syntax
very similar to TeX (the type-setting system created by Donald Knuth
that we used for this manual), or the traditional Mongo way. You might
ask what are the advantages 
of TeX? One is that sub- and super- scripts are handled much more naturally,
making it much harder to type
when you meant
Another is that you no longer have to remember that
is hidden
in the Greek font as `q', you can simply type <code>\theta</code>. A
third would be that you may well know TeX already.

</p>
<p>
If you want to make SM understand TeX strings
you should define the variable
<code>TeX_strings</code> (if you put a line
<code>TeX_strings 1</code> in your <tt>`.sm'</tt> file this will be done automatically).
<a name="IDX221"></a>
You can, of course, undefine it at any time to revert to the old-fashioned
strings described below.
<a name="IDX222"></a>
Using TeX-style
strings is strongly recommended by the authors; all future and most
recent improvements to SM's labels are only supported in TeX mode.

</p>
<p>
If you want to change the default font used for labels, define the variable
<code>default_font</code>; if you wanted to use the <code>\oe</code> (Old English)
font you could either say (<code>DEFINE default_font oe</code>) interactively,
or put a line in your <tt>`.sm file'</tt>: <code>default_font oe</code>.
This affects axis as well as regular labels and
only works if you use <code>TeX_strings</code> (of course).
<a name="IDX223"></a>

</p>
<p>
For some devices with hardware fonts (for example, postscript printers
or a Tektronix 4010 terminal), if <code>expand</code> is exactly 1, and
<code>angle</code> is exactly 0, the hard fonts will be used for speed.
Various strategies to defeat this are discussed below.

</p>

<ul>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC15">TeX Intro</a>: An Introduction to TeX
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC16">TeX Fonts</a>: Available Fonts
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC17">TeX Control Sequences</a>: SM's TeX Control Sequences
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC18">TeX Extensions</a>: SM's Extensions to TeX
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC19">Caveats</a>: Caveats and Cautions when using TeX
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC20">Defeating Hardware Fonts</a>: How to Stop the Device using its Fonts
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC21">Old Labels</a>: Old-style Labels
</li></ul>



<h2><a name="SEC15" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC15">An Introduction to TeX</a></h2>
<p>
(TeXsperts should skip this section.)
If you don't know TeX
let's start with an example:

</p><pre>label \pi^{\-21/2} = {\3\int}e^{-x^2}\,dx
</pre>

<p>
will print a well-known result (You'll have to <code>RELOCATE</code> somewhere
where the label will be visible first, of course).
(If
you want to try it now, you should be careful typing those ^'s, as
they are special to the history editor, dealing with this is
discussed below.) In 
this example the characters <code>\</code>, <code>{</code>, <code>}</code>, and <code>^</code>
are special (and so is <code>_</code> which wasn't used). Postponing <code>\</code>
for the moment, <code>^</code> means `make the next group a superscript',
<code>_</code> means `make the next group a subscript', where a group is
either a single character, a single control sequence (wait a moment!), or a
string enclosed in braces. So <code>A_a^{SM}B</code> would appear as
A <code>\</code> can serve one of two functions, either
turning off the special meaning of the next character (so <code>\_</code>
is simply a <code>_</code> with no special significance), or to introduce a
named `control sequence'. These fall into three groups, those that
change fonts, those that serve as abbreviations for single
characters (e.g. <code>\pi</code> in the example), and those that are macros.
The font changes persist
until the end of the string, or the current group, whichever comes
first.

</p>


<h2><a name="SEC16" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC16">Available Fonts</a></h2>

<p>
The available fonts are 
`greek', `old english', `private', `roman', `script', and `tiny'. They
may be referred to either by a
two-character control sequences (<code>\gr</code>, <code>\oe</code>, <code>\pr</code>,
<code>\rm</code>, <code>\sc</code>, or <code>\ti</code>) or simply by the first character
(e.g. <code>\r</code> for the roman font).
In addition <code>\i</code> or <code>\it</code>
can be used to make the current font italic (remember to use italics
within <code>{}</code> so that their effect is limited!).
The `bold' font <code>\b</code> or <code>\bf</code> is makes the current font bold,
and can be toggled off with a second
<code>\bf</code> if you didn't simply group it. I'd strongly recommend
treating <code>\bf</code> like any other font change, and
group them rather than relying on this toggling action.

</p>
<p>
The slant of <code>\it</code> letters can be controlled by the command sequence
<code>\slant</code>, which takes an argument which is the tangent of the desired
slope (i.e. it is the degree of shear). You can also compress all letters
along the direction that they are being written using <code>\condense</code>; for
example <code>{\slant0.4\condense0.5 Hello World}</code>.

</p>
<p>
You can alter the size of the letters
by using an escape such as <code>\6</code> which scales the current group
(any font change is local to a group).
<code>\6</code> corresponds to multiplying the size by
or
about 3, <code>\-4</code> scales by
or 0.48. This is similar to
the `magstep' used in scaling fonts in TeX.
These scale factors
are in addition to the expansion produced by going
up or down (<code>^</code> or <code>_</code>), or setting <code>EXPAND</code>.

</p>


<h2><a name="SEC17" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC17">SM's TeX Control Sequences</a></h2>

<p>
Other control sequences either consist of one non-alphabetic
character, or else a name consisting only of letters, so <code>\,</code> or
<code>\palmtree</code> is valid but <code>\one2three</code> is not. If a
alphabetic name is followed by a space, the space is treated as simply
delimiting the name and is discarded. For example,
<code>AB^{\alpha_\beta CD}</code> will appear as
(note that the space after <code>beta</code> disappeared). How do you make
just a few characters italic (script, old english, etc.)? Try
<code>ABC{\it DEF}GHI</code>. You can't read a subscript, and want it in
`tiny' font? Try <code>\Lambda_{\ti ab}</code>. All of the Greek letters are
defined, as <code>\alpha</code>-<code>\omega</code>,<code>\Alpha</code>-<code>\Omega</code>,
there are various mathematical symbols (e.g. <code>\int</code>, <code>\infty</code>,
or <code>\sqrt</code>), some astronomical (e.g. <code>\AA</code> for
and some
miscellaneous characters (e.g. <code>\snow</code> to draw a snowflake). 
You can generate 
a complete list of definitions by saying <code>load fonts TeX_defs</code>.
<a name="IDX224"></a>

</p>
<p>
Some of these definitions are more complex than just special characters,
if you know TeX most of them should be familiar.
</p><dl compact="compact">

<dt><code>\bar str</code>
</dt><dd>
Draw a bar over <code>str</code>.
</dd><dt><code>\border n str</code>
</dt><dd>
Add an n-pixel border of whitespace to <code>str</code> and draw it.
</dd><dt><code>\centre</code>
</dt><dd>
</dd><dt><code>\center</code>
</dt><dd>
Center a string horizontally
</dd><dt><code>\over str1 str2</code>
</dt><dd>
Draw <code>str1</code> over <code>str2</code>, separated by a horizontal line. This isn't
nearly as sophisticated as TeX's <code>\over</code>, and never will be.
It's written in SM's TeX emulator which is pretty limited. If you are
a LaTeX user, SM's \frac may be more familiar.
</dd><dt><code>\phantom str</code>
</dt><dd>
Don't actually draw <code>str</code>, but take up as much space as <code>str</code>
would have if you <em>had</em> drawn it.
</dd><dt><code>\smash str</code>
</dt><dd>
Draw <code>str</code> but pretend that it took up no space.
</dd><dt><code>\strut</code>
</dt><dd>
Make the current formula have at least the depth and height of a parenthesis.
</dd></dl>

<p>
You can also define your own TeX definitions by using the special
command <code>\def\name{value}</code> inside a label. It produces no output,
but defines <code>name</code> to expand to <code>value</code>. For example, I could define
<code>\TeX</code> to produce TeX by saying

</p><pre>LABEL \def\TeX{T\raise-200\kern-20E\raise200X}.
</pre>

<p>
Once a
definition has been made it is remembered forever (well, until you
leave SM actually) whatever devices you plot on. You must make sure that
all curly brackets are properly paired inside your definition. You
can have arguments just like real TeX, referred to as <code>#1</code>,
<code>#2</code>, <code>#3</code> and so forth, for example

</p><pre>\def\sub#1{_{#1}}
</pre>

<p>
Your SM guru can compile TeX-definitions into the binary fonts
file, instructions are given in the fonts appendix.

</p>


<h2><a name="SEC18" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC18">SM's Extensions to TeX</a></h2>

<p>
<a name="IDX225"></a>
We have made a number of extensions to TeX that are useful in
a plotting package, but wouldn't be especially valuable in a printed document.
We have also distorted the meanings of some of TeX's control words; sorry.

</p>
<dl compact="compact">

<dt><code>\point n s</code>
</dt><dd>
</dd><dt><code>\apoint angle n s</code>
</dt><dd>
Insert a points (such as would be drawn with <code>DOT</code>) into a label. The
string <code>\point43</code> (or <code>\point 4 3</code>) will draw a point at the
current position in the string, of <code>ptype</code> `4 3'. This sequence,
from the <code>\</code> to the <code>3</code>, is treated as a single character as regards
things like subscripts. If you want to specify an angle, use something like
<code>\apoint 45 4 0</code>.

</dd><dt><code>\hrule width</code>
</dt><dd>
Draw a horizontal line at the level of the current baseline, of length
<code>width</code> in screen units. It will be multiplied by the current
expansion. 

</dd><dt><code>\kern dx</code>
</dt><dd>
<code>\kern #</code> moves the current plot position by <code>#</code>
horizontally, where the distance
<code>#</code> is specified in screen units (the whole screen is 32768
across). It is multiplied by the expansion currently in effect, and may be
positive or negative. See also <code>\raise</code>.

</dd><dt><code>\line type length</code>
</dt><dd>
<code>\line</code> inserts a line into a label, at about the level of the
middle of a lower-case character.
e.g. <code>\line 1 1000</code> will draw a line of length 1000 (in screen
units, so the screen is 32768 across), of ltype 1.
See also <code>\hrule</code>.

</dd><dt><code>\move dx dy</code>
</dt><dd>
Move a group by <code>(dx,dy)</code>, but don't disturb SM's current idea of where
it is. This means that we can draw a line over a character with a string
such as <code>\move 0 300{\line 0 400}A</code>. It is possible to use the
commands such as <code>\width</code> to take the guesswork out of such commands,
for example the definition of <code>\bar</code> is

<pre>\def\bar#1{\move0\advance\height{#1}by100{\rule\width{#1}}#1}
</pre>

</dd><dt><code>\raise dy</code>
</dt><dd>
<code>\raise #</code> moves the current plot position by <code>#</code>
vertically, where the distance
<code>#</code> is specified in screen units (the whole screen is 32768
across). It is multiplied by the expansion currently in effect, and may be
positive or negative. See also <code>\kern</code>.

</dd><dt><code>\vrule depth height</code>
</dt><dd>
Draw a vertical line at the current position of depth <code>d</code> and
height <code>h</code> (and width 0) in screen units. Dimensions are multiplied by
the current expansion.

</dd></dl>

<p>
There are also a number of control sequences that can be used whenever
a number is expected (by <code>\kern</code>, <code>\line</code>, <code>\move</code>,
or <code>\raise</code>);
for an example of their use see <code>\move</code> in the preceding table.
</p><dl compact="compact">

<dt><code>\advance num1 [ by ] num</code>
</dt><dd>
Increment first number (which can be of the form <code>\width{...}</code>)
by the second. The <code>by</code> is optional.

</dd><dt><code>\depth{...}</code>
</dt><dd>
The depth a group would have if it were drawn.

</dd><dt><code>\divide num1 [ by ] num2</code>
</dt><dd>
Divide the <code>num1</code> by <code>num2</code>/1000. As for <code>\advance</code>,
<code>num1</code> and <code>num2</code> need not be `simple' numbers but can be
combinations of widths, advances, and so on. The <code>by</code> is optional.

</dd><dt><code>\height{...}</code>
</dt><dd>
The height a group would have if it were drawn.

</dd><dt><code>\multiply num1 [ by ] num2</code>
</dt><dd>
Multiply the <code>num1</code> by <code>num2</code>/1000. See <code>\divide</code> for the
lack of restrictions on num1 and num2. The <code>by</code> is optional.

</dd><dt><code>\width{...}</code>
</dt><dd>
The width a group would have if it were drawn
</dd></dl>

<p>
If you want to know the dimensions of the string that you have just drawn
(or just not drawn, q.v. PUTLABEL 0) you can look at the internal variables
$sdepth,  $sheight, and  $slength.
<a name="IDX226"></a>

</p>


<h2><a name="SEC19" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC19">Caveats and Cautions when using TeX</a></h2>

<p>
<a name="IDX227"></a>
Now for a few caveats: Firstly, because <code>\n</code> is a newline, you must type
<code>\\nu</code> or <code>"\nu"</code> to get a
Secondly, the superscript
character 
<code>^</code> is special to the history editor, so to type it interactively
you must quote
it with the <code>quote_next</code> key (usually <kbd>control-Q</kbd> or ESC-q, i.e.
type <code><kbd>control-Q</kbd>^</code>). Alternatively, you could change your history
character to some under-used character such as % or ' (which is the
solution that I use: you can choose a new character such as ' by
simply putting a line 
<code>history_char '</code> in your <tt>`.sm'</tt> file).
<a name="IDX228"></a>
Thirdly, TeX (and our pseudoTeX) are
rather verbose and labels may not fit on one line. The solution is to
continue the line by ending it with a \. This is probably best done
within a macro, as the continuation line won't appear on your history
list if typed at the prompt. You can currently have about 25
continuation lines (2000 characters).

</p>
<p>
A final point will only worry
TeXies, namely that the emulation isn't perfect: for example
<code>\sum_i</code> won't put the <code>i</code> beneath the summation symbol.
Some of the other discrepancies were listed in the previous section.

</p>


<h2><a name="SEC20" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC20">How to Stop the Device using its Fonts</a></h2>

<p>
If EXPAND is set to exactly 1, and ANGLE is exactly 0, then SM
will use hardware fonts, when available, in writing labels. This is faster,
but can lead to two styles of labels in one plot which is ugly.

</p>
<p>
There are various ways to trick SM into always using its own fonts:
you can say say "ANGLE 360",
or use a \0 to select a font with (explicitly) no expansion. To
affect the axis tick labels too, using the AXIS or BOX commands,
you'll have to say "EXPAND 1.0001" or somesuch. 
<a name="IDX229"></a>

</p>
<p>
Rather than always expanding your plots, you could ask your SM
Guru to edit the <tt>`graphcap'</tt> file to prevent a given device
(usually a printer) from ever using hardware fonts. Tell her to
see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">The Stdgraph Graphics Kernel</a>. If she won't oblige, you can define your own device in
your own graphcap file, and put yours first in the <tt>`.sm'</tt> file.
For example, my <tt>`.sm'</tt> file includes the line

</p><pre>+graphcap    /d/rhl/graphcap
</pre>

<p>
and the file <tt>`/d/rhl/graphcap'</tt> looks like:

</p><pre># Private overrides for RHL:
#
postscript|postscript + no hardware fonts:\
        :TB@:TE@:TC=postscript:
</pre>

<p>
Then I set <code>$printer</code> to <code>postscript</code> (also in <tt>`.sm'</tt>)
and all is well.

</p>
<p>
An alternative is to specify the device as

</p><pre>        DEVICE postscript :TB@:TE@:tc=postscript:
</pre>

<p>
which is perhaps simpler (you'd just define your value of <code>printer</code>
properly).

</p>


<h2><a name="SEC21" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC21">Old-style Labels</a></h2>

<p>
If you insist on using old-style labels (which are still the default),
here's a quick summary.
Type <code>\a</code> or <code>\\a</code>
to change to font
<code>a</code> for one character (first form) or permanently (second
form). The possible fonts are <code>g, o, p, r, s,</code> and <code>t</code> for
`greek', `old english', `private', `roman', `script', and `tiny'
respectively. In addition, the pseudo-fonts <code>u</code>  
and <code>d</code> move text `up' and `down' respectively, and <code>i</code> produces
`italic' (actually just slanted) characters.
Size changes are just like any other font change, so
<code>\6</code> and <code>\-4</code> will affect one character and the rest of
the string respectively.
This is really somewhat simpler than it sounds - try

</p><pre>label \gp\u\-21/2\2\d = \3\g:e\u-x\u2\d\s dx
</pre>

<p>
Note that `tiny' is a misnomer, it is (nowadays) just a font that
look better if you need small letters (
<code>\t\-6</code> will produce a shrunken `tiny' font, just like the
old days).
Spaces are treated differently in different fonts, as a greek space is
a negative space (i.e. a backspace), and a script space is only half as
wide as a normal space.

</p>


<h1><a name="SEC22" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC22">Getting Hardcopies of Plots</a></h1>
<p>
<a name="IDX230"></a>
There isn't really any need for this section because SM doesn't
distinguish between hardcopy devices such as laser printers and
other devices such as graphics terminals, except that it saves up
plotting commands for hardcopy devices and sends them all when you are
finished. There are, however, hard and
easy ways to do anything and this section is intended to make your life a
little simpler.

</p>
<p>
When a device that can produce hardcopy is closed the plot is sent off
to the printer (using the command given as <code>SY</code> in the device's
graphcap entry). The only way to close a device is to open another, any
other, so it is just as good to say <code>dev x11</code> as it is to say
<code>hardcopy dev x11</code> as the macro <code>hardcopy</code> does no more than
open the null device. So one way to produce a plot is to say

</p><pre>                device postscript
                plotting commands
                device x11
</pre>

<p>
There are many different printers available, and even if you are using
a postscript printer you might want portrait (<code>postport</code>) or
landscape (<code>postland</code>) plots, so it is traditional to put the
name of the desired printer into a variable <code>printer</code>. It is so
traditional, indeed, that it can be done with a line such as

</p><pre>printer     postport
</pre>

<p>
in your <tt>`.sm'</tt> file.
<a name="IDX231"></a>

</p>
<p>
The two commonest incantations are probably

</p><pre>                device $printer
                playback
                device x11
</pre>

<p>
or

</p><pre>                device $printer
                my_macro
                device x11
</pre>

<p>
which can be simplified to <code>hcopy</code> and <code>hmacro my_macro</code> respectively.
The former
can be given a single history number (e.g. <code>hcopy 12</code>) to only make
a hardcopy 
of the one command, or a range of numbers (<code>hcopy 1 12</code>) to plot
those lines (inclusive). 
The latter, if you omit the name of the macro, will prompt you to create
a temporary macro that is then printed. If you want to make a hardcopy of
the last line you have a choice, either <code>hcopy -1</code> or <code>hmacro</code>,
and then use the history editor to retrieve the desired line.

</p>
<p>
Some sites have many hardcopy devices of the same type, in which case
they usually set up the <code>SY</code> command to expect an argument
which is the name of the desired printer. You can deal with this by including
it in your <code>printer</code> variable: <code>define printer "postscript latypus"</code>
but this can be a nuisance, especially as unix already has a special
(environment) variable <code>PRINTER</code> that specifies your default printer.
The resolution is that both <code>hcopy</code> and <code>hmacro</code> are quite
careful; if you have an SM variable <code>PRINTER</code> it is taken to be your
default printer; if you <em>don't</em> have one they look for one in your
<tt>`.sm'</tt> file, if they don't find one there they look for an
environment (VMS: logical) variable. If all of these fail they take the
first argument (<code>hcopy</code>) or last argument (<code>hmacro</code>) to be the name
of the printer.
<a name="IDX232"></a>

</p>
<p>
So if you have a <code>PRINTER</code> variable anywhere, <code>hcopy</code> and
<code>hmacro macro_name</code> will work as before, if you don't then you'll have
to say <code>hcopy printer_name</code> or <code>hmacro macro_name printer_name</code>.

</p>


<h1><a name="SEC23" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC23">Overloading Keywords</a></h1>

<p>
<a name="IDX233"></a>
<a name="IDX234"></a>
Sometimes you might wish that SM's authors had decided to make
a command behave a bit differently, for instance that <code>ERASE</code> or
<code>QUIT</code> didn't appear on the history list, or that <code>SAVE</code> deleted
all the system macros before saving your environment. Of course, you can
(usually) write macros to get around these annoyances, but you <em>can't</em> easily give them the same names as the original commands (for these
examples the macros are called <code>era</code>, <code>q</code>, and <code>sav</code>).

</p>
<p>
It is possible to change the meaning of keywords (to `overload' them),
but it can be confusing, primarily because your
new commands may not behave the same way that this manual claims.
For example, if you were perverse, you could define <code>points</code>
to mean <code>QUIT</code>. Another danger is that you could end up with a
recursive call -- for instance if you wrote your own version of <code>box</code> that did all sorts of cunning things, then drew a box. If you
said <code>box</code> in your macro, then overloaded the keyword, you'd have
a macro that called itself. If you tried to use it, nothing would
happen for a while, and then you'd start getting messages about "extending
i/o stack" until you hit <kbd>control-C</kbd>. Or if you redefined <code>help</code> to mean
<code>DELETE HISTORY HELP</code> (in upper case to avoid recursive calls, and
in case <code>delete</code> has been overloaded), then <code>set help vec Help string</code>
won't work (you'd have to use <code>set HELP vec ...</code>).
<a name="IDX235"></a>
<a name="IDX236"></a>

</p>
<p>
Despite these warnings, overloading the meaning of
SM's keywords can be very convenient. There are two sets of
system macros that do just this, the compatibility ones (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC64">Tips for Mongo Users</a>),
and one called <code>set_overload</code> that is described below.

</p>
<p>
In addition to the semi-trivial use of overloading to allow you to type
<code>erase</code> not <code>era</code>, it is possible to add extra functionality
to simple commands. For example, <code>set_overload</code> defines <code>window</code>
to save the window parameters in variables, and <code>box</code> then uses these
values to label appropriate axes in touching boxes. Another example is that
(when overloaded) <code>lines</code> saves the line numbers used, so that you
can write a macro to print the top 10 lines of a file (it's called <code>head</code>).

</p>
<p>
So how do you do it? The command <code>OVERLOAD keyword #</code> will remove
the special meaning of <em>lowercase</em> <code>keyword</code> if <code>#</code> is
non-zero, or reinstate it otherwise. You can still use the uppercase form
-- you can't overload <em>that</em>. So now that e.g. <code>box</code> has no
special meaning you can define it to be a macro. What the <code>set_overload</code> macro does is to define new meanings for a number
of keywords, the new definitions are in the macro file <tt>`overload'</tt>.
If you intend using them (and I do all the time) you should look at
this file.
You can get them loaded by default by having a line <code>overload 1</code> in your
<tt>`.sm'</tt> file.
<a name="IDX237"></a>
If you don't like some, e.g. box, you can simply say <code>OVERLOAD
box 0</code> in your private startup file (see `private initialisation')
which is run after the system startup.

</p>
<p>
Most of the changes are benign, but not all. For example, the
new definition of <code>relocate</code> allows expressions, but it'll break
if you try to say <code>relocate ( 100 1000 )</code> to move to absolute
screen coordinates. You can still say <code>RELOCATE ( 100 1000)</code> of
course, and that's why most of the system macros are actually written
in uppercase. The definition of <code>box</code> (actually <code>bo</code>,
which <code>box</code> calls) may seem very complex, but
it has to deal with <code>box \n</code> as well as <code>box 1 2</code>, and it
must know if you have used the <code>WINDOW</code> command.
This brings up another point -- if you overload keywords,
you could slow SM down. It isn't that overloading is
inefficient, it's just that the macros that replace the old keywords
may do a good deal of work, <code>box</code> is a case in point. Even when
the macro is short and to the point, it's still extra work to parse
the original word and find its value as a macro.


</p><h1><a name="SEC24" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC24">Examples of Useful Macros</a></h1>
<p>
<a name="IDX238"></a>
<a name="IDX239"></a>
When you start SM the directory specified as <code>macro</code> in your 
<tt>`.sm'</tt> file is searched for a file <tt>`default'</tt>, and then the
macro <code>startup </code> from that file is executed. At the time of writing of
this manual, <code>startup</code> was defined as:

</p><pre>startup      ## macro invoked upon startup
             FOREACH 1 { default_font device edit file_type history_char \
                    macro macro2 overload printer prompt prompt2 SHELL } {
                DEFINE $1 :
             }
             FOREACH 1 { TeX_strings case_fold_search fan_compress \
                 line_up_exponents noclobber overload \
                 remember_history_line traceback uppercase } {
                DEFINE $1 :
                IF($?$1) {
                   IF('$$1' == '0') {
                      DEFINE $1 DELETE
                   }
                }
             }
             IF($?prompt) { PROMPT $prompt\n DEFINE prompt DELETE
             } ELSE { PROMPT : }
             IF($?device) { DEVICE $device
             } ELSE { DEFINE device nodevice }
             IF($?default_font &amp;&amp; $?TeX_strings == 0) {
                echo You can only define a default font if you use TeX
             }
             IF($?history_char) {   # use $history_char as history character
                IF('$history_char' != '0' &amp;&amp; '$history_char' != '1') {
                   EDIT history_char $history_char
                }
                EDIT ^ ^
                DEFINE history_char DELETE
             }
             # load the default macros
             DEFINE mfiles &lt; stats utils &gt; # $mfiles is used by `sav'
             FOREACH f ( mongo $mfiles ) { MACRO READ "$!macro"$f }
             FOREACH var ( x_col y_col data_file ) { DEFINE $var . }
             # load uppercase if defined in .sm file
             IF($?uppercase) {
                MACRO READ "$!macro"uppercase
             }
             # and overload keywords such as erase, if so desired
             set_overload $?overload
             # and some keymaps
             IF($?edit) { READ EDIT "$!edit" }
             # and an optional macro file, with macro startup2
             IF($?macro2) {
                MACRO READ "$!macro2"default
                IF(is_set(startup2,1)) { startup2 }  # startup2 is defined
             }
             # provide a \n after the IF
</pre>

<p>
As this macro is executed every time that you run SM, let us consider
it in some detail. After setting the prompt, it looks for entries for
a number of variables in your <tt>`.sm'</tt> file. Some (such as <code>printer</code>)
are simply <code>DEFINE</code>d, while some (such as <code>TeX_strings</code>)
are only <code>DEFINE</code>d if they
have a non-zero value. Because some of the values might not be numeric,
the comparison is forced to be done on strings by enclosing the quantities
in single quotes.
An entry <code>prompt</code> is interpreted as a primary prompt, mostly for
compatibility with the use of <code>$prompt2</code> to set the secondary prompt.
If <code>device</code> is defined it is used to set the default plotting
device, and both it and <code>printer</code> are used by a couple
of macros (<code>hcopy</code> and <code>hmacro</code>) that produce hardcopy.
The variables
<code>TeX_strings</code> and <code>default_fonts</code> are used in producing
labels (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC68">SM's Fonts</a>).
Because TeX uses <code>^</code> for superscripts, we
allow you to put a <code>history_char</code> line in <tt>`.sm'</tt> to specify a
character to use rather than <code>^</code> for history (I use <code>`</code>).
If you use <code>0</code>, or omit the value (so it is set to <code>1</code>), no
history character is defined to replace <code>^</code>.
The variable <code>file_type</code> is used by the <code>IMAGE</code> command to
determine the file format that you use (e.g. C, or unformatted fortran).

</p>
<p>
<code>Startup</code> doesn't have to check that <code>macro</code> was successfully
defined as it must have been found for <code>startup</code> to have been read
in the first place. <code>Macro</code> specifies where to look for macro libraries,
and <code>startup</code> next sets the variable <code>mfiles</code> containing the
names of some of 
<a name="IDX240"></a>
the system macros to be loaded, and reads them.
The macro <code>load</code> defined below also maintains the <code>mfiles</code>
list, as does <code>unload</code>. It is used by the
<code>sav</code> macro, which is discussed below the main listing of macros that
follows.
We also set some variables used by the <code>id</code> macro.

</p>
<p>
As part of our effort to be nice
to users, if you have <code>uppercase 1</code> in your <tt>`.sm'</tt> file,
we also load the <code>uppercase</code> macros.
Next <code>startup</code> overloads some keywords if <code>overload</code> is
in your <tt>`.sm'</tt> file, reads a file of keybindings (if <code>edit</code>
is given in <tt>`.sm'</tt>), and
finally tries to read a second optional macro directory
<code>macro2</code>, and executes a macro <code>startup2</code> if it's defined
(that's what the macro <code>is_set</code> is checking).
This is quite important, as it provides a way to customise SM
to your personal taste without convincing the local SM guru
that your taste should be foisted on everyone. If you want a prompt that
is different, or a definition of <code>q</code> that just quits without asking
questions, you can get them by using <code>macro2</code>.
<a name="IDX241"></a>
<a name="IDX242"></a>
<a name="IDX243"></a>
<a name="IDX244"></a>
You can see that it is possible
to tailor SM pretty much as you wish without changing a line of
code, just by playing with the <code>startup</code> macro.

</p>
<p>
SM provides various compatibility
macros, and some to package often-used functions.
The macro files <tt>`stats'</tt> and <tt>`utils'</tt>, which are read when SM
is started,  provide various useful
macros, a few of which are presented here. To see a current list, either
look at the files directly, set <code>VERBOSE</code> to zero and list all the
macros, look at the listing in this manual (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC63">The System Macro Libraries</a>),
or use <code>lsm</code> to list macro files
(this only works if you are running Unix; try <code>lsm demos</code>).
We give here a number of macros taken from the files <tt>`default'</tt>,
<tt>`mongo'</tt>, <tt>`stats'</tt>, and <tt>`utils'</tt>.
Among those not listed are those like <code>lin</code> defined to be <code>lines</code>
that are pure
abbreviations, those like <code>xlogarithm</code> defined as 
<code>SET x=lg(x)</code> which provide functionality in a perhaps familiar form,
and many more like those that are given here which provide
enhancements (e.g.   the macro <code>barhist</code>).
A discussion of a few of the more interesting or obscure follows.
Keywords are written in uppercase, because you might have been playing
tricks with overloading the lowercase equivalents.
Many of these macros, in fact all from <tt>`default'</tt> and <tt>`mongo'</tt>,
start with <code>##</code> so as not to show up in listings made when <code>VERBOSE</code> is 0, and so as not to be <code>SAVE</code>d. In the interest of
brevity we have omitted most of these initial comments.
<a name="IDX245"></a>

</p>

<pre>cumulate 2   # Find the cumulative distribution of $1 in $2
             DEFINE sum 0 SET $2=0*$1 SET HELP $2 Cumulation of $1
             DO i=0,DIMEN($1)-1 {
                DEFINE sum ( $sum + $1[$i] )
                SET $2[$i] = $sum
             }
             define sum delete
da   1       DATA "$1"
del1 1       DELETE HISTORY \n
dev  1       del1 DEFINE device $1 DEVICE $1
dra 2        # Draw, accepting expressions
             define 1 ($1) define 2 ($2) draw $1 $2
edit_hist    # Edit the history list
             del1 MACRO all 0 100000       # define "all" from buffer
             WRITE STANDARD Editing History Buffer\n
             MACRO EDIT all                # do the editing
             DELETE 0 100000       # empty history buffer
             WRITE HISTORY all             # replace history by "all"
era          del1 ERASE
gauss 1      # Evaluate a Gaussian : N($mean,$sig)
             SET $0 = 1/(SQRT(2*PI)*$sig)*EXP(-(($1-$mean)/$sig)**2/2)
get 2        # Syntax: get i j.  Read a column from a file.
             # Name of vector is jth word of line i.
             DEFINE nn READ $1 $2 echo reading $nn\n
             READ $nn $2
             SET HELP $nn Column $2 from $data_file
             DEFINE nn DELETE
hardcopy     DEVICE nodevice   # close old device
hcopy 13     ## hcopy [printer] [l1] [l2] Make hardcopy of playback buffer
             # optionally specify printer ($1) and desired lines ($2-$3)
             # if the printer ($1) is omitted (i.e. $1 is missing or a
             # number), it will be taken from the value of the environment
             # variable PRINTER, if defined.
             IF($?printer == 0) {
                DEFINE printer ? { what kind of printer? }
             }
             IF($?1) {
                IF(WHATIS($1) == 0) { # a number
                   if($?2) { DEFINE 3 $2 }
                   DEFINE 2 $1
                   DEFINE 1 DELETE
                }
             }
             IF($?1) {
                DEVICE $printer $1
             } ELSE {
                IF($?PRINTER == 0) { DEFINE PRINTER : } # which one?
                IF($?PRINTER) {
                   DEVICE $printer $PRINTER
                } ELSE {
                   DEVICE $printer
                }
             }
             IF($?2 == 0) {
                DEFINE 2 0 DEFINE 3 10000
             } ELSE {
                IF($?3 == 0) { DEFINE 3 $2 }
             }
             playback $2 $3 \n DEVICE $device
             bell
hmacro  12   ## hmacro [macro] [printer] Make hardcopy of a macro
             # If only 1 argument is present, it is taken to be the printer
             # unless an environment PRINTER variable is defined, when
             # that's used as a printer, and the argument is taken to be
             # a macro. If no macro is specified, make a temp one
             IF($?printer == 0) {
                DEFINE printer ? { what kind of printer? }
             }
             del1
             IF($?2 == 0) {          # only one arg
                IF($?PRINTER == 0) { DEFINE PRINTER : }
                IF($?PRINTER) {
                   DEFINE 2 $PRINTER
                }
             }
             IF($?1) {
                if($?2) {            # 2 args
                   DEFINE _mac $1
                   DEFINE _temp 0    # no temp macro
                } ELSE {             # 1 arg, take as printer
                   DEFINE 2 $1       # printer
                   DEFINE _temp 1    # need temp macro
                }
             } ELSE {                # no $1
                IF($?2 == 0) { DEFINE 2 " " }
                DEFINE _temp 1       # need temp macro
             }
             IF($_temp) {
                DEFINE _mac _mac
                echo "Create temporary macro, exit with ^X"
                MACRO EDIT $_mac
                IF(is_set($_mac,1) == 0) {
                   DEFINE _mac DELETE DEFINE _temp DELETE 
                   DEFINE _test DELETE
                   RETURN
                }
             }
             DEVICE $printer $2
             $_mac \n DEVICE $device
             IF($_temp) { MACRO $_mac DELETE }
             DEFINE _mac DELETE DEFINE _temp DELETE bell
load         # load macros in default directory
             DEFINE macro :                   # get default directory
             MACRO READ "$!macro"$1  # read macro file
             IF($?mfiles == 0) {
                DEFINE mfiles $1
             } ELSE {
                DEFINE 3 0
                FOREACH 2 ( $mfiles ) {
                  IF('$2' == '$1') { DEFINE 3 1 }
                }
                IF($3 == 0) { DEFINE mfiles &lt; $mfiles $1 &gt; }
             }
load2 1      # load macros in (second) default directory
             DEFINE macro2 : # get directory
             IF($?macro2) {
                MACRO READ "$!macro2"$1  # read macro file
             } ELSE {
                echo Directory macro2 is not defined
             }
logerr 3     # logerr x y error, where y is logged, and error isn't
             SET _y = 10**$2
             SET d_y = LG(_y + $3) - $2 ERRORBAR $1 $2 d_y 2
             SET d_y = $2 - LG(_y - $3) ERRORBAR $1 $2 d_y 4
             DELETE _y DELETE d_y
lsq  15      # do a least squares fit to a set of vectors
             # syntax: lsq x y [ x2 y2 [rms]] Fit line y2=$a*x2+$b to x y
             # optionally, calculate rms residual as $rms
             # see rxy to find product moment correlation coeff,
             # and spear for Spearman's corr. coeff., and significance
             SET _n = DIMEN($1)              # number of points
             SET _sx = SUM($1)               # sigma x
             SET _sy = SUM($2)               # sigma y
             SET _sxy = SUM($1*$2)           # sigma xy
             SET _sxx = SUM($1*$1)           # sigma xx
             DEFINE a ( (_n*_sxy - _sx*_sy)/(_n*_sxx - _sx*_sx) )
             DEFINE b ( (_sy - $a*_sx)/_n )
             IF($?3 &amp;&amp; $?4) {
                SET $4=$a*$3+$b
                IF($?5) {
                   DEFINE $5 ( sqrt(sum(($a*$1 + $b - $2)**2)/dimen($2)) ) 
                }
             }
             FOREACH v ( _n _sx _sy _sxy _sxx ) { DELETE $v }
playback     ## define "all" from buffer, and run it
             # with args, only playback those lines
             IF($?1 == 0) {
                DEFINE 1 0 DEFINE 2 10000
             } ELSE {
                IF($?2 == 0) { DEFINE 2 $1 }
             }
             del1 MACRO all $1 $2 all
read_old 1   del1 # read a Mongo file onto the history buffer
             READ OLD temp $1
             WRITE HISTORY temp MACRO temp { DELETE }
rel 2        # Relocate, accepting expressions
             define 1 ($1) define 2 ($2) relocate $1 $2
reverse 1    # reverse the order of a vector
             SET _i = DIMEN($1),1,-1 SORT &lt; _i $1 &gt; DELETE _i
sav 1        # Save to a file $1, don't save from files `$mfiles'
             _save $1
_save 1      # Save to a file $1, don't save from files `$mfiles'
             del1
             FOREACH 2 ( $mfiles ) { MACRO DELETE "$!macro"$2 }
             DEFINE 2 0 define 2 ? { save vectors? }
             SAVE "$!1" 1 $2 1
             FOREACH 2 ( $mfiles ) { MACRO READ "$!macro"$2 }
</pre>

<p>
<code>Cumulate</code> is given as a way <em>not</em> to write macros if you can
help it (in this case, I couldn't). A better example is <code>reverse</code>
which reverses the order of 
the elements in a vector without resorting to a <code>DO</code> loop.

</p>
<p>
The macro <code>da</code> could have been defined to be <code>DATA</code>, but there
are various special characters that appear in filenames;
try <code>data /usr/spool/junk</code> or
<code>data disk$data:[ETHELRED]junk.dat</code>. The macro <code>da</code>
provides a set of double quotes to escape these unwanted interpretations.
Incidently, <code>da "/usr/spool/junk"</code> won't work.

</p>
<p>
<code>DELETE HISTORY</code> deletes the last command on the history buffer, so
<code>del1</code> alone on a line will delete itself, which can be used to
prevent a command from appearing on the history 
list, for example changing devices with <code>dev</code>; <code>dev</code> also defines
a variable <code>device</code> which is used by the <code>hcopy </code> and <code>hmacro</code>
macros to make hardcopies, while returning you to your initial device. The
<code>startup</code> macro listed above also sets <code>device</code>, if it is specified
in your <tt>`.sm'</tt> file. You should be careful <em>not</em> to include more
than one <code>del1</code> macro in any macro that you write yourself, as
each <code>del1</code> 
will remove a command from history and you could find commands mysteriously
disappearing.
<a name="IDX246"></a>

</p>
<p>
<code>Gauss</code> evaluates a Gaussian, e.g. <code>SET x=-3,3,0.05 SET g=gauss(x)
lim x g box con x g</code>, an example of using a macro like a function definition.
(For this example to work, you have to define variables <code>mean</code> and
<code>sig</code> first).

</p>
<p>
There is an example of reading variables from files and using
them in macro <code>get</code>. This reads a word from a line in a file with
the <code>DEFINE nn READ i j</code> command, which sets <code>$nn</code> to be the
<code>j</code>th word on
line <code>i</code> of the current data file. This variable is then used to
<code>READ</code> a
vector, which is given the appropriate name. So if a file looks like:

</p><pre>This is an example file
alpha   beta    gamma   delta
1       10      0.1     1e1
2       20      0.2     1e2
3       30      0.3     1e3
4       40      0.4     1e4
5       50      0.5     1e5
</pre>

<p>
then the commands

</p><pre>GET 2 1   GET 2 2   GET 2 3   GET 2 4
</pre>

<p>
will read `1 2 3 4 5' into vector <code>alpha</code>, `10 20 30 40 50' into <code>beta</code> and so
forth. Note that

</p><pre>DEFINE READ file_id 1 LABEL $file_id
</pre>

<p>
will write out `This is an example file' to the current position of the
plot pointer (see, e.g.   <code>RELOCATE</code>). Incidently, <code>READ ROW omega 5</code>
would set the vector <code>omega</code> to have values `3 30 0.3 1e3'.

</p>
<p>
The macros <code>hcopy</code> and <code>hmacro</code> make hardcopies of, respectively,
the playback buffer and a macro. Both assume that the variables
<code>device</code> and <code>printer</code> are set. <code>device</code> is set from 
your <tt>`.sm'</tt> file and by the <code>dev</code> macro; <code>printer</code> is assumed
set in <tt>`.sm'</tt>. (See `startup' file above). If all is well, the macros
switch to device <code>printer</code> (with an argument to specify which
sub-printer is desired. We have so many laser printers here...), execute
the desired commands, and return to the initial <code>device</code>. When the
<code>printer</code> device is closed, hardcopy will result. Note the use of
<code>\n</code> to ensure that no nasty things happen; 
if there were no <code>\n</code> and the buffer ended with <code>LABEL Hi</code>, the
plot could appear with a label <code>Hi device tek4010</code>.
The versions of <code>hcopy</code> and <code>hmacro</code> given here
accept a variable number of arguments (`13' means up to 3 arguments).
The first (if present) is
taken to be the desired laser printer<a name="DOCF17" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT17">(17)</a>,
the next argument is the number
of the first line that you want played back, and the third is the last
line number. (If you omit both line numbers you'll get the whole
buffer; if you omit the second you'll just get the one line).
The macro sees what it has been given by using <code>$?</code> to see which
variables are defined, and acts accordingly. <code>hmacro</code> is somewhat
similar, except that if you omit an argument it is taken to be the
macro name, and a temporary one is created for you.
The <code>playback</code> macro deals
with its arguments in a similar way, and is discussed further in the examples
at the end of this section.

</p>
<p>
<code>load</code> enables you to read a set of macros from a directory
specified as <code>macro</code> in your environment file.
<code>Load2</code> is similar, but it looks in directory <code>macro2</code>. The macro
<code>unload</code> (not listed here) will undefine the <code>load</code>ed macros.
Note that a list of all the <code>load</code>ed macros is kept in <code>$mlist</code>, which is used by the <code>sav</code> macro to avoid <code>SAVE</code>ing
lots of system macros. <code>sav</code> is written in terms of a macro
<code>_save</code> so that it won't itself be forgotten (by <code>MACRO
DELETE</code>) while in the middle of saving macros.

</p>
<p>
If you want to put errorbars on logarithmic plots, <code>logerr</code> is the macro
you've been looking for. It calculates the correct length for the errorbars,
and plots them de-logging and re-logging as appropriate.

</p>
<p>
The macros <code>rel</code> and <code>dra</code> illustrate a method of using expressions,
rather than numbers, in the commands <code>RELOCATE</code> and <code>DRAW</code>. There
are Good Reasons why <code>DRAW</code> won't accept an expression
directly (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC31">The Command Interpreter</a>).
These macros exploit the fact that the arguments to a macro are whitespace
delimited, so a string such as <code>1+2/$x</code> comprises one argument.
Redefining the arguments means that the macros don't have to define,
and then delete, a couple of variables to hold the expressions.

</p>
<p>
Now that you have had your appetite whetted, we strongly recommend
that you take the time to look through the other macros that are
available (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC63">The System Macro Libraries</a>).
Otherwise how would you know that there are macros to draw arrows on
plots, do KS and Wilcoxon tests on vectors, and a host of other good
things?
<a name="IDX247"></a>

</p>


<h1><a name="SEC25" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC25">More Examples of Macros</a></h1>
<p>
<a name="IDX248"></a>
<a name="IDX249"></a>

</p>
<p>
In all these examples, we'll use the <code>del1</code> macro discussed
above to keep commands off the history list.
Let's start with a Fourier series, to demonstrate SM's ability
to manipulate vectors. All keywords are capitalised for clarity. 
Start SM, choose a plotting device (with
the <code>dev</code> macro), and erase all the commands on the history (or
playback) buffer with <code>DELETE 0 10000</code>. Then type the following
commands:

</p><pre>SET px=-PI/10,2*PI,PI/200
SET y=SIN(px) + SIN(3*px)/3 + SIN(5*px)/5 + SIN(7*px)/7
SET y=(y&gt;0)?y:0
LIMITS -1 7 y
BOX
CONNECT px y
</pre>

<p>
The vector <code>px</code> could just as well have been read from a file. You 
should now have a part of a square-wave, truncated at 0.

</p>
<p>
Now consider a simpler way of doing the same thing. For the present, clear
the history buffer again (<code>DELETE 0 10000</code>), and type:

</p><pre>SET px=-PI/10,2*PI,PI/200
SET y=SIN(px)
DO i=1,3 {
   SET val = 2*$i + 1
   SET y = y + SIN(val*px)/val
}
DELETE val
LIMITS -1 7 y
BOX
CONNECT px y
</pre>

<p>
Here we use a vector <code>val</code> to save a value, an equivalent (but
slower) loop using SM variables would be 

</p><pre>DO i=1,3 {
   DEFINE val (2*$i + 1)
   DEFINE y = y + SIN($val*px)/$val
}
DEFINE val DELETE
</pre>

<p>
That is all very well if you only ever wanted to sum the first four terms of the
series. Fortunately there is a way to change this, using the macro editor. First
define a macro consisting of all the commands on the history list:

</p><pre>del1 MACRO all 0 10000
</pre>

<p>
will define the macro <code>all</code> to be history lines 0-10000.
(You need the <code>del1</code> to avoid having the <code>MACRO all 0 10000</code> in
your macro). 
Then you can edit it using

</p><pre>del1 MACRO EDIT all
</pre>

<p>
when you have made the desired changes (e.g. changing <code>DO i=1,3</code>
to <code>DO i=1,20</code>) use <kbd>control-X</kbd> to leave the editor and return to the
command editor. Now you could type <code>all</code> to run your new macro,
or put it back onto the history list. To do the latter, delete the 
commands now on the history list (the now-familiar <code>DELETE 0 10000</code>),
then <code>del1 WRITE HISTORY all</code> to put the macro <code>all</code> onto the
list. Now the
<code>playback</code> command will run all those commands, and produce a better
squarewave. (As discussed in a moment, <code>playback</code> is a macro so type it
in lowercase, unless you have defined your own <code>PLAYBACK</code> macro.)

</p>
<p>
This ability to edit the history buffer is convenient, and there is a macro
provided called <code>edit_hist</code> which goes through exactly the steps that we
took you through. The trick of including a <code>del1</code> in macros is
pretty common, for example <code>h</code> is defined as 
<code>del1 HELP</code> so that it won't appear on the history list.
The macro <code>playback</code> is rather similar to <code>edit_hist</code>, but instead
of editing and then writing <code>all</code>, it executes it. We discussed
the possibility of just playing back a limited number of lines while
talking about <code>hcopy</code>, just say <code>playback n1 n2</code>.

</p>
<p>
Now that you have a set of commands which produce a Fourier plot, it
would be nice to define a macro to make plots, taking the number of
terms as an argument, and then free the history buffer for other things.
After a playback, the macro <code>all</code> is defined, so let's change its
name to <code>square</code>. There is a macro <code>ed</code> defined more-or-less as
<code>del1 MACRO EDIT</code>, so type <code>ed all</code> to enter the macro editor.
Use
or <kbd>control-P</kbd> to get to line 0 and
change the number of arguments from 0 to 1, and the name of the macro
from <code>all</code> to <code>square</code> (the space between the name and the : is
required.) Then go to the <code>DO i=1,20</code> line, and change <code>20</code> to
<code>$1</code>. Exit with <kbd>control-X</kbd>, clear the screen with <code>era</code> and
type <code>square 10</code>. Now how do you 
save your nice macro? <code>WRITE MACRO square filename</code> will write it
to file <tt>`filename'</tt>, and next time you run SM
<code>MACRO READ filename</code>
will define it. In fact there is a command <code>SAVE</code> to save everything
which can be a mindless way of proceeding.
A macro similar to this Fourier macro called <code>square</code>
is in the file <code>demos</code> in the default macro directory (and was used to 
produce the top left box of the cover to this manual). To try it yourself, type
something like <code>load demos square 20</code>. (<code>20</code> is the number of
terms to sum.)

</p>
<p>
If your wondering why <code>ed</code> is only `more-or-less' defined as <code>del1 MACRO EDIT</code>, it's because the real <code>ed</code> checks to see if you
have provided a macro name, and if you haven't it edits the same macro
as last time.

</p>
<p>
But enough of macros which fiddle with the history buffer. Here are four
sets of macros which do useful things, and may give some idea of the power
available.
First a macro to use the values of a third vector to mark points, then one
to do least-squares fits to data points, then a macro to join
pairs of points, and finally some macros to handle histograms and Gaussians.
These macros are given in the format that SM would
write them to disk (ready for a <code>MACRO READ</code>), with the name, then the
number of arguments if greater than 0, then the body of the macro.

</p>
<p>
First the points.

</p><pre>alpha_poi 3   # alpha_poi x y z. Like poi x y, with z as labels for points
              DO i=0,DIMEN($1)-1 {
                 DEFINE _x ($1[$i]) DEFINE _y ($2[$i])
                 RELOCATE $_x $_y
                 DEFINE _z ($3[$i])
                 PUTLABEL 5 $_z
              }
              FOREACH v (_x _y _z) { DEFINE $v DELETE }
</pre>

<p>
Here we use the temporary variables <code>_x _y _z</code> to get around
restrictions on expressions in <code>RELOCATE</code> commands.
Note the <code>DO</code> loop running from <code>0</code> to <code>DIMEN($1)-1</code>, produced
by array indices starting at 0 not 1.
If you wanted to use character strings as labels, this could be done by
using the <code>DEFINE READ</code> command, but this would be a good deal slower as
SM would have to rescan the file for each data-point. The top right
box of this manual's cover was made using this macro.
The use of <code>alpha_poi</code> (and also the macro file called <code>ascii</code>)
has been superseded by the introduction of string-valued vectors into
SM. Nowadays you'd simple read the column that you want to
label the point with as a string (e.g. <code>READ lab 3.s</code>), set the
point type to that string (e.g. <code>PTYPE lab</code>), and plot the points as usual
(e.g. <code>POINTS x y</code>).

</p>
<p>
The least-squares macro makes heavy use of the <code>SUM</code> operator.
It could be used to find the dimension of a
vector too, but only clumsily, and <code>DIMEN</code> is provided anyway. The macro
is:

</p><pre>lsq 4         # Do a least squares fit to a set of vectors
              # Syntax: lsq x y x2 y2   Fit line y2=$a*x2+$b to x y
              DEFINE _n (DIMEN($1))           # number of points
              DEFINE _sx (SUM($1))            # Sigma x
              DEFINE _sy (SUM($2))            # Sigma y
              DEFINE _sxy (SUM($1*$2))        # Sigma xy
              DEFINE _sxx (SUM($1*$1))        # Sigma xx
              DEFINE a (($_n*$_sxy - $_sx*$_sy)/($_n*$_sxx - $_sx*$_sx))
              DEFINE b (($_sy - $a*$_sx)/$_n)
              SET $4=$a*$3+$b
              FOREACH v ( _n _sx _sy _sxy _sxx ) {DEFINE $v DELETE }
</pre>

<p>
This does a linear fit, leaving the coefficients in <code>$a</code> and <code>$b</code>. It could 
be easily generalised to deal with weights, fits constrained to pass
through the origin, quadratics...

</p>
<p>
Our third example connects pairs of points. This was written to deal with
a set of data points before and after a certain correction had been applied.

</p><pre>pairs 4       # pairs x1 y1 x2 y2. Connect (x1,y1) to (x2,y2)
              DO i=0,DIMEN($1)-1 {
                 DEFINE _x ($1[$i]) DEFINE _y ($2[$i])
                 RELOCATE $_x $_y
                 DEFINE _x ($3[$i]) DEFINE _y ($4[$i])
                 DRAW $_x $_y
              }
              FOREACH v ( _x _y ) { DEFINE $v DELETE }
</pre>

<p>
After the introduction of vectors for <code>ANGLE</code> and <code>EXPAND</code>
(in version 2.1) this macro can be rewritten to be much faster:

</p><pre>pairs    4    # pairs x1 y1 x2 y2. connect (x1,y1) to (x2,y2)
              DEFINE 6 { ptype angle expand aspect }
              FOREACH 5 { $!!6 } { DEFINE $5 | }
              FOREACH 5 {fx1 fx2 fy1 fy2 gx1 gx2 gy1 gy2} {
                 DEFINE $5 DELETE
              }
              ASPECT 1
              SET _dx$0=($3 - $1)*($gx2 - $gx1)/($fx2 - $fx1)
              SET _dy$0=($4 - $2)*($gy2 - $gy1)/($fy2 - $fy1)
              PTYPE 2 0
              SET _a$0=(_dx$0 == 0 ? (_dy$0 &gt; 0 ? PI/2 : -PI/2) : \
                  (_dy$0 &gt; 0 ? ATAN(_dy$0/_dx$0) : ATAN(_dy$0/_dx$0) + PI))
              ANGLE 180/pi*_a$0
              EXPAND SQRT(1e-5 + _dx$0**2 + _dy$0**2)/(2*128)
              POINTS (($1 + $3)/2) (($2 + $4)/2)
              FOREACH 5 { $!!6 } { $5 $$5 DEFINE $5 DELETE }
              FOREACH 5 ( _a _dx _dy ) { DELETE $5$0 }
</pre>

<p>
Note how <code>DEFINE name |</code> is used to save things like the angle
and expansion, while <code>DEFINE name DELETE</code> is used to ensure that the
up-to-date versions of things like <code>fx1</code> are used (i.e. that they
<em>haven't</em> been DEFINEd with a <code>!</code>).
The name of the macro (<code>$0</code>) is used to
make unique vector names, or at least names like <code>_dxpairs</code> that
are very unlikely to be in use.

</p>
<p>
SM allows you to plot a pair of vectors as
a histogram, but what if you have only got the raw data points, not yet
binned together? Fortunately, SM can do this
binning for you. Consider the following macro:

</p><pre>get_hist 6    # get_hist input output-x output-y base top width
              # given $1, get a histogram in $3, with the centres of the
              # bins in $2. Bins go from $4 to $5, with width $6.
              SET $2 = $4+$6/2,$5+$6/2,$6
              SET HELP $2 X-vector for $3
              SET $3=0*$2 SET HELP $3 Histogram from $1, base $4 width $5
              DO i=0,DIMEN($1)-1 {
                 DEFINE j ( ($1[$i] - $4)/$6 )
                 SET $3[$j] = $3[$j] + 1
              }
              DEFINE j DELETE
</pre>

<p>
Since this was written, a new feature was added to SM, the
<a name="IDX250"></a>
expression <code>HISTOGRAM(x:y)</code>, to make histograms. The macro we discussed
above can now be written much more efficiently as:

</p><pre>get_hist 6    # get_hist input output-x output-y base top width
              # given $1, get a histogram in $3, with the centres of the
              # bins in $2. Bins go from $4 to $5, with width $6.
              SET $2 = $4+$6/2,$5+$6/2,$6
              SET HELP $2 X-vector for $3
              SET $3=HISTOGRAM($1:$3)
              SET HELP $3 Histogram from $1, base $4 width $5
</pre>

<p>
Suppose that your data is in vector x, for want of a better name, and
it has values between 0 and 20. Then the command

</p><pre>get_hist x xx yy 0 20 1
</pre>

<p>
will produce a histogram in <code>yy</code>, bin centres in <code>xx</code>, running
from 0 to 20 with bins 1 unit wide. So you could plot it with
<code>lim xx yy box hi xx yy </code>, and maybe it looks like a Gaussian. So what
is the mean and standard deviation? The command

</p><pre>stats x mean sig kurt echo $mean $sig $kurt
</pre>

<p>
will answer that, and find the kurtosis too. (Macro <code>stats</code>
consists of lines
such as <code>define $2 ( sum($1)/dimen($1) ) </code>). Then we could use
the macro <code>gauss</code> to plot the corresponding Gaussian,

</p><pre>set z=0,20,.1 set gg=gauss(z) set gg=gg*dimen(x) con z gg
</pre>

<p>
The bottom left box of the cover was made this way. What if you don't
like the way that the histogram looks? Try the macro <code>barhist</code>.
Now, if you wanted to plot a lognormal, you'd have to write your own
macro, and you could use <code>SORT</code> to find medians and add another macro
to <code>utils</code>, followed by one to find Wilcoxon statistics...
(Since this was written a <code>wilcoxon</code> macro was donated to <code>stats</code>).

</p>


<h1><a name="SEC26" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC26">What Quotes What When</a></h1>

<p>
This chapter is not really needed as all of its contents can be found
elsewhere in this manual, but as people manage to become confused anyway,
here's a summary. There are three ways in which characters can
alter SM's behaviour:
they can affect the way that characters and keywords are interpreted,
they can be special to the grammar, and they can perform both functions.
If you are confused, you might find a verbosity of four or five helpful.

</p>
<dl compact="compact">

<dt><code>"..."</code>
</dt><dd>
Turn off the expansion of variables, the significance of mathematical
operators such as <code>/</code> or <code>:</code>, and the recognition of keywords.
For example, after <code>DEFINE rhl
Patricia</code>, <code>/data/$rhl</code>
would be interpreted as four tokens (<code>/</code>, <code>data</code>, <code>/</code>, and
<code>Patricia</code>), while <code>"/data/$rhl"</code> is only one (<code>/data/$rhl</code>).
Note that in the former case, the <code>data</code> will be taken to be part of
a <code>DATA</code> command, and may well lead to a syntax error.
If you need to force a variable to be expanded within double quotes, use
an exclamation mark: <code>"$!rhl"</code>. Double quotes have no syntactical
significance.

Incidently, <code>"12"</code> is a <em>number</em> as the closing <code>"</code> is
read before the characters <code>12</code> are parsed.  You need to say
<code>"12 "</code> to make <code>12</code> a word;  in a different package you
might call that a bug.

</dd><dt><code>'...'</code>
</dt><dd>
Single quotes surround strings which may contain white space (spaces or tabs),
characters such as <code>+</code> or <code>/</code>, or keywords.
They don't affect variable expansion, so you have
to enclose them in double quotes if you want to protect them. Of course, you
must make sure that you are not quoting the single quotes -- use
<code>'"$abcd"'</code> rather than <code>"'$abcd'"</code> .
Strings are significant to the grammar so only use single quotes where they are
needed. For example <code>DATA 'my_file'</code> is a syntax error, and
<code>SET s='abc'</code> and <code>SET s=abc</code> mean quite different things.

</dd><dt><code>{...}</code>
</dt><dd>
Turn off all interpretation of special characters and keywords,
just like double quotes.
In fact, braces even turn off the expansion of <code>$!var</code>, to expand
a variable within braces you need to say <code>$!!var</code> but you only very
seldom need this. Braces have syntactical significance, delimiting lists.
Wherever you can use braces you can use angle brackets.

</dd><dt><code>&lt;...&gt;</code>
</dt><dd>
Almost identical to {...}, but don't turn off variable expansions.
In fact, <code>&lt;&gt;</code> don't always turn off keyword interpretation --
specifically they only do so in <code>str_list</code>'s (if you want to
know what this means you'll have to read SM's grammar in file
<tt>`control.y'</tt>). In practice you'll probably only meet this if you
try saying <code>Foreach f &lt; quit when ahead &gt; { echo $f }</code>.

</dd><dt><code>(...)</code>
</dt><dd>
Parentheses don't turn off any sort of expansion, but can have
syntactical significance.
You are most likely to see this in <code>DEFINE var ( 1 + 2 )</code> where the
parentheses tell SM to evaluate the expression before defining the variable
<code>var</code> as <code>3</code>. Note that <code>DEFINE var &lt; 1 + 2 &gt;</code> defines
<code>var</code> as <code> 1 + 2 </code>.

</dd><dt><code>$name</code>
</dt><dd>
Expand <code>name</code> as a variable. Expansion is turned off within single and
double quotes and within braces. Because the expansion happens before
the parser sees the input, variables cannot have any syntactical significance
as the parser never knows about them. This means that variables could
be used to make SM look like something quite different;
for example after <code>DEFINE begin "{ " DEFINE end "} "</code>, you can say

<pre>MACRO hi $begin echo Hello World $!!end
</pre>

(This is a little tricky. The spaces in <code>DEFINE begin "{ "</code> are
needed so that SM is still in quote mode when it processes the <code>{</code>. You
can probably figure out why I need to say <code>$!!end</code> -- the <code>!!</code> should
be a Helpful Hint.)

</dd><dt><code>$(expr)</code>
</dt><dd>
Evaluate the expression <code>expr</code> and substitute the resulting value. This
is identical to <code>DEFINE temp ( expr ) $temp</code>, but much more convenient.
</dd></dl>

<p>
As a reasonably complex example, try to guess the output from:

</p><pre>DEFINE hi {&lt;"$!('Hello')" World&gt;} DEFINE hello $hi echo :$hi:$hello:
</pre>

<p>
If you are not sure, try it
(you might find <code>VERBOSE 5</code> helpful)<a name="DOCF18" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT18">(18)</a>.

</p>


<h1><a name="SEC27" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC27">Reserved Keywords</a></h1>
<p>
Keywords are reserved, so don't try to use them as macro names or
whatever. You can use the lowercase forms if you explicitly ask to be
allowed to overload them.
The control words are :

</p><pre>WORD STRING FLOAT INTEGER ( ) { } \n ! APROPOS BREAK CHDIR DEFINE DELETE DO
EDIT ELSE FOREACH HELP HISTORY IF KEY LIST LOCAL MACRO OLD OVERLOAD PRINT
PROMPT QUIT READ RESTORE RETURN ROW SAVE SET STANDARD TABLE TERMTYPE USER
VERBOSE WHILE WRITE
</pre>

<p>
Arithmetic words are :

</p><pre>ABS ACOS ASIN ATAN ATAN2 CONCAT COS DIMEN EXP FFT INT LG LN PI RANDOM
SIN SQRT STRLEN SUM TAN WHATIS POWER_SYMBOL [ ] = + - * ** / &lt; &gt; | &amp; ? :
</pre>

<p>
SM plotting keywords are:

</p><pre>ANGLE ASPECT AXIS BOX CONNECT CONTOUR CTYPE CURSOR DATA DEVICE DOT DRAW
ERASE ERRORBAR EXPAND FORMAT GRID HISTOGRAM IMAGE LABEL LEVELS LIMITS
LINES LOCATION LTYPE LWEIGHT MINMAX NOTATION POINTS PTYPE PUTLABEL RANGE
RELOCATE SHADE SORT SPLINE TICKSIZE WHATIS WINDOW XLABEL YLABEL
</pre>

<p>
With the exception of <code>POWER_SYMBOL</code> (which is equivalent to <code>**</code>)
these are described below, with the convention that arguments between
square brackets are optional. This has nothing to do with their use in
subscripting arrays!
<a name="IDX251"></a>


</p><h1><a name="SEC28" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC28">Glossary of Terms used in this Manual</a></h1>
<p>
<a name="IDX252"></a>

</p>
<dl compact="compact">

<dt><strong>.sm</strong>
</dt><dd>
See Environment File.

</dd><dt><strong>Environment File</strong>
</dt><dd>
When you start SM it looks in a file
(by default called <tt>`.sm'</tt>) to discover where to find files that it
needs (such as the default macros, the help files, and the font files).
You can access variables stored in the environment file yourself,
although this is probably seldom done by non-gurus. For more details,
see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN23">Environment Variables</a>.

</dd><dt><strong>Expression</strong>
</dt><dd>
An SM expression is something that can appear on the right hand side of
a <code>SET</code> command. More specifically, it is something that can appear
as <em>part</em> of the right hand side of a <code>SET</code> command (this
excludes implied do loops: <code>SET x=1,10,2</code>).  Expressions may also
appear in other contexts, such as in the <code>ANGLE</code> command, or in
<code>DEFINE name ( expression )</code>. A formal definition of an
expression is given by the YACC grammar in <tt>`control.y'</tt> as the
non-terminal symbol <code>expr</code>.

</dd><dt><strong>Filecap</strong>
</dt><dd>
Binary files produced by different programmes (and
languages, and even compilers) are not identical, Fortran
`unformatted' files being a glaring example. A filecap file is a
database used to describe the byte-by-byte format of binary files, to
allow SM to read them (using the <code>IMAGE</code> command).

</dd><dt><strong>Graphcap</strong>
</dt><dd>
There are a very large range of graphics terminals
(and laser printers and so forth) in this world, and each seems to
have its own set of commands. A graphcap
file is a database that is able to describe (almost) all of these
dialects, allowing SM to plot on a wide range of devices

</dd><dt><strong>History</strong>
</dt><dd>
SM remembers commands as you type them, so that you
can repeat them or modify them (which includes correcting mistakes).
The set of remembered commands is referred to as the history buffer.

</dd><dt><strong>List</strong>
</dt><dd>
The word <code>list</code> is used in a few places in the manual
in the specific sense defined by the YACC grammar in <tt>`control.y'</tt>. A
list is simply a list of words or numbers, and its meaning depends on
the context. For example, <code>SET x=3*{1 2 3}</code> will set the vector
<code>x</code> to be <code>2 4 6</code>, while <code>MACRO hi { echo Hello}</code> will
define the macro <code>hi</code>.

</dd><dt><strong>Macro</strong>
</dt><dd>
A macro is an abbreviation for a set of commands, so
instead of typing a complicated sequence of commands you can simply
type the macro's name. You can either think of macros as a new commands in
their own right or as subroutines.

</dd><dt><strong>Mongo</strong>
</dt><dd>
Mongo is a plotting package written by John Tonry, and
widely used in astronomy 
departments. SM's command language was based on Mongo's, and we have
provided some support for an easy transition from Mongo to SM.

</dd><dt><strong>p_expr</strong>
</dt><dd>
A parenthesised expression. Many commands expect to be passed the name of
a vector, but will accept an expression in parentheses; for example
in the command <code>POINTS x (y + 2/z)</code>, <code>(y + 2/z)</code> is a p_expr.
<a name="IDX253"></a>

</dd><dt><strong>s_expr</strong>
</dt><dd>
A scalar expression. This is a term used in some of the command descriptions;
examples would be <code>210157</code>, <code>x[12]</code>, or <code>x</code>. In the latter
case, the first element of the vector <code>x</code> would be used, so it is
equivalent to <code>x[0]</code>.

</dd><dt><strong>Stdgraph</strong>
</dt><dd>
SM uses the stdgraph device driver for most devices, using the information
in the graphcap file (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">The Stdgraph Graphics Kernel</a>).

</dd><dt><strong>String</strong>
</dt><dd>
A string to SM is a sequence of characters enclosed in single quotes:
<code>'This is a string'</code>. Strings are primarily used in vector expressions,
but are also used in a few other places (e.g. to specify a format for a
<code>PRINT</code> or <code>READ</code> command). Note that characters in double quotes
are <em>not</em> strings to SM, merely characters protected from variable
expansion.

</dd><dt><strong>Termcap</strong>
</dt><dd>
Terminals come in many, many, flavours and types.
Their peculiarities are described by a termcap file, allowing
SM's command editor to run on (almost) any terminal.

</dd><dt><strong>TeX</strong>
</dt><dd>
TeX is a typesetting language developed by
Donald Knuth. We provide an emulation of certain parts of TeX's
mathematics mode in SM's label commands.

</dd><dt><strong>Overload</strong>
</dt><dd>
A keyword (such as <code>DEFINE</code> or <code>SET</code>) is said
to be <em>overload</em>ed if its meaning has been changed. Usually this
will be by adding functionality, rather than by actually changing what
it does.

</dd><dt><strong>Variable</strong>
</dt><dd>
A variable is an abbreviation for a sequence of characters, and may
appear anywhere that the characters in question could appear. Even if the
variable contains a number (e.g. <code>6.62559e-34</code>) it is still just
a characters, although SM may choose to treat them as a number in
some contexts (e.g. the right-hand side of a <code>SET</code> command).

</dd><dt><strong>Vector</strong>
</dt><dd>
A set of one (actually, zero) or more elements. The
elements can be either numerical (floating point) or strings. Vectors
are SM's primary data type. Do not confuse a 1-element vector (a scalar)
with a variable (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC5">String Variables</a>).

</dd><dt><strong>YACC</strong>
</dt><dd>
The SM command language is written in a language called
YACC (which is supported on Unix systems). We have provided an
implementation of YACC called Bison in the SM distribution.
</dd></dl>


<h1><a name="SEC29" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC29">Command Reference</a></h1>

<p>
This is the reference manual to SM's commands

</p>

<ul>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN1">Abort</a>: Abort the current plot without producing a hardcopy
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN2">Angle</a>: Draw Points and Text at an Angle
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN3">Apropos</a>: List all Commands and Macros Matching a String
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN5">Arithmetic</a>: Arithmetical Operations
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN4">Aspect</a>: Print or Set the Plot's Aspect Ratio
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN6">Axis</a>: How to Draw a Single Axis (see also Box)
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN7">Box</a>: Draw a Box around a Graph
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN8">Break</a>: Break out of a While loop
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN9">Chdir</a>: Change Directories
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN10">Connect</a>: Connect a Set of Points
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN11">Contour</a>: Contour an IMAGE
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN12">Ctype</a>: Set the Colour of Lines
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN13">Cursor</a>: Display a Cursor
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN14">Data</a>: Specify the Data File to Use
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN15">Define</a>: Define a Variable
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN16">Delete</a>: Delete Something
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN17">Device</a>: Chose an Output Device
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN18">Dither</a>: Floyd-Steinberg Dither an Image
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN19">Do</a>: Do-Loops
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN20">Dot</a>: Draw a Dot of the Current Type
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN21">Draw</a>: Draw a Line to the Current Plot Position
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN22">Edit</a>: Change Key Bindings for the Editor
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN23">Environment Variables</a>: Variables Effecting SM's Behaviour
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN24">Erase</a>: Clear the Screen
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN25">Errorbar</a>: Draw Errorbars
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN26">Expand</a>: Change the Size of Points and Text
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN27">Fft</a>: Fourier Transform a Vector
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN28">Foreach</a>: Do Something to each Member of a List
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN29">Format</a>: Specify the Axis Label Format
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN30">Grid</a>: Draw a Grid at the Axis Ticks
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN31">Help</a>: Help Me Please
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN32">Histogram</a>: Draw a Histogram
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN33">History</a>: List the Commands that you have Executed
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN34">Identification</a>: Write an I/D string on your Plot
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN35">If</a>: Do Something If an Expression is True
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN36">Image</a>: Read a Binary Image
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN37">Key</a>: Define a Key to Execute a Command
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN38">Label</a>: Draw a Label on a Plot
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN39">Levels</a>: Specify the Levels for a Contour Plot
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN40">Limits</a>: Set the Axis Limits
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN41">Lines</a>: Set which Lines of a File should be Read
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN42">List</a>: List Something; Macros, Variables, Vectors, ...
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN43">Local</a>: Make a Variable or Vector Local to a Macro
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN44">Location</a>: Specify where on the Screen the Plot Should Appear
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN45">Logical</a>: The Possible Logical Operators
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN46">Ltype</a>: Set the Pattern Used to Draw Lines
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN47">Lweight</a>: Set the Width of Lines
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN48">Macro</a>: Define a Macro, or Read or Write a Macro File
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN49">Meta</a>: SM's Support for Metafiles
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN50">Minmax</a>: Find the Minimum and Maximum of an Image
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN51">Notation</a>: Chose between Fixed and Exponential Axis Labels
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN52">Overload</a>: Change the Meaning of a Keyword
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN53">Page</a>: Start a New Page
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN54">Points</a>: Draw some Points
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN55">Print</a>: Print some Vectors
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN56">Prompt</a>: Set the Prompt
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN57">Ptype</a>: Choose the Type of Markers for Points
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN58">Putlabel</a>: Draw a Label on the Plot
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN59">Quit</a>: Leave SM
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN60">Range</a>: Specify a Range for the Axes
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN61">Read</a>: Read Vectors from a File
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN62">Relocate</a>: Move the Current Plot Pointer
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN63">Restore</a>: Restore a SAVEd SM Environment
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN64">Return</a>: Return from the Current Macro
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN65">Save</a>: SAVE your SM Environment
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN66">Set</a>: Set a Vector to an Expression
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN67">Shade</a>: Shade a Region of a Plot
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN68">Show</a>: Print the Value of Various Quantities
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN69">Sort</a>: Sort a Number of Vectors
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN70">Spline</a>: Fit a Cubic Spline to Two Vectors
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN71">Strings</a>: String Operations
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN72">Surface</a>: Draw a Surface from an Image, with Hidden Line Removal
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN73">Table</a>: Read from tables
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN74">Termtype</a>: Set the Terminal Type
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN75">Ticksize</a>: Specify the Style of Axis Ticks
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN76">User</a>: A User-Provided Command
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN77">Verbose</a>: Adjust SM's Chattiness
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN78">Version</a>: What version of SM are you Running?
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN79">Viewpoint</a>: Choose the Direction used to View Surfaces
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN80">Whatis</a>: Find the Type of a String
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN82">While</a>: Repeat Commands while an Expression is True
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN81">Window</a>: Choose a Plot Window; Use just Part of the Device
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN83">Write</a>: Write a String to a File
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN84">Xlabel</a>: Draw an X-axis Label
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN85">Ylabel</a>: Draw an Y-axis Label
</li></ul>

<hr><h2><a name="SYN1">Abort</a></h2>
<pre>Syntax: ABORT
</pre>

<p>
<a name="IDX254"></a>
<a name="IDX255"></a>
<a name="IDX256"></a>

</p>
<p>
ABORT closes the current device without producing any hardcopy. If you
are writing an output file it will be removed. You are left talking to
the null device, so you probably want to follow ABORT with a DEVICE
command.

</p>

<hr><h2><a name="SYN2">Angle</a></h2><p>
<a name="IDX257"></a>

</p><pre>Syntax: ANGLE expr
</pre>

<p>
   For most purposes only the first element of the expr is used, let's
call it <code>D</code> as it's an angle in degrees.

</p>
<p>
   ANGLE will cause text from LABEL to come out <code>D</code> degrees
anti-clockwise from horizontal. It also causes points to be rotated
counter-clockwise by <code>D</code> degrees.

</p>
<p>
If <code>D</code> is non-zero it will force axis and other labels to be
written with SM's internal fonts, and will overrule the
tendency to put x-axis labels horizontal, and y-axis labels vertical.

</p>
<p>
   For plotting points the full vector of values is used, with the
point rotated by the value of expr. If more points are specified than
the dimension of expr, the first element will be used for the excess.

</p>
<p>
The current value of <code>ANGLE</code> is (almost) always available as the variable
<code>$angle</code> (it is one of the special variables that are affected by the
<code>DEFINE variable |</code> command).
<a name="IDX258"></a>

</p>
<hr><h2><a name="SYN3">Apropos</a></h2>
<pre>Syntax: APROPOS pattern
</pre>

<p>
<a name="IDX259"></a>

</p>
<p>
<a name="IDX260"></a>

</p>
<p>
   Apropos lists all macros whose name or introductory comments match
the given pattern. Probably the most common use for the command is
simply to look for a word -- e.g. <code>APROPOS histogram</code>.

</p>
<p>
   If your system supports it, APROPOS will also search the help files
for the given pattern (in this case matches may not extend over more
than one line). If <code>VERBOSE</code> is zero only the line containing the
match is printed; if <code>VERBOSE</code> is one or more then a couple of
lines on each side of the match are printed too.  If the pattern
matches more than once each match will be printed, merged together if
appropriate and separated by line of dashes otherwise.  If you use `q'
to stop looking at the help files APROPOS will immediately proceed to
search the macros.

</p>
<p>
The pattern is a slightly restricted version of a
normal Unix regular expression, specifically:
</p><dl compact="compact">

<dt><code>.</code>
</dt><dd>
Matches any character except \n.
</dd><dt><code>[...]</code>
</dt><dd>
Matches any of the characters listed in the <code>[ ]</code>.

If the first character is a ^ it means use anything except
the range specified (in any other position ^ isn't special)

A range may be specified with a - (e.g. [0-9]), and if a ]
is to be part of the range, it must appear first (or after
the leading ^, if specified). A - may appear as
the special range <code>---</code>.

</dd><dt><code>^</code>
</dt><dd>
Matches only at the start of the string. Note that you must quote
the <code>^</code> with an <kbd>ESQ-q</kbd> if you use it as your history
character -- look in the index under <code>history</code> to learn how
to change it.

</dd><dt><code>$</code>
</dt><dd>
Matches only at the end of a string.

</dd><dt><code>\t</code>
</dt><dd>
Tab

</dd><dt><code>\n</code>
</dt><dd>
Newline

</dd><dt><code>\.</code>
</dt><dd>
(any other character) simply escapes the character (e.g. \^)

</dd><dt><code>*</code>
</dt><dd>
Any number of the preceding character (or range)

</dd><dt><code>?</code>
</dt><dd>
One or more of the preceding character or range
</dd></dl>

<p>
By default searches are case insensitive, but you can make searching
sensitive to case by deleting the variable case_fold_search (you can do this
by putting a line <code>case_fold_search 0</code> in your <tt>`.sm'</tt> file if you
so desire).

</p>
<p>
The name and the comments are searched separately, so you could list
all macros beginning with a, b, c, d, e, or z by saying

</p><pre>APROPOS ^[a-ez]
</pre>

<p>
(which works because all comments start with a <code>#</code>),
or

</p><pre>APROPOS "^#[^#]"
</pre>

<p>
to list all macros that start with a single <code>#</code> (the quotes are
needed to stop the <code>#</code>'s from being treated as comment characters).

</p>
<hr><h2><a name="SYN4">Aspect</a></h2>
<pre>Syntax: ASPECT A
</pre>

<p>
<a name="IDX261"></a>
<a name="IDX262"></a>
<a name="IDX263"></a>

</p>
<p>
   Set the aspect ratio (Y/X) to be A; This is used in drawing
characters and points and is reset when a new DEVICE command is issued.

</p>
<p>
The current values of the x- and y- dimensions of the current device are
(almost) always available as the variables
<code>$nx</code> and <code>$ny</code>, and the current aspect ratio is <code>$aspect</code>
(they are some of the special variables that are
affected by the <code>DEFINE variable |</code> command). 
<a name="IDX264"></a>
<a name="IDX265"></a>
<a name="IDX266"></a>

</p>
<p>
If A is exactly 0, the current aspect ratio is printed -- this is equivalent
to <code>echo $aspect</code> and is retained as a curiosity.

</p>
<p>
   Usually the aspect ratio is calculated by SM to make
characters look right (and to make square points square), but it is
sometimes useful to override this, especially when positioning labels
on graphs that will be plotted on printers of different aspect ratios.

</p>
<p>
It might be worth going through an example. Suppose that you want to make
a plot that really is square when printed; how should you proceed?

</p>
<p>
The available plotting area runs from 0--32767 on each axis. So a plot
set up as

</p><pre>location 5000 20000 5000 20000
</pre>

<p>
will have the same aspect ratio as the plotting device, in general rectangular.
We can write this as

</p><pre>define len 15000                # axis length, SCREEN units
location 5000 $(5000 + $len) 5000 $(5000 + $len)
</pre>

<p>
if we feel sophisticated.

</p>
<p>
The variable <code>$aspect</code> tells you the Y/X ratio of the current device;
so the location

</p><pre>location 5000 $(5000+$len) 5000 $(5000+int($len/$aspect)) box
</pre>

<p>
will be a square box. Of course, you'd probably really want to say

</p><pre>if($aspect &gt; 1) {
   location 5000 $(5000+int($aspect*$len)) 5000 $(5000+$len) box
} else {
   location 5000 $(5000+$len) 5000 $(5000+int($len/$aspect)) box
}
</pre>

<p>

</p>
<p>
There is a problem with this; the sizes of points and labels are varied to
look right with the current aspect ratio. This means that a

</p><pre>putlabel 5 Hello World
</pre>

<p>
command that looks fine on the screen of your workstation will look awful
on the printer. That's where the ASPECT command comes into play: on your
workstation lie to SM and tell it that the aspect ratio is that of the
printer. How do you do that? Well, the slick way is to say

</p><pre>macro aspect_as_device 1 {
   DEVICE $1
   define 1 $aspect
   ABORT
   DEVICE $device
   ASPECT $1
}
</pre>

<p>
which assumes that you use a version of the device command that saves the
current device as <code>$device</code>; the macro <code>dev</code> does this, and you can
overload <code>device</code> to mean <code>dev</code>. Then you can say

</p><pre>aspect_as_device postport
</pre>

<p>
to force the same aspect ratio as the <code>postport device.</code>; your plots
will look ugly on the screen but beautiful when printed.

</p>
<hr><h2><a name="SYN5">Arithmetic</a></h2>
<pre>Arithmetic
</pre>

<p>
<a name="IDX267"></a>
<a name="IDX268"></a>
<a name="IDX269"></a>
<a name="IDX270"></a>
<a name="IDX271"></a>
<a name="IDX272"></a>
<a name="IDX273"></a>
<a name="IDX274"></a>
<a name="IDX275"></a>
<a name="IDX276"></a>
<a name="IDX277"></a>
<a name="IDX278"></a>
<a name="IDX279"></a>
<a name="IDX280"></a>
<a name="IDX281"></a>
<a name="IDX282"></a>
<a name="IDX283"></a>
<a name="IDX284"></a>
<a name="IDX285"></a>
<a name="IDX286"></a>
<a name="IDX287"></a>
<a name="IDX288"></a>
<a name="IDX289"></a>
<a name="IDX290"></a>

</p>
<p>
Arithmetic is allowed on vectors and scalars in SM, using the following
operators, where expr is a expression, s_expr is a scalar expression (e.g.
a number), and vector the name of a vector.
 

</p><pre>Nonary (?):

PI              Pi
</pre>

<p>
<a name="IDX291"></a>
<a name="IDX292"></a>

</p><pre>Unary:

-expr           Change sign             ABS(expr)       Absolute value
ACOS(expr)      Arccosine               ASIN(expr)      Arcsine
ATAN(expr)      Arctangent              COS(expr)       Cosine
CTYPE()         Return CTYPEs           DIMEN(vector)   Dimension of a vector
EXP(expr)       Exponential             FLOAT(expr)     Convert to float
GAMMA(expr,expr) Incomplete gamma fn    INT(expr)       Integral part
LG(expr)        Log_10                  LN(expr)        Log_e
RANDOM(s_expr)  Random numbers          SIN(expr)       Sine
SQRT(expr)      Square root             STRING(expr)    Convert to a string
SUM(expr)       Sum_i expr_i            TAN(expr)       Tangent
VECTOR[expr]    Elements of an array    { list }	Set vector to list
&lt; list &gt;	Set vector to list      ( expr )        Raise precedence
</pre>


<pre>Binary:

expr + expr          Add                expr - expr     Subtract
expr CONCAT expr     Concatenate        expr * expr     Multiply
expr / expr          Divide             expr ** expr    Exponentiate
expr &amp; expr          Bitwise AND        expr | expr     Bitwise OR
expr &lt;&lt; expr         Bitshift left      expr &gt;&gt; expr    Bitshift right
expr % expr          Modulus            ATAN2(expr_y,expr_x) Atan2
</pre>

<p>
(note that a bitwise XOR may be achieved as <code>| - &amp;</code>).

</p>
<p>
There are also some special operators:

</p><pre>HISTOGRAM(expr:expr)            Construct histogram
IMAGE(expr,expr)                Extract cross section (x, y coordinates)
IMAGE[expr,expr]                Extract cross section (x, y indices)
expr1 ? expr2 : expr3           expr2 if expr1 is true, else expr3
DO(s_expr, s_expr)              Implicit DO loop
DO(s_expr, s_expr, s_expr)      Implicit DO loop with increment
</pre>

<p>
<code>GAMMA</code> returns an incomplete Gamma function, so GAMMA(a,infty) = 1.

</p>
<p>
<code>RANDOM</code> generates a vector of <code>s_expr</code> random numbers in the
range [0,1]. If you don't specify a seed (using <code>SET RANDOM</code>) one
will be chosen for you based on the current time.

</p>
<p>
<code>ATAN2</code> is the same as C's function of the same name, and is
equivalent to <code>ATAN(y/x)</code>. It gives a result in the range
<code>-pi -- pi</code> dealing correctly with divisions by zero.

</p>
<p>
<code>CTYPE</code> returns a vector of red + 256*green + 256^2*blue, giving the
currently defined colours; CTYPE(STRING) returns their names
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN71">Strings</a>).

</p>
<p>
<code>DO</code> generates a range of values, e.g. <code>set x=do(1,5)</code> sets
x to have the values <code>1 2 3 4 5</code>; this is the same as
<code>set x=1,5</code>; but <code>set y=100 + sin(pi*do(0,10)/10)</code> is more
interesting. You can specify an increment, so <code>do(5,1,-1)</code> is
<code>5 4 3 2 1</code>.

</p>
<p>
The expression
<code>VECTOR[expr]</code> results in a vector of the same dimension as
the <code>expr</code>, with elements taken from <code>VECTOR</code>
(i.e. <code>VECTOR[INT(expr_i)]</code>). See, for example, the macro <code>interp</code>.
<a name="IDX293"></a>
 
You can also use <code>WORD([ expr [ , ... ]])</code> as part of
an expression, where <code>WORD</code> is a macro taking zero or more arguments.

</p>
<p>
<a name="IDX294"></a>
The precedences are what you'd expect, with <code>**</code> being highest, then
<code>*</code>, <code>/</code> and <code>%</code>, then <code>+</code> and <code>-</code>, then
<code>CONCAT</code>, then the bitwise and logical operators, and finally
<code>?:</code> has the lowest priority of all. You should not assume <em>any</em>
precedence between logical and bitwise operators, because if you do you'll
be fooled (e.g. <code>1||0 | 0x6</code> is <code>7</code>, but <code>0x6 | 1||0</code> is 1);
if you use parentheses all will be well
(<code>1||(0 | 0x6)</code> is <code>1</code> and <code>0x6 | (1||0)</code> is 7).
 
If you have defined an image file with the IMAGE command,
<code>IMAGE(expr,expr)</code> is an expression to extract values from your image.
The two expressions give the x and y values where the image is to be sampled.
For example <code>SET x=0,1,.01 SET z=IMAGE(x,0.5)</code> will extract a horizontal
cross section through an image. As an alternative, you can use (0-based)
indices to extract the values with <code>IMAGE[expr,expr]</code>; there are
examples under IMAGE (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN36">Image</a>).
<a name="IDX295"></a>
 
<code>HISTOGRAM(expr1:expr2)</code> constructs a histogram from a vector,
where the data is in <code>expr1</code>, and <code>expr2</code> (which must be sorted)
gives the location of the bins.
If the values of <code>expr2</code> are equally spaced, the `location' of the bin
means the centre; if they are not, a bin is defined by saying that points with
value <code>(e2[i-1] + e2[i])/2 &lt;= x &lt; (e2[i] + e2[i+1])/2</code> go into the
<code>i</code>th bin.
Note that values on bin boundaries go into the higher bin.
<a name="IDX296"></a>
<a name="IDX297"></a>
<a name="IDX298"></a>

</p>
<p>
<code>a ? b : c</code> is very useful if you want to treat some value of an
expression specially. You could do this with a loop but <code>?:</code> is
much faster; for example

</p><pre>set y = lg(x &gt; 0 ? x : 1e-37)
set y = sqrt(x &gt;=0 ? x : 0)
</pre>

<p>
Due to the way that SM evaluates these expressions you may see warnings from
the parts of the expressions that are not used (i.e. where the logical
expression is false). You can turn down the verbosity, of course, or you
could try sending mail us mail to see if we can't fix it (but it isn't easy,
or else we'd have done it already).

</p>
<p>
See `Logical' for the logical operators, `Strings' for string operators,
and `whatis' for finding out if strings are numbers, words, vectors, or
whatever.

</p>

<hr><h2><a name="SYN6">Axis</a></h2>
<pre>Syntax: AXIS A1 A2 VSMALL VBIG AX AY ALEN ILABEL ICLOCK
        AXIS A1 A2 VSMALL VBIG VLAB AX AY ALEN ILABEL ICLOCK
        AXIS A1 A2 ASMALL ABIG AX AY ALEN ILABEL ICLOCK
</pre>

<p>
<a name="IDX299"></a>
<a name="IDX300"></a>

</p>
<p>
Makes an axis labeled from <code>A1</code> to <code>A2</code> at location <code>AX</code>,
<code>AY</code>, length <code>ALEN</code>.
The first form (with <code>VSMALL</code> and <code>VBIG</code>) specifies the values
where you want small and big ticks explicitly; if you specify the string-valued
vector <code>VLAB</code> it will be used to label the big ticks.
The third form is more
obscure: If <code>ABIG</code> &gt; 0 use that for spacing of large ticks.
If <code>ASMALL</code> &lt; 0 make a logarithmic axis, if <code>ASMALL</code> = 0, do
the default. (See TICKSIZE for more on the meaning of negative
<code>ASMALL</code> and/or <code>ABIG</code>).
If <code>ASMALL</code> &gt; 0 try to use that for the spacing of small ticks.

</p>
<p>
<code>ILABEL</code> is 0 for no labels, 1 for labels parallel to axis, 2 for
perpendicular to axis, and 3 for neither labels nor ticks.
<code>ANGLE</code> determines the angle of the axis.

</p>
<p>
<code>ICLOCK</code> is used for (too) many purposes; it's treated as three
integers of 1, 2, and 1 bits respectively.

</p><pre>ICLOCK      &amp; 0x1:      Control the ticks orientation:
                        0       Anticlockwise from the axis
                        1       Clockwise from the axis
(ICLOCK&gt;&gt;1) &amp; 0x3:      Control the tick direction:
                        0       Ticks are perpendicular to axis
                        1       Ticks are vertical
                        2       Ticks are vertical
                        3       Don't draw any ticks
(ICLOCK&gt;&gt;3) &amp; 0x1:      Control which side of the axis the ticks appear:
                        0       The same size as the labels
                        1       The opposite side to the labels
</pre>

<p>

</p>
<p>
If you prefer not to think in terms of bitwise operators, this can be
written as if <code>ICLOCK</code> is even the ticks are anticlockwise on the
axis, if odd they are clockwise. You usually want the ticks
perpendicular to the axes, and this is what you get with <code>ICLOCK</code> 0
or 1; if it is 2 or 3 the ticks are vertical, and if 4 or 5 they are
horizontal. The labels are on the opposite side of the axis from the
ticks unless you add 8 to the numbers given above.

</p>
<p>
For example, the following commands are equivalent to <code>BOX</code>:

</p><pre>ANGLE 0
AXIS $fx1 $fx2 0 0 $gx1 $gy1 $($gx2-$gx1) 1 $(0|8)
AXIS $fx1 $fx2 0 0 $gx1 $gy2 $($gx2-$gx1) 0 $(1|8)
ANGLE 90
AXIS $fy1 $fy2 0 0 $gx1 $gy1 $($gy2-$gy1) 2 $(1|8)
AXIS $fy1 $fy2 0 0 $gx2 $gy1 $($gy2-$gy1) 0 $(0|8)
ANGLE 0
</pre>

<p>
(except that I set <code>ICLOCK</code>'s <code>0x8</code> bit to draw the ticks
outside the box).

</p>
<p>
If you want to label the bottom axis of some
plot only at prime points try

</p><pre>SET b={1 2 3 5 7 11 13 17 19} SET s=0,20
AXIS 0 20 s b 3500 3500 27500 1 0
</pre>

<p>
If you have used LIMITS to scale the axes and LOCATION or WINDOW
to move them, you could say something like

</p><pre>AXIS $fx1 $fx2 s b $gx1 $gy1 $($gx2-$gx1) 1 0
</pre>

<p>
An example of using your own string valued labels would be:

</p><pre>set s=1,7,.5 set b=1,7 set labs={ O B A F G K M }
LIMITS 1 7 0 0
AXIS 0 10 s b labs 3500 3500 27500 1 0
</pre>

<p>
which works as expected. If you don't have a shift key and try using
lower case (obafgkm) you'll be surprised as all the letters are not
at the same level (as they don't all have the same height). The easiest way
to deal with this is to make them all the same height:

</p><pre>set labs={ o b a f g k m } + '\\strut'
</pre>

<p>
(a strut is a TeXism that has the height and depth of a parenthesis;
I'm afraid that you do have to escape the \ in the string). If that leaves
too much space try:

</p><pre>set labs='\\move 100' + { o b a f g k m } + '\\strut'
</pre>

<p>
I think that you get the point.

</p>
<p>
If you want more control over placement and sizes of axis labels and
ticks, you can force SM to draw them separately:

</p><pre>        EXPAND 0.5
        AXIS $fx1 $fx2 0 0 $gx1 $gy1 $($gx2-$gx1) 0 $(1&lt;&lt;3)
        EXPAND 1.44
        AXIS $fx1 $fx2 0 0 $gx1 $gy1 $($gx2-$gx1) 1 $(3&lt;&lt;1)
</pre>

<p>
gives smaller-than-usual ticks outside the box with larger-than-usual labels
(you could have used <code>define default_font "2"</code> to achieve the latter)
<a name="IDX301"></a>

</p>
<p>
The distance of labels from axes is controlled by the SM variable
<code>label_offset</code>; increase it to move them further away.
<a name="IDX302"></a>

</p>
<p>
Rather than use AXIS to draw all of your axes, it may be easier
to use BOX with some 3's to disable its axis-drawing habits. You'll
still get a box, but no ticks or labels. For example,

</p><pre>LIMITS 0 1 0 10 BOX 1 2 0 3 TICKSIZE 0 0 -1 0 BOX 3 3 1 3
</pre>

<p>
will label the <i>y</i>-axis with both linear and logarithmic axes.

</p>
<p>
<em>This was changed in V2.1: To specify logarithmic axes you should
now specify the logarithms, just as you do to BOX.</em> For example, to
draw a logarithmic axis running from 1 to 1000, 
specify <code>A1</code> as 0 and <code>A2</code> as 3, rather than 1 and 1000. 

</p>
<p>
See NOTATION if you want to control the use of floating point
or exponential notation.
You can control the font used by setting
the variable <code>default_font</code>.
If you want your positive and negative exponents to line up
define the SM variable <code>line_up_exponents</code>; if it's <code>1</code> they'll
be padded with a space, if <code>2</code> or more, with a <code>+</code>
(you can do this in your <tt>`.sm'</tt> file).

</p>
<hr><h2><a name="SYN7">Box</a></h2>
<pre>Syntax: BOX [ INTEGER1 INTEGER2 [ INTEGER3 INTEGER4 ] ]
</pre>

<p>
<a name="IDX303"></a>
<a name="IDX304"></a>

</p>
<p>
   BOX puts axes around the plot region, labelling the lower and left according
to the values set by LIMITS and TICKSIZE.
If arguments <code>INTEGER1</code> and <code>INTEGER2</code> are included (default 1 and 2)
they are used as <code>ILABEL</code>
arguments for the lower and left axes (see AXIS). An <code>ILABEL</code> of 0 means
to omit axis labels, 1 produces labels parallel to the axis, 2 perpendicular, 
3 omits both labels and tickmarks, and 4 omits the axis entirely.
<code>INTEGER3</code> and
<code>INTEGER4</code> are
used for the top and right axes.

</p>
<p>
If you want to change the font used for axis labels, define the
variable <code>default_font</code>, either interactively (<code>DEFINE
default_font oe</code>), or by putting a line in your <tt>`.sm'</tt> file:
<code>default_font oe</code>. This affects regular as well as axis labels,
and only works if you use <code>TeX_strings</code>, which we recommend
anyway.
<a name="IDX305"></a>
<a name="IDX306"></a>

</p>
<p>
See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN51">Notation</a> if you want to control the use of
floating point or exponential notation, and some details on how to draw
exponents.  If you want more control over your axis labels, see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN6">Axis</a>.

</p>
<hr><h2><a name="SYN8">Break</a></h2>
<pre>Syntax: Break
</pre>

<p>
<a name="IDX307"></a>

</p>

<p>
   Exit the current WHILE (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN82">While</a>) loop, and continue executing
commands after it.

</p>
<p>
You cannot use BREAK to escape from a DO loop; either embed the loop in
a macro and use RETURN to exit early, or rewrite the DO as a WHILE loop.

</p>
<hr><h2><a name="SYN9">Chdir</a></h2>
<pre>Syntax: CHDIR WORD
</pre>

<p>
<a name="IDX308"></a>
<a name="IDX309"></a>
<a name="IDX310"></a>

</p>
<p>
Set the current directory to be <code>WORD</code>, where <code>WORD</code> is any valid
directory. It might be wise to enclose it in quotes,
e.g.  <code>CHDIR "[-.more_data]"</code>, or use the <code>cd</code> macro.
The new directory only affects SM,
for example <code>DATA</code> or <code>SAVE</code> commands. When you exit
SM, you will be back 
where you started. If the directory starts with a `~',
the `~' will be replaced by the name of your home directory. This
is the only 
place that `~' is significant; in particular it will not be recognised
by the DATA command.<a name="DOCF19" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT19">(19)</a>

</p>
<p>
Your current directory is always available as the <code>$cwd</code> variable.

</p>

<hr><h2><a name="SYN10">Connect</a></h2>
<pre>Syntax: CONNECT WORD1 WORD2 [ IF (expr) ]
</pre>

<p>
<a name="IDX311"></a>

</p>
<p>
   CONNECT draws line segments connecting the points in vectors <code>WORD1</code> and
<code>WORD2</code>. If the IF clause is present, only connect those points for which 
<code>expr</code>
(see the section on vector arithmetic) is non-zero. Only contiguous
points in the input vectors will be connected, resulting in a number of
line-segments. If you don't want this behaviour, say something like

</p><pre>set l = (z==1) ? 1 : 0  set x=xx if(l) set yy=y if(l) connect xx yy
</pre>

<p>

</p>
<p>
In fact, either or both of the <code>WORD</code>s may be replaced by
`parenthesised expressions', i.e. expressions in parentheses. For example,

</p><pre>CONNECT x (2*y)
</pre>

<p>
plots x against 2y.

</p>
<p>
If <code>WORD1</code> and <code>WORD2</code> have different dimensions CONNECT will
ignore the excess points in the longer vector. If you want to plot a
constant value you'll have to explicitly promote it, for example

</p><pre>CONNECT x (1+0*x)
</pre>

<p>
which makes a rather boring plot.

</p>
<p>
To draw a line in a label you can either use CONNECT or DRAW, or use the
TeX-macro <code>\line</code> to directly insert your line.

</p>
<hr><h2><a name="SYN11">Contour</a></h2>
<pre>Syntax: CONTOUR 
</pre>

<p>
<a name="IDX312"></a>
<a name="IDX313"></a>

</p>
<p>
Makes a contour plot of an image read by the IMAGE command
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN36">Image</a>).
The contour levels are set using LEVELS;
plot coordinates are taken to be those set by the
LIMITS command, and contours are drawn in the current LTYPE. It is not
possible to produce labeled contours.

</p>
<p>
Any pixels whose value is <code>NaN</code> are ignored, as are any whose value
equals the SM variable <code>$missing_data</code>; by default this is some
very large number (usually 1e37). If a contour line runs into a missing
data point it simply stops, rather than being made to join up with some
other line that also runs into a missing point.

</p>
<p>
See also DITHER for dithering images, IMAGE CURSOR for using cursors to
get values from images, MINMAX for finding the minimum and maximum of
images, and Arithmetic for extracting cross-sections of images.

</p>
<hr><h2><a name="SYN12">Ctype</a></h2>
<pre>Syntax: CTYPE WORD
        CTYPE INTEGER
        CTYPE = expr
</pre>

<p>
<a name="IDX314"></a>
<a name="IDX315"></a>
<a name="IDX316"></a>
<a name="IDX317"></a>
<a name="IDX318"></a>
<a name="IDX319"></a>

</p>
<p>
With <code>WORD</code>, set the line colour to be <code>WORD</code>, if your
display device supports
coloured lines, where <code>WORD</code> must be one of <code>default</code>, <code>white</code>,
<code>black</code>, <code>red</code>, <code>green</code>, <code>blue</code>, <code>cyan</code>, <code>magenta</code>,
or <code>yellow</code>. The colours are those composed of three, zero, one, or two
of the primary colours red, green, and blue. When a device is opened
it sets <code>default</code> to some device specific value (e.g. white for
xwindows, black for sunwindows).

</p>
<p>
Initially, CTYPE <code>INTEGER</code> is another way of selecting the same colours
as are available with CTYPE <code>WORD</code>, where CTYPE 1
is the equivalent of the
first colour listed above, or white (so <code>default</code> is 0).
However, the CTYPE = <code>expr</code>
command redefines the available colours to be the elements of the array
given by expr. If it is arithmetic, each element of is interpreted as
RED + 256*GREEN + 256^2*BLUE for the given colour, where 0 is off,
and 255 corresponds to full intensity.
If the <code>expr</code> is string-valued it specifies the names to be
used for the colours that you have just defined. Any connection
between the names and colours is, of course, up to you.
<a name="IDX320"></a>
You can get the current value of CTYPE with <code>DEFINE ctype |</code>,
and vectors of the current ctypes and their names as <code>CTYPE()</code> and
<code>CTYPE(STRING)</code>.
<a name="IDX321"></a>

</p>
<p>
So another way to get
white lines would be to say:

</p><pre>CTYPE = { 0 255 0 } + 256*({ 0 255 255 } + 256*{0 255 0 })
CTYPE 1
</pre>

<p>
while

</p><pre>CTYPE 2
</pre>

<p>
would give green lines.

</p><pre>CTYPE ={ black white green }
</pre>

<p>
would make your colour names correspond to reality again. You can use any
names you like, you are certainly not restricted to the initial set.

</p>
<p>
You can reset the colours to their default (i.e. correct) values using the macro
<code>reset_ctype</code>.

</p>
<p>
If you want to add a new colour you can say:

</p><pre>CTYPE = CTYPE() concat 200 + 256*(100 + 256*100)
CTYPE = CTYPE(STRING) concat 'pink'
</pre>

<p>
and delete one with

</p><pre>foreach f {"" string} {
   set ct=ctype($f) if(ctype(string) != 'pink') ctype = ct
}
</pre>

<p>
(see also macros <code>add_ctype</code> and <code>del_ctype</code>).

</p>
<p>
Many devices (e.g. <code>sunview</code>) require you to specify
a number of colours that is a power of 2, so asking for 70 colours
will use up 128 slots. It is probably a good idea to
use as few colours as possible, as they are scarce resources on most displays.
You should also be aware that the display may use some of `your' slots
for the background, so specifying 63 colours on (e.g.) a sun actually
requires 64 (and asking for 64 will use up 128). If you specify more colours
than are physically available, or more than the device driver thinks
that you deserve, SM will interpolate your values of CTYPE for you.

</p>
<p>
If you are using X11 (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">Device</a>), you will probably need to use the
<code>-cmap</code> flag when openinig your device if you want to allocate many
private colours.

</p>
<p>
The default colour is specified
in the device drivers, or in the <code>DC</code> (Default Colour) graphcap
capability, and is set whenever a device is opened, so don't try to
modify it with a <code>CTYPE = expr</code> command. You can, however, override 
the default colour with a <code>foreground</code> entry in your <tt>`.sm'</tt> file; 
it should be the name of a colour (as listed above). You may also be able to
specify a background colour (as <code>background</code>). This is either a colour
name or a set of three integers in the range 0-255 specifying
the red, green, and blue values. We allow you this chance to specify arbitrary
colours because it's your only chance to affect the background, and you can't
use a CTYPE = command to compose your own palette. On some devices
the name of the background colour may be chosen from a wider selection;
for example if you are using Xwindows you may use any name from the
colour database.

</p>
<hr><h2><a name="SYN13">Cursor</a></h2>
<pre>Syntax: CURSOR 
        CURSOR WORD1 WORD2
        CURSOR READ
</pre>

<p>
<a name="IDX322"></a>

</p>
<p>
   Display the cross-hair cursor to enable you to get positions (in user
coordinates).  The current cursor position is typed on the screen every time
that you hit a key; some keys are special, specifically you can exit
the cursor routine by hitting `e' or `q'. If you exit with `e', CURSOR issues a
relocate command to set the current plot position to the cursor
position, and puts the command in the history buffer. If you exit with `q',
no entry is made in the buffer (but the current position is still updated).
Usually successive positions overwrite
each other, but if a digit is used to mark a point then the position is
followed by a newline, so the next time you hit a key its position
will appear on the next line. (You can remember that digits lead to
numerous values appearing). If the verbosity (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN77">Verbose</a>) is one or
more, a message will be printed reminding you what keys to use.

</p>
<p>
If you simply want to read the current position of the cursor, you can
say <code>CURSOR READ</code>; this is mostly useful within macros (see, for
example, <code>animate</code> in the macro file <tt>`3d'</tt>).

</p>
<p>
Many graphics devices have things called "GIN terminators".
SM usually expects that this be set to `Carriage Return' with
no extra characters, EOT is a popular (unacceptable) choice. If you
have trouble check your graphics setup screen, then with your
SM Guru who can look up in graphcap to see what is expected.
If the local Guru were very friendly, he could change your GIN
terminator to anything he wanted, even EOT, but he probably isn't.
<a name="IDX323"></a>

</p>
<p>
   The second form enables you to define a pair of vectors <code>WORD1</code>
and <code>WORD2</code>.  SM provides you with a cursor, and every time that
you hit a key it prints its position (just as above).  If the letter is
`e' it draws a point of the current type at the current position,
prints the current position, and enters the (x,y) coordinates in the
vectors; if you use `m' to mark a point the coordinates are not written
to the screen, but the point is still added to the vectors.  `p' defines
the current point, and exits. Exit without defining another point with
`q', so the sequence `e' `q' is equivalent to `p'. You can also
abort with a <kbd>control-C</kbd> in which case <code>WORD1</code> and
<code>WORD2</code> are unchanged.

</p>
<p>
Note that if you want to use SPLINE on the vectors produced in this
way, you should take care that at least one of the vectors is monotonic and
increasing, or use the SORT command.

</p>
<p>
See also IMAGE CURSOR which returns the value under the cursor as well
as the position if an IMAGE (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN36">Image</a>) has been defined.

</p>
<p>
For devices with mice, if the buttons do anything, they should generate
the characters `e', `p', and `q' (starting at the left).

</p>
<p>
The SunWindows cursor is slightly different. The cursor position is given 
by a pointing finger (it's the best we could do), and
SM won't see any characters typed at
the keyboard until you hit a carriage return. Device <code>sunwindows</code> is
obsolete anyway, you should simply switch to using the <code>sunview</code> driver.
<em>Its</em> cursor has a bug, in that it only sees every other character
typed at the keyboard. If I knew why I'd fix it.
<a name="IDX324"></a>

</p>
<hr><h2><a name="SYN14">Data</a></h2>
<pre>Syntax: DATA file
</pre>

<p>
<a name="IDX325"></a>
<a name="IDX326"></a>

</p>
<p>
   Use file <code>file</code> as the source of data read with the READ command.
The file is assumed to have numerical data in columns separated by spaces,
or tabs. The range of lines specified by LINES is reset. If the file
can't be opened for read, you will be warned. The variable <code>$data_file</code>
is set to <code>file</code>.
See the READ command to see how to read the data.
You may need to quote the filename, e.g. <code>DATA "/usr/file"</code>, which
you can do by using the macro <code>da</code>: <code>da /usr/file</code>.

</p>
<p>
Perverse people who wish to use filenames such as <tt>`12'</tt> or
<tt>`3.14'</tt> will find that they get syntax errors. If they must
persist <code>DATA "3.14 "</code> will work.

</p>
<hr><h2><a name="SYN15">Define</a></h2>
<pre>Syntax: DEFINE name value
        LOCAL DEFINE name ...
        DEFINE name { value_list } [ \[ INTEGER, INTEGER \] ]
        DEFINE name &lt; value_list &gt; [ \[ INTEGER, INTEGER \] ]
        DEFINE name DELETE
        DEFINE name LOCAL
        DEFINE name ( expr )
        DEFINE name :
        DEFINE name |
        DEFINE name ? [ { prompt } ]
        DEFINE name ? [ &lt; prompt &gt; ]
        DEFINE name READ INTEGER
        DEFINE name READ INTEGER INTEGER2
        DEFINE name IMAGE
        IMAGE DEFINE name  value
        LIST DEFINE [ begin end ]
</pre>

<p>
<a name="IDX327"></a>
<a name="IDX328"></a>
<a name="IDX329"></a>

</p>
<p>
All of these varieties of DEFINE define variable <code>name</code> to have some
value, but
as variables can be defined in all sorts of ways there are a good
many possibilities. With the prefix LOCAL (which is allowed in front
of <em>any</em> of the DEFINE commands), the variable will be local to the
macro; (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN43">Local</a>).

</p>
<p>
<code>Name</code> is a single word starting with a letter, and
containing only letters, digits, or `_', and may be a keyword.
Whenever SM comes across
<code>$name</code>, it is interpreted as a reference to variable <code>name</code> and
<code>$name</code> is replaced by its value.
(Note that some variables such as <code>date</code> are special as they always
contain an up-to-date value, for an example try <code>echo $date</code> sometime.
These variables are listed under <code>DEFINE name |</code>.)
You can also evaluate expressions with <code>$(expr)</code>, for example
<code>echo $(pi/2)</code>. The value can't be longer than about 80 characters,
except for the <code>value_list</code> form in which case its length can
be essentially infinite.

</p>
<p>
If you just want to know if a variable is defined, then <code>$?name </code>
is defined to have the value 1 if <code>name</code> is defined, and 0 otherwise.
Variables are not usually expanded within double quotes or {}, but if you use
the syntax <code>$!name</code> the variable will be expanded within double quotes;
<code>$!!name</code> will be expanded anywhere.

</p>
<p>
For the variants of DEFINE <code>name value</code> and DEFINE <code>name value_list</code>,
<code>value</code> is either a word or number, or a list.
The difference between using
{} and <code>&lt;&gt;</code> to delimit a list is that keywords can appear within {},
but variables are not usually expanded.

</p>
<p>
With the optional [ INTEGER, INTEGER ] clause (I apologise for the
notation in the manual; those [] are required) you can choose a
subrange, just as SUBSTR (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN71">Strings</a>) can choose a part of a vector
element.  For example,

</p><pre>  define s &lt;"/abc/def"&gt;[1,-2]  echo $s
</pre>

<p>
prints

</p><pre>  abc/d
</pre>

<p>
Why is this useful? Because it provides a way of working around limits
on lengths of vector elements; otherwise this example is equivalent to

</p><pre>  define s (substr('/abc/def', 1,-2))  echo $s
</pre>

<p>
DEFINE <code>name</code> DELETE, deletes a variable (see
also the macro undef to undefine variables).
<a name="IDX330"></a>

</p>
<p>
DEFINE <code>name</code> LOCAL, which is only allowed within macros,
creates a variable which will only be visible from the current macro, and from
macros called by it (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN43">Local</a>).
Such local variables are automatically destroyed when
leaving the macro within which they were created, and may not be explicitly
deleted. This is similar to the behaviour of numbered variables, except that
they really are local (i.e. they are only visible in the macro, and
not in its descendents; SM's LOCAL variables have nested scope rather than
being truly local).

</p>
<p>
An alternative is to prefix the DEFINE command itself with LOCAL;
<code>DEFINE me LOCAL  DEFINE me RHL</code> is exactly equivalent to
<code>LOCAL DEFINE me RHL</code>.

</p>
<p>
A common use for DEFINE LOCAL is:

</p><pre>   define i local
   foreach i { sorbus aucuparia } { set $i local }
</pre>

<p>
to protect a FOREACH (or DO) variable, and all local vectors, in one simple
line. It is because such loop variables are automatically destroyed that
attempts to delete local variables are not reported at VERBOSE levels of
1 or less.

</p>
<p>
DEFINE <code>name ( expr )</code> defines a variable to have the value of
a (scalar) expression. When possible, it is more efficient to use
vectors to perform calculations on scalars, rather than putting them
into variables. It is also more efficient (and more obscure!) to use
numbered variables (macro arguments) than real named ones.
As a special dispensation, the expression can be an element of a
string-valued vector (elements of arithmetic vectors are allowed too
of course).
<a name="IDX331"></a>

</p>
<p>
DEFINE <code>name :</code> defines the variable <code>name</code> from
the environment file. If <code>name</code> can't be found, and is capitalised,
SM will look for it in the environment (as a logical variable for VMS
users).

</p>
<p>
<code>DEFINE name |</code> is used to define a variable
from an internal SM variable such as <code>expand</code> or <code>angle</code>.
These variables can be listed with <code>LIST DEFINE |</code> (or by
<code>LIST DEFINE</code> if <code>VERBOSE</code> is two or more); a possibly incomplete
list is: <code>angle</code>, <code>aspect</code>, <code>ctype</code>, <code>cwd</code>,
<code>date</code>, <code>exit_status</code>, <code>expand</code>, 
<code>fx1</code>, <code>fx2</code>, <code>fy1</code>, <code>fy2</code>,
<code>gx1</code>, <code>gx2</code>, <code>gy1</code>, <code>gy2</code>,
<code>ltype</code>, <code>ltype_expand</code>, <code>lweight</code>,
<code>nx</code>, <code>ny</code>, <code>ptype</code>,
<code>sdepth</code>, <code>sheight</code>, <code>slength</code>,
<code>distance</code>, <code>theta</code>, <code>phi</code>,
<code>uxp</code>, <code>uyp</code>, <code>verbose</code>, 
<code>xp</code>, and <code>yp</code>. The
current plot limits are <code>fx1</code> etc., (or <code>gx1</code> etc. in device
coordinates), the size of the screen (in pixels, or dots, or whatever the
hardware uses) is <code>nx * ny</code>, the current position (in user
coordinates) is <code>(uxp,uyp) </code>,
the current position (in plot
coordinates) is <code>(xp,yp)</code>, <code>exit_status</code> is the return code from the
last <code>!</code> command,
<code>sdepth</code>, <code>sheight</code>, and <code>slength</code> are the depth, height, and
length of the last string drawn to the screen,
<code>distance</code>, <code>theta</code>, and <code>phi</code> are the viewpoint for surface
plots (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN79">Viewpoint</a>),
and the rest should be obvious. In the case of <code>angle</code>, <code>expand</code>,
and <code>ptype</code>, if you used a vector to set (e.g.) the expansion, the
value given will be that of its first element, and there's also
an extra value giving its dimension. This allows you to say things like

</p><pre>if(dimen(&lt;$angle&gt;) == 2) { echo You used a vector angle command }
</pre>

<p>
<a name="IDX332"></a>
<a name="IDX333"></a>
<a name="IDX334"></a>

</p>
<p>
This sort of variable changed a little with version 2.1.1. The variables
that you can use have not changed, but their usage has
slightly. They are all defined for you when SM starts and each is always
correct, tracking the current value of the corresponding internal variable.
For example, try <code>echo $angle\n angle 45 echo $angle</code>. If you now
say <code>define angle |</code>, <code>$angle</code> will cease to track the internal
value and will remain fixed (the same effect can be achieved with
<code>define angle 45</code>). When you say <code>define angle delete</code> it will
once more track the internal value. Your old code will continue to work,
but in many cases it is possible to remove the explicit definition
with <code>|</code>. This special sort of variable will not be <code>SAVE</code>d,
and will not show up if you list the currently defined variables (unless
<code>VERBOSE</code> is two or more).

</p>
<p>
DEFINE <code>name ?</code> will prompt you for the value
of <code>name</code> at the keyboard, using the prompt string if given,
otherwise the name of the variable. The old value of the variable (if
defined) is printed within [], and is taken to be the default if you
simply hit carriage return. As previously discussed, the difference between
{} and <code>&lt;&gt;</code> is in the treatment of keywords and variables. If you
don't want to use {} (probably because of something weird to do with when
variables are expanded), you can always use quotes within <code>&lt;&gt;</code>.

</p>
<p>
The versions of the DEFINE command including READ define variables from
the current data file. DEFINE <code>name</code> READ <code>INTEGER</code>
sets <code>name</code> to be line <code>INTEGER</code> of the current data file, while
DEFINE <code>name</code> READ <code>INTEGER INTEGER2</code>
defines <code>name</code> to be word <code>INTEGER2</code> of line <code>INTEGER</code>.
<code>name</code> is subject to the usual restrictions. If the line begins with
a <code>#</code> the first character is simply ignored when defining variables.

</p>
<p>
DEFINE <code>name</code> IMAGE defines a variable from a file read with the
IMAGE or TABLE command. Currently this only works for <code>NX</code>, <code>NY</code>,
<code>X0</code>, <code>X1</code>,
<code>Y0</code>, <code>Y1</code>, or any keyword from a FITS header. Any minus signs
(<code>-</code>) appearing in <code>name</code> are converted to underscores (<code>_</code>),
as SM doesn't allow <code>-</code> in a variable name.

</p>
<p>
You can define further such variables using IMAGE DEFINE name value,
a facility that is chiefly useful in connection with the WRITE IMAGE command
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN36">Image</a>).

</p>
<p>
LIST DEFINE lists all currently defined variables, or all those which are
between <code>begin</code> and <code>end</code> alphabetically (asciily).

</p>
<p>
Examples

</p><pre></pre>


<pre>DEFINE v1 5.993
DEFINE label1 KPNO
DEFINE label1 &lt; National Optical Astronomical Observatory &gt; 
DEFINE v2 ($v1 + 3.4)
DEFINE v1 DELETE
DEFINE age ? { How old are you? }
DEFINE macros : WRITE STANDARD "$!macros"
</pre>

<p>
(Note that we couldn't have used <code>&lt;&gt;</code> to prompt for your age, because then
the ? after <code>you</code> would be treated as a keyword).

</p>
<p>
To illustrate the <code>DEFINE name READ</code> commands, consider a file with
the following lines:

</p><pre>This is a file containing astronomical data
Magnitude  Intensity  Wavelength  Error
</pre>

<p>
Then using the <code>DEFINE</code> commands as follows:

</p>

<pre>DEFINE title READ 1
DEFINE labelx READ 2 3
</pre>

<p>
will assign the string <code>This is a file containing astronomical data</code>
to the variable <code>title</code>, and the word <code>Wavelength</code> to the variable
<code>labelx</code>, so you can say <code>XLABEL $labelx</code>.

</p>
<hr><h2><a name="SYN16">Delete</a></h2>
<pre>Syntax: DELETE [ INTEGER1 [ INTEGER2 ] ]
        DELETE HISTORY [ ! ]
        DELETE HISTORY [ INTEGER1 [ INTEGER2 ] ]
        DELETE WORD
</pre>

<p>
<a name="IDX335"></a>

</p>
<p>
   Delete commands <code>INTEGER1</code> to <code>INTEGER2</code> (inclusive) from the
history buffer. If the <code>INTEGER</code>s are not present, delete the last
command. DELETE 0 will delete all history commands. If the <code>INTEGER</code>s
are negative they are interpreted relative to the current command, so
<code>-1</code> is the last command.

</p>
<p>
   The DELETE HISTORY commands are identical to the DELETE commands, except
they themselves <em>do</em> appear on the history list; they are preserved for
backwards compatibility and because DELETE HISTORY \n can be used to prevent
a command from appearing on the history list (the macro <code>del1</code>).
If a macro contains a <code>DELETE HISTORY</code>, or
calls a macro that contains one, or ... the macro will not appear on the
history list.
Traditionally, this meant that if there were two (or more) occurrences
of DELETE HISTORY the
previous command(s) were also be deleted, but in SM version 2.2.1 this
has been changed, and DELETE HISTORY will only delete the last command
typed at the keyboard. If for some nefarious purpose you really do want
to delete older commands too, you can say DELETE HISTORY ! and the command
will work the old way.

</p>
<p>
DELETE WORD deletes the vector <code>WORD</code> (see SET <code>WORD</code>
or READ <code>WORD</code> for how to define vectors), <code>MACRO name DELETE</code>
is used to delete a macro, <code>DEFINE name DELETE</code> deletes a variable.

</p>
<hr><h2><a name="SYN17">Device</a></h2>
<pre>Syntax: DEVICE WORD [ rest_of_line ]
        DEVICE INTEGER [ WORD ] [ rest_of_line ]
        DEVICE META WORD
        DEVICE META CLOSE
</pre>

<p>
<a name="IDX336"></a>
<a name="IDX337"></a>

</p>
<p>
(The <code>DEVICE INTEGER</code> form is retained for historical interest and
backwards compatibility only.)

</p>
<p>
Choose a device to plot to. Exactly which devices are available depends
on your hardware configuration and how SM was compiled. You can list
available devices with the <code>LIST DEVICE</code> command (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN42">List</a>).
When you specify a device the previous device is closed, which
may lead to some action being taken (for example, sending a plot
to a printer).

</p>
<p>
When a device is opened it is looked up by name in the <tt>`graphcap'</tt> file
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">The Stdgraph Graphics Kernel</a>).
In some cases all the information that SM needs to plot to the device is
available there (for example <code>xterm</code> or <code>postscript</code>); such devices
are referred to as <code>stdgraph</code> devices. Otherwise the graphcap entry
will contain the name of the real device driver, for example <code>x11</code>.
Anything else on the line is passed to the device driver.
<a name="IDX338"></a>
<a name="IDX339"></a>
In particular, for the <code>stdgraph</code> devices an argument that is not
specifically processed by the device is taken to be the name of a file to save
the plot in. Thus <code>device postscript foo.ps</code> creates a plot in a file
called <tt>`foo.ps'</tt><a name="DOCF20" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT20">(20)</a>

</p>
<p>
The pseudo-device META is special (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN49">Meta</a>). It is used to support
metafiles, which allow you to save a plot as you display it, and
finally send it to a different device.

</p>
<p>
Especially for hardcopy devices, you may have to specify which one you want,
e.g. <code>DEVICE postscript latypus</code>. Because this depends on how your
local graphcap was configured, you'll have to see your Guru for guidance;
see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">The Stdgraph Graphics Kernel</a>.

</p>
<p>
When a device is opened, it is set to the current CTYPE, LWEIGHT, and
LTYPE, and the proper aspect ratio is chosen to make text and plotted
points look nice. It also looks for an entry <code>foreground</code> in your <tt>`.sm'</tt> file, and uses it as the default colour for the device (this
overrides any default that the device driver may have specified). The
device driver may (or may not) choose to honour a <code>background</code>
entry as well. These colours may be specified either as names (see
CTYPE), or the background colour may be given as a set of three numbers, 
which are interpreted as the
red, green, and blue intensities in the range 0 - 255. Some devices may allow
you a wider selection of background names; for example the Xwindows driver
allows any name from the colour database.
<a name="IDX340"></a>
<a name="IDX341"></a>
<a name="IDX342"></a>

</p>
<p>
If you want to use some foreground colour that <code>CTYPE</code> doesn't usually
understand you must define it before opening the device. For example, after
defining the macro

</p><pre>add_colour 4 ## add a colour to the standard set. Usage: name r g b
             CTYPE=&lt;0 255 0 255 0 0 0 255 255 $2&gt; + \
                 256*(&lt;0 255 0 0 255 0 255 0 255 $3&gt; + \
                       256*&lt;0 255 0 0 0 255 255 255 0 $4&gt;)
             ctype=&lt;default white black red green blue cyan magenta yellow $1&gt;
</pre>

<p>
you could say <code>add_colour gray 200 200 200</code>, after which `gray' would
be a perfectly good `foreground' colour.

</p>
<p>
Different ways of plotting to
the same device (e.g. portrait or landscape) are accommodated by using
different drivers (e.g. <code>postport</code> and <code>postland</code> for postscript
devices) rather than some magic command to SM.
<a name="IDX343"></a>
<a name="IDX344"></a>

</p>

<ul>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">Nodevice</a>: The NULL device
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">Borland</a>: Borland Graphics on a PC
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">Metafile</a>: Graphics Metafiles
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">OS/2</a>: OS/2 Presentation Manager
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">Postscript</a>: Postscript Devices
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">SGI</a>: The Silicon Graphics (and RS-6000) Device
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">Stdgraph</a>: The General Device Driver, using Graphcap
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">SunView</a>: The SunView (and Sunwindows) Devices
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">Tk</a>: A Tk Widget
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">UnixPC</a>: The Unix-PC Device
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">MS-Windows</a>: PC Graphics under MS-Windows
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">VAX-UIS</a>: VAX/VMS UIS$ device
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">XWindows</a>: The X-Windows Devices (X10 and X11)
</li></ul>

<p>
The NULL device
<a name="IDX345"></a>

</p>
<p>
DEVICE <code>nodevice</code> is always available; it is a bit bucket where
plot commands may be sent never to be seen again, the equivalent of
<code>/dev/null</code> (under unix) or <code>nl:</code> under VMS.

</p>
<p>
It is useful because it is always available; it's the current device when
SM is started.
Because SM submits plots only when the current
device is closed, and because opening <code>nodevice</code> closes the current
device, it is also used by the <code>hardcopy</code> command (in fact
<code>hardcopy</code> is a macro that expands to <code>DEVICE nodevice</code>).

</p>
<p>
Borland Graphics on a PC
<a name="IDX346"></a>
<a name="IDX347"></a>

</p>
<p>
SM works on a PC running DOS either by using Borland's graphics or windows
(see the section on MS-Windows); this section describes the former.
SM was ported
to run under DOS by Laurent Bartholdi, who also wrote the BGI and MS-Windows
device drivers. He gets all the credit for the PC version of SM, but of
course he is not responsible for any remaining bugs (some of which we
almost certainly created while merging the PC and regular versions).

</p>
<p>
The graphics drivers, the <tt>`.bgi'</tt> files, are assumed to be in a directory
given by the DOS <code>BGIPATH</code> environment variable; alternatively you
can specify a <code>bgipath</code> variable in your <tt>`.sm'</tt> file.

</p>
<p>
The DEVICE command takes two optional arguments:
<code>DEVICE bgi devtype mode</code>. The first, <code>devtype</code>, is the type of
hardware that you are running. If you want the driver to try to figure
this out for itself, use <code>DEVICE bgi detect</code> (this is the default
if you omit devtype entirely); for a listing of
possibilities say <code>DEVICE bgi ?</code>. The second argument, <code>mode</code>,
determines how SM switches between screen and graphics modes. Your options are
<code>none</code>, <code>swap</code> (the default), or <code>switch</code>; experiment to
see which works better for you. At present, a certain amount
of `snow' is left at the top of the graphics screen. This is very dependent
on the details of your graphics card, and we see no general way to prevent
its appearance.

</p>
<p>
Once you have decided what options you like best, you can set a variable
<code>stdmode</code> in your <tt>`.sm'</tt> file (e.g. to <code>detect swap</code>) to save
yourself some typing.

</p>
<p>
There is a `hot key', <code>ALT-F1</code>, that can be used to toggle between text
and graphics mode.

</p>
<p>
The current return value of the function <code>coreleft</code> is available as
<code>$coreleft</code> (which is like any other <code>DEFINE var |</code> variable).

</p>
<p>
OS/2 Presentation Manager

</p>
<p>
The OS2PM driver is used to display graphics in a Presentation Manger
graphics window under OS/2 v2.x (you should specify your terminal as
<code>os2pc</code>). Two optional arguments are currently supported:
</p><dl compact="compact">

<dt><code>-n</code>
</dt><dd>
Disable all backing for the graphics window. This will
significantly increase the drawing speed, but the contents
of the graphics window will not be redrawn when portions of 
the window are uncovered or when the window is resized.
</dd><dt><code>-gWxH</code>
</dt><dd>
Specify the window geometry. The W and H parameters should
contains the WIDTH and HEIGHT of the graphics window in pixels.
</dd></dl>

<p>
If DEVICE os2pm is specified without the -gWxH argument the graphics window
will be created the same size as the last previously displayed window. If
this is the first time the graphics window is created it will default to
600 x 400 pixels.

</p>
<p>
For example,

</p><pre>     DEVICE os2pm -g800x500
          .
          .
          .
     DEVICE os2pm -n
</pre>

<p>
The first DEVICE statement will produce an 800 x 500 pixel graphics
window with backing enabled. The second will again produce an 800 x 500
pixel window but with no backing.

</p>
<p>
Graphics Metafiles

</p>
<p>
As described elsewhere (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN49">Meta</a>) SM can save graphics commands
to a metafile while producing a plot on your screen.

</p>
<p>
Postscript Devices
<a name="IDX348"></a>
<a name="IDX349"></a>

</p>
<p>
Strictly speaking, there are no postscript devices, merely postscript
drivers in stdgraph (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">The Stdgraph Graphics Kernel</a>). On the other hand, SM is able
to drive postscript printers in a totally transparent way, so a user
can think of SM's postscript capability as discrete drivers. In the
following descriptions the arguments to the device command are referred to
as <code>$1</code>, <code>$2</code>, and so on. Aliases are listed in parentheses
after the device name, so <code>post_colour</code> can also be called
<code>post_color</code>.
Those
currently supported are:
</p><dl compact="compact">

<dt><code>postscript (POSTSCRIPT)</code>
</dt><dd>
The basic driver; produces 8x8inch output on the default printer.
</dd><dt><code>postport (POSTPORT)</code>
</dt><dd>
A full-page portrait-mode plot.
</dd><dt><code>postland (POSTLAND)</code>
</dt><dd>
A full-page landscape-mode plot.
</dd><dt><code>post_colour (post_color)</code>
</dt><dd>
Like <code>postscript</code>, but generates a colour postscript plot, and sends
it to a printer called ps_colour0.
</dd><dt><code>blackpostscript</code>
</dt><dd>
Like <code>post_colour</code>, but uses a black background.
</dd><dt><code>postfile (postencap)</code>
</dt><dd>
Like <code>postscript</code>, but generate an encapsulated postscript file in $1.
</dd><dt><code>postlandfile</code>
</dt><dd>
Like <code>postland</code>, but generate an encapsulated postscript file in $1.
</dd><dt><code>post_remote (postscript_remote)</code>
</dt><dd>
Like <code>postscript</code>, but prints to a printer <code>$2</code> on host <code>$1</code>.
</dd><dt><code>postland_remote</code>
</dt><dd>
Like <code>postscript</code>, but prints to a printer <code>$2</code> on host <code>$1</code>.
</dd><dt><code>postport_remote</code>
</dt><dd>
Like <code>postport</code>, but prints to a printer <code>$2</code> on host <code>$1</code>.
</dd></dl>

<p>
For an example of defining your own postscript device that takes a printer
name as an argument, see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">The Stdgraph Graphics Kernel</a>.

</p>
<p>
The Silicon Graphics (and RS-6000) Device
<a name="IDX350"></a>
<a name="IDX351"></a>

</p>
<p>
The Silicon Graphics device driver works. If you read this and want
more documentation, send mail to us and we'll get to it.

</p>
<p>
The General Device Driver, using Graphcap
<a name="IDX352"></a>

</p>
<p>
By far the majority of devices that SM supports are driven through the
<code>stdgraph</code> device; a partial list includes <code>tek4010</code>, <code>tek4012</code>,
<code>pericom</code>,
<code>selanar</code>, (or <code>hirez</code> ),
<code>versaterm</code> (or <code>macvt</code> ), 
<code>vt640</code> (a vt100 with retrographics ), <code>vt240</code> in REGIS mode,
<code>hard4012</code> or <code>hard4010</code> for a tek4010 that really has no decent
ascii mode, <code>tek4025</code>, <code>wyse1575</code>, <code>cit414a</code> or 414a.
We also support graphcap drivers for Postscript, QMS, and LN03 laser printers,
(device names <code>postscript, qms</code> and <code>ln03</code>). Stdgraph can also
cooperate with <code>raster</code> devices, for instance to plot on a lineprinter.

</p>
<p>
For the <code>stdgraph</code> (i.e. default) device driver the final word on
the command line (if present) is taken to be the name of a file to receive
the output that would ordinarily go to the screen, so if you say

</p><pre>device graphon outfile
</pre>

<p>
and then create a plot nothing will seem to happen. However, if you close the
device and write <tt>`outfile'</tt> to the terminal (maybe using /passall
if you are running VMS) your plot will appear.
In addition, any word
beginning with a colon will be taken to be part of a graphcap entry
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">The Stdgraph Graphics Kernel</a>), and prepended to the entry in the graphcap file
for your chosen device.
For example, if you wanted to save your postscript output in a file
you could say

</p><pre>dev postscript ":SY=echo File is $F:"
</pre>

<p>
which would replace the <code>SY</code> entry that sent the output
to the printer by a new one that merely tells you what the file is called.
If you'd prefer to give it a memorable name, you could say

</p><pre>dev postscript ":SY=echo File is \$F:OF=name:"
</pre>

<p>
or

</p><pre>dev postscript :SY@: :OF@: name
</pre>

<p>
(it doesn't matter if the entries are all in the same word). The former
redefines the output file <code>OF</code> to be "name", and makes <code>SY</code>
tell you so. The latter disables both <code>OF</code> and <code>SY</code>, so the generated
postscript would ordinarily go to the terminal (just like any other
graphics terminal), but a file <tt>`name'</tt> is specified, so the output is sent
there instead.
<a name="IDX353"></a>

</p>
<p>
If you find yourself frequently wanting to use a customised stdgraph device,
this mechanism can become rather tedious; you'd rather simply invent the
device and be done with it. The proper way to do this is to create a local
graphcap file (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC38">The Graphcap File</a>), and add your new device to it.
For example, if you wanted to define a postscript device that took the name of
the printer as its argument, you'd put an entry

</p><pre>mypostscript|like postscript, but specify the printer as its argument:\
        :SY=lpr -r -P$1 $F:TC=postscript:
</pre>

<p>
in your file, and merrily proceed with making beautiful plots
using <code>DEVICE mypostscript fred</code>. If you always want to use your new
device you could call it <code>postscript</code> and in effect redefine the
old <code>postscript</code> device (note carefully that I said <code>:TC=postscript:</code>
not <code>:tc=postscript:</code>; if I hadn't, an infinite loop would have resulted).
<a name="IDX354"></a>

</p>
<p>
The SunView (and Sunwindows) Devices
<a name="IDX355"></a>
<a name="IDX356"></a>
<a name="IDX357"></a>
<a name="IDX358"></a>

</p>
<p>
As the <code>sunwindows</code> driver is now obsolete, and may well disappear in
some future release, you should use the <code>sunview</code> driver instead.
<a name="IDX359"></a>
If you insist on using the old driver, it
must be run from within a gfxtool.

</p>
<p>
  The SunView window driver supports a subset of the usual SunView
command line arguments, specifically:
</p><dl compact="compact">

<dt><code>-WH</code>
</dt><dd>
Summarise options
</dd><dt><code>-Wi</code>
</dt><dd>
Open window as an icon
</dd><dt><code>-Wl label</code>
</dt><dd>
Specify label for the window (default: SM)
</dd><dt><code>-Wn</code>
</dt><dd>
Don't label window
</dd><dt><code>-WP x y</code>
</dt><dd>
Position of icon
</dd><dt><code>-Wp x y</code>
</dt><dd>
Position of window
-Ws w h
Size of window
</dd></dl>

<p>
The standard SunView popup `frame' menu has been modified to
allow you to erase the graphics screen. It is perfectly safe to use
the menu to <code>quit</code> the graphics window, in this case the next
<code>device sunview</code> command will create a new one. If SM
thinks that the window is active when you try to kill it, it will warn
you; failing to believe it may result in a cascade of complaints to
the console window. There is a bug in the cursor routine (I claim that
it is a SunView bug) that means that SM sees only every other key-stroke.

</p>
<p>
A Tcl/Tk Widget

</p>

<p>
It's possible to build SM to support a Tk widget (on unix boxes only; the
SM Tk graphics are based on X11). If this interests you, specify the <code>TK</code>
device when building SM, then build tkSM in the callable directory and say

</p><pre>   tkSM smtk.tcl
</pre>

<p>
to run an example that we wrote.
The source code should be easily modifiable to add features that your
application needs.

</p>
<p>
The Unix-PC Device
<a name="IDX360"></a>
<a name="IDX361"></a>
<a name="IDX362"></a>
<a name="IDX363"></a>

</p>
<p>
On a Unix-PC <code>DEVICE upc</code> opens a window of 304 by 192 pixels,
which is about 4 by 4 inches. To quote the author
(Peter Teuben, teuben@astro.umd.edu),

</p><ol>
<li>

This whole Unixpc version is an experimental version, take
it as is, it works on my configuration, but may not work on yours.
    
</li><li>

I'm playing with allowing a second and third parameter to
the upc device name, which would allow you to change the default size of 304
by 192 pixels (The size in X must be a multiple of 16 though).
Right now I have it check environment variables <code>YAPP_X</code> and
<code>YAPP_Y</code>, but this may not work satisfactorily.

</li><li>

I spawn windows using the public domain program `wlogin',
this may be of some importance if your `upc' device in SM fails. 
</li></ol>

<p>
I don't have a Unix PC, so I can't work on this driver.

</p>
<p>
PC Graphics under MS-Windows

</p>
<p>
This section needs more work; send mail to <code>rhl@astro.princeton.edu</code>.

</p>
<p>
VAX/VMS UIS$ device

</p>
<p>
the VAXUIS driver is used to display graphics on a VAX Workstation
using the VAX UIS$ library routines. The optional X and Y parameters
specify the size of the graphics window ( in centimeters ) created on
the workstation screen.

</p>
<p>
   If called without the optional X and Y parameters the graphics 
display window will be the same size as that previously displayed.

</p>
<p>
   If the X and Y parameters are not specified the first time the
DEVICE vaxuis command is issued, the graphics display window will
occupy 1/2 the height and 1/2 the width of the workstation screen.

</p>
<p>
For example, to create a 15 cm wide x 10 cm tall display window say:

</p><pre>		DEVICE vaxuis 15 10
</pre>

<p>
The X-Windows Devices (X10 and X11)
<a name="IDX364"></a>
<a name="IDX365"></a>
<a name="IDX366"></a>
<a name="IDX367"></a>

</p>
<p>
There are two X-Windows drivers, one for X10 and one for X11 and they
differ in their treatment of command line arguments. The X11 driver
is considerably more sophisticated and will be treated first.

</p>
<p>
<a name="IDX368"></a>
The X11 window driver (device <code>x11</code>) supports a subset of the standard
command line arguments, specifically (the X-resources names appear in
parentheses at the ends of the descriptions):
</p><dl compact="compact">

<dt><code>#geom</code>
</dt><dd>
Specify icon geometry (<code>.icongeometry</code>)
</dd><dt><code>-bd n</code>
</dt><dd>
Border width (<code>.borderwidth</code>)
</dd><dt><code>-bg colour</code>
</dt><dd>
Background colour (<code>.background</code>)
</dd><dt><code>-device n (<code>.device</code>)</code>
</dt><dd>
Use X11-device n
</dd><dt><code>-cmap</code>
</dt><dd>
Use a private colour map for this device (<code>.colormap</code>)
</dd><dt><code>-colormap</code>
</dt><dd>
Use a private colour map for this device (same as -cmap). (<code>.colormap</code>)
</dd><dt><code>-colourmap</code>
</dt><dd>
Use a private colour map for this device (same as -cmap). (<code>.colormap</code>)
</dd><dt><code>-cmap</code>
</dt><dd>
Use a private colour map for this device (<code>.colormap</code>)
</dd><dt><code>-display name</code>
</dt><dd>
Name of display to open (<code>.display</code>)
</dd><dt><code>-fg colour</code>
</dt><dd>
Foreground colour (<code>.foreground</code>)
</dd><dt><code>-fn fontname</code>
</dt><dd>
Name of hardware font to use (<code>.font</code>)
</dd><dt><code>-geometry geom</code>
</dt><dd>
Specify window geometry (<code>.geometry</code>)
</dd><dt><code>-help</code>
</dt><dd>
Summarise options
</dd><dt><code>-kbdfocus</code>
</dt><dd>
Preserve keyboard focus (the same as -focus). Without this, some window
managers transfer focus to the graphics window when it is created; probably
not what you want (<code>.kbdfocus</code>)
</dd><dt><code>-iconic</code>
</dt><dd>
Open window as an icon (<code>.iconic</code>)
</dd><dt><code>-name name</code>
</dt><dd>
</dd><dt><code>-ndevice n (<code>.ndevice</code>)</code>
</dt><dd>
Allow up to n X11 devices
</dd><dt><code>-nocurswind</code>
</dt><dd>
Do <em>not</em> show the cursor position while in cursor mode (same as -nocw)
Specify name of window (<code>.name</code>)
</dd><dt><code>-preopened display_id:window_id</code>
</dt><dd>
Specify device and window id's
</dd><dt><code>-synchronise</code>
</dt><dd>
Synchronise with server (debugging only) (<code>.synchronise</code>)
</dd><dt><code>-title title</code>
</dt><dd>
Specify title of window (<code>.title</code>)
</dd></dl>

<p>
Where <code>geom</code> is a standard geometry string of the form <code>WxH+-X+-Y</code>,
and the <code>preopened</code> option is for a programme calling SM
non-interactively.
All options may be abbreviated, so

</p><pre>device x11 -i #-1+1 -g 512x512+100+100
</pre>

<p>
specifies that the graphics window be created as an icon in the top
right hand corner of the screen, and that the real window should be
512*512 and positioned near the top left corner.

</p>
<p>
SM is able to open more than one x11 device (by default it can handle 5);
see the <code>-device</code> and <code>-ndevice</code> options.
You can say <code>device x11 -dev +</code> to switch to the next open X11
device; <code>device x11 -dev -</code> switches to the previous one.

</p>
<p>
If you want to raise your graphics window so that you can see it, you
can either use the window manager, reopen the device (<code>dev x11</code>),
erase the screen, or use the <code>PAGE</code> command.

</p>
<p>
On hardware that doesn't support a backing store (or if you have chosen
to disable a backing store when compiling the X11 driver) the screen will
only be refreshed when it is active or when SM is waiting for input. If
your operating system doesn't support the <code>select()</code> system call you
may be even worse off, but reopening the device (<code>device x11</code>) should
still result in the screen being redrawn.

</p>
<p>
If you use <code>CTYPE = expr</code> to ask for more than a small number of
special colours (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN12">Ctype</a>), you will probably need to specify
<code>-cmap</code> to get your own colour map; if you don't SM may well
complain about being unable to allocate colours.

</p>
<p>
<a name="IDX369"></a>
The X10 driver is known as <code>xwindow</code>, and you can optionally
specify a device to open, and a window ID, on the command line. For
example

</p><pre>device xwindows DEVICE unix:0
</pre>

<p>
will open a graphics window on device <code>unix:0</code>. (You can
optionally include a <code>ID number</code> after the DEVICE if you are calling
SM from a programme, and have already opened the window).
The X10 driver doesn't bother to remember any hardware characters that
you may have 
written on a graph, so that if you refresh the window they won't appear.
If this worries you can, as always, force the software character set
with an <code>expand 1.001</code>.

</p>
<hr><h2><a name="SYN18">Dither</a></h2>
<pre>Syntax: DITHER x y min max fac
</pre>

<p>
<a name="IDX370"></a>
<a name="IDX371"></a>

</p>
<p>
Generates a dithered represention of an image read by the IMAGE command
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN36">Image</a>). The vectors x and y are set to points whose density
is proportional to the image's intensity (only values between min and
max are considered).

</p>
<p>
Any pixels whose value is <code>NaN</code> are ignored, as are any whose value
equals the SM variable <code>$missing_data</code>; by default this is some
very large number.

</p>
<p>
The dithering algorithm used is Floyd-Steinberg, and each pixel of
the image is represented by (up to) fac*fac points, where (of course)
all fac*fac points are only used for intensities greater than equal to
max. Even the case fac == 1 can produce nice output for suitably sampled
images.

</p>
<p>
The resulting vectors are usually plotted as <code>ptype 1 1</code>.

</p>
<p>
An example of dithering an image would be:

</p><pre>IMAGE image_file
DITHER x y 0 3000 4
PTYPE 1 1
POINTS x y
</pre>

<p>
Of course, you can be more sophisticated; for example:

</p><pre>define min 3000  define max 60000  define gamma 2
set ii = image[*,*]
set ii=(ii &lt; $min ? 0 : ii &gt; $max ? 1 : (ii-$min)/($max - $min)
set image[*,*] = (1 + $gamma)*ii/(1 + $gamma*ii)
dither x y 0 1 4
define v local foreach v (x y) {
   set $v=$v + 0.5*random(dimen($v))
}
POINTS x y
</pre>

<p>
or

</p><pre>DITHER x y 0 3000 1
expand 0.3 + IMAGE(x,y)/3000
PTYPE 4 3
POINTS x y
</pre>

<p>
See also IMAGE for reading images, CONTOUR for contouring them, IMAGE CURSOR
for using cursors to get values from images, MINMAX for finding the minimum
and maximum of images, and Arithmetic for extracting cross-sections of images.

</p>
<hr><h2><a name="SYN19">Do</a></h2>
<pre>Syntax: DO variable = start, end [ , incr ] { commands }
</pre>

<p>
<a name="IDX372"></a>

</p>
<p>
   While the value of <code>$variable</code> runs from <code>start</code> to <code>end</code>, the commands 
are executed. The optional increment defaults to 1. It is not possible
to change the value of the loop variable inside a loop (or at least it
has no effect on the next iteration). To break out of a loop you have
to break out of the current macro as well with RETURN (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC10">DO and FOREACH loops, WHILE loops, and IF statements</a>).

</p>
<p>
For example,

</p><pre>DO i=1,10,0.5 { WRITE STANDARD $i } 
</pre>

<p>
will write <code>1 1.5 2 2.5 ... 10</code> to the terminal. The commands may be
spread over several lines.

</p>
<hr><h2><a name="SYN20">Dot</a></h2>
<pre>Syntax: DOT 
</pre>

<p>
<a name="IDX373"></a>

</p>
<p>
   Draw a point at the current location (set by RELOCATE, DRAW, etc.) in the
style determined by PTYPE. The point's size and rotation are governed by
EXPAND and ANGLE.

</p>
<p>
To insert dots into labels, it may be easier to use the `TeX'
definition <code>\point</code> or <code>\apoint</code> which inserts a dot of a
specified PTYPE into a string (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC68">SM's Fonts</a>).

</p>
<hr><h2><a name="SYN21">Draw</a></h2>
<pre>Syntax: DRAW #1 #2
        DRAW ( #1 #2 )
</pre>

<p>
<a name="IDX374"></a>

</p>
<p>
   Draw a line from the current position (set with, for example RELOCATE) to
(#1, #2) in user coordinates. If the parentheses are present, use
screen coordinates.

</p>
<hr><h2><a name="SYN22">Edit</a></h2>
<pre>Syntax: EDIT function key_strokes 
</pre>

<p>
<a name="IDX375"></a>

</p>
<p>
Bind a function to a set of <code>key_strokes</code> for the editor.
For example, <code>EDIT refresh <kbd>control-R</kbd></code> makes the <kbd>control-R</kbd> key
refresh the screen. A complete list of functions is given in the
`Changing Key-Bindings' section in the main part of this manual (see
under `bindings' in the index). Each character in the key sequence can
be specified as a character, e.g. `<code>a</code>' or the single character
`<code><kbd>control-A</kbd></code>',
as `<code><kbd>control-c</kbd></code>' representing the single character <code><kbd>control-c</kbd></code> as the two
character sequence `<code>^</code>' followed by `<code>c</code>', or by `<code>\nnn</code>'
where <code>nnn</code> is an octal number (e.g. <code>EDIT refresh \022</code>).

</p>
<p>
In order to use multiple key sequences
(e.g. <code><kbd>control-A</kbd><kbd>control-B</kbd><kbd>control-C</kbd></code>) you must first undefine
any sub-sequences, in this case <code><kbd>control-A</kbd></code> and <code><kbd>control-A</kbd><kbd>control-B</kbd></code>,
by making them illegal -- <code>EDIT illegal <kbd>control-A</kbd></code>.

</p>
<p>
See <code>READ</code> for how to define a set of keys from a file, and
<code>KEY</code> for how to define keys to execute commands.

</p>
<hr><h2><a name="SYN23">Environment Variables</a></h2>
<pre>Environment (`sm') Variables
</pre>

<p>
<a name="IDX376"></a>

</p>
<p>
SM environment variables are defined in <tt>`.sm'</tt> files, which are searched
for along a path which typically consists of
the current directory, your home directory, and then some system place. You
can specify your own search path by setting the environment (VMS: logical)
variable <code>SMPATH</code>.
If ~ appears in a path it is interpreted as your home directory unless you
specified <code>-u NAME</code> when starting SM, in which case it will be interpreted
as NAME's home directory instead.
Alternatively, you can specify the name of the environment file using the
`-f' flag on the command line; if it starts with a <tt>`/'</tt> it will be taken
to be an absolute path name, otherwise it will be taken relative to the
current path.

</p>
<p>
If you invoke SM with the <code>-f</code> or <code>-u</code>
flags, the are <em>not</em> passed on to raster devices, so if you plot
to a device that invokes <code>rasterise</code> it will use the <code>.sm</code> files
specified by <code>$SMPATH</code>.

</p>
<p>
Each line of the files is taken to consist of a variable name, and the
rest of the line which is taken to be its value. Any variable may be
accessed using the DEFINE <code>name :</code> command, which defines <code>name</code>
from the environment file.

</p>
<p>
Comments run from `#' to the end of the line.
If the first character of a line is a `@' or `+' the name is taken to start
with the second character. A `@' means that the entry isn't present, and
that SM should stop searching the path for it. A `+' means that SM should
keep on searching the current <tt>`.sm'</tt> file, and then the rest of the
search path, looking for more entries with the same name. If it finds one,
the second value is added to the end of the first (and if the second
occurrence also had a `+' specified the search continues).
<a name="IDX377"></a>
<a name="IDX378"></a>

</p>
<p>
Some entries in the environment file are special to SM, although
you are free to use them to your own ends as well. For most of those for
which SM is only interested in whether the variable is defined, a value
of 0 means that it shouldn't be defined. The variables are:
</p><dl compact="compact">

<dt><code>background</code>
</dt><dd>
The background colour for plots
</dd><dt><code>case_fold_search</code>
</dt><dd>
If non-zero, make searches case insensitive
</dd><dt><code>default_font</code>
</dt><dd>
<a name="IDX379"></a>
The default font for labels; you can also set this interactively, e.g.
<code>expand 1.001 define default_font "\oe\3"</code>.
</dd><dt><code>device</code>
</dt><dd>
Your initial graphics device
</dd><dt><code>edit</code>
</dt><dd>
A file of keybindings to read (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC7">Changing Key-Bindings</a>).
</dd><dt><code>fan_compress</code>
</dt><dd>
Apply fan compression when connecting lines. This was donated by a user, and
is intended to reduce the number of lines actually plotted to the device;
whether it is useful is not clear. The reference is
<i>IEEE Computer Graphics and Applications, March 1989,
`Faster Plots by Fan Data-Compression', by R.A. Fowell and D.D. McNeil</i>.

</dd><dt><code>file_type</code>
</dt><dd>
The type of 2-D image for the IMAGE command
</dd><dt><code>filecap</code>
</dt><dd>
The filecap file to use (default: same as graphcap)
</dd><dt><code>line_up_exponents</code>
</dt><dd>
Force an extra space before single-digit exponents in axis labels
</dd><dt><code>fonts</code>
</dt><dd>
The name of the binary fonts file
</dd><dt><code>foreground</code>
</dt><dd>
The foreground colour for plots
</dd><dt><code>graphcap</code>
</dt><dd>
The graphcap file to use
</dd><dt><code>help</code>
</dt><dd>
The help directory
</dd><dt><code>history</code>
</dt><dd>
The length of the history list (default: 80)
</dd><dt><code>history_char</code>
</dt><dd>
The character used to recall commands (default: ^)
</dd><dt><code>history_file</code>
</dt><dd>
File to save history in
</dd><dt><code>macro</code>
</dt><dd>
The default macro directory
</dd><dt><code>macro2</code>
</dt><dd>
Your private macro directory
</dd><dt><code>missing_macro_continue</code>
</dt><dd>
If defined, a reference to a missing macro isn't a syntax error
</dd><dt><code>name</code>
</dt><dd>
The name SM calls you by
</dd><dt><code>noclobber</code>
</dt><dd>
Refuse to overwrite existing files with MACRO WRITE or PRINT.
</dd><dt><code>overload</code>
</dt><dd>
If non-zero, overload some commands
</dd><dt><code>printer</code>
</dt><dd>
The default printer (see hcopy and hmacro)
</dd><dt><code>prompt</code>
</dt><dd>
The initial value of SM's prompt
</dd><dt><code>prompt2</code>
</dt><dd>
The initial value of SM's secondary prompt
</dd><dt><code>remember_history_line</code>
</dt><dd>
Remember which line you last reused
</dd><dt><code>save_file</code>
</dt><dd>
Default file to save a SM session in
</dd><dt><code>save_read_ptr</code>
</dt><dd>
Save the position of the read pointer between READ commands
</dd><dt><code>temp_dir</code>
</dt><dd>
The directory for temporary files
</dd><dt><code>term</code>
</dt><dd>
Default terminal, over-ruling <code>TERM</code>
</dd><dt><code>termcap</code>
</dt><dd>
The file describing terminals to SM
</dd><dt><code>TeX_strings</code>
</dt><dd>
Use TeX-style strings for labels
</dd><dt><code>traceback</code>
</dt><dd>
Print the macro stack following an error
</dd><dt><code>uppercase</code>
</dt><dd>
Define uppercase versions of some macros
</dd><dt><code>x_gutter</code>
</dt><dd>
</dd><dt><code>y_gutter</code>
</dt><dd>
Modify the spacing between windows when using the WINDOW command.
(These are not actually read from the <tt>`.sm'</tt> by the default
startup macro, you have to set them yourself).
</dd></dl>
<p>
Under Unix, you should omit the <code>termcap</code> entry, or point it at
`/etc/termcap'. Also under Unix, SM knows how to look up your
name, so you can omit the <code>name</code> entry. If you try to use a name
with more than one word, SM will use the first so you'll have
to call yourself `my_lord' rather than `my lord' (the `_' will be
replaced by a space).

</p>
<p>
Some of these are used directly by SM (e.g. <code>help</code>, <code>fonts</code>,
but some are merely used by the <code>startup</code> macro to set the initial
value of SM variables (e.g. <code>TeX_strings</code>, <code>file_type</code>).
Other names may be used by the default <code>startup</code> macro, e.g.
<code>macro2</code> to specify a private macro directory or
<code>term</code> to specify the terminal that you are using. See the
discussion of <code>startup</code> under `useful macros'.

</p>
<hr><h2><a name="SYN24">Erase</a></h2>
<pre>Syntax: ERASE 
</pre>

<p>
<a name="IDX380"></a>
   ERASE erases the graphics screen. The macro <code>era</code> erases the
screen without appearing on the history buffer. If you want to start a
new output page on a hardcopy device use the PAGE command.

</p>
<p>
You may be able to erase individual lines with LTYPE ERASE, if you can
you should look at the macro <code>undo</code>.

</p>
<hr><h2><a name="SYN25">Errorbar</a></h2>
<pre>Syntax: ERRORBAR WORD1 WORD2 expr INTEGER
</pre>

<p>
<a name="IDX381"></a>
   ERRORBAR is analogous to POINTS; it draws one-sided error bars on
all points defined by vectors <code>WORD1</code> and <code>WORD2</code>, where the
length of each errorbar is set by the corresponding value in <code>expr</code>. <code>INTEGER</code> is 1 to put the bar along the +x direction, 2 for
+y, 3 for -x, and 4 for -y. Use EXPAND to govern the size of the caps.
In fact, instead of either or both of <code>WORD1</code> and <code>WORD2</code> you
can use an expression in parentheses,
for example ERRORBAR <code>(lg(x)) (lg(y)) 120 1</code>.

</p>
<p>
See also the macros <code>ec</code> and <code>err</code> for backwards compatibility with
Mongo, and <code>error_x</code> and <code>error_y</code> to produce (symmetrical)
two-sided errorbars.
There is also a macro <code>logerr</code> to draw errorbars on logarithmic plots.

</p>
<hr><h2><a name="SYN26">Expand</a></h2>
<pre>Syntax: EXPAND expr
</pre>

<p>
<a name="IDX382"></a>
<a name="IDX383"></a>
<a name="IDX384"></a>
   EXPAND expands all characters and points, its default is 1.0. Note that the
EXPAND factor is used in determining the plot window size in the WINDOW
command. This means you should declare your EXPAND size to SM (if other
than the default) before you use WINDOW. The current value of EXPAND
is available as a <code>DEFINE expand |</code>.
<a name="IDX385"></a>

</p>
<p>
If EXPAND is set to exactly 1, and ANGLE is exactly 0, then SM
will use hardware fonts, when available, in writing labels. This is faster,
but if you don't like it say "EXPAND 1.00001", or "ANGLE 0.00001",
or use a \r explicitly to select the roman font.

</p>
<p>
EXPAND can in fact be given a vector of values, which are used for
each point in a POINTS command. This supersedes the use of a fractional
PTYPE (although we still support it as a quaint anachronism). Using
vectors for both ANGLE and EXPAND makes it easy to draw a vector
field, see (for example) the <code>vfield</code> macro.
<a name="IDX386"></a>
If more points are specified than
the dimension of expr, the first element will be used for the excess.

</p>
<hr><h2><a name="SYN27">Fft</a></h2>
<pre>Syntax: FFT n pexpr1 pexpr2 WORD1 WORD
</pre>

<p>
<a name="IDX387"></a>

</p>
<p>
   Fourier transform 2 vectors (treated as the real and imaginary parts
of a complex vector), returning the answer in the two vectors <code>WORD1</code> and
<code>WORD2</code>. The input vectors may be the names of vectors or expressions in
parentheses. The direction is specified by <code>n</code>, either +1 for a forward
transform, or -1 for an inverse.

</p>
<p>
   The dimension of the vectors need not be a power of 2, but the transform
is more efficient if it is. The worst case is when <i>n</i> is prime, in
which case this command performs a slow Fourier transform in <i>O(n^2)</i> time.

</p>
<hr><h2><a name="SYN28">Foreach</a></h2>
<pre>Syntax: FOREACH variable ( list ) { commands }
        FOREACH variable { list } { commands }
        FOREACH variable WORD { commands }
</pre>

<p>
<a name="IDX388"></a>

</p>
<p>
   In the first two forms, the value of <code>variable</code> is set to each
element of list in turn,
and then the commands are executed. An example would be

</p><pre>var ( alpha 2 gamma ) { WRITE STANDARD $var }
</pre>

<p>
which would write <code>alpha</code>, <code>2</code>, and then <code>gamma</code> to the
terminal (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC10">DO and FOREACH loops, WHILE loops, and IF statements</a>).

</p>
<p>
The form with {} can be useful if you want the list exactly as you type it,
for example

</p><pre>	FOREACH f { 0.1 $date } { echo $f }
</pre>

<p>
<a name="IDX389"></a>
The form FOREACH <code>variable</code> WORD ... is used to iterate over a vector,
either arithmetic or string. For example,

</p><pre>        SET str={Sorbus Aucuparia David Monger}
	FOREACH f str { echo $f }
</pre>

<p>
It is often useful to define the FOREACH variable to be LOCAL (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN15">Define</a>),
e.g. DEFINE <code>f</code> LOCAL in the last example.

</p>

<hr><h2><a name="SYN29">Format</a></h2>
<pre>Syntax: FORMAT [ x-format-string y-format-string ]
</pre>

<p>
<a name="IDX390"></a>
<a name="IDX391"></a>
   Allow the user to specify the axis tick label formats. The format should be
given as a standard C (e.g. %4.1g) or Fortran (e.g. F10.4). 
This format
will be in effect until unset by issuing the FORMAT command with no argument,
in which case SM will figure out the best format for you, or until you
issue a new FORMAT command with new format strings. 

</p>
<p>
If a format is specified as "0", the format string is left unchanged;
if it is given as "1", the default value is reinstated. The command
FORMAT 1 1 is thus equivalent to FORMAT.

</p>
<hr><h2><a name="SYN30">Grid</a></h2>
<pre>Syntax: GRID [ INTEGER1 [ INTEGER2 ] ]
</pre>

<p>
<a name="IDX392"></a>
<a name="IDX393"></a>

</p>
<p>
Grid draws a grid at either major ( <code>INTEGER1 = 0</code> ) or 
minor ( <code>INTEGER1 = 1</code> ) tickmarks within a box.
The default is <code>INTEGER1 = 0</code>. You can use <code>INTEGER2</code> to specify
only drawing an x- or y-axis grid: if <code>INTEGER2</code> is omitted or 0,
draw both x and y; if it's 1 only draw x; if it's 2 only draw y (3 is
equivalent to 0).

</p>
<hr><h2><a name="SYN31">Help</a></h2>
<pre>Syntax: HELP [ word ]
</pre>

<p>
<a name="IDX394"></a>

</p>
<p>
The HELP command tries to help you with <code>word</code>. If possible, it
prints the entry from the <code>help</code> directory specified in your <tt>`.sm'</tt> file, the definition of <code>word</code> if it's a macro,
the value of <code>word</code> if it's a variable, and the HELP string if it
is a vector.
If none of these are defined, HELP confesses defeat.
You might want to use the abbreviation <code>h</code> which will not appear on
your history list (or you could overload <code>help</code> itself). Further
discussion of the <code>HELP</code> command is given in See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC11">The Help Command</a>.

</p>
<p>
If <code>word</code> is omitted it is assumed to be <code>HELP</code>.

</p>
<p>
You can associate a help string with a vector with the command
<code>SET HELP</code>.

</p>
<p>
See also APROPOS and LIST.

</p>
<hr><h2><a name="SYN32">Histogram</a></h2>
<pre>Syntax: HISTOGRAM WORD1 WORD2 [ IF (expr) ]
</pre>

<p>
<a name="IDX395"></a>

</p>
<p>
HISTOGRAM connects the points in vectors <code>WORD1</code> and <code>WORD2</code> as
a histogram.
The <code>i</code>th bin of the histogram is taken to run from
<code>(x[i-1] + x[i])/2</code> to <code>(x[i] + x[i+1])/2</code>;
for the case of equally spaced x-values, this reduces
to saying that the x values are the bin centres.

</p>
<p>
If the IF clause is present, only use those points for which <code>expr</code> (see
the section on vector arithmetic) is true (i.e. non-zero). Only contiguous
parts of the histogram are connected; if you don't want this behaviour,
say something like

</p><pre>set l = (z==1) ? 1 : 0  set x=xx if(l) set yy=y if(l) histogram xx yy
</pre>

<p>

</p>
<p>
In fact, either or both of the <code>WORD</code>s may be replaced by
`parenthesised expressions', i.e. expressions in parentheses. For example,

</p><pre>HISTOGRAM x (2 + y)
</pre>

<p>
to plot x against <i>2 + y</i>.
There is a macro <code>barhist</code> for drawing bar charts.
See Arithmetic for how to convert vectors of data into histograms, and
<code>SHADE</code> for how to shade them.

</p>
<hr><h2><a name="SYN33">History</a></h2>
<pre>Syntax: HISTORY [ - ]
</pre>

<p>
<a name="IDX396"></a>
<a name="IDX397"></a>

</p>
<p>
List the current commands stored in the buffer. For details on the
history system, see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC6">Command History</a>.
With the optional minus sign, the history list is printed
backwards which is probably what you want if you are thinking of it as
a set of commands to repeat.
It's possible to overload <code>list</code> to be a synonym for HISTORY, see
`overloading' in the index.

</p>
<hr><h2><a name="SYN34">Identification</a></h2>
<pre>Syntax: IDENTIFICATION str
</pre>

<p>
<a name="IDX398"></a>
<a name="IDX399"></a>

</p>
<p>
   IDENTIFICATION puts the current date and time followed by <code>str</code> outside
the upper right hand corner of the plot region.
(Actually, <code>identification</code> is a macro, which RELOCATEs to a point
above the right-hand axis, and half way between the top axis and the
top of the page, and then writes a string with a PUTLABEL 4.)
Note that the variable 
<code>$data_file</code> is set to the name of the current data file, and
<code>$date</code> always expands to the current date and time.

</p>
<hr><h2><a name="SYN35">If</a></h2>
<pre>Syntax: IF ( expr ) { list } 
        IF ( expr ) { list } ELSE { list } 
</pre>

<p>
<a name="IDX400"></a>
If the <code>expr</code> is true (non-zero), then the <code>list </code> of commands
are executed, otherwise the <code>ELSE</code> clause is executed. For various
complicated reasons, the <code>ELSE</code>less command must end with a newline
(or as usual a \n) (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC10">DO and FOREACH loops, WHILE loops, and IF statements</a>).
One common use for IF tests is when the expression tests if a variable
has been defined, e.g.

</p><pre>IF($?file_name == 0) { DEFINE file_name ? } 
</pre>

<p>
within some macro.

</p>
<p>
Note that you can write IF-ELSE IF-ELSE blocks as

</p><pre>if('Robert' == 'Patricia') {
   echo Something's wrong
} else { if('Patricia' == 'Ralph') {
   echo Still wrong
} else {
   echo Go Yankees
}}
</pre>

<p>

</p>
<p>
There are also commands using IF to define vectors conditionally
(see SET), and to plot parts of vectors (See CONNECT, HISTOGRAM, POINTS).

</p>
<hr><h2><a name="SYN36">Image</a></h2>
<pre>Syntax: IMAGE [n] file
        IMAGE [n] file xmin xmax ymin ymax
        IMAGE [n] file [ * : *]
        IMAGE [n] file [ x1, x1 : *]
        IMAGE [n] file [ * : y0, y1]
        IMAGE [n] file [ x1, x1 : y0, y1]
        IMAGE ( nx , ny )
        IMAGE ( nx , ny ) xmin xmax ymin ymax
        IMAGE CURSOR
        IMAGE CURSOR WORD WORD WORD
        IMAGE DELETE
        IMAGE DEFINE variable value
        WRITE IMAGE WORD
</pre>

<p>
<a name="IDX401"></a>
<a name="IDX402"></a>

</p>
<p>
Read an image from <code>file</code>, optionally specifying the range of
coordinates covered by the data values. If you do not specify them
they will be taken to be <code>0 nx-1 0 ny-1</code> where
nx and ny are the dimensions of the image. If you specify
<code>( nx, ny )</code> instead of a filename an empty image of the desired
size will be created (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC57">Two-Dimensional Graphics</a>).

</p>
<p>
   If you specify <code>n</code> the n'th IMAGE extension of a fits file
will be read; the primary data unit (i.e. the start of the file)
is n == 0.

</p>
<p>
If you want to read part of an image you can specify the desired part
using [ ... : ... ]; (n.b. those [] are part of the command you type,
not optional parameters).  If you want the whole range use *, otherwise
a pair of 0-indexed integers. In other words,

</p><pre>IMAGE file
and
IMAGE file [ * : * ]
</pre>

<p>
are identical; you can read only the first 100 elements of the first
row of an image into a vector with

</p><pre>IMAGE file [ 0,99 : 0,0]  SET x=IMAGE[*,*]
</pre>

<p>
IMAGE CURSOR is identical to the CURSOR command (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN13">Cursor</a>), 
except that value of the image under
the cursor is returned in addition to the position; IMAGE CURSOR WORD WORD WORD
is equivalent to CURSOR WORD WORD, but it also generates a vector of
image intensities.

</p>
<p>
IMAGE DELETE will forget the current image and levels.

</p>
<p>
The file format is specified using a <tt>`filecap'</tt> file, similar to
<tt>`graphcap'</tt>,
and the entry to use in this file is given by the variable <code>file_type</code>
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC57">Two-Dimensional Graphics</a>).
The file is unformatted, and should start with two integers giving the
dimensions of the data
array, followed by the data values written row by row.

</p>
<p>
The current entries in <tt>`filecap'</tt> support files written from C,
or from fortran in one of a variety of ways.
For C programmers, DEFINE <code>file_type C</code>, the file should be written with 
open/write/close.
For Fortran, there are a variety of options depending on operating systems
and the details of how the file was opened. Under Unix, simply DEFINE
<code>file_type unix</code>. Under VMS you have a choice. You can either create a 
variable record type file (<code>recordtype='variable'</code> in the <code>OPEN</code>
statement) and choose <code>file_type vms_var</code>, 
or set <code>recordtype='fixed'</code> choose <code>recl</code> to be the x-dimension
of the array and define file_type to be <code>vms_fixed</code>. You <em>must</em> set 
<code>recordtype</code> in one of these two ways.
By default, data is taken to be real (float in C), but this can be overridden
in the filecap entry for a file type. There is also an entry for FITS files
<a name="IDX403"></a>
(FITS is the `standard' image transport format for astronomical images).
If you want to use a different
file type you'll have to learn about <tt>`filecap'</tt>
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC57">Two-Dimensional Graphics</a>),
or else see your local SM Guru.

</p>
<p>
So under VMS either your code should look like (file_type = <code>vms_var</code>)

</p>

<pre>        integer i,j
        real arr(100,10)
c
        open(2,file=filename,form='unformatted',recordtype='variable')
        i = 100
        j = 10
c now write your data into arr
        write(2) i,j
        write(2) arr
        end
</pre>

<p>
or, with file_type = <code>vms_fixed</code>,

</p><pre>        integer i,j
        real arr(100,10)
c
        open(2,file=filename,form='unformatted',recl=100,recordtype='fixed')
        i = 100
        j = 10
c write your data into arr here
        write(2) i,j
        do 1 j=1,10
           write(2) (arr(i,j),i=1,100)
1       continue
        end
</pre>

<p>
Under Unix, either of these programme fragments would work after omitting
the record information from the open statement.

</p>
<p>
See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN66">Set</a> for an example of creating an image from scratch or a vector.
<a name="IDX404"></a>

</p>
<p>
If you have an image defined (using the IMAGE command), you can extract
a cross-section using the <code>SET name = IMAGE ( expr , expr )</code> command. The
two expressions give the (x,y) coordinates where you want the image to be
sampled. For example,

</p><pre>SET x=0,1,.01 SET z=IMAGE(x,0.5)
</pre>

<p>
will extract a horizontal cross section through an image. You can also use
<code>IMAGE[expr,expr]</code> to extract values via their indices, where either
or both
of the <code>expr</code>s may be <code>*</code> meaning "all values"; this is especially
useful to those who like to use SM's images as a way of reading binary data.
<a name="IDX405"></a>

</p>
<p>
An example of creating an image from scratch would be

</p><pre>image (51,81) 0 1 0 1
define NX image define NY image
set ix=0,$NX*$NY-1 set iy=ix 
set iy=int(iy/$NX) set ix=ix - $NX*iy
set x=ix/($NX-1) set y=iy/($NY-1)
set image[ix,iy] = sin(x)*sin(y)
</pre>

<p>
If you have a vector <code>v</code> of size <code>NX*NY</code>, you can say

</p><pre>set image[*,*] = v
</pre>

<p>
to convert it to an image. The data is arranged row-by-row (i.e. in
the fortran order).

</p>
<p>
If you wanted to extract the top row of an image, after

</p><pre>   define NY IMAGE  define NX IMAGE
   set ix=0,$NX-1
</pre>

<p>
you can get the top row with any one of

</p><pre>   set rr=image[ix,$NY-1]
   set rr=image[do(0,$NX-1),$NY-1]
   set rr=image[*,$NY-1]
</pre>

<p>
If you want to add 100 to every value of an image, you can say

</p><pre>set image[*,*] = image[*,*] + 100
</pre>

<p>
<a name="IDX406"></a>
<a name="IDX407"></a>
It's obviously pretty easy to use SM to manipulate images point-by-point
in this way.

</p>
<p>
   You can write the current image to a file using WRITE IMAGE filename.
Only a small subset of the images that SM can read can be written;
currently your choices are "C", "CH", and "FITS"; all of these will
write out floating point values (as images are stored as floats), and
the FITS writer assumes that you have IEEE arithmetic, in conformity to the
FITS standard.
All current image keywords (i.e. those available via DEFINE name IMAGE) are
written to the FITS header; you can define further keywords with
IMAGE DEFINE name value.
<a name="IDX408"></a>
<a name="IDX409"></a>
<a name="IDX410"></a>

</p>
<p>
Writing and reading images is an space- and time-efficient way of
saving/rereading vectors in a binary format; if you use the FITS file
format (i.e. set <code>file_type</code> to FITS) the data will be suitably
byteswapped if necessary. For example,

</p><pre>        data file.dat
        read { x 1 y 2 z 3 }
        image (3, dimen(x) )
        set image[0,*] = x
        set image[1,*] = y
        set image[2,*] = z
        image define filename file.dat
        define file_type fits
        write image save.fts
</pre>

<p>
and then, in some other SM session:

</p><pre>        define file_type fits
        image file.dat
        define filename IMAGE
        set x = image[0,*]
        set y = image[1,*]
        set z = image[2,*]
</pre>

<p>
Note well that defining the image as <code>image(dimen(x), 3)</code> would be
<em>far</em> less efficient.

</p>
<p>
See also ARITHMETIC for how to extract a cross-section into a vector and
DEFINE for defining a variable from the image header. Images may be displayed
with CONTOUR or DITHER, and examined with IMAGE CURSOR.

</p>
<hr><h2><a name="SYN37">Key</a></h2>
<pre>Syntax: KEY 
        KEY key string
</pre>

<p>
<a name="IDX411"></a>

</p>
<p>
Define a key to generate a string. This is most often used simply to
save typing some common command such as <code>edit_hist</code>. With the
command KEY, you are prompted for the <code>key</code> to define, and the string.
Because you are not using the history editor when you type the key,
you can simply hit the key that you want defined, type a space, and
then type the string terminated by a carriage return. The other form,
where the whole command appears on one line, is probably more suitable
for use in a macro such as your private startup macro (see under <code>startup2</code> in the index). If you try entering it at the keyboard any special
characters in <code>key</code>, such as ESC, will be interpreted by the
history editor so you'll probably have to quote the <code>key</code> with
<kbd>control-Q</kbd> or ESC-q. Alternatively you can use ^ and printing
characters , or octal numbers, to represent the escape characters in
the same way as for EDIT (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN22">Edit</a>).
If <code>key</code> is given as <code>pf#</code> or
<code>PF#</code> (where <code>#</code> is 1, 2, 3, or 4) it will be interpreted as
a special function key on your keyboard in a terminal-independent way
(see the description of termcap (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC59">Termcap -- A Terminal Database</a>) to see how these keys
are defined).
KEY definitions are listed along with
other key bindings by the LIST EDIT command.

</p>
<p>
If the <code>string</code> ends in a \N, it will be executed the moment that
the key is struck. (Note that this is \N not \n, which would have
been interpreted as a newline.)

</p>
<p>
Only 10 keys can be defined, after that you'll start overwriting
earlier definitions (this is a result of the way that KEY was implemented;
if it is a serious nuisance send us mail).

</p>
<hr><h2><a name="SYN38">Label</a></h2>
<pre>Syntax: LABEL str
</pre>

<p>
<a name="IDX412"></a>

</p>
<p>
   LABEL writes the string <code>str</code>, which starts one space after LABEL and
continues to the last non-space character, at the current location (set by
RELOCATE, etc). After the label is written the current location is on the
baseline, just to the right of the last character drawn.
You can of course use quotes to include trailing white space.
LABEL str is exactly equivalent to PUTLABEL 9 str (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN58">Putlabel</a>).

</p>
<p>
The string's size and angle are determined by EXPAND and
ANGLE. For more information on fonts and such like, See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC14">Drawing Labels and SM's TeX Emulation</a>.

</p>
<hr><h2><a name="SYN39">Levels</a></h2>
<pre>Syntax: LEVELS WORD
        LEVELS expr
</pre>

<p>
<a name="IDX413"></a>
<a name="IDX414"></a>

</p>
<p>
Set the levels for the CONTOUR command to be the values of the 
vector <code>WORD</code> or to the values of the expression.

</p>

<hr><h2><a name="SYN40">Limits</a></h2>
<pre>Syntax: LIMITS WORD WORD
        LIMITS WORD Y1 Y2
        LIMITS X1 X2 WORD
        LIMITS X1 X2 Y1 Y2
</pre>

<p>
<a name="IDX415"></a>

</p>
<p>
   LIMITS sets the coordinates of the plot region. All coordinates in RELOCATE,
DRAW, etc, are referred to these limits. The various forms specify
explicit limits for the x or y axis (<code>X1 X2</code> or <code>Y1 Y2</code>), or default 
(specify the name of the vector to be used).

</p>
<p>
In fact, either or both of the <code>WORD</code>s may be replaced by
`parenthesised expressions', i.e. expressions in parentheses. For example,

</p><pre>LIMITS 0 5 (ln(y))
</pre>

<p>
will scale the y axis according to the logarithm of vector y (but <em>not</em>
produce a logarithmic axis - see TICKSIZE for this capability).

</p>
<p>
The current value of the minimum and maximum values on the x and y axes
can be obtained with a DEFINE | command, e.g. <code>DEFINE fx1 |</code>.
<a name="IDX416"></a>

</p>
<p>
If the two limits specified for an axis are the same, the limits for
that axis will not be changed.

</p>
<p>
You can specify that the limits on one or both axes have a desired range
using the RANGE command. This command affects the performance of the
LIMITS command. If a non-zero RANGE has been set, LIMITS
will ensure that the upper and lower limits differ by that amount. (e.g.
after RANGE <code>2 0 </code>, LIMITS  <code>0 1 0 1 </code> is equivalent to 
LIMITS <code>-0.5 1.5 0 1 </code>). If you specify a vector, the range is
centred on the median value. If you have specified a range, and then
ask for logarithmic axes with TICKSIZE, you may get complaints that
logarithmic axes are impossible. Simply unset RANGE, and the problem
should go away.
<a name="IDX417"></a>

</p>
<hr><h2><a name="SYN41">Lines</a></h2>
<pre>Syntax: LINES INTEGER INTEGER
</pre>

<p>
<a name="IDX418"></a>
   Use only lines <code>INTEGER1</code> to <code>INTEGER2</code> from the current data
file (specified with the DATA command). If VERBOSE is greater than 0, the
lines actually read
will be reported. LINES 0 0 will use the entire file, which is also
the default following a DATA command.
The variables <code>$_l1</code> and <code>$_l2</code> will be set to the first and last
lines specified.

</p>
<hr><h2><a name="SYN42">List</a></h2>
<pre>Syntax: LIST DEFINE [ begin end ]
        LIST DEFINE |
        LIST DEVICE [ pattern ]
        LIST EDIT
        LIST MACRO [ begin end ]
        LIST SET
        LIST TABLE
</pre>

<p>
<a name="IDX419"></a>
<a name="IDX420"></a>
<a name="IDX421"></a>

</p>
<p>
list all the currently defined variables (DEFINE) or macros (MACRO),
optionally only within the range <code>begin - end </code>. If VERBOSE is 0
macros beginning ## won't be listed. You can list the internal variables
(i.e. those such as <code>$fx1</code> that track SM internal variables) with
LIST DEFINE |, or by setting VERBOSE to be two or more.
<a name="IDX422"></a>

</p>

<p>
LIST EDIT will list all the keybindings. If VERBOSE is 0 only the keys
that don't generate themselves are listed (i.e. because A is bound
to A it isn't listed). If VERBOSE is 1, in addition all non-printing keys
are listed, and if VERBOSE is 2 or greater all keys are listed. Both the
EDIT and the KEY bindings are listed.

</p>
<p>
LIST DEVICE will list all the devices known to SM. The devices are
listed with each device on an (indented) line, first the primary name,
then a list of aliases in parentheses, then a full name. If <code>pattern</code>
is provided only those lines that match the given pattern will be printed,
for details on SM's regular expressions See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN3">Apropos</a>. An example would
be

</p><pre>LIST DEVICE ^post
</pre>

<p>
to list all devices whose principle name begins `post'.

</p>
<p>
LIST SET lists all currently defined vectors. For each vector the name,
the dimension and the <code>HELP</code> field are given. See <code>SET</code> for how
to set the latter.

</p>
<p>
LIST TABLE lists all columns available in the current TABLE; this currently
only works for FITS binary tables.

</p>
<p>
For a list of the history buffer use HISTORY (macro <code>lis</code>), to list a
macro use HELP (macro <code>h</code>). It can be useful to overload `list' so
that it doesn't appear on the history list, and so that `list' by
itself corresponds to the command HISTORY (this is done for you if you
use <code>set_overload</code> or put <code>overload</code> in your <tt>`.sm'</tt>
file).

</p>
<hr><h2><a name="SYN43">Local</a></h2>
<pre>Syntax: LOCAL DEFINE name value
        DEFINE name LOCAL
        LOCAL set name = expr
        SET name LOCAL
</pre>

<p>
<a name="IDX423"></a>
<a name="IDX424"></a>
<a name="IDX425"></a>
<a name="IDX426"></a>
<a name="IDX427"></a>
<a name="IDX428"></a>

</p>
<p>
Usually, SM's variables (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN15">Define</a>) and vectors (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN66">Set</a>)
have global scope, meaning that if you define one in a macro it is
still defined when you return to the command prompt. This is often
what you want, but not always; for example macros often define scratch
vectors that must be explicitly deleted before returning. This is
annoying, but a more serious problem is that two different macros
can each set a vector called <code>i</code>, but mean different things.

</p>
<p>
The solution to this is to make your vectors and variables <strong>local</strong> to
a macro, meaning that they are only visible within that macro, and from
any called from it. This is really a <strong>nested scope</strong> rather than local,
but LOCAL is easier to type.
Such local objects are automatically destroyed when they go out of scope.

</p>
<p>
For example, if you define the macro <code>bar</code> as

</p><pre>   macro bar 2 {
      echo $(goo)
      set goo local 
      set goo=$1
      if(goo &lt; $2) {
         bar $(goo+1) $2
      }
      echo $(goo)
   },
</pre>

<p>
the command <code>set goo=0 bar 1 5</code> will count from 0 to 5 and down again,
and if you run the macro <code>yar</code> (defined as
<code>macro yar { set foo local set foo=1\n}</code>) the vector <code>foo</code> will
not be defined at global scope.

</p>
<p>
Note that, as usual, you may have to be a
little careful to ensure that you don't exit a macro before you expect.
The symptoms would be that your local variable or vector was already
destroyed, or that
it referred to one at less restrictive scope (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC31">The Command Interpreter</a>).
The easiest fix is to add a comment line to the end of the macro.
<a name="IDX429"></a>
<a name="IDX430"></a>
<a name="IDX431"></a>

</p>
<hr><h2><a name="SYN44">Location</a></h2>
<pre>Syntax: LOCATION GX1 GX2 GY1 GY2
</pre>

<p>
<a name="IDX432"></a>
<a name="IDX433"></a>

</p>
<p>
   Set the physical location of the plot. The plot region is the rectangle
inside the box drawn by BOX. Vectors and points are
truncated at the bounds of the plot region. LOCATION specifies (in device
coordinates) where the plot region is located. LOCATION can be used to make
an arbitrary size and shape plot, providing that you want it rectangular.

</p>
<p>
Because all devices have the same coordinate system in SM
(0-32767), this command is considerably more useful than it used to
be. The default LOCATION is 3500 31000 3500 31000. You can get at the
current values of <code>GX1</code> etc. using the DEFINE | command.
<a name="IDX434"></a>

</p>
<p>
While you are using WINDOW (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN81">Window</a>), LOCATION commands have no effect.
SM remembers them, however, and obeys the most recent one when you are
finished with WINDOW.

</p>
<p>
See the RELOCATE <code>( x y )</code> command to draw labels outside the plot region,
and DRAW <code>( x y )</code> to draw lines there.

</p>
<p>
If you want to increase the x-location by 500 (say), you can say:

</p><pre>        LOCATION $($gx1 + 500) $gx2 $gy1 $gy2
</pre>

<p>
This is sometimes useful to make room for an axis label; if your verbosity
is 1 or higher you'll be advised of the appropriate displacement.

</p>
<hr><h2><a name="SYN45">Logical</a></h2>
<pre>Syntax: Logical Operators
</pre>

<p>
<a name="IDX435"></a>

</p>
<p>
The following logical operators are allowed on vectors and scalars in
SM, where non-zero means true:

</p>


<pre>Unary:

!expr           Logical Complement    
</pre>


<pre>Binary:

expr == expr    Equal to             expr != expr    Not equal
expr &lt; expr     Less than            expr &lt;= expr    Less than or equal
expr &gt; expr     Greater than         expr &gt;= expr    Greater than or equal
expr &amp;&amp; expr    Logical and          expr || expr    Logical or
</pre>

<p>
Only <code>!</code>, <code>==</code>, and <code>!=</code> are allowed for string valued vectors.
All arithmetic vectors test unequal to all string-valued vectors.

</p>
<p>
<a name="IDX436"></a>
For string vectors, there are three cases to consider:
<code>vstr1 == vstr2</code> generates a vector of the same length as
<code>vstr1</code> (with must be the
same length as <code>vstr2</code>) by comparing the two vectors element by element;
<code>'str1' == vstr</code>
generates a vector of the same length as <code>vstr</code>
by comparing each element of the vector <code>vstr</code> to the string <code>str1</code>;
and
<code>'str1' == 'str2'</code>
which returns a scalar by comparing the strings <code>str1</code> and <code>str2</code>
(so it's false in this example).

</p>
<p>
<a name="IDX437"></a>
As in C, <code>==</code> has a higher precedence than <code>&amp;&amp;</code>, which in turn has
higher precedence than <code>||</code>.

</p>
<p>
Note that there is also a ternary operator, <code>(expr1) ? expr2 : expr3</code>
which has the value <code>expr2</code> if <code>expr1</code> is true, and <code>expr3</code>
if it is false.

</p>
<p>
See `arithmetic' for the arithmetical operators See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN5">Arithmetic</a>.
You can test to see if a variable is defined by looking at the value
of <code>$?var</code> (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN15">Define</a>).

</p>
<hr><h2><a name="SYN46">Ltype</a></h2>
<pre>Syntax: LTYPE INTEGER
        LTYPE ERASE
        LTYPE EXPAND <code>number</code>
</pre>

<p>
<a name="IDX438"></a>
<a name="IDX439"></a>
<a name="IDX440"></a>
<a name="IDX441"></a>
<a name="IDX442"></a>

</p>
<p>
   All lines except for those making up axes and characters are drawn
with line type <code>INTEGER</code>, meaning:

</p><pre>0       solid                           1       dot
2       short dash                      3       long dash
4       dot - short dash                5       dot - long dash
6       short dash - long dash                  
</pre>

<p>
the default is a solid line, LTYPE 0. The current value of LTYPE
is available as an internal variable (e.g. <code>DEFINE ltype |</code>)
<a name="IDX443"></a>

</p>

<p>
   LTYPE ERASE and will erase any lines
that are redrawn (e.g. LTYPE 0 BOX LTYPE ERASE BOX will first draw a
box, and then erase it). Not all devices can support erasing
individual lines, if yours doesn't you'll have to ERASE the whole
screen. A convenient way to use LTYPE ERASE is the <code>undo</code> macro.
(in fact, LTYPEs 10 and 11 are used to implement LTYPE ERASE,
LTYPE 10 to start erasing, LTYPE 11 to notify a device that you've finished
doing so).

</p>
<p>
   LTYPE EXPAND makes all dots, dashes, and spaces in the chosen ltype
larger (or smaller) by the value specified.

</p>
<hr><h2><a name="SYN47">Lweight</a></h2>
<pre>Syntax: LWEIGHT number
</pre>

<p>
<a name="IDX444"></a>
<a name="IDX445"></a>

</p>
<p>
Set all lines to have a weight of <code>number</code>, where the bigger the blacker.
Generally, an lweight of 0 is taken to be the hardware's preferred width.
The current value of LWEIGHT is available as an internal variable
(e.g. <code>DEFINE lweight |</code>)
<a name="IDX446"></a>

</p>
<hr><h2><a name="SYN48">Macro</a></h2>
<pre>Syntax: MACRO EDIT name
        MACRO LIST [begin end ]
        MACRO name [ narg ] { body }
        MACRO name [ narg ] &lt; body &gt;
        MACRO name DELETE
        MACRO name #1 #2
        MACRO READ file
        MACRO WRITE file
        MACRO DELETE file
        MACRO WRITE name [ + ] file
</pre>

<p>
<a name="IDX447"></a>
<a name="IDX448"></a>

</p>
<p>
MACRO EDIT name allows you to edit a macro. All the commands available to
the history editor area available (including the ^ history), except
that <kbd>control-M</kbd> inserts
a line before the cursor, <kbd>control-N</kbd> and <kbd>control-P</kbd> get the next and
previous lines respectively, and <kbd>control-V</kbd> and ESC-v move forwards and
backwards 5 lines at a time.
To exit use <kbd>control-X</kbd>
(or whatever you have bound to <code>exit_editor</code>).
The macro need not exist, and both its name and number of arguments can be
changed by editing the zeroth line of the macro (<kbd>control-P</kbd> from the
first line. If this line is corrupted, or deleted, no changes are made to the
macro when you exit. If the number of arguments is negative, the macro will be
deleted when you exit.) You may prefer to use the macro <code>ed</code> instead of
MACRO EDIT, as it doesn't appear on the history list and, if invoked
without a macro name will edit the macro that you edited last. Incidently,
<code>hm</code> (`help macro') will list the last macro that you edited with <code>ed</code>.
The keybindings may be changed with READ EDIT.

</p>
<p>
LIST MACRO lists all currently defined macros, or all those which are
between <code>begin</code> and <code>end</code> alphabetically (asciily). If VERBOSE is
0, macros starting with ## are not listed.

</p>
<p>
MACRO <code>name [narg] { body }</code> defines <code>name</code> to be <code>body</code>,
where <code>name</code> is a
single word, and <code>body</code> may be anything (most users need not
worry about the form in angle brackets; it is occasionally useful when
writing clever macros). A macro is invoked by
typing its name. 
The optional <code>nargs</code> is the number of arguments the macro expects,
default 0.

</p>
<p>
If the macro's body is defined to be <code>delete</code>, the macro is deleted.
MACRO <code>name</code> DELETE also deletes a macro.

</p>
<p>
Arguments are referred to as $1, $2, ... $n, up to a maximum of $9.
$0 gives the name of the macro. If the number of arguments has
more than one digit (e.g. 03 or 12), the macro is taken to have a variable
number of arguments, between the `tens' digit and the `units' digit.
For example, <code>12</code> means 1 or 2 arguments, <code>39</code> means between
3 and 9 arguments, and <code>02</code> means 0, 1, or 2. Confused?  <code>HELP</code>
will tell you what SM knows about a macro's arguments.
There's one problem here; if you say

</p><pre>MACRO woosie 01 {
   if($?1) {
      echo An argument: $1
   } else {
      echo No arguments
   }
}
</pre>

<p>
SM will interpret that <code>01</code> as the integer <code>1</code> before the macro's
defined, so that's equivalent to <code>MACRO woosie 1 { ... }</code>.  So you
cleverly say <code>MACRO woosie "01" { ... }</code>; but that won't work either
as the closing <code>"</code> is seen before the 01's parsed; you have to say
<code>MACRO woosie "01 " { ... }</code> -- and that does work.
<a name="DOCF21" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT21">(21)</a> You don't
have to go through any such contortions in files read by <code>MACRO READ</code>,
but they have their own problems.
<a name="IDX449"></a>
<a name="IDX450"></a>

</p>
<p>
If the number
declared is greater than 99 the last argument will extend to the end
of the line, and may consist of many words. When called, all the arguments 
must appear on the same line as the macro itself. This line may, as
usual, be ended with an explicit \n. The macro can determine whether
it has been supplied a given argument by using the <code>$?</code> construction
(see DEFINE). It is also possible to change the values of arguments
using DEFINE just as usual, and even to DEFINE arguments that you
didn't declare. These are temporary variables, local to the macro, and
will disappear when you exit the macro.

</p>
<p>
Macros must end in space or newline, and if they don't SM will silently
add one (why? to prevent the macro stack being popped prematurely
see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC31">The Command Interpreter</a>). If you want to defeat this, end your
macro with an explicit #, e.g. <code>macro echo {WRITE STANDARD#}</code>; a
slightly less efficient
alternative would be <code>macro echo 111 {WRITE STANDARD $1}</code>.

</p>
<p>
MACRO <code>name #1 #2</code> defines macro name to consist of lines #1 -- #2
of the history buffer.
If #1 or #2 is negative it is interpreted
relative to the current command, so saying <code>MACRO last2 -1 -2</code>
will define a macro <code>last2</code> consisting of the last 2 commands issued.

</p>
<p>
MACRO READ <code>file</code> reads the macros in <code>file</code> and defines them.
See RESTORE for how to also restore the history buffer from macro <code>all</code>.

</p>
<p>
MACRO DELETE <code>file</code> has the effect of deleting all macros defined in
<code>file</code>.

</p>
<p>
MACRO WRITE <code>file</code> writes all currently defined macros to <code>file</code> in
alphabetical order.
If the file exists, and <code>$noclobber</code> is defined, SM will refuse to
overwrite the file.  You can set <code>noclobber</code> by specifying it in
your <tt>`.sm'</tt> file.

</p>
<p>
MACRO WRITE <code>name [ + ] file</code> writes the macro <code>name</code> to <code>file</code>.
If the <code>+</code> is specified, or the file is the
same as for the previous use of this command, the macro is written to the
bottom of the file, otherwise the file is created.
If the file exists and you aren't simply appending, and <code>$noclobber</code> is
defined, SM will refuse to overwrite the file.
You can set <code>noclobber</code> by specifying it in your <tt>`.sm'</tt> file.

</p>
<hr><h2><a name="SYN49">Meta</a></h2>
<pre>Syntax: DEVICE META WORD
        DEVICE META CLOSE
        META READ WORD
</pre>

<p>
<a name="IDX451"></a>
<a name="IDX452"></a>
<a name="IDX453"></a>

</p>
<p>
If you open the special device called META it doesn't close the current
device, merely intercepts plotting commands and stores them away as well
as executing them immediately. This continues until you issue a
CLOSE command.

</p>
<p>
The command META READ reads a metafile and executes it on the current
device. So to make hardcopy of a plot you could say something like:

</p><pre>device x11
device meta metafile.dat
my_cunning_macro
more_brilliance
device meta close
</pre>

<p>
after which (maybe after exiting SM and restarting it), you could say:

</p><pre>device postscript
meta read metafile.dat
device 0
</pre>

<p>
to make a hardcopy.

</p>
<p>
It is safe to concatenate metafiles together, if the fancy takes you.

</p>
<p>
Because of the way that SM interrogates devices about their abilities,
while using META all ltypes, lweights, and fonts will be emulated in
software (this guarantees that the device you playback on will be able
to handle the code). If the current device can handle dots (i.e.
<code>PTYPE 0 0</code>) then META will attempt to use them too, but if
it can't then META will be reduced to faking them. This could
be a serious problem, so good luck. Metafiles do not support colour,
again due to the impossibility of knowing if they will have the same
behaviour as the original device.

</p>
<hr><h2><a name="SYN50">Minmax</a></h2>
<pre>Syntax: MINMAX min max
</pre>

<p>
<a name="IDX454"></a>

</p>
<p>
Set variables <code>min</code> and <code>max</code> to the the maximum and minimum
values of an image
read by the IMAGE command. Only that portion of the image within
the current LIMITS is examined.
This may be useful for setting contour levels,
or doing a halftone plot (see the macro <code>greyscale</code>).

</p>
<p>
For example, the commands:

</p><pre>MINMAX min max
SET levs = $min,$max,($max-$min)/9
LEVELS levs
</pre>

<p>
will choose a set of 10 levels which cover the complete range of the data.

</p>

<hr><h2><a name="SYN51">Notation</a></h2>
<pre>Syntax: NOTATION XLO XHI YLO YHI
</pre>

<p>
<a name="IDX455"></a>

</p>
<p>
   Set axis label format (exponential or floating). By default, all numbers
between 1e-4 and 1e4 are written as floating point numbers, and all numbers
outside this range are written with an exponent. This corresponds to a
<code>NOTATION -4 4 -4 4</code> command.

</p>
<p>
If you set <code>XLO</code>=<code>XHI</code> and/or <code>YLO</code>=<code>YHI</code>,
all values on that axis will be plotted using exponents (including 1); as
a special case if both <code>XLO</code> and <code>XHI</code> are 0 NOTATION will
be reset for this axis.

</p>
<p>
If you want your positive and negative exponents to line up
define the SM variable <code>line_up_exponents</code>; if it's <code>1</code> they'll
be padded with a space, if <code>2</code> or more, with a <code>+</code>
(you can do this in your <tt>`.sm'</tt> file).

</p>
<hr><h2><a name="SYN52">Overload</a></h2>
<pre>Syntax: OVERLOAD keyword INTEGER
</pre>

<p>
<a name="IDX456"></a>

</p>
<p>
   Allow "keyword" (in lowercase) to be used as a macro name if
integer is non-zero. For example,

</p><pre>overload set 1 overload define 1
macro set { DEFINE } macro define { SET }
</pre>

<p>
would interchange the
meanings of the SET and DEFINE commands. The uppercase forms
of the keywords retain their usual meanings. <code>overload set 0</code>
would reinstate the usual meaning of set. You may be surprised by the
effects of overloading certain keywords. For example, if you overload
<code>help</code> to mean <code>DELETE HISTORY HELP</code>, then <code>set help vec
help_string</code> won't work (you'd have to say <code>set HELP vec ...</code>).

</p>
<p>
   This command is intended to be used for changing the default action of
commands, rather than for a wholesale renaming of keywords! A more practical
example than the above would be

</p><pre>overload erase 1 macro erase { del1 ERASE }
</pre>

<p>
to prevent erase commands from appearing on the history list. See the
macro <code>set_overload</code> for a set of definitions like this. It can
be automatically executed by including an "overload" line on your
<tt>`.sm'</tt> file.

</p>
<hr><h2><a name="SYN53">Page</a></h2>
<pre>Syntax: PAGE 
</pre>

<p>
<a name="IDX457"></a>
   PAGE starts a new page for a hardcopy plot (n.b. the device driver for
raster plots is unable to support multiple page plots).

</p>
<p>
On window systems (X11, SunView) page will raise the window and refresh
it if necessary.

</p>
<hr><h2><a name="SYN54">Points</a></h2>
<pre>Syntax: POINTS WORD1 WORD2 [ <code>IF</code> (expr) ]
</pre>

<p>
<a name="IDX458"></a>
<a name="IDX459"></a>
<a name="IDX460"></a>

</p>
<p>
   POINTS makes points of the current style (PTYPE), linetype (LTYPE),
colour (CTYPE), size (EXPAND), and rotation (ANGLE) at the points in
vectors <code>WORD1</code> and <code>WORD2</code>.
If the IF clause is present, only use those points for which <code>expr</code> (see
the section on vector arithmetic) is non-zero.
In fact, either or both of the <code>WORD</code>s may be replaced by
`parenthesised expressions', i.e. expressions in parentheses. For example,

</p><pre>POINTS x (lg(y))
</pre>

<p>
to plot x against the logarithm of y.

</p>
<p>
   In case you ever need to know, the distance from the centre of a point
to a corner is 128 screen units when unexpanded, if the ASPECT
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN4">Aspect</a>) ratio is unity.

</p>
<hr><h2><a name="SYN55">Print</a></h2>
<pre>Syntax: PRINT [+] [ file ] [ 'format' ] { list }
        PRINT [+] [ file ] [ 'format' ] &lt; list &gt;
</pre>

<p>
<a name="IDX461"></a>
<a name="IDX462"></a>
<a name="IDX463"></a>
<a name="IDX464"></a>

</p>
<p>
Print the vectors specified by <code>list</code> to <code>file</code>, if <code>file</code> is
absent, print to the terminal (the output is paged, sort of).
The name of each vector is printed at the head of the
appropriate column. If the output is going to a file, each line of the
header starts with a `#', so the file can be read without using the
LINES command.

</p>
<p>
The header is not printed if the variable
<code>print_noheader</code> is defined and non-zero. For example, I have a macro

</p><pre>p       111     ## print a vector or expression. E.g. "p x" or "p sin(x)"
                local define print_noheader 1
                local set foo=$1
                if(whatis(foo) &amp; 2**5) {
                   print '%g ' { foo }
                } else {
                   print '%s ' { foo }
                }
                #
</pre>

<p>
to print vectors on a single line.
In addition, no header is printed if you are not actually printing any vectors,
in this case no newline is appended to the string. This provides a way of
controlling string output, and suppressing newlines, e.g.
<code>PRINT 'S' {} PRINT 'M\n' {}</code>. You probably will usually want
to use WRITE STANDARD instead (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN83">Write</a>).
<a name="IDX465"></a>

</p>
<p>
With the optional `+' the vectors are appended to the file, otherwise
it is overwritten unless <code>$noclobber</code> is defined, in which case
SM will refuse to touch the file.  You can set <code>noclobber</code> by
specifying it in your <tt>`.sm'</tt> file.

</p>
<p>
   The optional format string is of the type accepted by the C function
`printf', and you should see a book on C (or maybe the online system
manual or help command) for more details. Basically, the format string
is copied to the file with format specifiers beginning with <code>%</code>
signs replaced by the numbers that you want printed. The format
specifiers to use are the floating point ones, <code>%e</code>
(exponential), <code>%f</code> (floating point), and <code>%g</code> (computer's
choice), <code>d</code>, <code>o</code>, <code>x</code> for printing numbers as integers
(the latter two are octal and hexadecimal), or <code>%s</code> for strings.
Fields are right justified by default, you 
can insert a <code>-</code> just after the <code>%</code> to left justify them. A
<code>%</code> may be written as <code>%%</code>, and a tab as <code>\t</code>. Lines
are <em>not</em> terminated by a newline by default, you have to write
them explicitly as <code>\n</code>.

</p>
<p>
   For example,

</p><pre>SET x=1,10 SET y=x**2
PRINT file '%10f (%10.2e)\n' { x y }
</pre>

<p>
will produce

</p><pre>#........x............y
#
..1.000000.(..1.00e+00)
..2.000000.(..4.00e+00)
..3.000000.(..9.00e+00)
(etc.)
</pre>

<p>
where I have replaced each space by a <code>.</code> for clarity. If you say

</p><pre>PRINT '%g ' { x }
</pre>

<p>
you will get

</p><pre>..........x

1.2.3.4.5.6.7.8.9.10.
</pre>

<p>
If you want very long output lines you'll run into one of SM's internal
limits; the maximum length of a string (currently 160 characters).
You might try to work around this
by putting part of the formatted output into string vectors and then using
a %s format to write it out; such an approach can be
made to work, for example instead of

</p><pre>print file 'Date: %2d %2d %4d\n' { dd mm yy }
</pre>

<p>
you can write

</p><pre>set date = sprintf('Date: %2d',dd) + \
           sprintf(' %2d',mm) + \
           sprintf(' %4d',yy)
print file '%s\n' { date }
</pre>

<p>
If you think that this is a hack I rather agree with you, but it does
permit formatted output of up to 400 characters.

</p>
<hr><h2><a name="SYN56">Prompt</a></h2>
<pre>Syntax: PROMPT new_prompt
</pre>

<p>
<a name="IDX466"></a>

</p>
<p>
The current prompt is replaced by <code>new_prompt</code>; the default is
<code>:</code>. Any occurrences of
the character `*' are taken as instructions to ring the terminal bell.
When you start SM your prompt is set to the value of the entry
<code>prompt</code> in your <tt>`.sm'</tt> file (if you have one).
<a name="IDX467"></a>

</p>
<p>
If you enter a partial command (e.g. <code>macro foo {</code> or <code>echo ABC\</code>)
SM switches to a different prompt. By default this is <code>&gt;&gt;</code>, but if you
define the variable <code>prompt2</code> that will be used instead. You can
set <code>prompt2</code> in your <tt>`.sm'</tt> file.
<a name="IDX468"></a>

</p>
<hr><h2><a name="SYN57">Ptype</a></h2>
<pre>Syntax: PTYPE n s
        PTYPE WORD
        PTYPE ( expr )
        PTYPE { list }
</pre>

<p>
<a name="IDX469"></a>

</p>
<p>
   PTYPE <code>n s</code> causes points to be drawn as <code>n</code> sided polygons of a 
style <code>s</code>, where <code>s</code> refers to:
</p><dl compact="compact">

<dt><code>0</code>
</dt><dd>
open 
</dd><dt><code>1</code>
</dt><dd>
skeletal (center connected to vertices)
</dd><dt><code>2</code>
</dt><dd>
starred
</dd><dt><code>3</code>
</dt><dd>
solid
</dd></dl>
<p>
For example, <code>PTYPE 1 1</code> (or <code>PTYPE 0 0</code>) makes points appear as
dots, <code>PTYPE 4 1</code> (the default) makes
(diagonal) crosses, and <code>PTYPE 6 3</code> makes filled hexagons.
Points made up of lines (types <code>0</code>, <code>1</code>, and <code>2</code>)
are drawn using the current LTYPE.

</p>
<p>
When possible <code>PTYPE 0 0</code> will draw the smallest possible dots that
the device is capable of; these may or may not be different from
<code>PTYPE 1 1</code>.

</p>
<p>
The current value of PTYPE is available as an internal variable (e.g.
<code>DEFINE ptype |</code>)
<a name="IDX470"></a>

</p>
<p>
PTYPE <code>WORD </code> or PTYPE <code>( expr )</code> use vector <code>WORD</code> or the
expression <code>expr</code> as its source of <code>n</code> and 
<code>s</code>, ( so you may define different point types for each point) except
that the
numbers are contracted together. If the entry has a fractional part, it is
treated as an expansion factor, relative to the current expansion
(no fractional part means default expansion); so if
<code>n</code> is a vector giving the desired number of sides for a set of points,
<code>s</code> is a vector giving the desired types, and <code>e</code> is a vector
giving the desired relative sizes (<code>0 &lt;= e &lt; 1</code>), you'd want to say
<code>PTYPE (10*n+s+e)</code>.
For example, an an entry of 103.5 in <code>WORD</code> is the same as PTYPE 10 3,
EXPAND 0.5, but if you now say EXPAND 2 the net expansion will be unity.
It's much easier to use a vector of
expansions directly to the EXPAND command, but fractional ptypes are
preserved for backwards compatibility.
<em>N.b. due to a bug in X10R4 for the Sun,
PTYPE <code>n 3</code> does not work for <code>dev xwindows</code> on a sun</em>.
If more points are specified than
the dimension of expr, the first element will be used for the excess.

</p>
<p>
If <code>WORD</code> is a string-valued vector, its elements are used to
label the points of the graph. They are drawn at the current expand
and angle (vector-valued EXPANDs and ANGLEs are ignored), and in the
current default font. For TeX-string users this can be specified
with the variable <code>default_font</code>, which can either simply be defined,
or set in your <tt>`.sm'</tt> file.
<a name="IDX471"></a>
<a name="IDX472"></a>

</p>
<p>
PTYPE <code>{ list }</code> defines the symbol to use with the POINTS
command to be some creation of the user.
The list consists of a set of <code>c x y</code> where <code>c</code> is a letter,
and <code>x</code>
and <code>y</code> are integers. If <code>c</code> is `m' or `r' (move or relocate)
the plot pointer is moved to the point (x,y), if it is `d' (draw) or absent
a line is drawn from the current position to the point (x,y). The coordinates
are measured relative to the current point being plotted, and are
measured in screen coordinates (i.e. 0-32767). Both EXPAND and ANGLE
are applied to the (x,y) values as usual.

</p>
<p>
As an example the command

</p><pre>PTYPE { m 0 500 500 0 0 -500 -500 0 0 500 } 
</pre>

<p>
will define the marker to be a diamond, something like:

</p><pre>                  /\
                 /  \
                 \  /
                  \/
</pre>

<p>
(but with unbroken lines). As a more useful example, there is
a macro <code>upper</code> which defines a variable $upper to draw an upper limit
sign, used as

</p><pre>PTYPE $upper
</pre>

<p>
(if ANGLE were 180, they'd be lower limits).

</p>
<hr><h2><a name="SYN58">Putlabel</a></h2>
<pre>Syntax: PUTLABEL INTEGER str
</pre>

<p>
<a name="IDX473"></a>

</p>
<p>
   PUTLABEL writes a label at the current location with rotation and
size specified by ANGLE and EXPAND (exactly like LABEL). The label
is centered with respect to the current location according to the
argument <code>INTEGER</code> which can be 1 - 9 meaning that the label is:

</p><pre>                        left    centre  right
        above           7       8       9
        centered        4       5       6
        below           1       2       3
</pre>

<p>
(cf. a vt100 keyboard)
To be a little more precise, `above' means that the string's baseline
(the bottom of characters such as `a' that have no descender) is at the
level of the current point, while `below' means that the top of the tallest
character in the string is level with the current point. If you don't like
this neglect of descenders, try

</p><pre>MACRO myputl 102 {label \raise\advance\depth{$2}by100{}\n putlabel $1 $2}
myputl 7 This is a Label
</pre>

<p>
(You can then say <code>overload putlabel 1 macro putlabel {myputl}</code>
if the mood takes you).
After the label is written the current location is on the
baseline, just to the right of the last character drawn.
If <code>INTEGER</code> is 0 the string isn't actually drawn,
but the string's dimensions are calculated (and are available as
<code>$swidth</code>, <code>$sheight</code>, and <code>$sdepth</code>), and any
TeX definitions are remembered. If PUTLABEL 5 isn't quite what you want
(as it centres vertically as well as horizontally), try
<code>LABEL \centre{H_\alpha}</code> instead.

</p>
<p>
See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC14">Drawing Labels and SM's TeX Emulation</a>, for a description of how
to enter a label with funny characters, sub- and super-scripts, and so forth.

</p>
<p>
If EXPAND is set to exactly 1, and ANGLE is exactly 0, then SM
will use hardware fonts, when available, in writing labels. This is faster,
but if you don't like it say "EXPAND 1.00001",
or use a \r explicitly to select the roman font. Or ask your
SM Guru to edit the <tt>`graphcap'</tt> file to stop your printer
from ever using hardware fonts (or read the discussion under LABEL).

</p>
<hr><h2><a name="SYN59">Quit</a></h2>
<pre>Syntax: QUIT 
</pre>

<p>
<a name="IDX474"></a>
<a name="IDX475"></a>
Quits the programme entirely.

</p>
<p>
The macro `q' is defined as something like

</p><pre>DELETE HISTORY DEFINE 1 0     # default value
DEFINE 1 ? { Are you sure? Enter 1 to really quit }
IF($1) { QUIT } 
</pre>

<p>
so you won't quit accidently, and the QUIT won't appear
in the history file. This is an obvious candidate for overloading.

</p>
<hr><h2><a name="SYN60">Range</a></h2>
<pre><a name="IDX476"></a>
Syntax: RANGE number_x number_y
</pre>

<p>
If number is non-zero, set the range on the x or y axis to be number,
so LIMITS will choose two values that differ by number. Nothing will
happen until you issue a LIMITS command.

</p>
<p>
For instance, if you wanted to ensure that the y axis of a logarithmic plot
spans exactly two decades the commands RANGE <code>0 2</code> LIMITS <code>x y </code> would
choose suitable y limits, with actual values appropriate for the <code>y</code>
vector (in fact symmetrical about the median value).

</p>
<hr><h2><a name="SYN61">Read</a></h2>
<pre>Syntax: READ WORD INTEGER
        READ [ ! ] { WORD INTEGER WORD INTEGER ... }
        READ [ ! ] { ... WORD range ... }
        READ ROW WORD INTEGER
        READ [ ! ] 'format' { WORD WORD ... }
        READ EDIT WORD
        READ OLD WORD WORD
        META READ WORD WORD
</pre>

<p>
<a name="IDX477"></a>

</p>
<p>
READ <code>WORD INTEGER</code> reads a column of data from the file specified
by the DATA command, using the lines specified by LINES. Columns may
be separated by white space (blanks or tabs) or by a comma, or by some
combination of the two. It's OK if some of the columns contain text,
providing that you don't try to read them. You can read text columns
into string vectors, as described in the next paragraph.
The data is
read into the vector <code>WORD</code>, which will be created, from column
<code>INTEGER</code>. Any field beginning with a <code>*</code> is taken to be `empty',
and is assigned the value 1.001e36. Any line beginning with a
# is skipped over (and printed if VERBOSE is greater than 1), any line
beginning with a ! is skipped and always written to the terminal.
Long (logical) lines may be spread over
several (physical) lines by ending the line with a `\'; no line may
exceed a total of 1500 characters. If you use continuation lines, note
that SM's line numbers (for example, as set with the <code>LINES</code> command)
apply to <em>logical</em> not <code>physical</code> lines; a continued line counts
as only one line.
<a name="IDX478"></a>
<a name="IDX479"></a>
<a name="IDX480"></a>

</p>
<p>
You can optionally specify a type of vector by adding a suffix onto the
integer; `.f' (the default) means floating point, `.d' or `.i' means integer,
`.s' means string-valued.
String valued vectors can be used as input to PTYPE commands, or
simply for reading columns from data files that you want to PRINT.
<a name="IDX481"></a>
<a name="IDX482"></a>
<a name="IDX483"></a>

</p>
<p>
READ { <code>WORD INTEGER WORD INTEGER</code> ... } is the same as repeating
READ <code>WORD INTEGER</code> for each vector, but more efficient as it only has to
read the file once.

</p><pre>READ { x 1 s 5.s y 2.f z 3.i }
</pre>

<p>
will read columns 1 and 2 into floating point vectors <code>x</code> and <code>y</code>,
column 3 into an integer-valued vector z,
and column 5 into string-valued vector <code>s</code>. As noted below, you can
omit the INTEGERs by specifying an empty format: READ " { x y } (those
are two single quotes).

</p>
<p>
Usually
SM stops reading at the first invalid line, but if you say <code>READ !</code> all
the lines specified with <code>LINES</code> (or the entire file) are read.
Missing numerical fields are set to be invalid (i.e. they are treated as *);
missing string values are left blank. This is probably most useful with the
<code>%n</code> format specifier.

</p>
<p>
If <code>INTEGER</code> is invalid (&lt;= 0), the contents of the file are written
to the standard output. READ ROW is very similar, but the values
are read from row <code>INTEGER</code> of the file (any LINES command is ignored).
The same type qualifiers are allowed as for reading columns. There is no
limit to the number of elements in the vector, except that implied by
the maximum length of a line. You cannot specify a range of columns to
read with READ ROW, but try

</p><pre>SET i=2,5
READ ROW x 1
SET x=x[i]
</pre>

<p>
If the first field is a string, you can say READ ROW s 1.s  SET x=ATOF(s[i]).

</p>
<p>
<a name="IDX484"></a>
If your data is in a number of columns (e.g. you have written it out to a file
ten values to a line) you can specify a range of columns, for example

</p><pre>READ { x 1-4 y 5 z 6-10 }.
</pre>

<p>
You can only use ranges for numerical vectors, and only with the list form
of <code>READ</code>. Ranges won't work if
there is a short line at the end, but you can still say something like

</p><pre>LINES 0 100
READ { x 1-4 }
READ ROW _x 101
SET x=x CONCAT _x
</pre>

<p>
which will be almost as efficient if you have defined <code>$save_read_ptr</code>.

</p>
<p>
<a name="IDX485"></a>
<a name="IDX486"></a>
In order to speed up multiple reads of the same file, SM usually remembers
where it got to in a file; this is disabled if you undefine the variable
<code>$save_read_ptr</code> (which can be done in your <tt>`.sm'</tt> file by setting
it to 0). The remembered position is forgotten every time that you issue a
<code>DATA</code> command,
or try to re-read part of the file. You can get into trouble if you read
part of a file, modify the file without reissuing a <code>DATA</code> command,
and then read some more, but in normal
usage it should be safe to leave saving the read pointer enabled.

</p>
<p>
Instead of using simple column-oriented input
it is possible to specify a format similar to those used by C's <code>scanf</code>
functions (Fortran formats are not supported); if you don't know C
then most of what you need to know is that characters in the input
must match those in the input file, except that items to be read are specified
with format strings that start <code>%</code>. For example, a format
<code>abc%f:%f</code> expects the input to consist of `abc' then two floating point
numbers separated by a colon.
If the <code>%</code> is followed by a <code>*</code>
the field is read but isn't assigned to a vector.
You can specify a newline as <code>\n</code> or a tab as <code>\t</code>.

</p>
<p>
As a further example, if your data file has lines like

</p><pre>        1:12:30  -45:30:11
</pre>

<p>
you could read it with

</p><pre>        read '%d:%d:%d %f:%f:%f' { hr min sec deg dmin dsec }.
</pre>

<p>
The type of the vector is deduced from the format string; you can't
use <code>.f</code> or <code>.s</code> in the vector list (why would you want
to specify a type twice?).

</p>
<p>
As a special case, of you specify an empty format (") the named vectors
are read as floats from the first n columns of the file, so

</p><pre>READ " { x y z }
</pre>

<p>
is equivalent to

</p><pre>READ { x 1.f y 1.f z 3.f }
</pre>

<p>
or simply

</p><pre>READ { x 1 y 1 z 3 }
</pre>

<p>
I said that the %-formats were `similar' to <code>scanf</code>'s; they differ
in the way that they treat field widths and white space. If you don't
specify a width at all SM follows the usual C behaviour of skipping
white space between items; if you do specify a field width no space is
skipped over before the field begins. You can always explicitly skip
spaces with a <code>%*[ ]</code> format. The <code>%n</code> format returns the number
of fields matched rather than the number of characters.

</p>
<p>
The supported format letters are <code>d</code>, <code>e</code>, <code>f</code>, <code>g</code>,
<code>o</code>, <code>n</code>, <code>s</code>, <code>x</code>, and <code>[</code>, their meanings are:

</p>
<dl compact="compact">

<dt><code>%d</code>
</dt><dd>
Read an integer into a floating vector (`d' stands for `decimal'). If a
field width is specified trailing spaces are treated as spaces not zeros
-- this isn't fortran you know. The field <code>" 1234 "</code> (i.e. a
field width of 6, <code>%6d</code>) has the value <code>1234</code> not <code>12340</code>.

</dd><dt><code>%e</code>
</dt><dd>
</dd><dt><code>%g</code>
</dt><dd>
Read a floating point number with or without an exponent into a floating
vector. As for <code>%d</code>, trailing spaces in a fixed-width field are treated
as spaces not zeros.

</dd><dt><code>%f</code>
</dt><dd>
Read a floating point number without an exponent into a floating vector.
As for <code>%d</code>, trailing spaces in a fixed-width field are treated
as spaces not zeros.

</dd><dt><code>%n</code>
</dt><dd>
Return the number of fields that are already correctly
matched in the current line; this is only useful in conjunction with
READ !.

</dd><dt><code>%o</code>
</dt><dd>
Like %d, but the number's taken to be octal.

</dd><dt><code>%s</code>
</dt><dd>
Read a string into a string-valued vector. If a field width is specified
the entire field is read spaces and all; if there is no width initial spaces
are skipped as usual and the string is terminated by the first white
space character.

</dd><dt><code>%x</code>
</dt><dd>
Like %d, but the number's taken to be in hex.

</dd><dt><code>%[...]</code>
</dt><dd>
Read a string consisting of the characters <code>...</code> into a string valued
vector. You can specify a range as <code>a-z</code> so <code>%[a-zABC0-9]</code> would
read a string consisting of any lower case character or digit, or one
of A, B, or C.
If the first character is ^, read any characters <em>except</em> those
specified (e.g. %[^abc] reads anything but
the letters a, b, or c). If a field width is specified characters that
don't match those specified at the end of the field are ignored.

</dd><dt><code>%%</code>
</dt><dd>
Not a conversion format, but a literal %.

</dd></dl>

<p>
READ EDIT <code>WORD</code> reads a new set of keybindings from the file <code>WORD</code>.
The format and syntax are given under History (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN33">History</a>) in the
introduction.

</p>
<p>
READ OLD <code>WORD1 WORD2</code> defines macro <code>WORD1</code> to be the the
contents of file <code>WORD2</code>. This is provided for compatibility with
Mongo (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC64">Tips for Mongo Users</a>) and the <code>read_old</code> macro. You no longer
need use <code>read_old</code> to read SM history files, use RESTORE
instead.

</p>
<p>
   If VERBOSE (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN77">Verbose</a>) is greater than 0, the lines actually
read will be reported.

</p>
<p>
META READ <code>WORD</code> reads a metafile, as produced with the pseudo-device
META, and executes the enclosed commands on the current device.
<a name="IDX487"></a>

</p>
<hr><h2><a name="SYN62">Relocate</a></h2>
<pre>Syntax: RELOCATE X Y
        RELOCATE ( X Y )
</pre>

<p>
<a name="IDX488"></a>

</p>
<p>
   The first form sets the current position to (<code>X,Y</code>) in user
coordinates without drawing a line. The second (with parentheses) sets
the position in `screen' coordinates, i.e. 0-32767. The current
position is used by the DRAW, LABEL, and PUTLABEL commands.

</p>
<p>
There are a couple of pairs of internal variables <code>($uxp,$uyp)</code>
and <code>($xp,$yp)</code> that give the current position of the plot pointer,
either in user or screen coordinates.
<a name="IDX489"></a>
<a name="IDX490"></a>

</p>

<hr><h2><a name="SYN63">Restore</a></h2>
<pre>Syntax: RESTORE [ filename ]
</pre>

<p>
   Restore all the current macros, variables, and vectors from file
<code>filename</code>
(if omitted the default is to use the value of <code>save_file</code> in
your <tt>`.sm'</tt> file, or failing that <tt>`sm.dmp'</tt>). In
addition, the current history buffer 
is replaced by the macro <code>all</code> if defined in the RESTOREd file.

</p>
<p>
   The file should have been written by the SAVE
command, and RESTORE will treat any other file type as if it were a
SM history file and add its commands to the end of the
current history list.
<a name="IDX491"></a>

</p>
<p>
If VERBOSE (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN77">Verbose</a>) is greater than 0, some extra information
is printed.

</p>

<hr><h2><a name="SYN64">Return</a></h2>
<pre>Syntax: RETURN 
</pre>

<p>
<a name="IDX492"></a>
<a name="IDX493"></a>

</p>
<p>
   Return from the current macro, which includes breaking out of
 DO and  FOREACH loops. If you are not executing a macro,
simply return
to the prompt (this is more or less equivalent to typing <kbd>control-C</kbd>).

</p>
<p>
   A RETURN can be useful while playing with fiddling with data
interactively. For example, if you want to playback 
a set of commands, but then do other things when the plot has
appeared, you could put a RETURN after the desired part of the
playback buffer. (This doesn't work quite the way that you might
naively think. <code>Playback</code> works by defining a macro <code>all</code> from
the history list, and then executing it. The RETURN is actually returning
from this macro, rather than directly from the command list,
but the effect is the same. If RETURN always returned
directly to the prompt, macros such as <code>hcopy</code> wouldn't work.)

</p>
<p>
   If VERBOSE is 2 or more, the name of the
macro being returned from is output.

</p>
<p>
<em>If the very last command in a macro is RETURN then the RETURN
will take place, not from the desired macro, but from where the macro
was called from. You can work around this by putting
a space after the RETURN, or simply omitting it as it isn't doing anything
anyway. If a RETURN comes last on a history list, this problem will
lead to macros such as <code>hcopy</code> not working correctly</em>.
<a name="IDX494"></a>
<a name="IDX495"></a>

</p>
<hr><h2><a name="SYN65">Save</a></h2>
<pre>Syntax: SAVE [ filename  ]
</pre>

<p>
<a name="IDX496"></a>

</p>
<p>
Save some or all of the current macros, variables, and vectors
in file <code>filename</code>
(if omitted the default is to use the value of <code>save_file</code> in your 
<tt>`.sm'</tt>
file, or failing that <tt>`sm.dmp'</tt>). The current history buffer may also
be saved, as the macro <code>all</code>.

</p>
<p>
You are prompted for whether you want to save
variables, vectors, and macros (which includes <code>all</code>, the current
playback buffer). Macros beginning
## are <em>not</em> saved, as they are assumed to be system macros.
Variables and vectors whose names start with a `_' are assumed to be
temporaries, and are not saved either.

</p>
<p>
   The opposite to SAVE is RESTORE (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN63">Restore</a>).
You may want to use the MACRO
DELETE WORD command to undefine macros from e.g. the <tt>`utils'</tt> macro file.
See, for example, the macro <code>sav</code> (which can be overloaded).

</p>
<p>
If VERBOSE (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN77">Verbose</a>) is greater than 0, some extra information
is printed.

</p>
<hr><h2><a name="SYN66">Set</a></h2>
<pre>Syntax: SET name = expr
        LOCAL SET name = ...
        SET name = { expr }
        SET name = &lt; expr &gt;
        SET name = expr IF ( expr )
        SET name = expr1, expr2 [, expr3 ]
        SET name = expr1 ? expr2 : expr3
        SET name LOCAL
        SET DIMEN ( name ) = INTEGER
        SET name = WORD ( [ WORD [ , WORD ... ] ] )
        SET name [ expr ] = expr
        SET name [ expr, expr ] = expr
        SET IMAGE[expr, expr] = expr
        SET HELP WORD [ rest ]
        SET RANDOM s_expr
</pre>

<p>
<a name="IDX497"></a>
<a name="IDX498"></a>
<a name="IDX499"></a>
<a name="IDX500"></a>
<a name="IDX501"></a>
<a name="IDX502"></a>

</p>
<p>
Conduct various operations on vectors of data.
The simplest, SET <code>name = expr</code> sets vector <code>name</code>
to be equal to the expression <code>expr</code>.
If the IF clause is present, <code>name</code> will only contain
those elements of <code>expr</code> for which it is true (non-zero).
A special case of an expression is simply a list of values within braces (or
angle brackets).<a name="DOCF22" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT22">(22)</a>
For string-valued vectors, the
only allowable expressions are a string-valued vector, the
CONCATenation of two string vectors, the addition (i.e. element-by-element
concatenation), or a string in single quotes
(e.g. <code>SET s='Hello, World'</code> or
<code>SET ss='n_{' + &lt; e cl co g &gt; + '}'</code>).

</p>
<p>
Within a macro,
any of these commands that set an entire vector may be preceded by the
word LOCAL. This ensures that the vector <code>name</code>
is only visible within that macro, and any called from it (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN43">Local</a>).
Future references to the name automatically refer to the local vector,
so only the first occurrence need be preceeded by LOCAL.
Such local vectors are automatically destroyed when they go out of scope;
in fact it is illegal to delete one explicitly.

</p>
<p>
An equivalent way to achieve this is with the command <code>SET name LOCAL</code>,
after which the vector may be SET in local scope (so
<code>SET x LOCAL SET x=10 SET x=20</code> is equivalent to
<code>LOCAL SET x=10 SET x=20</code>).

</p>
<p>
Note that, as usual, you may have to be a
little careful to ensure that you don't exit a macro before you expect.
The symptoms would be that your local vector was already destroyed, or that
it referred to one at less restrictive scope (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC31">The Command Interpreter</a>).
The easiest fix is to add a comment line to the end of the macro.
<a name="IDX503"></a>
<a name="IDX504"></a>

</p>
<p>
With expressions separated by commas the SET command is like a DO loop,
setting
<code>name</code> to be the values between <code>expr1</code> and <code>expr2</code>, at
increments of <code>expr3</code> (which defaults to 1). You can also use an
implicit DO as part of an expression, e.g. SET x=1 + do(0,10,2)/10
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN5">Arithmetic</a>).

</p>
<p>
The command with ? and : is similar to the C ternary operator.
If <code>expr1</code> is true,
take the corresponding value of <code>name</code> for <code>expr2</code>, otherwise
use <code>expr3</code>. This command is worth learning, as it can often be
<a name="IDX505"></a>
used to replace a DO loop. This command is in fact simply a special case
of SET <code>x = expr</code>.

</p>
<p>
If you have a DO loop that calculates each element of a vector in turn,
something that is possible if inefficient in SM,
<a name="DOCF23" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT23">(23)</a>
you need to define a vector before you use it. You will also need to
declare a vector (or create it by putting it on the left of a SET command)
if you want to use a vector-valued subscript on the left of an expression.
This can be done with
the SET DIMEN(<code>name</code>) = <code>INTEGER</code>, which also initialises it to 0.
Thus SET DIMEN(<code>y</code>) = DIMEN(<code>x</code>) is
equivalent to SET <code>y</code> = <code>0*x</code>. You cannot use expressions as the
dimension, but SET <code>y</code> = <code>$(4 + 4)</code> works perfectly well.
You can optionally specify a qualifier to the dimension, in just the same way
that you can specify a qualifier to a column in a READ command, so
SET DIMEN(<code>s</code>) = <code>10.s</code> declares a 10-element string-valued vector.
<a name="IDX506"></a>
See also SET <code>WORD</code> [ <code>expr</code> , <code>expr</code> ] = <code>val</code>.

</p>
<p>
SET <code>name</code> = <code>WORD</code> ( [ <code>arg</code> [ <code>, arg ...</code> ] ] )
allows you to use a macro 
as a sort of function definition. Within the macro WORD any
assignment to <code>$0</code> has the effect of assigning to <code>name</code>, and the
other arguments behave as normal. The arguments <code>arg</code> can be words
or numbers (but not general expressions) and are separated by commas.
<em>Note that this is a change to
the syntax of this command!</em> Previously only one argument was
permitted, but it could be an expression, and the result was returned
by assigning to <code>$1</code> in a rather confusing way.

</p>
<p>
SET <code>word[expr] = expr</code> sets the elements <code>expr</code>
of vector <code>word</code> to the values of the vector on the right hand side.
If the left hand side is a string but the right hand side is numerical
it will be converted.
The first <code>expr</code>
is converted to an integer before being used as an index; if it is too small
it's set to 0, if too large to the largest allowable index.
For example,

</p><pre>	set i=0,10 set x=100*i
	set dimen(y) = dimen(x)
	set y[i-1] = x
</pre>

<p>
will result in a complaint that -1 is an invalid index
and set <code>y = { 100 200 300 ... }</code>. 
Note that
arrays are subscripted with [ ] not (), and that, as always, indices start
at 0 not at 1. The <code>word</code> must exist before you can do this to it.
<a name="IDX507"></a>

</p>
<p>
If your range of indices is contiguous you can say:

</p><pre>        set x[0,10] = y
</pre>

<p>
instead of

</p><pre>        set i = 0, 10
        set x[i] = y
</pre>

<p>
As a bonus the vector x will be extended
as needed to accomodate the new elements.  This means that

</p><pre>        set x = x CONCAT y
</pre>

<p>
is equivalent to

</p><pre>        set x[dimen(x), dimen(x) + dimen(y) - 1] = y
</pre>

<p>
If you have pre-allocated x to be large enough,
the latter is (maybe much) more efficient.

</p>
<p>
This also provides a way to generate a vector initialised to a desired
value:

</p><pre>        set x[0, 100] = 10
</pre>

<p>
SET IMAGE[ix,iy] is used to set elements of an image to the specified values.
The image must exist (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN36">Image</a>), and the vectors ix and iy are interpreted
as integer subscripts into the image (0-indexed, of course). This is the
inverse of the SET z=image[ix, iy] and <em>isn't</em> quite
the same as the SET z=IMAGE(x,y) command, as x and y are interpreted with
using the (optional) xmin, xmax, ymin, and ymax values. In the old days, this
command was <code>set image(ix,ix) = ...</code>, but this was confusing and is
now deprecated.

</p>
<p>
SET HELP sets the help string for a vector; the rest of the line is read,
and will be returned in response to a HELP <code>WORD</code> request. It can
also be used in the string-valued expression HELP(<code>name</code>), for example
YLABEL $(HELP(yvec)).

</p>
<p>
SET RANDOM number sets the seed of the random number generator used by the
RANDOM operator; if you don't set it yourself it'll be set to some value
based on the time since 1970.

</p>
<p>
Let's look at some examples.

</p><pre>SET y = $v1 + 5.0 * x
</pre>

<p>
This sets each element of the vector <code>y</code> to be the value of the
scalar <code>$v1</code> plus 5.0 times the corresponding element of the
vector <code>x</code>  
(assuming that <code>x</code> has been defined previously)

</p><pre>SET data_set_1 = lg(x) IF ( lg(x) &gt; 0)
</pre>

<p>
This sets the elements of the vector <code>data_set_1</code> to be the (common)
logarithm
of the corresponding element of the vector <code>x</code>, if that logarithm is
&gt; 0.  Thus <code>data_set_1</code> will in general be of smaller size than <code>x</code>.

</p><pre>SET data = (lg(x) &gt; 0) ? lg(x) : 0
</pre>

<p>
In this case, <code>data_set_1</code> will be the same size as <code>x</code>, and any
elements of <code>data_set_1</code> where the corresponding element of 
<code>x</code> is less than or equal to 1, will be set to 0.

</p><pre>SET vec = 4*{ 1 1.5 2 2.5 3 }
</pre>

<p>
will define a vector <code>vec</code>, with 5 elements, with the values given
by four times those in the list.

</p><pre>SET vec = 1,12,2 
</pre>

<p>
an alternative way of defining the same values.

</p><pre>SET i = { 2 3 }
SET x = vec[i]
</pre>

<p>
will set the vector <code>x</code> to have be <code>8 10</code> (i.e. <code>vec[2]</code>
and <code>vec[3]</code>).

</p><pre>MACRO pow 2 { SET $0 = $1 ** $2 } 
SET vec = pow(vec , 3) 
</pre>

<p>
cube the vector <code>vec</code>.

</p><pre>SET vec[0] = 2*pi
</pre>

<p>
Change your mind about the first element of <code>vec</code>.

</p><pre>SET HELP pam Wichita, Kansas, July 7, 1953
</pre>

<p>
will set the help string for vector <code>pam</code> to be the string
<code>Wichita, Kansas, July 7, 1953</code>, so when you type
<code>HELP pam</code>, this string will be printed out.

</p><pre>SET rhl=Robert
</pre>

<p>
defines a string vector with one element.

</p><pre>SET DIMEN(rhl) = 10.s
</pre>

<p>
defines a string vector with ten elements (all blank), while

</p><pre>SET rhl={Robert Horace Lupton}
</pre>

<p>
defines a string vector with initialised elements, and

</p><pre>SET rhl[1]=Hugh
</pre>

<p>
corrects it.

</p>
<p>
See the CURSOR command for defining a pair of vectors using the
cursor to mark the points, and SPLINE for how to fit splines
to pairs of vectors.

</p>
<hr><h2><a name="SYN67">Shade</a></h2>
<pre>Syntax: SHADE INTEGER pexpr pexpr
        SHADE HISTOGRAM INTEGER pexpr pexpr
</pre>

<p>
<a name="IDX508"></a>
<a name="IDX509"></a>

</p>
<p>
   (`Pexpr' is the name of a vector, or an expression in parentheses,
e.g. <code>SHADE 1000 x (sqrt(y))</code>).

</p>
<p>
   Shade `inside' a curve defined by the expressions. The shading is
rotated through the current value of <code>ANGLE</code>, and lines are spaced
<code>INTEGER</code> apart (screen coordinates, so the full screen is 32768
across). If <code>INTEGER</code> is 0, the lines will be drawn as close
together as the device allows, simulating an area fill. This is a very
inefficient way to fill areas, made only slightly better by specifying a
large <code>LWEIGHT</code> on devices that support such things in hardware
(you'll also get slightly jagged edges).

</p>
<p>
The meaning of `inside' is that as the shading is done, from
left to right taking the value of <code>ANGLE</code> into account, lines are drawn
from every odd to every even crossing of the curve. The curve is
considered as being closed by joining the first to the last point. If
a shading line just touches the curve the algorithm may be confused,
change <code>INTEGER</code> slightly, or adding 180 to ANGLE. Sometimes
joining the ends of the curve may 
not be what you want, try using <code>CONCAT</code> to add points on the end
yourself. For example,
<a name="IDX510"></a>

</p><pre>SET x=0,10 SET y=x**2 LIMITS x y SHADE 1000 x y
</pre>

<p>
looks like a new moon, but

</p><pre>SHADE 1000 (x CONCAT 10) (y concat -1e10)
</pre>

<p>
shades beneath the curve, for <code>ANGLE</code> 0 that is.
You could also try the macros <code>scribble</code> and <code>shading</code> in
demos, e.g. type <code>load demos scribble</code>.

</p>
<p>
<code>SHADE HISTOGRAM</code> is similar, but it shades the histogram that would
be drawn by <code>HISTOGRAM</code> from the same set of points. In this case the
area to be shaded lies between the histogram and the line y=0. If this
offends you, offset the whole graph and lie about the axes.

</p>
<hr><h2><a name="SYN68">Show</a></h2>
<pre>Syntax: SHOW 
</pre>

<p>
<a name="IDX511"></a>

</p>
<p>
   List the values of some of the internal variables, including
current location
and plot region limits in user and device coordinates, the value of
the expansion and angle variables, the line type and weight, and the
physical limits. Show is actually a macro, so you could modify
it to your own ends, for example listing the current data file too.

</p>
<hr><h2><a name="SYN69">Sort</a></h2>
<pre>Syntax: SORT { vector_list }
</pre>

<p>
<a name="IDX512"></a>
<a name="IDX513"></a>

</p>
<p>
Sort the first vector in the list into increasing numerical order, and
rearrange the others in the same way. The maximum number of vectors that can
be sorted is 10. For example, following the commands

</p><pre>SET e = { 2 7 1 8 2 8 1 8 2 } SET p = { 3 1 4 1 5 9 2 6 5 }
SORT { e p } 
</pre>

<p>
the vectors <code>e</code> and <code>p</code> would be <code>1 1 2 2 2 7 8 8 8 </code> and
<code>4 2 3 5 5 1 1 9 6 </code>. The order within the <code>p</code> vector is
not defined when the <code>e</code> values are identical.

</p>
<p>
Any mixture of string- integral- and arithmetic-valued vectors is allowed;
the only exception is that if the first (i.e. key) vector is integral,
it'll be converted to floating before being used.

</p>
<hr><h2><a name="SYN70">Spline</a></h2>
<pre>Syntax: SPLINE x1 y1 x2 y2
</pre>

<p>
<a name="IDX514"></a>
<a name="IDX515"></a>

</p>
<p>
Fit a natural cubic spline through the points specified by vectors <code>x1</code> and
<code>y1</code>.
The dimensions of <code>x1</code> and <code>y1</code> must be the same and must exceed 2, 
<code>x1</code> must
be monotonic increasing (use SORT if necessary). When the spline
has been fit, take the points
specified in vector <code>x2</code>, and fill the (new) vector <code>y2</code> with the
corresponding values. Linear interpolation is used beyond the ends of
<code>x1</code>.

</p>
<hr><h2><a name="SYN71">Strings</a></h2>
<pre>Strings
</pre>

<p>
<a name="IDX516"></a>
<a name="IDX517"></a>
<a name="IDX518"></a>
<a name="IDX519"></a>
<a name="IDX520"></a>
<a name="IDX521"></a>
<a name="IDX522"></a>

</p>
<p>
SM supports a number of string operations on vectors and scalars. In the
following descriptions expr is a expression and vector the name of a vector.
 
<a name="IDX523"></a>
<a name="IDX524"></a>

</p><pre>Unary:
</pre>

<p>
<a name="IDX525"></a>
</p><dl compact="compact">

<dt><code>ATOF(expr)</code>
</dt><dd>
The value of expr converted to a floating point number. If an element of the
expression cannot be so interpreted (i.e. it doesn't start with an optional
sign followed by a digit), the value returned will be 0.

</dd><dt><code>CTYPE(STRING)</code>
</dt><dd>
Return a vector with the names of all currently defined colours; there
is also CTYPE() to recover their values (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN5">Arithmetic</a>).

</dd><dt><code>HELP(name)</code>
</dt><dd>
The help string associated with vector <code>name</code> (set with SET HELP)

</dd><dt><code>LENGTH(expr)</code>
</dt><dd>
The length (SCREEN units) that a string would have if plotted

</dd><dt><code>STRLEN(expr)</code>
</dt><dd>
The number of characters in a string

</dd><dt><code>STRING(expr)</code>
</dt><dd>
Convert a number to a string. You might prefer to use sprintf('%t',expr)
instead, as it gives you more control.

</dd><dt><code>STRING&lt;WORD&gt;</code>
</dt><dd>
Convert a string to a string, quoting ". You don't usually need to
use this (simple write <code>'my string'</code>), but if your string already
contains quotes this doesn't work.

</dd><dt><code>( expr )</code>
</dt><dd>
Raise precedence

</dd></dl>


<pre>Binary:
</pre>

<dl compact="compact">

<dt><code>expr + expr</code>
</dt><dd>
Add; concatenate element by element

</dd><dt><code>expr CONCAT expr</code>
</dt><dd>
Concatenate the two vectors

</dd><dt><code>INDEX(expr_1,expr_2)</code>
</dt><dd>
Return the starting index of expr_2 in expr_1, or -1 if not found.

</dd><dt><code>SPRINTF(expr_1,expr_2)</code>
</dt><dd>
Format expr_2 using the standard C format string expr_1. The additional
format %t or %T is identical to %e, but formats the string as a power of
10 in TeX format.  Note that only one expr may be formatted, but that
you can say <code>sprintf(expr,expr) + sprint(expr,expr) ...</code> to
work around this restriction.

</dd><dt><code>vector[expr]</code>
</dt><dd>
The elements of vector given by expr.

</dd></dl>


<pre>Ternary:
</pre>

<dl compact="compact">

<dt><code>SUBSTR(expr_1,expr_2,expr_3)</code>
</dt><dd>
Return the substring of expr_1 that starts at expr_2 and is expr_3
characters long. If expr_2 is negative, count from the end of the string;
if expr_3 is 0 return the rest of the string. For example,
<code>'Dr. ' + substr('Ralph Monger',-6,0)</code> would return <code>'Dr. Monger'</code>.

</dd><dt><code>expr1 ? expr2 : expr3</code>
</dt><dd>
expr2 if expr1 is true, else expr3

</dd></dl>
<p>
Node that this is similar to the corresponding SET command, but
it needs parentheses if used as an expression.

</p>
<p>
All indices, as elsewhere in SM, start at 0; e.g.
<code>substr('Algonquin',0,1)</code> is <code>A</code>.

</p>
<p>
The expression <code>VECTOR[expr]</code> results in a vector of the same
dimension as the <code>expr</code>, with elements taken from <code>VECTOR</code>
(i.e. <code>VECTOR[INT(expr_i)]</code>).
 
You can also use <code>WORD([ expr [ , ... ]])</code> as part of
an expression, where <code>WORD</code> is a macro taking zero or more arguments.
The arguments are restricted to be either the names of vectors or numbers;
sorry.

</p>
<p>
You can use the usual logical operators (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN45">Logical</a>) with string-valued
vectors ; there's a
discussion in that section of the confusions that people conjure up about
when they need to use <code>"</code>.

</p>
<p>
The HELP(<code>name)</code> string operator is often useful in labels, for example

</p><pre>        SET HELP size "r_e"
        ...
        XLABEL $(HELP(size))
</pre>

<p>
<a name="IDX526"></a>
The precedences are what you'd expect, with <code>+</code> being higher than
<code>CONCAT</code>. The logical operators have even lower precedence than
<code>CONCAT</code>.

</p>
<hr><h2><a name="SYN72">Surface</a></h2><p>
<a name="IDX527"></a>

</p><pre>Syntax: SURFACE type z1 z2
or      SURFACE type z1 z2 WORD WORD
</pre>

<p>
   Draw a wire-frame surface of the current <code>IMAGE</code> from the point
defined by <code>VIEWPOINT</code>. If the WORDs
are omitted a line in the surface will be drawn for each row and column
of the image; if the WORDs are present they will be taken to be the
<code>x</code>- and <code>y</code>- coordinates of the desired lines, and SM will
interpolate in the image to determine
the corresponding values (see also the hundreds digit of type, below).

</p>
<p>
The command <code>VIEWPOINT</code> specifies the position of the observer
and the type of projection used (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN79">Viewpoint</a>).

</p>
<p>
   The last digit of TYPE is used to determine which surface to draw:

</p><pre>        0       no hidden line removal
        1       draw top surface
        2       draw bottom surface
        3       draw both top and bottom surfaces
</pre>

<p>
If <code>type</code>'s tens digit is set, <code>SURFACE</code> will use the current
limits (as set with <code>LIMITS</code>) rather than autoscaling them from the
data.

</p>
<p>
If <code>type</code>'s hundreds digit is set, the two <code>WORD</code>s are taken to
be the <code>x</code>- and <code>y</code>- coordinates corresponding to the rows and
columns of the IMAGE, but no interpolation is done. For example, after

</p><pre>IMAGE (11,11)
SET ix=0,10
set xs=0,10,2
do y=0,10 {
   SET IMAGE(ix,$y) = cos(0.2*ix)*sin(0.4*$y)
}
VIEWPOINT 30 -10 -1
SURFACE 3 -1.1 1.1 xs xs
</pre>

<p>
will draw a 2-sided surface, drawing 21 lines in each direction on
the surface. If, on the other hand, the data were really only known on
at irregular set of <code>x</code>- and <code>y</code>-values, you could say something
like

</p><pre>IMAGE (11,11)
SET ix=0,10
SET x = { 0 1.3 2.4 3 4 4.5 4.6 6.7 8.2 9.6 10 }
SET y = { 0 0.4 0.9 1.2 2.718 3.14 4.2 5.4 6.667 9.1 10 }
do i=0,10 {
   SET IMAGE(ix,$i) = cos(0.2*x)*sin(0.4*y[$i])
}
CTYPE cyan
SURFACE 103 -1.1 1.1 x y
CTYPE default
</pre>

<p>
to draw the same surface.

</p>
<p>
<code>z1</code> and <code>z2</code> are the limits used for the z-axis;
you might want to set them with <code>MINMAX</code>. The surface drawn will
be truncated at <code>z1</code> and <code>z2</code> unless you are using an
axonometric projection (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN79">Viewpoint</a>).

</p>
<p>
There are some useful macros in the file <tt>`surfaces'</tt>; say
<code>load surfaces</code> to read them. If VERBOSE is one or more, a helpful
header will be printed when you load the file.

</p>
<hr><h2><a name="SYN73">Table</a></h2>
<pre>Syntax: TABLE [subtable] ['format'] file
        TABLE subtable \n
        READ TABLE { WORD [WORD ...] }
        READ TABLE 'format' { WORD [WORD ...] }
        READ TABLE 'byname' { WORD [WORD ...] }
        READ TABLE 'bycolumn' { WORD id [WORD id ...] }
        LIST TABLE
</pre>

<p>
<a name="IDX528"></a>

</p>
<p>
SM is able to read a wide range of table formats, using tricks similar
to those used for the IMAGE command. The variable <code>table_type</code> is used to
specify which you want (and may be set in your <tt>`.sm'</tt> file). Common values
are <code>bintable</code> and <code>ctable</code>.

</p>
<p>
TABLE <code>[...]</code> file is the equivalent of the DATA command, and sets
file <code>file</code> to be the source of data read with the READ TABLE command;
if the file can't be opened for read, you will be warned. If the
subtable argument is provided, it specifies which table in a TABLE
file is to be read; this is only currently supported for FITS tables
(<code>$table_type</code> is <code>bintable</code> or a type derived therefrom; for such
tables
you probably want to use a subtable of 1). The format, if provided,
specifies the types of the columns in the table; some tables may
provide this either in the table header (e.g. FITS binary tables) or
in the filecap file, as the <code>FM</code> quantity. Allowable format strings are
specified at the end of this file. This format applies to READ TABLE
commands for this table, unless specifically overridden.

</p>
<p>
   The range of lines specified by LINES is reset; the LINES command may
be used to select portions of TABLEs to read.

</p>
<p>
If you don't specify the filename, and if SM knows how to skip tables,
it will skip over  HDUs that it has already read, provided that the SM variable
<code>save_read_ptr</code> is set (which it is by default; see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN61">Read</a>).
<a name="IDX529"></a>
<a name="IDX530"></a>

</p>
<p>
   The READ TABLE command is used to read data from a table. If you
specify a format string and a list of names, a vector will be read from
each column specified in the format and assigned to the corresponding
vector (for example, <code>READ TABLE 'x16if2' { i x y }</code> will skip 16
bytes at the start of the row, then read an integer into <code>i</code>, and
two columns of floats into <code>x</code> and <code>y</code>).  Format strings are
described at the end of this section.

</p>
<p>
   If you specify the format as <code>'byname'</code>, the names of the
vectors will be taken to be the names of columns in the file, and the
corresponding columns will be read. If the column name, say <code>RDL</code>,
specifies an array, the vector will be filled from column <code>RDL[0]</code>;
as an alternative to this you can specify the name as (e.g.)
<code>RDL[2]</code> in which case vector <code>RDL2</code> will be created from
column <code>RDL[2]</code>.
You can also say <code>RDL[0-2]</code> to read vectors <code>RDL0</code>, <code>RDL1</code>,
and <code>RDL2.</code>
Byname access is only currently supported for
FITS binary tables (as a special case, you can specify <code>byname</code> as
the format in a filecap file).

</p>
<p>
The name that you give will be used as the name of the vector, but the
matching with the binary table is done without regard to case, so

</p><pre>        read table 'byname' { AlGoNqUiN }
</pre>

<p>
and

</p><pre>        read table 'byname' { Algonquin }
</pre>

<p>
will read the same column of the table into two different vectors,
<code>AlGoNqUiN</code> and <code>Algonquin</code>.

</p>
<p>
   For tables where <code>byname</code> formats are acceptable,
you can list the available column names with LIST TABLE.

</p>
<p>
   If you specify the format as 'bycolumn', the list is expected to be a
list of pairs of values (similar to the regular <code>READ { x 1 y 2 ... }</code>
command).
The first element of each pair is the name of a vector, the second may be
either a number or a column name (if supported). The number gives the
desired column with respect to the current format string. For example,

</p><pre>	TABLE 'd*' file
	READ TABLE 'bycolumn' { x 1 y 2 }
</pre>

<p>
will read <code>x</code> and <code>y</code> from the first two columns of the file, whereas

</p><pre>	TABLE 'x8d*' file
	READ TABLE 'bycolumn' { x 1 y 2 }
</pre>

<p>
will read <code>x</code> and <code>y</code> from the second and third columns of the file,
assuming that a double (the <code>d</code>) is eight bytes wide.

</p>
<p>
Instead of a number, you may be able to specify a column name, for
example

</p><pre>	READ TABLE 'bycolumn' { x_u rowc[0] x_g rowc[2] }
</pre>

<p>
but this depends on your chosen <code>$table_type</code> having support for
byname access.  In general you will not be able to mix name- and column-
orientated access (for example, we do not support column orientated
access to FITS binary tables unless you provide a format).

</p>
<p>
TABLE's formats are strings (i.e. they must be enclosed with ").
consisting of a set of types followed by optional repeat counts, for
example <code>'x12f5d*'</code> would specify a table, each of whose rows had 12
unwanted bytes, 5 floats, and the rest integers.  Format letters are:
</p><dl compact="compact">

<dt><code>a</code>
</dt><dd>
A 1-byte ascii string
</dd><dt><code>c</code>
</dt><dd>
A 1-byte char
</dd><dt><code>d</code>
</dt><dd>
An 8-byte double
</dd><dt><code>f</code>
</dt><dd>
A 4-byte float
</dd><dt><code>i</code>
</dt><dd>
A 4-byte int
</dd><dt><code>l</code>
</dt><dd>
A long int (may be 8 bytes on some machines)
</dd><dt><code>s</code>
</dt><dd>
A 2-byte int
</dd><dt><code>x</code>
</dt><dd>
1 byte to skip (a space may be used instead of an x)
</dd></dl>
<p>
and each may be followed by a repeat count (default: 1), or a *, meaning
to repeat as many times as fits into a row. In all cases except
<code>a</code>, the repeat count refers to how many columns there are (so
<code>d4</code> means 4 doubles); for a it refers to the length of the string
(so a4 is one 4-byte string). Note that the maximum length of an <code>a</code>
table is the length of an element of a string-valued vector (usually
40, but configurable by whoever built your copy of SM).
<a name="IDX531"></a>

</p>
<p>
    Header keywords may be available with the DEFINE name IMAGE command.

</p>
<hr><h2><a name="SYN74">Termtype</a></h2>
<pre>Syntax: TERMTYPE word [ INTEGER ]
</pre>

<p>
<a name="IDX532"></a>
<a name="IDX533"></a>
<a name="IDX534"></a>
<a name="IDX535"></a>

</p>
<p>
Set the terminal type to be <code>WORD</code>. This has nothing to do with
graphics, but is to do with the history and macro editors.  <code>WORD</code>
is case-sensitive.  With two exceptions, the properties of the terminal
will be read from the termcap file (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC59">Termcap -- A Terminal Database</a>). If <code>WORD</code>
is <code>dumb</code> SM tries to support editing on a (very) stupid terminal.
If this isn't what you want, for example you are running SM from within
emacs <code>TERMTYPE none</code> is equivalent to starting SM with the <code>-s</code>
flag and entirely disables input line editing (although commands
are still remembered so commands like <code>playback</code> and <code>hcopy</code>
will still work). You can turn editing back on by issuing a <code>TERMTYPE</code>
command with a valid terminal name.

</p>
<p>
For most purposes you don't even need to use
this command, as when SM starts up it reads the value of the
environment variable <code>TERM</code> (under Unix) or logical variable (under VMS)
it effectively issues a TERMTYPE command with its value as
argument. If you have a <code>term</code> entry in your <tt>`.sm'</tt> file
this takes precedence over any <code>TERM</code> variable. For example, a
<code>term</code> entry of <code>selanar -21</code> is equivalent to the command
<code>TERMTYPE selanar -21</code>.

</p>
<p>
You also should not have to use the optional <code>INTEGER</code> argument,
which specifies the number of lines that will appear at a time when
LISTing things, as this information
is usually derived from termcap. If you are using a window system,
then termcap may be wrong and this argument may be useful. 
Another exception occurs when you wish to
disable cursor motion to avoid having your graphs scrolling off the
screen. If this concerns you see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC59">Termcap -- A Terminal Database</a>.
<a name="IDX536"></a>
<a name="IDX537"></a>
<a name="IDX538"></a>

</p>
<hr><h2><a name="SYN75">Ticksize</a></h2>
<pre>Syntax: TICKSIZE SMALLX BIGX SMALLY BIGY
</pre>

<p>
<a name="IDX539"></a>
<a name="IDX540"></a>
<a name="IDX541"></a>
<a name="IDX542"></a>

</p>
<p>
Determine tick intervals for BOX. <code>SMALLX</code> refers to the interval
between small tick marks on the x axis, <code>BIGX</code> refers to the
interval between large ticks and so forth. If <code>BIG</code> is 0, the axis
routine will supply its own intervals according to the label limits.
If <code>SMALL</code> &lt; 0, the axis will have logarithmic tick spacing and
BOX assumes that the limits are logarithms, e.g. -2 and 2
refers to limits of 0.01 and 100.
If both <code>BIG</code> and <code>SMALL</code> are 0, you'll get SM's default
behaviour.

</p>
<p>
Negative values of <code>SMALL</code> and <code>BIG</code> are interpreted as
specifying the tickspacing in the decade 1:10, and are scaled to fit
the decades actually plotted. For instance, if you say

</p><pre>LIMITS 0 1 3 4
TICKSIZE -1 10 -0.1 1 BOX
</pre>

<p>
then the x-axis will have small ticks at 2, 3, ..., 9 and big ticks at
1 and 10, while the y axis will have small ticks at 1100, 1200, 1300, ...
and big ticks at 1000, 2000, 3000, ... (You might want to use NOTATION
to stop SM using exponential notation for the 10000 label). The most
usual TICKSIZE is probably <code>-1 10</code>, and this may be written <code>-1 0</code>
for backwards compatibility.

</p>
<p>
Occasionally you may want to use the same tickspacing in all decades
of your plot. To do this make <code>BIG</code> negative also in which case the
spacing used for the first decade plotted will be used for all decades.
(Note that this means that if the axis is plotted backwards then the
value from the largest decade will be used):

</p><pre>LIMITS 1.9 2.1 2.1 1.9
TICKSIZE -0.1 -1 -0.1 -1 BOX
</pre>

<p>
this is a good way to make an axis very crowded! 

</p>
<p>
If you really cannot use TICKSIZE to accomplish your needs, you can use
AXIS and provide vectors specifying the positions of the big and little
ticks, and even the axis labels.

</p>
<hr><h2><a name="SYN76">User</a></h2>
<pre>Syntax: USER ABORT [ string ]
        USER integer string
</pre>

<p>
<a name="IDX543"></a>

</p>
<p>
The first form, USER ABORT, is used to generate a syntax error, and
return to the prompt (with a traceback if you've requested one with the
<code>traceback</code> variable). The
command reported as the offender is <code>string</code> if provided, otherwise
<code>USER ABORT</code>.

</p>
<p>
If you want to catch these errors you can define a macro
<code>abort_handler</code> which will be called with the message as all of its
arguments instead of causing SM to return to the command prompt. For
example, I use

</p><pre>abort_handler 111	# catch USER ABORT
		        echo Caught user abort: $1
        		#
</pre>

<p>
Note that the argument extends to the end of the line -- this is important!
If <code>abort_handler</code> took a single argument, what would the command
<code>USER ABORT good bye world</code> do? First the handler would be called
as <code>abort_handler good bye world</code>. It'd pull off the first argument
<code>good</code> and print it and SM would continue to process <code>bye</code> as
a command. It's neither a command nor a macro, so the default
<code>macro_error_handler</code> executes
<code>USER ABORT bye is not a macro; aborting. Rest of line: world</code>. The
abort handler pulls of the <code>bye</code>, and tries to execute <code>is</code> ---
and we have an infinite recursion that is broken only by a <kbd>^C</kbd> or by
reaching the maximum depth to which SM will nest abort handlers.

</p>
<p>
<a name="IDX544"></a>
<a name="IDX545"></a>
<a name="IDX546"></a>
<a name="IDX547"></a>

</p>
<p>
The other, with an integer, calls a function called `userfn',
passing the <code>integer</code> and the
string as arguments, both are passed by address as if SM were
written in fortran (string is passed as a NUL terminated C string, though).

</p>
<p>
This function is provided to allow users without C compilers to make
additions to the main grammar, but whether it is really useful is a
different matter. Currently, if <code>integer</code> is non-zero then both
<code>integer</code> and <code>string</code> are printed unless <code>integer</code> is
<code>1</code>, in which case the command
<code>USER 1 r 1.23</code> is equivalent to <code>SET r=1.23</code> (only constants
are allowed).

</p>
<p>
If <code>string</code> is <code>dump</code> you'll get a macro stack trace, and if
it's <code>segv</code> you'll get a segmentation violation (on purpose). If
you really want some new functionality, send us mail.

</p>

<hr><h2><a name="SYN77">Verbose</a></h2>
<pre>Syntax: VERBOSE INTEGER
</pre>

<p>
<a name="IDX548"></a>
<a name="IDX549"></a>

</p>
<p>
Make SM produce output on what it is doing if <code>INTEGER</code> is &gt; 0.
Setting VERBOSE to 0 is a way of only listing `important' (non-system) macros,
and generally getting a little peace and quiet. It has the considerable
disadvantage that you can think that you are reading data from files, while
actually something is wrong. For this reason the default value is 1. A value
of 2 or more is basically useful for debugging. If you get some nondescript
syntax error and don't know where it is coming from, VERBOSE of 3 or 4 will
trace your programme, and should help find the problem. The original error
message will tell you which macro SM thinks it is processing
when the error occurred but it will be wrong if the macro
had been fully scanned when the error is detected. In this case it will
report a parent of the current macro. The reason for this behaviour is
related to why <code>RETURN</code> can return from the wrong place
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC31">The Command Interpreter</a>).
<a name="IDX550"></a>

</p>
<p>
If you want to know the current value of VERBOSE you can use the
SHOW command (actually a macro), or try

</p><pre>DEFINE verbose DELETE echo Verbose: $verbose
</pre>

<p>
which is (of course) what SHOW does anyway.
<a name="IDX551"></a>

</p>
<p>
If verbose is one or more SM will:

</p><ul>
<li>

Complain about things like division by zero, and logs of negative
numbers the first time that they occur in a given expression
</li><li>

Identify the X11 device that you switch to with <code>-dev</code> [+-]
</li><li>

Include all macros in macro listings, even those starting ##
</li><li>

Indicate line where arithmetical errors occur
</li><li>

List all non-printing key-bindings with LIST EDIT
</li><li>

Note more than 40 curve crossings in SHADE
</li><li>

Notify user when a <kbd>control-C</kbd> stopped the production of a hardcopy
</li><li>

Output a little extra about RESTORE and SAVE
</li><li>

Print lines beginning # while reading macro files
</li><li>

Provide some context with APROPOS on help files
</li><li>

Realise that a WINDOW number is out of range
</li><li>

Report which lines are read from a file using READ
</li><li>

Remind you that mixing LOCATION with WINDOW confuses people
</li><li>

Say something about format and size of IMAGE files
</li><li>

Suggest that you change LOCATION to make room for axis labels
</li><li>

Tell you what keys to use with the cursor
</li><li>

Warn about zero-length vectors
</li><li>

Whinge about missing fields with DEFINE var READ # #
</li><li>

Write a note when it finds out-of-range values while contouring IMAGE files
</li></ul>


<ul>
if <code>INTEGER</code> is two or greater, then also :
<li>

Announce when the do, foreach, input, or macro stacks are extended
</li><li>

Complain if an environment or SM variable is not defined
</li><li>

Echo lines in data files that start with #
</li><li>

Include `internal' variables in LIST DEFINE output
</li><li>

Inform you when it seeks to a line in a data file
</li><li>

List all key-bindings with LIST EDIT
</li><li>

Note attempts to `unput' off bottoms of buffers (this is related to the
implementation of macros and variables)
</li><li>

Point out attempts to delete local variables and vectors
</li><li>

Print the fraction of axes covered by the tick labels
</li><li>

Prompt for variables, even if they are on the macro buffer
</li><li>

Protest if you reference an undefined history number
</li><li>

Remark if a variable is referenced in a graphcap SY string, but not provided
</li><li>

Remind you that only a finite number of KEY commands can be processed
</li><li>

Repeat complaint about things like division by zero, and logs of
negative numbers every time that they occur
</li><li>

Report vectors of different lengths in PRINT
</li><li>

Say when a vector is used as a scalar.
</li><li>

Tell you when vectors are redefined.
</li><li>

Write a note when it finds out-of-range values while contouring IMAGE files.
</li></ul>

<p>
if <code>INTEGER</code> is three or greater, then also :

</p>

<ul>
<li>

List each macro name just prior to expansion.
</li></ul>

<p>
if <code>INTEGER</code> is four or greater, then also :

</p><ul>
<li>

Print each token as it is recognised along with its text. The number in
</li><li>

column 1 is the value of `noexpand', the level of nesting of {} loops.
</li><li>

Show expansions of variables.
</li></ul>

<p>
if <code>INTEGER</code> is five or greater, then also :

</p><ul>
<li>

Print the contents of DO, FOREACH, IF, and MACRO command lists.
</li><li>

Prompt for DEFINEing variables and the values of multi-word variables.
</li></ul>

<p>
If you set a negative verbosity, then if the parser was compiled
with DEBUG defined, you'll get a veritable torrent of debugging
information. Use another negative VERBOSE command to turn it off again.

</p>
<hr><h2><a name="SYN78">Version</a></h2>
<pre>Syntax: VERSION 
</pre>

<p>
<a name="IDX552"></a>

</p>
<p>
Return a string identifying the version of SM in use. If you have
any reason to communicate with SM's authors, we'll want to
know which version you are running. As a matter of fact, version is
a macro to print <code>$version</code>.

</p>
<hr><h2><a name="SYN79">Viewpoint</a></h2><p>
<a name="IDX553"></a>

</p><pre>Syntax: VIEWPOINT theta phi l
</pre>

<p>
Surfaces are drawn from a direction <code>(THETA,PHI)</code>, and projected onto
a surface passing through the origin. The projection is from a point
<code>L</code> away from the nearest corner of the cube containing the image. If
<code>L</code> is positive a perspective projection is used; if it is 0 the viewpoint
is taken to be infinitely far from the surface, and if it is negative
an axonometric projection is used (i.e. the surface is projected from
infinity onto the x-z plane).

</p>
<p>
   The coordinate system is such that the z-axis is <code>THETA=90</code>, the
x-axis is <code>(THETA,PHI) = (0,0)</code>, and the coordinate system is right
handed. Angles are taken to be in degrees, with theta lying in
[-90,90] and phi lies in [-180,180].  The nearest corner of the cube
containing the surface is projected onto the point (0,0).

</p>
<p>
There are some useful macros in the file <tt>`surfaces'</tt>; say
<code>load surfaces</code> to read them. If VERBOSE is one or more, a helpful
header will be printed when you load the file.

</p>
<hr><h2><a name="SYN80">Whatis</a></h2>
<pre>Syntax: Whatis ( expr )
</pre>

<p>
<a name="IDX554"></a>
<a name="IDX555"></a>

</p>
<p>
WHATIS(something) has a value depending on what something is:

</p><pre>a number:       0
not a number:           set 01 bit    (bit 0)
  a macro:              set 02 bit    (bit 1)
  a variable:           set 04 bit    (bit 2)
  a vector:             set 010 bit   (bit 3)
     a float vector:    set 040 bit   (bit 5)
     a string vector:   set 0100 bit  (bit 6)
     a long vector:     set 0200 bit  (bit 7)
  a keyword:            set 020 bit   (bit 4)
</pre>

<p>
So if "aa" is the name of a string vector, WHATIS(aa) has the octal
value 0111, or 73, 
whereas WHATIS(HELP) has the value 021, or 17, and WHATIS(1) is 0.
There is a macro in <tt>`utils'</tt> called <code>is_set</code> that tests if WHATIS
sets a particular bit, for example

</p><pre>	if(is_set(kkk,3)) { echo kkk is a vector }
</pre>

<p>
tests if bit 3 (vector) is set for "kkk" and prints its findings;
it's easier to say

</p><pre>	if(is_vector(kkk)) { echo kkk is a vector }
</pre>

<p>
which does the test for you.

</p>

<hr><h2><a name="SYN81">Window</a></h2>
<pre>Syntax: WINDOW nx ny x y
</pre>

<p>
<a name="IDX556"></a>
<a name="IDX557"></a>

</p>
<p>
   WINDOW makes the current plot location the window at (x,y), where there
are nx windows across and ny windows up and down.
WINDOW 1 1 1 1 resets the plot location to the entire plot area.
The size and placement of the windows is decided by the value of
EXPAND when the WINDOW commands are issued, so be sure that EXPAND has the
same value for every window in a set. (It's used to figure out the
axis labels, and spacings between boxes).
While plotting to a given window you can of course change EXPAND
to your heart's content.

</p>
<p>
If the number of windows in either the x or y direction is 
negative no space is left between the boxes in that direction
(try DO i=1,3 { WINDOW <code>1 -3 1 $i</code> BOX }). It's possible to
overload `window' and `box' to only label external axes in blocks of
touching boxes.

</p>
<p>
If either x or y is specified as, e.g. 2:4, the window is set to
cover the range 2-4 (i.e. the part of the screen covered by windows 2,
3, and 4). Note that this feature can be used to split the screen in
arbitrary ways, e.g.

</p><pre>    window -1 -6 1 1:5 box
    window -1 -6 1 6 box
</pre>

<p>
(or you could say <code>window -20 -20 15:19 15:19</code> as an alternative to a
LOCATION command).

</p>
<p>
If you don't want boxes that touch, but you don't like the gaps left
between boxes by the <code>WINDOW</code> command, you can now do something
about it legally, without lying to SM. After we calculate the widths
of the `gutters' between the windows that we think that you need, they
are multiplied by the values of the SM variables <code>x_gutter</code> and
<code>y_gutter</code>, so if you think that the spacing is too large in the
x direction you can say

</p><pre>define x_gutter 0.5
window 2 2 1 1 box
window 2 2 1 2 box
</pre>

<p>
to make things look better. Within a macro it can be convenient to
say <code>local define x_gutter 0.5</code>, as then the gutter value softly
and suddenly vanishes at the end of the macro.
<a name="IDX558"></a>
<a name="IDX559"></a>

</p>
<p>
It's confusing to change LOCATIONs while using WINDOWs; you probably want
to say WINDOW 1 1 1 1 first.

</p>

<hr><h2><a name="SYN82">While</a></h2>
<pre>Syntax: WHILE { expr } { commands }
</pre>

<p>
<a name="IDX560"></a>

</p>

<p>
   Repeat the <code>commands</code> while the <code>expr</code> is true.
You can break out of the loop early with the BREAK command (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN8">Break</a>).

</p>
<p>
There is further discussion in section See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC10">DO and FOREACH loops, WHILE loops, and IF statements</a>.

</p>
<p>
  For example,

</p><pre>define i 0
while{$i &lt; 10} {
        echo Hi $i
        define i ($i+1)
}
</pre>

<p>
is equivalent to either

</p><pre>do i=0,9 {
        echo Hi $i
}
</pre>

<p>
and

</p><pre>set i=0
while{i != 100} {
        if(i == 10) { break }
        echo Hi $(i)
        set i=i+1
}
</pre>

<p>
except in so much as which variables and vectors are defined at the end.

</p>
<hr><h2><a name="SYN83">Write</a></h2>
<pre>Syntax: WRITE STANDARD string
        WRITE [+] WORD string
        WRITE HISTORY WORD
</pre>

<p>
<a name="IDX561"></a>
<a name="IDX562"></a>

</p>
<p>
WRITE STANDARD writes a string, followed by a newline,
to the standard output. The string is taken to be the rest
of the line up to a carriage return (which may be written explicitly as \n).
The macro <code>echo</code> is usually used as an abbreviation for this command.
WRITE <code>WORD</code> is similar, except that the string is written to file
<code>WORD</code>.
If the filename is the same as the previous WRITE, or if you preface the
filename with a <kbd>+</kbd>, the string is
appended, otherwise the file is overwritten.
<a name="IDX563"></a>
<a name="IDX564"></a>
<a name="IDX565"></a>

</p>
<p>
WRITE HISTORY <code>WORD</code>, writes macro <code>WORD</code> onto
the end of the history list.

</p>
<p>
For MACRO WRITE, see under macros.

</p>
<hr><h2><a name="SYN84">Xlabel</a></h2>
<pre>Syntax: XLABEL str
</pre>

<p>
<a name="IDX566"></a>

</p>
<p>
Write the label <code>str</code> centered under the x axis made by BOX.
The string is taken to be the rest
of the line up to a carriage return (which may be written explicitly as \n).
If you think that the label is badly positioned you can say things like

</p><pre>XLABEL \raise-500My X-axis Label
</pre>

<p>
(providing that you use TeX-style fonts, of course)

</p>
<p>
If the label is too tall it may overlap with the numerical tickmark
labels. If VERBOSE is one or more, you'll be warned about this, and
a suggested change to the plot LOCATION will be suggested. This moves
the entire plot; it is your responsibility to reset it later if appropriate.

</p>
<p>
If ANGLE is non-zero, it will be used to determine the direction of
the label, otherwise it is parallel to the x axis.

</p>
<p>
See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC14">Drawing Labels and SM's TeX Emulation</a>, for a description of how
to enter a label with funny characters, sub- and super-scripts, and so forth.

</p>
<p>
If EXPAND is set to exactly 1, and ANGLE is exactly 0, then SM
will use hardware fonts, when available, in writing labels. This is faster,
but if you don't like it say "EXPAND 1.00001", or start the string with a
\0 which does nothing, but forces the software character set.

</p>
<hr><h2><a name="SYN85">Ylabel</a></h2>
<pre>Syntax: YLABEL str
</pre>

<p>
<a name="IDX567"></a>

</p>
<p>
Write the label <code>str</code> centered to the left of the yaxis made by BOX.
The string is taken to be the rest
of the line up to a carriage return (which may be written explicitly as \n).
If you think that the label is badly positioned you can say things like

</p><pre>YLABEL \raise500My Y-axis Label
</pre>

<p>
(providing that you use TeX-style fonts, of course)

</p>
<p>
If the label is too tall it may overlap with the numerical tickmark
labels. If VERBOSE is one or more, you'll be warned about this, and
a suggested change to the plot LOCATION will be suggested. This moves
the entire plot; it is your responsibility to reset it later if appropriate.

</p>
<p>
If ANGLE is non-zero, it will be used to determine the direction of
the label, otherwise it is parallel to the y axis (ANGLE 360 will
achieve horizontal labels).

</p>
<p>
See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC14">Drawing Labels and SM's TeX Emulation</a>, for a description of how
to enter a label with funny characters, sub- and super-scripts, and so forth.

</p>
<p>
If EXPAND is set to exactly 1, and ANGLE is exactly 0, then SM
will use hardware fonts, when available, in writing labels. This is faster,
but if you don't like it say "EXPAND 1.00001", or start the string with a
\0 which does nothing, but forces the software character set.

</p>


<h1><a name="SEC30" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC30">Appendices</a></h1>


<ul>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC31">Command Internals</a>: How The Command Interpreter Works
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">Graphcap</a>: How SM uses Graphcap to Plot to almost any Device
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC48">Calling SM</a>: Calling SM from Programmes
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC56">Grammar</a>: The SM Grammar
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC57">2-D Graphics</a>: Two-Dimensional Graphics
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC59">Termcap</a>: Termcap -- A Terminal Database
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC60">New Devices</a>: Adding New Devices, and Porting to New Machines
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC63">Libraries</a>: The System Macro Libraries
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC64">Mongo</a>: Tips for Mongo Users
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC68">Fonts</a>: SM's Fonts
</li></ul>



<h2><a name="SEC31" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC31">The Command Interpreter</a></h2>

<p>
The basis around which the command interpreter is written is a grammar
which is passed a set of tokens ( analogous to words in English )
which it parses, given a set of grammatical rules. As it recognises
each rule, it executes the code associated with that rule.
See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC56">The SM Grammar</a>.

</p>
<p>
An example would be:

</p><pre>        aa : BB CC
           {
              printf("Rule BB CC found\n");
           }
</pre>

<p>
which specifies that the rule aa consists of the token <code>BB</code> followed by
<code>CC</code>,
and that if rule <code>aa</code> is recognised the programme should print that fact
out. Conventionally, uppercase names are reserved for `terminal symbols',
and lowercase for `non-terminal symbols' where terminal symbols are
those that are passed to the parser ( analogous to words ), and
non-terminal symbols are tokens that the parser has constructed out of
terminal symbols (analogous to phrases). The right hand side of a rule
may contain a mixture and non-terminal symbols, and symbols may be
assigned a
value<a name="DOCF24" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT24">(24)</a>.
<a name="IDX568"></a>
<a name="IDX569"></a>

</p>


<h3><a name="SEC32" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC32">Token Generation</a></h3>
<p>
<a name="IDX570"></a>
SM generates tokens for the grammar roughly as follows:
When characters are typed at the keyboard, they are read by a routine
which runs in CBREAK mode (PASSALL for VMS), and
receives each character as it is typed. It is this routine that handles
command line editing, the history system, and
key bindings.<a name="DOCF25" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT25">(25)</a>
Following a carriage return, it passes the whole line to the
lexical analyser, which divides
the input stream into integers, floats, strings, or words. In addition it
recognises <code>${}^</code> as having special meanings (see below under
variables (<code>$</code>) and history (<code>^</code>)). As in
C, the escape sequence `\n' is replaced by a newline, which means that
commands which read to the end of the line may be fooled into thinking
that they have found it; see the examples at the end of the section.
A <code>{</code> sets the flag `noexpand', which
turns off the interpretation of all special symbols, and causes all
tokens to be returned as <code>WORD</code>. The matching <code>}</code> unsets this flag.
This mechanism is used in defining macros and various lists.
A word is anything which is not otherwise recognised, so for
example `hello_there.c' or `1.2e' would be considered words.
Symbols are separated by white space, taken to be spaces tabs or newlines,
or the characters <code>!</code>, <code>{</code>, <code>}</code>, <code>+</code>, <code>-</code>,
<code>*</code>, <code>/</code>, <code>=</code>, <code>?</code>, <code>!</code>, <code>,</code>, <code>&lt;</code>,
<code>&gt;</code>,
<code>(</code>, or <code>)</code>. This behaviour can be modified by enclosing a string in
double quotes, when no characters (except <code>^</code>) are special, and
tokens are delimited only by the end of the line, or some character
after the closing quote.
Enclosing in quotes is rather
similar to enclosing in {}, except that quotes have no grammatical
significance. A string in double quotes is always treated as a word,
but the quotes must not have been discarded by the time that the
lexical analysis occurs.
<a name="IDX571"></a>
<a name="IDX572"></a>
For example, <code>"2.80"</code> is a float, as SM will have digested
the <code>"</code> before looking at the string. You can fool it with <code>"2.80 "</code>.
A string begins with a <code>'</code> and continues to the next <code>'</code>: they
are used in certain contexts where SM needs to know if a
<code>WORD</code> or <code>STRING</code> is involved, for example in a <code>PRINT</code>
command. It's worth noting that the <code>'...'</code> are stripped when the
string is recognised -- if you need to preserve them make sure that
<code>noexpand</code> is set (e.g. <code>SET s={ 'a' 'b' 'c'} </code>).
<a name="IDX573"></a>

</p>
<p>
The output from this programme is passed to a second stage of lexical
analysis. This passes integers and floats through unaltered, while
words are passed through a filter to see if they are external
tokens<a name="DOCF26" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT26">(26)</a>
from the grammar (such as <code>CONNECT</code>).
If a word is recognised as being a token then that token is returned,
otherwise the token <code>WORD</code> is passed, and the text of the word is stored.
Tokens may be written in
either lower or upper case, but for clarity they are written in upper
case in this document. The overloading of lowercase tokens is achieved
at this stage by simply refusing to recognise them as keywords.

</p>
<p>
The input stream is now fully analysed into tokens and is passed to the
parser, which is written in YACC.
If the sequence of tokens seen corresponds to a grammar rule,
the parser executes the appropriate section
of code, which is written in C. If the parser doesn't understand, it
tells you that you have a syntax error and prints the last
logical line that it was processing, with the error underlined. If you can't
figure out which command it really failed on, try setting the <code>VERBOSE</code>
flag to be 4 or more. This produces a voluminous output, which will stop
suddenly when the error re-occurs.
One simple rule in the grammar is that a <code>WORD</code> should be
treated as a possible macro.

</p>


<h3><a name="SEC33" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC33">Peculiarities of the Grammar</a></h3>
<p>
<a name="IDX574"></a>
If the command interpreter is faced with a pair of grammar rules such as

</p><pre>        AA BB CC
and
        AA BB
</pre>

<p>
it may not know whether to treat the tokens <code>AA BB</code> as the first part of
<code>AA BB CC</code> or as the complete command <code>AA BB</code> followed by the token
<code>CC</code> beginning the next command
without examining the next token. This ambiguity only arises if a command can
begin <code>CC</code>, and may
be dealt with by defining the second rule as

</p><pre>        AA BB \n
</pre>

<p>
This should be borne in mind whenever
SM complains about a syntax error in an apparently valid command (such
as <code>LIST MACRO HELP</code>, intended as first <code>LIST MACRO</code> and then the valid
command <code>HELP</code>). The presence of a required carriage return also sometimes
requires that macros be spread over a number of lines rather than as one
long list of commands, although a carriage return may always be written as
`\n', which makes SM think that it has found a carriage
return. There is a also requirement that an <code>ELSE</code>less <code>IF</code> statement
should end with a newline; this is produced by a subtlety of the way
that <code>IF</code>'s are processed and is discussed under <code>IF</code>.

</p>
<p>
SM places a restriction upon commands such as <code>RELOCATE</code> which
expect more than one argument, which is that the arguments must be
numbers rather than (scalar) expressions. This is required by the
unary minus, as if the grammar sees <code>expr1 - expr2</code> it cannot know
whether this is the two expressions <code>expr1</code> and <code>-expr2</code>, or the single
expression <code>expr1-expr2</code>. Unless the grammar is changed, for instance by
using commas to separate arguments, this restriction cannot be lifted;
it can, however, frequently be circumvented using macros such as <code>rel</code>
discussed under `Useful Macros'. As an alternative, in almost all
cases the expression can be enclosed in parentheses, for example
<code>connect (lg(x)) (-lg(rho))</code>.

</p>


<h3><a name="SEC34" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC34">The Macro Processor</a></h3>
<p>
<a name="IDX575"></a>
Executing a macro consists of substituting the text of the macro for
its name. In order to understand how SM does this you have to
know a bit more about how it processes input characters. We said above
that it `passed the whole line' to the lexical analyser. What it
actually does is to pass a pointer to the line, and starts reading
from the beginning of the line. Now if you execute a macro, all that
is done is that we now pass a pointer to the text of the macro, and
start reading from it instead. The old pointer is pushed onto the top
of a stack. When SM comes to the `\0' at the end of the macro
text, the stack is popped and input continues as if the macro had
never been seen. When we come to the end of the `whole line' pushed at
the top of this paragraph, <em>it</em> is popped, and SM gives
you a prompt for more input.
Of course, if a macro had been seen while the first
macro was being executed, the first one would get pushed onto the
stack, and attention transferred to the the new one. If a macro has
any arguments, their definitions are pushed onto an argument stack
which is popped at the proper times. To jump ahead a little, variables
are implemented in a very similar way, being pushed onto the stack, as
are <code>DO</code> and <code>FOREACH</code> loops, and perhaps more surprisingly
<code>IF</code> statements.

</p>
<p>
The strange behaviour of <code>RETURN</code> at the end of macros comes about
because when the input routine is reading the <code>RETURN</code> it has to
read one character beyond it, so as to know that it isn't dealing with,
say, <code>RETURN_OF_THE_NATIVE</code>. But in looking for the next character
it has to pop the macro off the stack, so when the <code>RETURN</code> is
acted upon we have <em>already</em> returned from where we wanted to
return from, and we now <code>RETURN</code> from the wrong place. In a
similar way, an <code>IF</code> at the end of a macro will cause the parser
to look for an <code>ELSE</code>, thereby popping the macro stack if there
isn't one. If the <code>IF</code> test was true, and contained references to
macro arguments, there will be a problem as either there will be no
macros defined, or the arguments to the previous macro on the stack
will be supplied.

</p>
<p>
<em>This behaviour is changed in SM2.4.3 and above; an automatic
space or newline is added at the end of every macro, avoiding this problem.</em>

</p>
<p>
Macro definitions are currently stored in the form of a weight-balanced
tree (actually
a
tree). This means that the access time for a given macro
only grows as the logarithm of the total number defined. In the future it may
be possible to choose the weights depending on the access probability for
a given macro, but this is not currently possible. Definitions of variables
and vectors are stored in the same way.

</p>


<h3><a name="SEC35" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC35">The DO, FOREACH, and IF commands</a></h3>
<p>
<a name="IDX576"></a>
It seems worth discussing the implementation of these commands.
Both loops consist of a definition of a variable, together with instructions
about what to do with it, followed by a list of commands within a set
of {}, while <code>IF</code> just has the command list.
It is not possible for the main grammar to execute commands or
macros, as the YACC implementation is
non-reentrant, so the best that it can do is to push the commands onto
the input stack as a sort of temporary macro, after defining the
initial value of the loop parameter. When the `\0' at the end of the
loop appears, instead of popping the macro stack we simply define the
loop parameter to have its next value, and jump back to the
beginning. This means that you can't change the value of a loop parameter,
as it'll be reset anyway, but you can use it as a sort of local variable.

</p>
<p>
<code>IF</code> statements are similar, in that we read the entire list
before executing it. Once more, a temporary buffer is pushed onto the
stack, with instructions to delete it after use. The reason that a newline
is required after an <code>ELSE</code>less <code>IF</code> is that the grammar will
have already read the next token to see if it was <code>ELSE</code>. If it
wasn't, then it will seem to have been typed before the body of the
<code>IF</code>. For example, <code>IF( test ) { echo Hello } PROMPT :</code> will be
parsed as <code>IF( test ) { PROMPT echo Hello } :</code> if test is true,
but correctly as <code>IF( test ) { echo Hello } PROMPT : </code> if it is false.
Because an extra \n does no harm, we demand it.

</p>


<h3><a name="SEC36" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC36">Examples of How SM Parses Input</a></h3>
<p>
<a name="IDX577"></a>
If you want to watch SM thinking about these examples, the command
<code>VERBOSE 4</code> will make it print out in detail each token as it reads it,
and each macro or variable as it expands it. To turn this off, use
<code>VERBOSE 0</code> or <code>VERBOSE 1</code>.
To really see the parser at work, try a negative value of verbosity.
This will report every step that the parser takes, providing that it
was compiled with DEBUG defined. A second negative value will turn the
information off again.
<a name="IDX578"></a>

</p>
<dl compact="compact">

<dt><code>PROMPT @</code>
</dt><dd>
<code>PROMPT</code> is an external token, so <code>PROMPT</code> is passed to the
grammar which recognises the rule
<code>PROMPT WORD</code>, and sets the prompt to be `@'. When it has finished,
control is passed back to the input routine.
</dd><dt><code>MACRO p { PROMPT }</code>
</dt><dd>
This is a simple macro defining <code>p</code> to be <code>PROMPT</code>
</dd><dt><code>p @</code>
</dt><dd>
The lex analyser doesn't recognise <code>p</code> as a keyword, so it returns
<code>WORD</code>
and as the grammar has no other interpretation of a <code>WORD</code> in this
context,
it passes <code>p</code> to the macro interpreter, which
replaces it by <code>PROMPT</code> (i.e.  pushes <code>PROMPT</code> onto the input stack).
SM now thinks that you have just typed
<code>PROMPT @</code>, and behaves as described in the first example.
</dd><dt><code>MACRO pp 1 { PROMPT $1 }</code>
</dt><dd>
The macro <code>pp</code> is declared to have one argument, which is referred to as
$1. After <code>pp</code> is invoked it reads the next (whitespace delimited) word
from the input stream, and replaces <code>$1</code> by that word.
</dd><dt><code>pp @</code>
</dt><dd>
Just like the first example, the prompt is set to <code>@</code>.
</dd><dt><code>pp</code>
</dt><dd>
You are prompted for the missing argument to <code>PROMPT</code>.
</dd><dt><code>PRMPT</code>
</dt><dd>
As <code>PRMPT</code> isn't an external token, it is a <code>WORD</code>, so SM
tries to execute
it as a macro and complains if it isn't defined.
</dd><dt><code>DEFINE Hi Hello</code>
</dt><dd>
The variable <code>Hi</code> is defined to have the value <code>Hello</code>.
</dd><dt><code>WRITE STANDARD $Hi Gentle User</code>
</dt><dd>
When it has read <code>$Hi</code> SM pushes the value of the variable <code>Hi</code>
onto the stack and then reads it, popping it off again when it has finished.
The <code>WRITE STANDARD</code> command writes <code>Hello Gentle Reader</code> (i.e.
up to the end of the line) to the terminal.
</dd><dt><code>WRITE STANDARD $Hi Gentle User \n pp "SM&gt;"</code>
</dt><dd>
As above, the rest of the line is written to the terminal (up to the
carriage return `\n'), then the prompt is changed yet again.
</dd></dl>



<h2><a name="SEC37" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC37">The Stdgraph Graphics Kernel</a></h2>

<p>
SM can use a single set of subroutine calls to plot on almost any
terminal, and on many printers. The routines that it uses, called stdgraph,
were originally
taken from the IRAF GIO package written at
Kitt Peak by Doug Tody<a name="DOCF27" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT27">(27)</a>
and converted to C and partially re-written to be integrated into SM.
Despite our extensive rewrite, these routines should probably still be
considered to be in the public domain.

</p>

<ul>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC38">Graphcap File</a>: The Graphcap File
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC39">Binary Encoder</a>: Stdgraph's Binary Encoder
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC40">Graphcap Examples</a>: Examples of Graphcap Entries
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC41">Graphcap Cursors</a>: Using Cursors with Graphcap
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC42">Graphcap Colours</a>: Using Colours with Graphcap
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC43">Modified Entry</a>: How to Modify a Graphcap Entry
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC44">New Entry</a>: Writing a New Graphcap Entry
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC45">Raster</a>: Support for Raster Devices
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC46">Compiling</a>: Compiling Graphcap
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC47">Graphcap Index</a>: Index to Graphcap Capabilities
</li></ul>



<h2><a name="SEC38" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC38">The Graphcap File</a></h2>

<p>
Stdgraph uses a file called a graphcap file to specify the properties of
terminals, in a way that is similar to the termcap facility of Unix. You
don't have to know anything about termcap to read this section; you don't
have to read this section unless you want to change the graphcap file
to add a new device, to fix a bug, or to change the way that SM treats
your plotting device. The name of the graphcap file is given by the variable
<code>graphcap</code> in the environment file.

</p>
<p>
A list of files to be searched
in order may be given instead of a single graphcap file (up to a
current maximum of three). The usual way to accomplish this is to
add an entry

</p><pre>+graphcap          /u/rhl/sm/graphcap
</pre>

<p>
above any other graphcap entries in your <tt>`.sm'</tt> file, which instructs
SM to put <tt>`/u/rhl/sm/graphcap'</tt> first in the list of files, followed by
any others that might appear, either in your file or in some other that
the system provides (ask the person who installed SM where the default
<tt>`.sm'</tt> file is; usually something like <tt>`/usr/local/lib/.sm'</tt>).
<a name="IDX579"></a>
<a name="IDX580"></a>

</p>

<p>
A graphcap file is a way of describing a terminal in a concise way, so a 
programme can discover which idiosyncrasies a terminal has without having
to be recompiled. A graphcap file consists of a number of entries, one for
each device supported, and to add a new terminal all that one has to do is
to add another entry.
It is also possible to define variables in graphcap files, which are used
in <code>SY</code> entries.
You can compile selected entries in the graphcap file, so as to 
improve access time for popular terminals. If this has been done, changing
the graphcap file for one of these terminals will have no effect until
it is recompiled, see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC46">Compiling Graphcap</a> for details.

</p>
<p>
For a list of all the capabilities that SM uses see the index to
graphcap at the end of this appendix.

</p>
<p>
Some devices are not supported through stdgraph (graphics drawn to a
SunView window would be an example), but they still appear in graphcap
with a special entry (<code>DV</code>) giving the name of the appropriate hard-coded
device driver.

</p>
<p>
Each entry consists of a name for the device, followed by a list of 
aliases, followed by a list of fields, separated by colons. A \ may be used
to continue an entry onto the next line, and lines starting with a
<code>#</code> are comments (comment lines are permitted both between and
within entries).
As a rather complex example,
the graphcap entry for a Tektronix 4012 reads:

</p><pre>tek4010|tek4012|TEK4010|TEK4012|Tektronix 4010/2:\
        :ch#.0294:cw#.0125:co#80:li#35:xr#1024:yr#800:\
        :MC=^M:CL=^[^L:CN#6:GD=^X:GE=^[1^]:\
        :ML=^[(1$0)`($1)a($2)c($3)d($4)b($$:lt=01234:\
        :OW=^]^_:RC=^[^Z:SC=(,!3, &amp; *, &amp;+!1, &amp; *, &amp;+!2:\
        :TB=^]%t^_:VS=^]:\
        :xr#1024:XY=%t:yr#780:
</pre>

<p>
This is one of the longest entries in the graphcap file - all of the terminals
which are Tektronix emulators explicitly include this entry, so they only
need provide the capabilities that are different from the Tektronix. As an
example, the entry for a Pericom reads

</p><pre>pericom|Pericom:\
        :GE=^]:TB=^](2#7-!2)%t^_:\
        :tc=tek4012:
</pre>

<p>
The <code>|</code> separate the aliases, and the final field <code>tc=tek4012</code> tells
stdgraph to take all other fields from the entry for <code>tek4012</code>, given
above. If you have specified a list of graphcap files, each will be
searched in order for each <code>:tc=</code> continuation. If you don't want the
search to begin again use <code>TC</code>, e.g.

</p><pre>graphon|Graphon which claims to support lw:\
        :LW=:TC=graphon:
</pre>

<p>
if you had used <code>:tc=graphon:</code> this would have been recursive and
illegal, but as <code>TC</code> doesn't restart the search it merely has the
effect of adding (or in general, replacing) an capability in a
preexisting graphcap entry.
<a name="IDX581"></a>

</p>
<p>
Control characters are entered as ^A, ^B, and so on (those
are two characters, `^' and `A'). `Escape' may
be represented as ^[, \E, or in octal as \033. Because the
normal way of handling strings in C treats <code>\0</code> as meaning
`end of string' you can't simply put a <code>\000</code> into a graphcap
entry, instead write <code>\377</code> and SM'll interpret it as <code>\0</code>. (If
you need a real <code>\377</code> enter <code>\377\377</code>).
<a name="IDX582"></a>
<a name="IDX583"></a>
If a delay of so many
milliseconds is required before the transmission of a string, it is given
first (followed by a <code>*</code> if it is to be applied to each line
affected). This leads to problems with graphcap entries that start with
numbers, you must precede them with a space or (if the string is run through
the encoder) insert a no-op e.g. <code>:CP=()1000:</code>.
Numerical values are preceded by a #, so <code>:co#80:</code> means that co
(the number of columns
displayed) is 80, while <code>:MC=^M:</code> means that MC (the cursor
delimiter) consists of the character ^M. This could
just as well have been written <code>:MC=\010:</code>. If the first character of
a capability is `@', it specifies that that capability is not present for that
terminal (e.g. <code>:lt@=1234:</code> specifies that <code>lt</code> is not defined).
A field may simply not be provided if it is irrelevant, although in this
case it may be supplied by a <code>tc</code> or <code>TC</code> continuation.
<a name="IDX584"></a>
A common set of graphcap entries to `comment out' are <code>TB</code> and
<code>TE</code>, which deal with hardware character sets. If you don't want
your plotter to use it's internal fonts simply insert `@' before the `='.
By inserting their private file before the system one in the list of
graphcap files, users can tailor the entries to their liking.

</p>
<p>
We use a subset of the graphcap capabilities defined by the IRAF group, and the
distinction between upper and lower case parameters comes from them. In a few
cases our usage is different from theirs, in these cases we have
specified our own capabilities
(<code>CD</code>
<code>MC</code>,
<code>DD</code>
<code>SY</code>,
<code>LT</code>
<code>ML</code>, and
<code>TS</code>
<code>TB</code>.
We have also added the <code>lt</code>, <code>BP</code>, <code>BR</code>, <code>CO</code>, <code>CS</code>,
<code>CT</code>, <code>DC</code>, <code>DT</code>, <code>DV</code>, <code>EP</code>, <code>ER</code>, and <code>TC</code>.
capabilities.).  
First the lower case, which specify mostly dimensions:
</p><dl compact="compact">

<dt><code>ch</code>
</dt><dd>
Height of a character, relative to the screen height being 1.0.
</dd><dt><code>co</code>
</dt><dd>
Number of columns displayable, with characters of width cw.
</dd><dt><code>cw</code>
</dt><dd>
Width of a character, relative to the screen width being 1.0.
</dd><dt><code>li</code>
</dt><dd>
Number of lines displayable, with characters of height ch.
</dd><dt><code>lt</code>
</dt><dd>
Which linetypes are supported in hardware.
</dd><dt><code>pc</code>
</dt><dd>
Pad character for delays (use NUL if not supplied).
</dd><dt><code>xr</code>
</dt><dd>
x dimension of plotting device. This may be specified as an argument from
the <code>DEVICE</code> line. E.g. for <code>DEVICE example 1200 1400</code>,
<code>:xr=$1:yr=$2:</code> is equivalent to <code>:xr#1200:yr#1400:</code>
</dd><dt><code>yr</code>
</dt><dd>
y dimension of plotting device. See the previous entry for an example.
</dd></dl>
<p>
Of these, <code>co</code> and <code>li</code> are not currently used. 
<a name="IDX585"></a>
<a name="IDX586"></a>
<a name="IDX587"></a>
<a name="IDX588"></a>
<a name="IDX589"></a>
<a name="IDX590"></a>
<a name="IDX591"></a>
<a name="IDX592"></a>

</p>
<p>
The capitalised capabilities mostly tell
the stdgraph routines how to plot lines, clear the screen and so forth. Some
of these are no more than character strings to send to the terminal,
(e.g. <code>CL</code> to clear a screen), but
some use the graphcap entries to programme a sort of RPN calculator, which 
computes the bit-patterns that the terminals demand. This calculator is usually
referred to as the `encoder'.
We'll first list all the capabilities in a reasonably ordered way,
then describe the encoder and what it can do,
and then go through a number of examples.

</p>
<p>
First the fields which are simple character strings to be written to the
terminal.
The second
column is an attempt to explain the etymology of the two character name.
</p><dl compact="compact">

<dt><code>CL (CLear)</code>
</dt><dd>
Clear the screen, possibly also the text screen.
</dd><dt><code>CW (Close Workstation)</code>
</dt><dd>
Close terminal, expect no more graphics.
</dd><dt><code>DS (Draw Start)</code>
</dt><dd>
Prepare the terminal to draw a line.
</dd><dt><code>DE (Draw End)</code>
</dt><dd>
Finish a line.
</dd><dt><code>FD (Fill Draw)</code>
</dt><dd>
Draw a side of a filled polygon.
</dd><dt><code>FE (Fill End)</code>
</dt><dd>
Finish drawing a filled region.
</dd><dt><code>FS (Fill Start)</code>
</dt><dd>
Start drawing a filled region.
</dd><dt><code>GD (Graphics Disable)</code>
</dt><dd>
Return the terminal to a character mode.
</dd><dt><code>GE (Graphics Enable)</code>
</dt><dd>
Set the terminal to graphics mode.
</dd><dt><code>IF (Initialisation File)</code>
</dt><dd>
Used to supplement OW if sequence is too long.
</dd><dt><code>LR (Load Registers)</code>
</dt><dd>
(Used by the RPN encoder, see `binary encoding').
</dd><dt><code>ME (Mark End)</code>
</dt><dd>
Finish a series of dots movements.
</dd><dt><code>MS (Mark Start)</code>
</dt><dd>
Start a sequence of dots movements.
</dd><dt><code>OW (Open Workstation)</code>
</dt><dd>
Prepare a terminal to produce plots.
</dd><dt><code>OX (Open workstation)</code>
</dt><dd>
(a continuation of OW).
</dd><dt><code>OY (Open workstation)</code>
</dt><dd>
(a continuation of OX).
</dd><dt><code>OZ (Open workstation)</code>
</dt><dd>
(a continuation of OY).
</dd><dt><code>PG (PaGe)</code>
</dt><dd>
Start a new page.
</dd><dt><code>VE (? End)</code>
</dt><dd>
Finish a series of pen (beam) movements.
</dd><dt><code>VS (? Start)</code>
</dt><dd>
Start a sequence of pen movements.
</dd></dl>
<p>
<a name="IDX593"></a>
<a name="IDX594"></a>
<a name="IDX595"></a>
<a name="IDX596"></a>
<a name="IDX597"></a>
<a name="IDX598"></a>
<a name="IDX599"></a>
<a name="IDX600"></a>
<a name="IDX601"></a>
<a name="IDX602"></a>
<a name="IDX603"></a>
<a name="IDX604"></a>
<a name="IDX605"></a>
<a name="IDX606"></a>
<a name="IDX607"></a>
<a name="IDX608"></a>
<a name="IDX609"></a>
<a name="IDX610"></a>
<a name="IDX611"></a>
For hardcopy devices <code>PG</code> should start a new page.
The <code>GD</code> and <code>GE</code> are used by terminals which spend some of their
time being graphics terminals, and some being regular text terminals.
The various "... Start" and "... End" capabilities assume that the
points in question are specified by the <code>XY</code> entry (except for
<code>FS</code>/<code>FE</code> where <code>FD</code> is used instead). Typically, the
`start' is used to put the device into (e.g.) line-drawing mode, then
the line is drawn with a sequence of <code>XY</code>'s, then it is taken out
of (e.g.) line mode with the `end'. The support for filling areas
assumes that a region is specified by drawing a line around it; if
this isn't so, you'll have to omit area fill from graphcap, and rely
on SM emulating it for you. An example would be a Graphon
GO-250, which has an area fill where you fill rectangular areas by
specifying opposing corners; this is not acceptable to SM.

</p>
<p>
Some operations require an argument, for instance setting the hardware line
type, specifying which cursor to read<a name="DOCF28" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT28">(28)</a>, or specifying
coordinates. In the following properties, the expected parameters are listed
after the field names, the first to go into register 1, the second into
register 2, and so on. If you haven't skipped forward to the section on the
encoder this will seem obscure, but all will become clearer.
</p><dl compact="compact">

<dt><code>CO(r,g,b) (COlour)</code>
</dt><dd>
Set next colour to (r,g,b).
</dd><dt><code>CS(n) (Colour Start)</code>
</dt><dd>
Start defining n colours.
</dd><dt><code>CT(i) (Colour Type)</code>
</dt><dd>
Set a colour.
</dd><dt><code>DC (Default Colour)</code>
</dt><dd>
Set default colour.
</dd><dt><code>LW(f) (Line Weight)</code>
</dt><dd>
Set the lineweight to f.
</dd><dt><code>MC(i,x,y) (sM Cursor)</code>
</dt><dd>
Decode a cursor response.
</dd><dt><code>ML(i) (sM Line)</code>
</dt><dd>
Set the linetype to i.
</dd><dt><code>RC(c) (Read Cursor)</code>
</dt><dd>
Read the cursor. `c' is for compatibility.
</dd><dt><code>SC (Scan Cursor)</code>
</dt><dd>
Decode the cursor reply following a RC.
</dd><dt><code>TB(x,y) (Text Begin)</code>
</dt><dd>
Start writing text at (x,y).
</dd><dt><code>TE (Text End)</code>
</dt><dd>
Stop interpreting characters as text.
</dd><dt><code>XY(x,y) (X Y)</code>
</dt><dd>
Encode the coordinate pair (x,y).
</dd></dl>
<p>
<a name="IDX612"></a>
<a name="IDX613"></a>
<a name="IDX614"></a>
<a name="IDX615"></a>
<a name="IDX616"></a>
<a name="IDX617"></a>
<a name="IDX618"></a>
<a name="IDX619"></a>
<a name="IDX620"></a>
<a name="IDX621"></a>
<a name="IDX622"></a>
<a name="IDX623"></a>
Some of the above comments are a little cryptic, but we return to the 
various graphcap parameters that take arguments as examples after describing
the encoder. Note that it isn't sufficient to change the 
<code>ML</code> entry -- for a linetype to be supported in hardware it must also be 
included in the <code>lt</code> list, e.g. <code>lt=01234</code>. Similarly, for hardware
fonts you must include <code>ch</code> and <code>cw</code>, and <code>TB</code> must be present
even if it does nothing. Note that <code>LW</code> is passed a floating point number,
and that the special case 0 is special, meaning choose the most efficient line
thickness for the device.

</p>
<p>
The following capabilities have to do with rasterising and are
discussed in their own section near the bottom of this appendix:
</p><dl compact="compact">

<dt><code>BP (Bit Pattern)</code>
</dt><dd>
Bit patterns for rastered data.
</dd><dt><code>BR(i) (Begin Row)</code>
</dt><dd>
Begin row of rastered data.
</dd><dt><code>EP (Empty Pattern)</code>
</dt><dd>
Bit pattern for rastered empty pixel.
</dd><dt><code>ER (End Row)</code>
</dt><dd>
End of a row in rastered data.
</dd><dt><code>ll (lINE lENGTH)</code>
</dt><dd>
Length of a row for <code>DR=hex</code>.
</dd><dt><code>MR (Many Rows)</code>
</dt><dd>
Number of rows output at once.
</dd><dt><code>nb (nUM bYTES)</code>
</dt><dd>
Number of bytes to process at once for MR.
</dd><dt><code>RA (RAster)</code>
</dt><dd>
(RA is no longer supported -- see DV).
</dd><dt><code>RD (Raster Device)</code>
</dt><dd>
Type of device if not generic.
</dd></dl>
<p>
<a name="IDX624"></a>
<a name="IDX625"></a>
<a name="IDX626"></a>
<a name="IDX627"></a>
<a name="IDX628"></a>
<a name="IDX629"></a>
<a name="IDX630"></a>
<a name="IDX631"></a>
<a name="IDX632"></a>
Raster devices also make use of <code>xr</code>, <code>yr</code>, <code>CW</code>, <code>OW</code>,
<code>OX</code>, <code>OY</code>, <code>OZ</code>,
<code>OF</code>, and <code>SY</code> which are also used by stdgraph itself.

</p>
<p>
Finally there are some capabilities that are designed for driving
hardcopy devices and devices that may not use stdgraph at all:
</p><dl compact="compact">

<dt><code>DT (Device Type)</code>
</dt><dd>
Type of device in use.
</dd><dt><code>DV (DriVer)</code>
</dt><dd>
Name of hard-coded driver.
</dd><dt><code>OF (Out File)</code>
</dt><dd>
The file to direct output to.
</dd><dt><code>RT (Record Terminator)</code>
</dt><dd>
(RT is no longer supported).
</dd><dt><code>SY (SYstem)</code>
</dt><dd>
The action to be taken upon closing the OF file.
</dd></dl>
<p>
<a name="IDX633"></a>
<a name="IDX634"></a>
<a name="IDX635"></a>
<a name="IDX636"></a>
<a name="IDX637"></a>
The <code>OF</code> file may be specified with the last characters being `XXXXXX', in
this case the Xs are replaced by a random characters, to make a unique
filename. If the variable <code>temp_dir</code> is defined in the environment
file, then <code>OF</code> is created in that directory, otherwise it is put in the 
current directory. The <code>DT</code> string, if present, specifies the type
of device in use. Currently the values are only used under VMS, where
they are used to decide how to open files. The recognised values are
"qms" and "imagen". In general DT should be omitted, as it
requires programming support, but it can help stdgraph to deal with
hostile operating systems. For a discussion of the <code>DV</code>
entry, See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC60">New Devices and New Machines</a>.

</p>
<p>
The <code>SY</code> string is passed to the operating system after graphcap
variables have been expanded (they are similar to macros in Unix's
<code>make</code>). A variable is defined with a line like:

</p><pre>	name = value
</pre>

<p>
where <code>name</code> must start in the first column. Any white space surrounding
the equals sign is removed, as are any trailing blanks. If <code>value</code> starts
with a $ it is taken to be a regular SM variable.
Variables may be defined in any of the graphcap files in the search path,
and if a name appears more than once the first value
found will be used (if you change graphcap without leaving SM the variables
are re-read). There is no guarantee that all the graphcap files in the
path will be read but this is unlikely to be a problem.
The major use for graphcap variables is probably for encoding
<code>rasterise</code>'s full name:

</p><pre>BIN = /usr/local/bin
device|some device:\
        :DV=raster:OF=tst_XXXXXX:\
           ...
        :SY=${BIN}/rasterise -r $0 $F $1:
</pre>

<p>
Variables are written as <code>${name}</code> <em>not</em> <code>$name</code>, which
means that they will not (usually) conflict with the operating system's
uses for dollar signs. The graphcap variable <code>F</code> is special, as it
always expands to the filename specified as <code>OF</code>. As a 
concession to history it may be written as <code>$F</code> instead of <code>${F}</code>.
Also special are <code>$"prompt"</code>, which is replaced by a string read from the
keyboard (you are prompted with <code>prompt</code>),
and <code>$n</code> which is replaced by the n'th argument to the <code>DEVICE</code>
command.
For example, if the DEVICE command were <code>DEVICE qms lca0 Hello</code>
(or <code>DEVICE 1 qms lca0 Hello</code>), then
the device name <code>qms</code> would be $0, <code>lca0</code> would be $1 and
<code>Hello</code> $2.
If a `$' is found under other circumstances it is simply treated as a dollar
sign, but if you wish you can escape it with a \ (but remember that
the \ must itself be escaped so to explicitly
escape a dollar in an <code>SY</code> string you must type <code>\\$</code>).
This means that (under Unix)
you can access environment variables from <code>SY</code> strings, e.g.
<code>:SY=mv ${F} $HOME:</code>. If a variable is referenced but no value is
provided when the device is opened a warning message is printed; this
message can be suppressed by referring to the variable as (e.g.)
<code>$%1</code>.
 
The SY string is only used if an OF file has been specified. There is no
guarantee that SY is supported by all operating systems, but it is certainly
available under Unix and VMS (SY requires the C call `system()', as defined
for Unix. We have provided one for VMS, and any serious SM
implementation would have to have one too.)
A trivial example of SY in use on an Unix system would be:

</p><pre>:SY=cat $F ; rm $F:OF=out_XXXXXX:
</pre>

<p>
(<code>cat</code> prints a file, <code>;</code> separates multiple commands on a line,
<code>rm</code> deletes a file). Because not all operating systems can support
multiple commands on one line, you can use \n within a SY string to
separate commands. For example, under VMS that <code>SY</code> string could have been
written

</p><pre>:SY=type $F. \n delete $F..*:OF=out_XXXXXX:
</pre>

<p>
(Type adds a `.lis' unless explicitly given a closing `.', delete
requires a version number, hence the <code>$F.</code> and  <code>$F..*</code>.)
An example of the use of <code>$""</code> would be

</p><pre>:SY=mv $F $"Output filename? ":
</pre>

<p>
which renames the <code>OF</code> file to whatever you want.

</p>
<p>
The <code>RT</code> capability has been deleted in version 2.0, in favour of
using <code>DT</code>; The <code>RA</code> capability has been replaced in version
2.1 by <code>:DV=raster:</code>.

</p>


<h2><a name="SEC39" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC39">Stdgraph's Binary Encoder</a></h2>

<p>
Different terminals have very different ways of doing the same thing. For
example to move the beam to (200,200), a vt240 in REGIS mode needs to be
told `[200,259]', while a Tektronix 4010 needs `&amp;h&amp;H'. In order to cope
with this much diversity, stdgraph has a binary encoder with a 50 element
stack, 10 registers and about a dozen operators. The encoder communicates with
the rest of the world through its registers - for example in encoding a
coordinate pair it expects to find x in register 1, and y in register 2. When
reading a graphcap string, initially stdgraph simply copies the input
characters to an output string, which is then written to the terminal.
This is exactly what it does when it interprets the OW string
for a Tektronix, <code>OW=^]^_</code>. However, in addition
to characters such as <code>^</code> being special, it also recognises the
following as being special:
</p><dl compact="compact">

<dt><code>'</code>
</dt><dd>
escape special meaning of next character
</dd><dt><code>%</code>
</dt><dd>
Begin a format string
</dd><dt><code>(</code>
</dt><dd>
Switch from copy into encode mode.
</dd></dl>
<p>
When in `encode' mode, the following operators are available:
</p><dl compact="compact">

<dt><code>'</code>
</dt><dd>
Escape next character (recognised everywhere)
</dd><dt><code>%</code>
</dt><dd>
Formatted output, e.g. %d, %g, or %t
</dd><dt><code>)</code>
</dt><dd>
Revert to copy mode
</dd><dt><code>#nnn</code>
</dt><dd>
Push signed decimal number nnn onto the stack
</dd><dt><code>$</code>
</dt><dd>
Part of a switch statement
</dd><dt><code>.</code>
</dt><dd>
Pop a number from the stack, and put it in the output string
</dd><dt><code>,</code>
</dt><dd>
Get next number from input string, and push it onto the stack
</dd><dt><code>`str`</code>
</dt><dd>
Prompt with str, then read a character and push it onto the stack
</dd><dt><code>&amp;</code>
</dt><dd>
Modulus operator (similar to an AND of the low order bits)
</dd><dt><code>+</code>
</dt><dd>
Add (similar to OR)
</dd><dt><code>-</code>
</dt><dd>
Subtract (similar to AND)
</dd><dt><code>*</code>
</dt><dd>
Multiply (a left shift if number is a power of 2)
</dd><dt><code>/</code>
</dt><dd>
Divide (a right shift if number is a power of 2)
</dd><dt><code>&lt;</code>
</dt><dd>
Less than (0:false, 1:true)
</dd><dt><code>&gt;</code>
</dt><dd>
Greater than (0:false, 1:true)
</dd><dt><code>=</code>
</dt><dd>
Equals (0:false, 1:true)
</dd><dt><code>;</code>
</dt><dd>
Branch, &lt;boolean&gt;&lt;offset&gt;; (; is at 0 offset)
</dd><dt><code>0-9</code>
</dt><dd>
Push register 0-9 onto the stack
</dd><dt><code>!N</code>
</dt><dd>
Pop the top of the stack into register N.
</dd><dt><code>!!</code>
</dt><dd>
Pop the stack, and delay that many milliseconds.
</dd><dt><code>|</code>
</dt><dd>
Convert the top of the
stack from float to int (it is rounded rather than truncated).
</dd></dl>

<p>
Unless otherwise specified the stack is taken to be integer-valued,
although in fact it can support either integer or floating point
values. There is no type checking -- if you ask the encoder to print
the top of the stack as a float, but you stored an int, you can expect
trouble. If it is needed we might add more floating point support;
apart from printing the top of the stack, the only floating
point operation supported is `|' which rounds the top of the stack
(taken to be a float), converting it to an integer (so, for example,
<code>1|1!</code> converts the contents of register 1 from float to int).

</p>
<p>
All the binary operators operate on the top 2 elements of the stack, and
push the answer onto the top. Any other character is interpreted as an
integer, and pushed onto the stack - for instance, `' is the same as `#64',
octal 100. A blank is the octal constant 040.

</p>
<p>
The <code>%</code> command means, `format the top of the stack, and write
it to the
output string'. The format string may be any printf format specifier (printf
is the C formatted i/o function. In practice, the only formats that you are 
likely to need are <code>%c</code>, <code>%d</code>, <code>%g</code> and <code>%t</code> -- and
<code>%t</code> isn't even in C!
<code>%c</code> means `write the integer as a character', <code>%d</code> means
`format the number as a decimal integer', <code>%6d</code> means
`and make it fill 6 characters', and <code>%g</code> means format a floating
point number.
If you should need to know more, look at any book on C.) The special format
<code>%t</code> means `take x and y from registers 1 and 2, and format them for a
Tektronix'. As we shall see below, you can programme the encoder to do this,
but Tektronix emulators are so common that <code>%t</code> is provided for
efficiency's
sake. In fact there are two Tektronics formats, <code>%t</code> for 10 bit addresses,
and <code>%T</code> for 12 bit addresses.
The switch and branch instructions are discussed below, while examining
specimen <code>ML</code> and <code>SC</code> strings.

</p>


<h2><a name="SEC40" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC40">Examples of Graphcap Entries</a></h2>

<p>
As a simple example, the ANSI command to set a non-graphics cursor to a 
given line and column is

</p><pre>^[[ line ; column H
</pre>

<p>
Assuming that the x and y coordinates are in registers 1 and 2 respectively,
the corresponding graphcap string would be

</p><pre>"^[[(2)%d;(1)%dH"
</pre>

<p>
(where the quotes are not part of the format.) What if line and column
coordinates start at 1, but the terminal wants them starting at 0? then
the format would be

</p><pre>"^[[(2#1-)%d;(1#1-)%dH"
</pre>

<p>
You could write those <code>#1</code>'s as <code>^A</code> which would be slightly
faster, but why bother?

</p>
<p>
As promised above, it is also possible to encode Tektronix-type coordinates.
The desired bit format for a 10-bit address is

</p><pre>0 1 ya y9 y8 y7 y6
1 1 y5 y4 y3 y2 y1
0 1 xa x9 x8 x7 x6 
1 0 x5 x4 x3 x2 x1
</pre>

<p>
where x1 is the least significant bit in x, and ya is the tenth bit in y.
If x and y are in registers 1 and 2, the simplest XY (move/draw to
(x,y)) string is

</p><pre>"%t"
</pre>

<p>
but if this weren't available the following string would work:

</p><pre>"(2 / +.2 &amp;`+.1 / +.1 &amp;@+."
</pre>

<p>
(as before, the double quotes don't belong to the format). To understand this,
First look
up the octal values of ` ' (040), "' (0140), and `@' (0100). Then the first
<code>`('</code> puts the encoder into encode mode. <code>`2 /'</code> pushes the Y value
onto the
stack, and right shifts it by 5 bits (` ' is 100000 in binary). The next
<code>` +.'</code> adds the resulting bit pattern `0 0 ya y9 y8 y7 y6' to 0100000 and
transfers it to the output string, and we have produced the desired first
byte. The other bytes are produced in a similar fashion.

</p>
<p>
As another example consider an AED512, which is reputed to desire the bit
sequence

</p><pre>xa x9 x8 yb ya y9 y8
x7 x6 x5 x4 x3 x2 x1
y7 y6 y5 y4 y3 y2 y1
</pre>

<p>
The graphcap string

</p><pre>"(#128!919/^N*29/+.19&amp;.29&amp;."
</pre>

<p>
will accomplish this. We could further optimise this by loading the value
`#128' into register 9 once and for all with the LR capability, so a part
of the graphcap entry would appear as

</p><pre>":LR=#128!9:XY=(19/^N*29/+.19&amp;.29&amp;.:"
</pre>

<p>
I've never seen an AED512, but this should work anyway.

</p>
<p>
The switch instruction has the form

</p><pre>$i ... $j-k ... $l ... $D ... $$
</pre>

<p>
where <code>i</code>, <code>j</code>, <code>k</code>, and <code>l</code> are integers.
The encoder pops the top value off the stack adds `0' to make it
a character, and scans forward looking for a <code>$</code> followed by that
character.
<code>$2-5</code> would match the characters `2', `3', `4', or `5'. When it
has met its match, it executes the instructions that it meets until it
reaches the next <code>$</code> in execute mode. The encoder then skips forward
until just after the
<code>$$</code>, and resumes scanning. If the character from the stack is not
matched by
any of the cases, the encoder will use the <code>$D</code> (i.e. default) case,
if present.

</p>
<p>
As an example, consider how stdgraph sets the type of line to draw.
SM expects linetype 0 to be solid, 1 to be dotted, and so on.
We expect a linetype in register 1 and have to do something with it.

</p>
<p>
For a Tektronix, the linetypes are set by an ML entry:

</p><pre>ML=^[(1$0)`($1)a($2)c($3)d($4)b($$
</pre>

<p>
What does this do? The <code>^[</code> is simple, it is executed in copy
mode, and writes the character <code>^[</code> to the output string.
The <code>(1</code> enters encode mode, and places the contents of register 1, the
desired linetype, on the stack. Then begins the switch. If the linetype is
0, then the encoder scans past the <code>$0</code> and starts reading the string
again with <code>)`</code>. The <code>)</code> takes the encoder back to copy mode,
so it copies <code>`</code> to the output string, and encounters a
<code>($</code> which puts it back into encode mode. Once in encode mode it
recognises the <code>$</code> as the end-of-case, and scans forward until it reaches
<code>$$</code>, where it stops. We deduce that the set-linetype-0 escape sequence
is <code>^[`</code>. If register 1 had contained a 2, after 
entering the switch the encoder would have scanned forward to <code>$2</code>
(ignoring
all characters as it went), and copied <code>c</code> to the output string.

</p>
<p>
If you want to support erasing of individual lines (<code>LTYPE ERASE</code> or
<code>LTYPE 10</code>) you'll have to include a <code>$\:</code> case in your switch
(as <code>:</code> follows <code>9</code> in the ascii character set, and an un-escaped
<code>:</code> would end the graphcap entry). You'll have to escape the <code>:</code>
in the <code>lt</code> list as well. When leaving erase mode, by specifying any
other line type, the device will first
be set to <code>LTYPE 11</code> (i.e. <code>ML</code>'ll get a <code>;</code>) before it's
set to the desired 
<code>LTYPE</code>; this gives the driver a chance to reset itself. It's wise
to also turn off 
erase mode when closing the device. An example of an entry supporting
erasing lines is a graphon, which includes

</p><pre>:lt=01234\:;:CW=^[1^]^[^A^[2\
:ML=^_^[(1$0)`($1)a($2)c($3)d($4)b($\:)`^[^P($;)^[^A($$:
</pre>

<p>
as <code>^[^P</code> puts a graphon into erase mode, and
<code>^[^A</code> takes it out. Note that in erase mode the
linetype is set to solid (<code>^[`</code>), so as to erase all types of lines.

</p>
<p>
There is also a branch instruction, which has syntax

</p><pre>&lt;boolean&gt;&lt;offset&gt;;
</pre>

<p>
If the boolean is true (non-zero), then skip (offset - 1) characters in the
programme
string. The offset may be either positive or negative, and the `;' is at
offset 0. For example,

</p><pre>(0#15;)Goodbye(#1#8;)Hello()\n
</pre>

<p>
will print `Goodbye\n' if register 0 contains zero, or `Hello\n' otherwise.
As an example of the use of `;', consider using the 
encoder to decode a string.
Remember that `,' meant `read a
character onto the stack', and that there was a graphcap capability SC to
decode cursor responses. Suppose that we are dealing with a vt240 in REGIS
mode, then a cursor read will return a string of the form `k[nnn,mmm]' where
`k' is the character you hit, and (nnn,mmm) is the cursor position. We want
to put k into register 3, and (x,y) into registers 1 and 2. This is a little
messy, as we'll have to convert the ascii positions into integers. The desired
graphcap entry is

</p><pre>SC=(#0!1#0!2,!3,#0!8,#48-!99$0-91#10*9+!1#1!8$$8#1=#-39;\
0!8,#48-!99$0-92#10*9+!2#1!8$$8#1=#-39;62-!2):
</pre>

<p>
The first part is simple enough, store 0 in registers 1 and 2, store the
first character in register 3, read a character (the [), and store 0 in
register 8. 
Then we come to <code>,#48-!99$0-91#10*9+!1#1!8$$8#1=#-39;</code>.
The <code>,#48-</code> reads a character and converts it to an digit (48 is the
decimal
code for `0'), then stores it in register 9. The switch then checks if we do
have a digit, if so we multiply register 1 by 10 and add the new digit. We then
set register 8 to 1 and finish the switch which is here being used as an
if statement. The <code>8#1=#-39;</code> tests register 8 against 1 (i.e. checks if
we found a digit), and if we did it jumps back 39 characters, to read the
next character<a name="DOCF29" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT29">(29)</a>.
So we are accumulating the integer nnn in register 1, just as we needed to.
The rest of the string deals with decoding the y coordinate.

</p>
<p>
Sometimes you don't want to read from the input string, but from the
keyboard instead. In this case use <code>`str`</code>, e.g.
<code>(`Hello\: `#48-$0)False($D)True($$)\n:</code> will prompt you with
<code>Hello: </code>, then read a character from the keyboard. If you enter
a `0' it'll print <code>False</code>, otherwise it'll print <code>True</code>. Of course,
in reality you'd want to do something more useful (such as erasing
the screen).

</p>


<h2><a name="SEC41" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC41">Using Cursors with Graphcap</a></h2>
<p>
<a name="IDX638"></a>
We have just been through a long explanation of how to decode a cursor string,
but how did stdgraph know what to read in the first place? After receiving the
RC string, the terminal will send back a sequence of bytes, and the format
of these bytes must be specified in graphcap.<a name="DOCF30" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT30">(30)</a>
There are two ways to do this,
either by specifying a sequence of characters which <tt>`end'</tt> the response
string
along with a minimum number of characters to read, or by specifying a pattern
that the terminal response is to match. A typical example of the former is a
Tektronix whose cursor response may be chosen to be <code><kbd>control-M</kbd></code>
(this is
called the GIN response, and can usually be set in the terminal setup). We
know that the terminal will also send 5 other bytes (the key struck and the
encoded x,y coordinates so we would specify
<a name="IDX639"></a>

</p><pre>:MC=^M:CN=6:
</pre>

<p>
On the other hand, a REGIS terminal sends `k[nnn,mmm]'. This can be specified
as

</p><pre>:MC=?[#*,#*]:CN=-6:
</pre>

<p>
where the negative value of CN means that we are providing a pattern not just
a terminator (as before, the absolute value of CN is the minimum number of 
bytes in a cursor response). In MC strings, but nowhere else, the characters
<code>?</code>, <code>#</code>, and <code>*</code>
are special (although their special meanings may be escaped with
a <code>\</code>). <code>?</code> will match any character, <code>#</code> any digit, and
<code>*</code> means `match zero or more of the preceding characters'. So a MC
string of
<code>a#*?ba</code> will match `aaa1111bbaa' at the third character. (Incidently,
<code>a#*?a</code> would match at the first). Because this special character syntax is
different from that used in standard graphcap files for IRAF, the name of
this graphcap parameter has been changed from <code>CD</code> to <code>MC</code>.

</p>
<p>
If your cursor is attached to a mouse, if possible the buttons should
be set up to generate 
`e', `p', and `q' from left to right (if you have that many buttons).
If you have only one button, `p' is probably the best choice.
<a name="IDX640"></a>

</p>


<h2><a name="SEC42" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC42">Using Colours with Graphcap</a></h2>

<p>
The number passed to <code>CT</code> are the same as those specified with the
<code>CTYPE INTEGER</code> command, so initially they specify
default, white, black, blue, red, green, magenta, yellow, and cyan
(white is 1). 
These are the colours corresponding to turning one, zero, two, or three of the 
primary colours on. The default colour to use for a device is
specified by the <code>DC</code> capability, e.g. <code>:DC="red":</code>.

</p>
<p>
The <code>CS</code> and <code>CO</code> capabilities are used to support the <code>CTYPE = expr</code> command. First <code>CS</code> is used to tell the device how many
colours to expect, then <code>CO</code> is used for each number, with red, green,
and blue as its arguments. In this case <code>CT</code> passes an index
into the set of <code>CO</code> values. If you want to get an index, but
don't need <code>CS</code> and <code>CO</code>, you must still provide them; just
provide a no-op such as <code>:CS=():</code>.
<a name="IDX641"></a>
<a name="IDX642"></a>

</p>


<h2><a name="SEC43" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC43">How to Modify a Graphcap Entry</a></h2>
<p>
<a name="IDX643"></a>
<a name="IDX644"></a>

</p>
<p>
You might think that all that you have to do to modify a graphcap entry is
to start up your favourite editor, and start typing. You could do that,
many people have, but it isn't recommended because you'll have to do it
again when a new release of SM comes along. It's better to use SM's graphcap
search path (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC38">The Graphcap File</a>) as follows:

</p>
<p>
Let us assume that you want to modify the xterm entry to print something
every-time that is changes from graphics to alpha mode or vice versa (why?
so as to fix a problem with excessive screen switching). First
set up the system <tt>`.sm'</tt> file to look like:

</p><pre>+graphcap               /my/private/graphcap
graphcap                /usr/local/lib/sm/graphcap
</pre>

<p>
which tells SM to first search <tt>`/my/private/graphcap'</tt>
then <tt>`/usr/local/lib/sm/graphcap'</tt> (the graphcap file that we provide)
for graphcap entries. Then edit <tt>`/my/private/graphcap'</tt>
and add the entry

</p><pre>xterm|an xterm with noisy mode flipping:\
        :GE=\nE\n^[[?38h:GD=^[^C\nD\n:TC=xterm:
</pre>

<p>
Note the use of <code>:TC=xterm:</code> which says that SM should skip this file
when looking for the definition of <code>xterm</code>, thus avoiding an infinite
loop.

</p>
<p>
When a new version of SM is released your new definition will continue
to work (unless we change the definition of <code>xterm</code> in which case
you'll have some work to do anyway). You can use this technique to change
entries or add your own new ones without modifying the system file; all
of your changes are in <tt>`/my/private/graphcap'</tt>.

</p>


<h2><a name="SEC44" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC44">Writing a New Graphcap Entry</a></h2>
<p>
<a name="IDX645"></a>
<a name="IDX646"></a>
So, if you're faced with a new piece of hardware what should you do?
First of all, don't panic -- writing entries is quite simple. Second,
see if your device is basically the same as one that already exists
in graphcap, for example the entry for `graphon' uses the `selanar'
entry, and it in turn uses `tek4010'. You might be able to get away
with using <code>tc</code> to satisfy most of your device's needs.

</p>
<p>
Before writing your new entry please read the previous section to learn
the recommended strategy for modifying graphcap files.

</p>
<p>
Let's assume that you are faced with a totally new type of device
and really do have to start from scratch. First find out how large
your device is, and fill in the <code>xr</code> and <code>yr</code> entries. If you
are going to use hardware character sets you also need <code>ch</code> and
<code>cw</code>.  Next decide on the string to initialise the device -- does
it need to be set into some weird mode -- and put it into <code>OW</code>.
Put the string to reset it into <code>CW</code>. Now, if the initialised
device needs to be put into a special graphics mode put it into <code>GE</code>
and its inverse into <code>GD</code>. Next, you need to tell SM how to
draw a line and move the plot pointer. So enter the <code>DS</code>, <code>XY</code>,
<code>DE</code>, <code>VS</code>, and <code>VE</code> capabilities. Of course, if one
isn't required, don't put it in. If you have some sort of
printer you probably want to store all the commands in a file (<code>OF=</code>), and to plot them (<code>SY=</code>). You should now be ready to make
your first test, so plot a box. If it doesn't look right, fix it. Or you
might like to try printing the cover (<code>load cover cover</code>).

</p>
<p>
When all is well, you can begin looking into options that might make your
graphcap entry more efficient. Look through this appendix to see what
is available. Does your device support line types? Add
<code>ML</code> and <code>lt</code>. Heavy lines? <code>LW</code>. Coloured lines or a
cursor? See section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC42">Using Colours with Graphcap</a>.
Filled polygons? <code>FS</code>, <code>FD</code>, and <code>FE</code>. Dots? <code>MS</code> <code>ME</code>.
Hardware characters? <code>TS</code> <code>TE</code>. If your device produces
hardcopy you should arrange to start a new page with <code>PG</code> (the
<code>PAGE</code> command).
When you have finished please send us your new entry.

</p>


<h2><a name="SEC45" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC45">Support for Raster Devices</a></h2>
<p>
<a name="IDX647"></a>
<a name="IDX648"></a>
Stdgraph can only handle devices that can plot vectors specified by
their endpoints; unfortunately some devices (such as most line
printers) can only plot graphs when they have been reduced to rows of
`on' and `off' pixels. SM supports such devices through
<code>DEVICE raster</code> and a separate programme called <code>rasterise</code>.
You specify that a device in a graphcap file is a raster device by
using <code>DV</code>: <code>:DV=raster:</code> (The old form <code>:RA:</code> is no
longer supported).
It communicates with the rasteriser through graphcap, so the whole
process is user transparent. A separate rasterising programme was
written so as to allow the plot to be produced in the background while
you do more productive things, and to allow the rasterising to be
done on a remote machine.

</p>
<p>
<code>DEVICE raster</code> produces a file, whose name is specified as usual
by the <code>OF</code> field in graphcap, containing the vectors to be
plotted (as groups of four short integers) in device coordinates,
where the size of the device is taken from <code>xr</code> and <code>yr</code>. When
the device is closed, the command specified by <code>SY</code> are executed,
and these will usually be of the form
<code>rasterise -r $0 $F outfile\n print_it outfile\n delete outfile</code>
where <code>print_it</code> is the proper way of actually getting a plot. Under Unix,
the command might well be something like
<code>(rasterise -r $0 $F - | lpr -v -r -P$1)&amp;</code> dispensing with the
temporary <code>outfile</code>.

</p>
<p>
<a name="IDX649"></a>
What do these <code>rasterise</code> commands do? The command syntax is
<code>rasterise [-flags] device infile outfile</code>, where the infile may
be specified as `-' to use standard input (sys$input to VMS),
where the outfile may
be specified as `-' to use standard output (sys$output to VMS).
Possible flags are <code>r</code> to remove the infile after use, <code>R</code> to
rotate the plot through 90 degrees, and <code>v</code> for more verbose operation.
<code>Rasterise</code> then reads the data in the infile, and produces a
rasterised version, row by row, on the outfile. In order to do this,
it looks in graphcap for an entry for <code>device</code>, and uses the <code>xr</code>,
<code>yr</code>, <code>OW</code> (and <code>O[XYZ]</code>), and <code>CW</code> fields
as usual.<a name="DOCF31" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT31">(31)</a>
<a name="IDX650"></a>

</p>
<p>
Let's first consider a simple, one-line-at-a-time device such as a line
printer.  Before writing each row to <code>outfile</code>, rasterise encodes
the <code>BR</code> (Begin Row) capability, using the current row number as an
argument, and encodes <code>ER</code> (End Row) at the end of the line. By
default, it assumes that the raster device simply wants bits turned on
where a dot is required, but this can be overridden using the <code>BP</code>
and <code>EP</code> capabilities.  <code>EP</code> (Empty Pixel) specifies the bit
pattern for a character to represent white space.  In the simple case
mentioned a moment ago, this would be simply NUL, with no bits on, but
sometimes this doesn't suffice (see examples below).  <code>BP</code> (Bit
Pattern) is a string, giving the bit patterns required to turn on the
various pixels. In the default case, <code>BP</code> could be specified as
<code>BP=\001\002\004\010\020\040\100\200</code>, so <code>\001</code> would turn on
the first (rightmost) dot. Because there are eight characters given in
the string, <code>raster</code> assumes that it can fit eight pixels into a
single character. If you don't specify a <code>BP</code> this is what will be
used.
Some devices desire or require that the data be sent as hexadecimal numbers
rather than as binary; see the <code>RD=hex</code> graphcap entry.

</p>
<p>
Some other devices (e.g. Epson printers) choose to print several lines
at a time, so a single byte transmitted to the device might print 8
lines, but only the first pixel of each line. Such devices are
described to graphcap by being given the <code>MR</code> (Many Rows) capability and
a number <code>nb</code> which describes how many bytes deep the
printing band is (if omitted <code>nb</code> defaults to 1). In this case,
<code>BP</code> is used to describe which bits are turned on vertically
rather than horizontally but everything is otherwise the same as for
the simple case.

</p>
<p>
As an example, consider the HP laserjet. You'd specify it as
<code>DEVICE laserjet</code>, and its Unix graphcap entry reads:

</p><pre>laserjet|HP laserjet (high resolution):\
        :DV=raster:xr#1280:yr#640:CW=^[*rB:OW=^[*r1280^[*rA:BR=^[*b160W:\
        :OF=hp_XXXXXX:\
        :SY=/usr/local/sm/rasterise -r $0 $F - &gt; /dev/hp&amp;:
</pre>

<p>
On opening the device, it gets the string <code>^[*r1280^[*rA</code>,
setting the resolution and raster mode. Then, at the beginning of each
rastered line it gets <code>^[*b160W</code> specifying that 160 bytes
are coming its way, then finally <code>^[*rB</code> to restore it to
alpha mode. (It doesn't need to know which row it is on, so the <code>BR</code> string doesn't tell it, and the default <code>BP</code> and <code>EP</code> are fine).
After the input file is read it is
deleted, and the output file is sent to the standard output, whence it is
redirected to the proper device, in this case directly rather than
through a spooler.

</p>
<p>
A more complex example is a printronix printer, which encodes 6 pixels
in each byte, and requires that bit 7 be turned on. It also needs an escape
sequence at the end of each line. The corresponding graphcap entry is

</p><pre>printronix|DEC printronix printer:\
        :DV=raster:xr#792:yr#792:CW=^L:OW=^L:BR=ER=^E^J:\
        :BP=\001\002\004\010\020\040:EP=\100:\
        :OF=pr_XXXXXX:\
        :SY=(/usr/local/sm/rasterise -r $0 $F - | rsh wombat lpr)&amp;:
</pre>

<p>
We use <code>EP</code> to turn on the seventh bit everywhere, as required,
and specify only 6 values for <code>BP</code>, so only 6 dots will be packed
into each character. The <code>BR</code> entry is empty, and <code>ER</code> provides
the needed escape sequences at ends of lines. In this case <code>SY</code> sends
the plot over a network to machine <code>wombat</code>.

</p>
<p>
<a name="IDX651"></a>
Some devices are not able to simply accept a string of bytes with an
occasional escape sequence. For example, a versatec needs to have the
bit order changed, or a simple screen plotter might want to write a
<code>*</code> if a bit is set and a space otherwise. If this is the extent
of your pathology, you can deal with it via the provided capabilities.
(Fortunately adding a <code>*</code> onto a space makes a <code>*</code>, so you can
use <code>:EP= :BP=*:</code> for the latter.)
If you have a really bad device, it is possible to add new coded
device drivers to <code>rasterise</code>.
For the convenience of such devices there is a graphcap capability
<code>RD</code> which specifies the name of a type of raster device. If
<code>rasterise</code> recognises the device
it it calls a different set of routines to deal with the rows of data.
Otherwise it proceeds as discussed in the previous paragraph. This behaviour
is similar to that of the <code>DEVICE</code> command in using stdgraph if it
doesn't recognise a device name.

</p>
<p>
If you find that you <em>do</em> need to write routines for some device, don't
be too disheartened. <code>Rasterise</code> will still do the book-keeping and
rasterising for you, your work will be limited to a couple of output
routines. If you need to know more, see the source for rasterise. The only
time that I used this capability came about two years after rasterise was
written, and was <code>RD=hex</code> which specifies that lines be written as
hexadecimal numbers rather than as 8-bit characters (e.g. write the two
characters <code>FF</code> instead
of the single character `\377'). The line length is given as <code>ll</code>.
<a name="IDX652"></a>
<a name="IDX653"></a>

</p>


<h2><a name="SEC46" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC46">Compiling Graphcap</a></h2>
<p>
<a name="IDX654"></a>
(This section is really for someone maintaining SM.)
Rather than have stdgraph read the graphcap every time that it opens a 
devices, it is possible to compile the capabilities of the more popular
devices into the executable. This is done by preparing an include file
which initialises the appropriate arrays, using the programme `compile_g'
in the main directory. After this file (called cacheg.dat) has been
prepared, files depending on it must be recompiled and SM must
be relinked. The use of compile_g is pretty much self-explanatory, you
give it a list of the devices you want and it produces the cacheg.dat file.
Problems arise, however, if you don't have a valid cacheg.dat file, as then
you can't compile compile_g in the first case. Fortunately, it is possible
to bootstrap a cacheg.dat file (by defining BOOTSTRAP to the C-preprocessor),
and proceed from there.

</p>
<p>
When stdgraph attempts to use the compiled capabilities, it checks that the 
current graphcap file has exactly the same name as the one that cacheg.dat
was compiled
from, if it isn't then it reads the graphcap file anyway. This provides
a mechanism for those without C compilers to change the graphcap entries of
pre-compiled devices. If you have a list of graphcap files, the name
of the first is checked against the name in the <tt>`cacheg.dat'</tt> file.

</p>
<p>
				


</p><h2><a name="SEC47" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC47">Index to Graphcap Capabilities</a></h2>
<p>
<a name="IDX655"></a>

</p>
<p>
</p><h2>b</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX624">BP (Bit Pattern)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX625">BR (Begin Row)</a>
</li></dir>
<h2>c</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX585">ch (Character Height)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX593">CL (CLear)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX612">CO (COlour)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX586">co (number of COlumns)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX613">CS (Colour Start)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX614">CT (Colour Type)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX587">cw (Character Width)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX594">CW (Close Workstation)</a>
</li></dir>
<h2>d</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX615">DC (Default Colour)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX596">DE (Draw End)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX595">DS (Draw Start)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX633">DT (Device Type)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX634">DV (DriVer)</a>
</li></dir>
<h2>e</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX626">EP (Empty Pattern)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX627">ER (End Row)</a>
</li></dir>
<h2>f</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX597">FD (Fill Draw)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX598">FE (Fill End)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX599">FS (Fill Start)</a>
</li></dir>
<h2>g</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX600">GD (Graphics Disable)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX601">GE (Graphics Enable)</a>
</li></dir>
<h2>i</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX602">IF (Initialisation File)</a>
</li></dir>
<h2>l</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX588">li (number of LInes)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX629">ll (lINE lENGTH)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX589">lt (Line Type)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX616">LW (Line Weight)</a>
</li></dir>
<h2>m</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX617">MC (sM Cursor)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX603">ME (Mark End)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX618">ML (sM Line)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX628">MR (Many Rows)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX604">MS (Mark Start)</a>
</li></dir>
<h2>n</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX630">nb (nUM bYTES)</a>
</li></dir>
<h2>o</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX635">OF (Out File)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX605">OW (Open Workstation)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX606">OX (Open workstation)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX607">OY (Open workstation)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX608">OZ (Open workstation)</a>
</li></dir>
<h2>p</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX590">pc (Pad Character)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX609">PG (PaGe)</a>
</li></dir>
<h2>r</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX631">RA (RAster)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX619">RC (Read Cursor)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX632">RD (Raster Device)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX636">RT (Record Terminator)</a>
</li></dir>
<h2>s</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX620">SC (Scan Cursor)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX637">SY (SYstem)</a>
</li></dir>
<h2>t</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX621">TB (Text Begin)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX622">TE (Text End)</a>
</li></dir>
<h2>v</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX610">VE (? End)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX611">VS (? Start)</a>
</li></dir>
<h2>x</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX591">xr (X-Resolution)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX623">XY (X Y)</a>
</li></dir>
<h2>y</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX592">yr (Y-Resolution)</a>
</li></dir>

<p></p>


<h2><a name="SEC48" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC48">Calling SM from Programmes</a></h2>
<p>
<a name="IDX656"></a>
<a name="IDX657"></a>
<a name="IDX658"></a>

</p>

<ul>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC49">Callable Intro</a>: Introduction to Callable SM
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC50">Example</a>: Example of Calling SM Functions
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC51">Functions (1-D)</a>: Function Definitions: 1-D
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC52">Functions (2-D)</a>: Function Definitions: 2-D
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC53">Callable Parser</a>: Calling the SM interactive Parser from Programmes
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC54">Why call sm_alpha?</a>: Why do I have to call <code>sm_alpha</code> etc.?
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC55">Fortran Names</a>: How to Configure Function Names for Fortran
</li></ul>



<h3><a name="SEC49" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC49">Introduction to Callable SM</a></h3>

<p>
The SM callable interface is different from that of
Mongo and corresponds directly to the interactive version. Almost
all of the commands available in SM can be called from either
fortran or C, the exceptions being those concerned with the macro processor,
variables, history, and vector manipulations. We assume that if you want to
call graphics routines directly, then you are prepared to take responsibility
for such things. In C (and probably pascal, modula, or ADA), the calls have the
same names as the commands with the prefix <code>sm_</code>, so to set the limits say
<code>sm_limits(0.0,1.0,0.0,1.0);</code>. On VMS, and with some unix systems (notably
HPUX and AIX), if you are writing fortran, you must
prepend
an `f' to the command - <code>call fsm_limits(0.0,1.0,0.0,1.0)</code>. If you forget
this
`f', your programmes will compile, but they <tt>`won't'</tt> work. (They'll give
segmentation violations, most likely.  Why?  Because you will be calling the
C functions directly, not the Fortran interface functions, and the languages 
have different ways of passing arguments, so e.g. you will pass the address of
the variable from your Fortran program to a C function that expects to get the
value of the variable.  This translation is precisely what the interface 
functions are set up to do for you).<a name="DOCF32" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT32">(32)</a>
<a name="IDX659"></a>
If your fortran compiler cannot find the function names, you might have to
read the section on how SM chooses function names (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC55">How to Choose the Name for Fortran Subroutines</a>).

</p>
<p>
So how are you supposed to know what to call the functions?  Well, our best
suggestion is to ask the person who build SM on your system; the second best
suggestion is to look in 
<tt>`libplotsub.a'</tt> (or <tt>`libplotsub.olb'</tt> on VMS systems), and see what 
the names of the functions are.  On VMS, try this:

</p><pre>lib/list/names libplotsub/lib
</pre>

<p>
and look at the names it lists under module <code>INTERFACE</code>.  On a unix system
you can use <code>nm</code> (or, if desperate strings). The output is quite long,
so I'd filter the output, e.g.:

</p><pre>nm libplotsub.a | grep errorbar
</pre>

<p>
If you see things in the output like <code>fsm_errorbar</code>, then
you know this is one of those machines where you have to prepend the `f' for
the fortran interface functions.

</p>
<p>
If you used an ANSI compiler to link SM (or your guru did) then you
should provide prototypes for the SM functions that you call if
you use the C interface (Fortran knows nothing of such things).
This can be done by including the file <tt>`sm_declare.h'</tt>.

</p>
<p>
In what follows, we will assume that you are not writing fortran under
VMS, so we will omit the leading effs.

</p>
<p>
<a name="IDX660"></a>
To use SM functions, you must link with appropriate libraries. You
will always need to link with the three SM libraries, <code>libplotsub</code>,
<code>libdevices</code>, and <code>libutils</code> <em>in that order</em>. Specifically,
under Unix, you'll need to include the files <tt>`libplotsub.a'</tt>,
<tt>`libdevices.a'</tt>, and <tt>`libutils.a'</tt>
when you link (it's probably easier to use <code>-lplotsub -ldevices -lutils</code>,
along with a <code>-Ldir</code> if needed).
and under VMS you'll
need <tt>`libplotsub.olb/lib'</tt>, <tt>`libdevices.olb/lib'</tt>, and <tt>`libutils.olb/lib'</tt>. I can't tell you where
they'll be on your system.
In addition, you may need to link (after <code>utils</code>)
any libraries used by
the devices that have been compiled into your version of SM.
For example, if you use the X-windows driver, you'll need to link with
the X-library (<code>-lX</code>). Consult a local guru in case of any trouble -
the person who installed SM has had to work this out already.

</p>


<h3><a name="SEC50" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC50">Example of Calling SM Functions</a></h3>

<p>
A list of functions giving the calling sequence for all the
available functions follows, but first an example. Note especially the use of
<code>graphics</code> and <code>alpha</code> to set the terminal to graphics mode, and
return
to a normal terminal afterwards. We would recommend always calling these,
if they do nothing (e.g.  on a laser printer) they'll do no harm.
A related function is <code>gflush()</code> which will update graphics on the
screen, for instance with stdgraph where output is usually buffered.

</p>
<p>
Some devices (such as GL on an SGI, or X-windows on machines without
backing store such as RS/6000's) need some help from you to redraw the
screen. You do this by calling <code>redraw</code> whenever you are waiting
for input, passing it `0' (the file descriptor of standard input, for
those of you familiar with C). When input is ready, <code>redraw</code> will
return and your application can proceed. It should do no harm on systems
where it does no good.

</p>
<p>
If you don't want to be bothered with calling
 <code>sm_alpha</code>, <code>sm_graphics</code>, <code>sm_gflush</code>, and
<code>sm_redraw</code>, see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC54">Why do I have to call <code>sm_alpha</code>, <code>sm_graphics</code>, <code>sm_gflush</code>, and <code>sm_redraw</code>?</a>.

</p>
<p>
There are examples of programmes (in both C and fortran)
calling SM in the directory <code>sm/callable</code>; you might want to look at them
before starting your own project.

</p>
<p>
<a name="IDX661"></a>
<a name="IDX662"></a>

</p><pre>        integer NXY
        parameter (NXY=20)
        integer sm_device
        integer i
        real x(NXY),y(NXY)
c
        do 1 i=1,NXY
           x(i) = i
           y(i) = i*i
1  continue
c
        if(sm_device('hirez') .lt. 0) then
            print *,'Can"t open hirez'
            stop
        endif
        call sm_graphics
        call sm_defvar("TeX_strings","1")
        call sm_limits(-1.,22.,0.,500.)
        call sm_ctype('red')
        call sm_box(1,2,0,0)
        call sm_ptype(40.,1)
        call sm_points(x,y,NXY)
        call sm_xlabel('X axis')
        call sm_ylabel('Not x axis')
        call sm_alpha
        print *,'hit any key to exit'
        call sm_redraw(0)
        read(5,*) i
        end
</pre>

<p>
Remember, if you were running VMS, HPUX, or AIX then all those calls would 
start `f' - <code>call fsm_graphics</code> and so forth.
Note that <code>sm_box</code> takes all of its four possible arguments, and that
commands such as <code>sm_points</code> add an argument to specify the number
of points to plot.
You must, of course, ensure that you use the correct type of variables,
passing integers or reals as required (and as listed below). If you are
using C, you must carefully distinguish between passing by value, and
passing by address (which we only use when an array is expected, and
for returning a cursor position).

</p>


<h3><a name="SEC51" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC51">Function Definitions: 1-D</a></h3>

<p>
<a name="IDX663"></a>
The functions are as follows. For fuller definitions of the
arguments look at the main description of the command. The only ones
that are different are <code>sm_curs</code>, <code>sm_defvar</code>,
and <code>sm_plotsym</code> because they don't
quite correspond to any interactive commands. A common source of
trouble is not noticing that the <code>sm_ptype</code> call is the <em>vector</em>
form of the command, so to set a ptype of `4 1' you must
say <code>sm_ptype(41.0,1)</code>.

</p>
<p>
The arguments are declared in fortran in this list. <code>real x(n)</code>
means that <code>x</code> is an array of size n.
`Real' means single precision. (So in C,
<code>character</code>
<code>char *</code>;
<code>integer</code>
<code>int</code>;
<code>real</code>
<code>float</code>;
<code>real()</code>
<code>float *</code>. We deal with converting the
calling conventions from one language to another, but note comments at
the bottom of this table.)
</p><dl compact="compact">

<dt><code>sm_alpha</code>
</dt><dd>
Set terminal back to a normal state
</dd><dt><code>sm_angle(a)</code>
</dt><dd>
Set angle to a (real a)
</dd><dt><code>sm_axis(a1,a2,as,ab,ax,ay,al,il,ic)</code>
</dt><dd>
Draw an axis. (real a1,a2,as,ab; integer ax,ay,al,il,ic)
</dd><dt><code>sm_box(x1,y1,x2,y2)</code>
</dt><dd>
Draw a box - note 4 args. (integer x1,y2,x2,y2)
</dd><dt><code>sm_connect(x,y,n)</code>
</dt><dd>
Connect a line. (real x(n),y(n); integer n)
</dd><dt><code>sm_conn(x,y,n)</code>
</dt><dd>
Equivalent to sm_connect
</dd><dt><code>sm_ctype(c)</code>
</dt><dd>
Set colour to c (character c)
</dd><dt><code>sm_ctype_i(i)</code>
</dt><dd>
Set colour to i (integer i)
</dd><dt><code>sm_curs(x,y,k)</code>
</dt><dd>
Return position of cursor (real x,y; integer k)
</dd><dt><code>sm_defvar(str1,str2)</code>
</dt><dd>
Select variable str1 to str2 (character str1, str2)
</dd><dt><code>sm_device(str)</code>
</dt><dd>
Select device str (character str); return integer
</dd><dt><code>sm_dot</code>
</dt><dd>
Draw a dot
</dd><dt><code>sm_draw(x,y)</code>
</dt><dd>
Draw to (x,y) in user coords (real x,y)
</dd><dt><code>sm_erase</code>
</dt><dd>
Erase screen
</dd><dt><code>sm_errorbar(x,y,e,k,n)</code>
</dt><dd>
Draw error bars (real x(n),y(n),e(n); integer k,n)
</dd><dt><code>sm_expand(e)</code>
</dt><dd>
Set expand to e (real e)
</dd><dt><code>sm_format(xf,yf)</code>
</dt><dd>
Set format strings to xf and yf (character xf,yf)
</dd><dt><code>sm_get_variable(name) (character name)</code>
</dt><dd>
Return the value of the variable name, if it's a special variable
</dd><dt><code>sm_gflush</code>
</dt><dd>
Flush graphics output
</dd><dt><code>sm_graphics</code>
</dt><dd>
Set terminal into plotting mode
</dd><dt><code>sm_grelocate(x,y)</code>
</dt><dd>
Relocate in screen coordinates (integer x,y)
</dd><dt><code>sm_grid(i)</code>
</dt><dd>
Draw a grid (integer i)
</dd><dt><code>sm_hardcopy</code>
</dt><dd>
Close current device, if appropriate make hardcopy
</dd><dt><code>sm_histogram(x,y,n)</code>
</dt><dd>
Draw a histogram (real x(n),y(n); integer n)
</dd><dt><code>sm_identification(str)</code>
</dt><dd>
Identification string (character str)
</dd><dt><code>sm_label(str)</code>
</dt><dd>
Draw a string (character str)
</dd><dt><code>sm_limits(x1,x2,y1,y2)</code>
</dt><dd>
Set limits (real x1,x2,y1,y2)
</dd><dt><code>sm_location(x1,x2,y1,y2)</code>
</dt><dd>
Set location (integer x1,x2,y1,y2)
</dd><dt><code>sm_ltype(lt)</code>
</dt><dd>
Set ltype (integer lt)
</dd><dt><code>sm_lweight(lw)</code>
</dt><dd>
Set lweight (real lw)
</dd><dt><code>sm_notation(xl,xh,yl,yh)</code>
</dt><dd>
Set axis format defaults (real xl,xh,yl,yh)
</dd><dt><code>sm_page()</code>
</dt><dd>
Equivalent to PAGE interactively
</dd><dt><code>sm_plotsym(x,y,n,sym,ns)</code>
</dt><dd>
Draw user points (real x(n),y(n); integer n,sym(3*ns),ns)
</dd><dt><code>sm_points(x,y,n)</code>
</dt><dd>
Draw points (real x(n),y(n); integer n)
</dd><dt><code>sm_ptype(pp,n)</code>
</dt><dd>
Set point type - vector form (real pp(n); integer n)
</dd><dt><code>sm_putlabel(i,str)</code>
</dt><dd>
Position a label (integer i; character str)
</dd><dt><code>sm_redraw(i)</code>
</dt><dd>
Wait for input on file descriptor i (integer i). 
</dd><dt><code>sm_relocate(x,y)</code>
</dt><dd>
Relocate in user coords (real x,y)
</dd><dt><code>sm_set_ctype(cols,n)</code>
</dt><dd>
Set SM's permitted colours to cols (real cols; integer n)
</dd><dt><code>sm_shade(delta,x,y,n,type)</code>
</dt><dd>
Shade a region (integer delta; real x(n),y(n); integer n,type)
</dd><dt><code>sm_ticksize(xs,xb,ys,yb)</code>
</dt><dd>
Set ticksize (real xs,xb,ys,yb)
</dd><dt><code>sm_window(nx,ny,x,y,x2,y2)</code>
</dt><dd>
Select a window (integer nx,ny,x,y)
</dd><dt><code>sm_toscreen(ux,uy,sx,sy)</code>
</dt><dd>
Convert to screen coordinates (real ux,uy, integer sx,sy)
</dd><dt><code>sm_xlabel(str)</code>
</dt><dd>
Draw x-axis label (character str)
</dd><dt><code>sm_ylabel(str)</code>
</dt><dd>
Draw y-axis label (character str)
</dd></dl>

<p>
<code>sm_device</code> returns 0 if it opens the requested device, or -1 if it
fails. You must declare <code>sm_device</code> as returning integer, of course.
<code>sm_curs</code> returns after you hit any key, returning the coordinates of
the point, and the key struck as an integer (e.g.  `a' as 97 in ascii).
In C, all three arguments are pointers, two to float and one to int.
<code>sm_defvar</code> defines a variable, it is identical to the interactive command
<code>DEFINE name value</code>. It is only used to certain define variables that are
significant to SM, currently <code>file_type</code>, <code>graphcap</code>,
<code>TeX_strings</code>, <code>x_gutter</code>, and <code>y_gutter</code>.
Fortran users might or might not need to double <code>\</code>s in TeX labels,
depending on the foibles of your compilers (you are more
likely to need the doubled <code>\\</code> under unix).

</p>
<p>
<code>sm_plotsym</code> is like first
using the <code>PTYPE { ... }</code> command to define <code>sym</code>, and then
<code>POINTS</code> to plot x against y. The <code>sym</code> array consists of triples
of integers, <code>(move x y)</code> where move is 1 to move the plot pointer,
0 otherwise. This is not quite the same as the interactive command,
but doesn't involve any characters. The <code>move</code> integer may not be omitted.
The `file descriptor' that <code>sm_redraw</code> demands will almost always be
<code>0</code> (standard input) on unix boxes; if it is needed by VMS or
other operating systems I will add a note here when I write the device driver.
<code>sm_shade</code> shades the inside of the curve specified by x and y if type is
1, or the area below a histogram specified by x and y if type is 2.
The line spacing in screen coordinates is delta.
You can use <code>sm_toscreen</code> to convert from user to screen coordinates
(which run from 0 to 32767, and are used by <code>sm_grelocate</code>).
The second pair of arguments should be pointers to int if called from C.

</p>
<p>
<code>sm_window</code> takes an extra two arguments over the interactive version;
they are the values that you'd specify using the <code>#:#</code> form of
window specification; for example, <code>WINDOW 4 5 1 2:3</code> corresponds to
the call <code>sm_window(4,5,1,2,1,3)</code>.

</p>
<p>
The colour functions are <code>sm_ctype</code> and <code>sm_ctype_i</code>, equivalent
to <code>CTYPE name</code> and <code>CTYPE integer</code> respectively, and
<code>sm_set_ctype</code>, equivalent to the numerical form of <code>CTYPE = expr</code>.

</p>
<p>
You can get at most of SM's `special' variables (e.g. expand) directly
by looking at C globals (these may look like common blocks to fortran,
it depends on your compiler); look in the file <tt>`src/plotsub/set.c'</tt>
for details. Alternatively (and less involved in SM's insides, if a
bit slower), you can use <code>sm_get_variable</code>, which will return values
as floating point numbers.

</p>
<p>
The functions to manipulate 2-dimensional data are described in the next
section.

</p>


<h3><a name="SEC52" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC52">Function Definitions: 2-D</a></h3>

<p>
The use of the 2-D functions may require a little more explanation.
If you want to use SM to read your data,
producing contour plots is very similar to doing so interactively, with the
difference that instead of defining the variable <code>file_type</code>, you
must call the function <code>sm_filetype</code> with the desired value as the
argument before reading the data. This is equivalent to calling
<code>sm_defvar</code> to
define the variable <code>file_type</code>, and is only supported for
backwards compatibility.
As an alternative, you can fill your own data array,
and pass it to SM to be contoured with <code>sm_defimage</code>.
<a name="IDX664"></a>

</p>
<p>
Please note: the image data that you provide to SM should be 4-byte floats
even if you are built SM to use 8-byte (double) floating point numbers.
<a name="IDX665"></a>

</p>
<p>
The function calls follow (again in fortran), followed by some explanation.
</p><dl compact="compact">

<dt><code>sm_contour</code>
</dt><dd>
Contour current 2-D image
</dd><dt><code>sm_defimage(arr,x1,x2,y1,y2,nx,ny)</code>
</dt><dd>
Define an image (real arr(nx,ny),x1,x2,y1,y2; integer nx,ny)
</dd><dt><code>sm_delimage</code>
</dt><dd>
delete current 2-D image
</dd><dt><code>sm_filetype(type)</code>
</dt><dd>
Set 2-D filetype (character type)
</dd><dt><code>sm_levels(l,n)</code>
</dt><dd>
Set levels for contour (real l(n); integer n)
</dd><dt><code>sm_minmax(x,y)</code>
</dt><dd>
Get minimum and maximum of image (real x,y)
</dd><dt><code>sm_readimage(file,x1,x2,y1,y2)</code>
</dt><dd>
Read a 2-D image (character file; real x1,x2,y1,y2)
</dd></dl>
<p>
The translation to other languages is not quite as simple as above.
In C, <code>sm_minmax</code> expects to be passed pointers to floats, and
the first argument to <code>sm_defimage</code> is not a 2-D array, but an array of
pointers to the rows of the image. <code>x1, x2, y1, y2</code> specify the limits
as in the interactive <code>IMAGE</code> command; if they are set to be 0.0 then
the dimensions of the array will be used. As an example, again in non-VMS
fortran:
<a name="IDX666"></a>
<a name="IDX667"></a>

</p><pre>        integer NXY
        parameter (NXY=20)
        integer sm_device
        integer i,j
        real z(NXY,NXY),lev(NXY)
c
        do 2 i=1,NXY
           do 1 i=1,NXY
              x(i,j) = (i-NXY/2)**2 + (j-1)**2
1          continue
2       continue
c
        if(sm_device('postscript latypus') .ne. 0) then
           print *,'Can"t open printer'
           stop
        endif
        call sm_graphics
        call sm_limits(-1.,21.,-1.,21.)
        call sm_box(1,2,0,0)
        call sm_defimage(z,0.,20.,0.,20.,NXY,NXY)
        call sm_minmax(amin,amax)
        do i=1,NXY
           lev(i)=amin + (i - 1.)/(NXY - 1)*(amax - amin)
3       continue
        call sm_levels(lev,NXY)
        call sm_contour
        call sm_hardcopy
        call sm_alpha
        end
</pre>



<h3><a name="SEC53" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC53">Calling the SM interactive Parser from Programmes</a></h3>

<p>
It is also possible to call the SM parser directly from your own programmes. 
This is usually done by people who have large data arrays that they want to 
plot, so we have also provided a call to define your arrays as SM vectors. 
To use this, your SM guru must build an extra library, (called 
<tt>`libparser.a'</tt> on unix systems). This is done with the command

</p><pre>        make Parser
</pre>

<p>
in the top level SM source directory. If this has been done, you can link
the parser into your code by including the flag <code>-lparser</code> before
the other SM libraries (but after any <code>-L</code> flags). The programmes
<tt>`interp'</tt> and <tt>`finterp'</tt> in the <tt>`callable'</tt> directory provide
examples of calling SM's parser; <tt>`finterp.f'</tt> looks like:

</p><pre>      real a(10)
      integer i

      do 1 i=1,10
         a(i) = i
 1    continue

      call sm_array_to_vector(a,10,'xyz')
      print *,'Calling SM parser...'
      call sm_parser('-q')
      print *,'Exited parser'
      end
</pre>

<p>
Here the array <code>a</code> (with 10 elements) is to be called <code>xyz</code> in SM,
and SM is to be invoked with the command line options <code>-q</code>. You can of
course define as many vectors as you feel like, but using <code>DELETE</code> to
delete them from the parser is a serious error (i.e. don't!).

</p>
<dl compact="compact">

<dt><code>sm_array_to_vector(arr,n,name)</code>
</dt><dd>
Define an SM vector called name to have the values of the
array arr. (real arr(n); int n; character name).

</dd><dt><code>sm_parser(args)</code>
</dt><dd>
Start up the SM command parser as if you had started SM interactively with
command line arguments args, but with some vectors predefined (those that
you defined using <code>array_to_vector</code>) (character args).
</dd></dl>



<h3><a name="SEC54" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC54">Why do I have to call <code>sm_alpha</code>, <code>sm_graphics</code>, <code>sm_gflush</code>, and <code>sm_redraw</code>?</a></h3>

<p>
The question sometimes comes up, `Why do I have to bother with these
calls <code>sm_alpha</code>, <code>sm_graphics</code>, <code>sm_gflush</code>, and
<code>sm_redraw</code>? After all, other graphics libraries don't require them.'

</p>
<p>
The answer is that it all depends on how sophisticated and device
dependent you want to be.

</p>
<p>
If you are using something like an xterm to plot to, then <em>yes</em>,
you do need to explicitly switch between graphics and alpha screens --
or else you'll get gibberish on the text screen (something like
<code>`?_"s#M"s&gt;H"s#M#b#M!s#F!s#F0"s$X"</code>) and no graphics on the
graphics screen, or else your graphs and your input commands (and some
gibberish to handle the screen editor) mixed together on the graphics screen.
Of course the SM routines could have done the switches for you,
but if the mode were
changed everytime that it <em>might</em> need switching, you'd get an immense
amount of mode switching. Why would that matter? Try running the code on
a terminal like a vt240 that physically has only one screen.

</p>
<p>
If you didn't care about devices like <code>xterm</code> and were determined
to only use devices like <code>x11</code> or <code>sgi</code> or <code>postscript</code>
you wouldn't have to worry about any of this.

</p>
<p>
Next to <code>gflush</code>. For efficiency, SM doesn't guarantee that every
write request is actually written to the screen when received, so at the
end of a function call there could be lines or points that haven't yet
reached the screen.  <code>gflush</code> deals with this by flushing the
graphics buffers, thus
ensuring that all pending writes to the screen are completed. If you
don't care about possible missing points, don't worry about it.

</p>
<p>
Finally <code>redraw</code>. On a traditional terminal such as an I^2S or a
tektronics 4010, there was no need to worry about other windows
appearing on top of your beautiful graphics window and erasing what was
there; for some devices such as <code>xterm</code> there is no problem as the
terminal emulator is always looking at the screen, like a faithful dog,
waiting for you to type something or for one of its screens to get
corrupted. In the old days of sunview, Sun had hacked the lowest level
system calls (read etc.) to allow an application programme to call the
equivalent of <code>redraw</code> automatically (well, under a reasonably
common set of conditions). But if you are running on something like an
X11 display or a GL display on an SGI, there is <em>no-one</em> looking
out for events that erase your window, and you have to do it
yourself. If you don't care about refreshing the screen when raised to
the top of the window stack, there's no need to worry about <code>redraw</code>.

</p>
<p>
So all these complications with <code>alpha</code>, <code>redraw</code>, and friends
are due to SM being designed to handle all the possible nasty cases.  If
you use SM interactively, it is all done for you, but if you want to
call SM functions you have to decide how much responsibility you want to
take.

</p>
<p>
Of course, you can write a trivial wrapper about each SM primitive that
calls <code>sm_graphics</code> before calling (e.g.) <code>sm_points,</code> then
<code>sm_gflush</code> and
<code>sm_alpha</code> just before returning. 
In a similar way, you could write a general i/o function that calls
<code>sm_gflush</code>
then <code>sm_alpha</code>, then prompts you, then calls <code>sm_redraw</code>,
then reads the reply, then calls <code>sm_graphics</code>. But I don't think that
the SM primitives should do it for you.

</p>


<h3><a name="SEC55" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC55">How to Choose the Name for Fortran Subroutines</a></h3>

<p>
As discussed above, the names used for SM callable functions from fortran
are, in general, different from those used in (almost?) all other languages,
as fortran's calling conventions are different, so we have to provide interface
code (in the file <tt>`sm/src/plotsub/interface.c'</tt>). The SM function
<code>sm_func</code> may be called as <code>AAAsm_funcBBB</code> where <code>AAA</code> and
<code>BBB</code> are the values of the C-preprocessor macros <code>FORTRAN_PREPEND</code>
and <code>FORTRAN_APPEND</code> respectively; their default values are nothing and
<code>_</code>. If you want to change this, edit <code>sm/src/options.h</code> and
define the values that you desire. Note: with C compilers that don't adhere
to the C89 ansi standard, you are restricted to the values <code>f</code> and
<code>_</code> for <code>PRE-</code> and <code>APPEND</code>.

</p>
<p>
After changing <code>options.h</code> (or <code>options.skl</code> if you want your
changes to survive the running of <tt>`set_opts'</tt>), rebuild SM and you
should be in business.

</p>


<h2><a name="SEC56" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC56">The SM Grammar</a></h2>
<p>
Previous editions of this manual included a printed copy of the SM
grammar, prepared directly from the source code using the <code>get_grammar</code>
utility.
This was helpful in understanding otherwise bizarre objections to your
favoured command, as it specified exactly what SM would accept,
but used a lot of paper. We have therefore omitted it from this edition,
but you are welcome to make yourself a copy.

</p>


<h2><a name="SEC57" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC57">Two-Dimensional Graphics</a></h2>

<p>
There is limited support for 2-dimensional graphics in SM,
<a name="IDX668"></a>
and we do not expect to make many extensions in this area. Currently it is
possible to read an unformatted image, to draw contours, to generate
a Floyd-Steinberg dithered image, to extract values
from the image into vectors, and to obtain image values with a cursor.
Previous editions of this manual (prior to version 2.3) have traditionally
said: `We expect to support half-tone imaging in the nearish future';
as of this release there is a macro (called <code>greyscale</code> and written
by Gabor Toth here at Princeton) that draws reasonably efficient
grey scale images on any supported output device.

</p>
<p>
The problem of specifying data formats for images is difficult, and we have
adopted an approach of using a `filecap' file to describe the unformatted
files. This allows the user to write the file using C or Fortran (or,
presumably, lisp) and then use SM to read the data.
<a name="IDX669"></a>
The name of the entry in the <code>filecap</code> file is given by the
variable <code>file_type</code>, which may be given in your <tt>`.sm'</tt> file
if you use the standard <code>startup</code> macro.
<a name="IDX670"></a>
<a name="IDX671"></a>
<a name="IDX672"></a>
The format of data on disk is first the x- and y- dimensions of the
image, then the data in
row-ascending order. The exact statements used to write the data may depend
on the chosen value of <code>file_type</code> (or vice-versa). A description
of the <code>filecap</code> fields comes at the end of this appendix; most
users should never have to change this file.

</p>
<p>
It is also possible to read data from a formatted file and create an image
inside SM, for example if <code>x</code> and <code>y</code> are integers in the
range 0-9:

</p><pre>IMAGE (10,10)                   # declare a 10*10 array
READ { x 1 y 2 vals 3 }         # read some data
SET IMAGE(x,y) = vals           # and put it into the image
</pre>

<p>
The command used to read an image is IMAGE, and you may optionally
specify the x and y range covered by the data
(e.g. IMAGE <code>datafile xmin xmax ymin ymax</code>; this also works with
declarations like the one in the previous paragraph). Only the region of the
image lying within the current limits is plotted when contouring - just
like any other graphics operation in SM. Images may be deleted
with the DELETE IMAGE command. To extract values from an image,
use the special expression <code>IMAGE(vec_x,vec_y)</code> which has the
value of the image at the points (vec_x,vec_y).

</p>
<p>
You can extract variables from the image's header using the command
<code>DEFINE name IMAGE</code>. See the discussion of filecap if you need
to know what variables can be retrieved this way.

</p>
<p>
If you want to use non-interactive SM (i.e. write your own command
interpreter), there is a call (<code>defimage</code>) to define your data array
to the contouring package, but this is of course not available interactively.

</p>


<h3><a name="SEC58" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC58">Filecap</a></h3>
<p>
Filecap is similar in graphcap or the Unix termcap, and in fact the
`filecap' entries may be physically in the same file as graphcap (i.e.
added as if they were graphcap entries; of course an attempt to say
<code>device fits</code> will lead to confusion...).
Filecap can be specified as a list of files to be searched in order.
The fields in filecap are used to specify the data type of the file,
the record format of the file (record-length, inter-record gaps,
etc.) and the header used (length of header, offset of desired items).
Note that these are `unformatted' files, as written by C write() or
fortran write(num) statements.

</p>
<p>
<a name="IDX673"></a>
<a name="IDX674"></a>
The current filecap is as follows:

</p><pre>#
# Filecap describes unformatted file formats to SM. The syntax is
# identical to termcap or graphcap files.
#
c|C|C files:\
        :HS#8:nx#0:ny#4:
ch|CH|C files with headers:\
        :HS#24:nx#0:ny#4:x0#8:x1#12:y0#16:y1#20:
fits|cfits|FITS|CFITS|C FITS files:\
        :DA=fits:RL=2880:
no_header|Files with no header, will prompt for nx, ny:\
        :HS#0:
unix|UNIX|Fortran unformatted files under Unix on a Vax:\
        :HS#-1:nx#0:ny#4:RS#4:RL#-1:RE#4:
unix_int|UNIX_INT|Like unix, but integer*4:\
        :DA=int:tc=unix:
unix_short|UNIX_SHORT|Like unix, but integer*2:\
        :DA=short:tc=unix:
vms_var|VMS_VAR|Fortran unformatted under VMS, recordtype=variable:\
        :HS#8:nx#0:ny#4:
vms_fixed|VMS_FIXED|Fortran unformatted under VMS, recordtype=fixed:\
        :HS#-1:RS#0:RL#-1:REnx#0:ny#4:
# This seems to be correct, based on one example
vms_direct:VMS_DIRECT|Fortran unformatted, direct access, under vms:\
        :HS#8:RS#0:RE#0:nx#0:nx#4:
</pre>

<p>
Comment lines start with a #, continuation lines start with white space
(a tab or a space) and \ may be used to continue an entry on to the
next line.
The first few fields in an entry are separated by <code>|</code>, and are alternative
names for the same entry. For example,
fortran unformatted files under Unix may be referred to as <code>unix</code> or
<code>UNIX</code>. Fields are separated by colons, and are of the form
<code>:CC#nnn:</code> for numbers, and <code>:SS=str:</code> for strings. Omitted fields
may be specified as <code>:CC@nnn:</code>, or simply omitted.
Filecap capabilities currently used are:
</p><dl compact="compact">

<dt><code>DA (DAta type)</code>
</dt><dd>
Type of data in file (string)
</dd><dt><code>FS (File Start)</code>
</dt><dd>
Unwanted bytes at start of file
</dd><dt><code>HS (Header Size)</code>
</dt><dd>
Size of header
</dd><dt><code>RE (Record End)</code>
</dt><dd>
Unwanted bytes at end of record
</dd><dt><code>NS (No Swap)</code>
</dt><dd>
Don't swap bytes for FITS files
</dd><dt><code>RL (Record Length)</code>
</dt><dd>
Number of useful bytes per record
</dd><dt><code>RS (Record Start)</code>
</dt><dd>
Unwanted bytes at start of record
</dd><dt><code>SW (SWap)</code>
</dt><dd>
Byte swap 2 by integer data, and byte-and-word swap 4 by integers.
</dd><dt><code>nx (Number X)</code>
</dt><dd>
Offset in file of X size of data
</dd><dt><code>ny (Number Y)</code>
</dt><dd>
Offset in file of Y size of data
</dd><dt><code>x0 (X 0)</code>
</dt><dd>
Coordinate at start of X axis
</dd><dt><code>x1 (X 1)</code>
</dt><dd>
Coordinate at end of X axis
</dd><dt><code>y0 (Y 0)</code>
</dt><dd>
Coordinate at start of Y axis
</dd><dt><code>y1 (Y 1)</code>
</dt><dd>
Coordinate at end of Y axis
</dd></dl>
<p>
In addition, <code>HH</code> is supported as an archaic form of <code>HS.</code>

</p>
<p>
In terms of these quantities a file will look like this:
As mentioned below, <code>HS</code> can be negative and is then taken as the record
length of the header <code>RL_H</code>, in which case the file will be
like:
Note that the first real data record begins with an <code>RS</code> -- this means
that
if you are writing fortran you <em>must</em> write the header in a
different write statement than the one that you use to write the data
(i.e. <code>write(fd) nx,ny,arr</code> will not work).

</p>
<p>
Most parameters are optional, and will default to 0. If RE or RS is
specified, you must give RL as well. If you specify it as negative, then
we'll look for it from the operating system.  You must provide a value
for HS (or HH if you're old fashioned), if it is negative we'll assume
that even the header has a record structure, with RS and RE just like
any other record. Its record length will be taken to be RL, if RL is
positive, otherwise we'll find it from the operating system. If HS and
RL are both negative there is no reason why the record length of the
header should be the same as that of the data.

</p>
<p>
If neither nx nor ny
are present in the graphcap entry you will
be prompted<a name="DOCF33" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT33">(33)</a>
for the x and y dimensions of the file, otherwise they
must both be present.
If they are negative
they are taken to be the negation of the true dimension (so a filecap entry
<code>:ny#-6:</code> specifies that the y-dimension of the data is 6), but usually
they are taken as the offsets of the values of the x and y dimensions in
the file, relative to the start of the header (if you set HS to be zero
you can specify nx and ny on the command line, but they must be on a
separate line, either a real separate line, or following a \n).  Note
that HS excludes
FS, so HS will usually be 2*sizeof(int) irrespective of the value of
FS, and nx will usually be 0.  If HS is negative, then the nx and ny
offsets also ignore RS,
i.e.  nx is still usually 0.

</p>
<p>
As an alternative to specifying the actual file sizes as negative
integer values of nx or ny (e.g. <code>:nx#-10:</code>) you can simply specify
them as positive string values: <code>:nx=10:</code>. Note how this differs
from <code>:nx#6:</code>.

</p>
<p>
Possibilities for <code>DA</code> are <code>char</code>, <code>float</code> (default),
<code>int</code>,
<code>long</code>, and <code>short</code>, all as in C, and also <code>fits</code> for FITS
format data. (If you don't know what FITS format is, don't worry about
it. It's a style of header and record structure used for data
transport in astronomy<a name="DOCF34" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT34">(34)</a>.
If you do know about FITS, then we assume that
each record is 2880 by long, although possibly with RS and RE non-zero.
The header is processed for the size of the file and the value of
BITPIX. If the file is not SIMPLE, it is taken to be 4 by floating
point data. CRPIX, CRVAL, and CDELT
are interpreted correctly, as are BZERO and BSCALE. X0, x1, y0,
and y1 are specified as the keywords X0, X1, Y0, and Y1 respectively,
and take preference over CRPIX etc.
FITS files on a machine with vax byte order are supposed to be byte
swapped, but you can override this by specifying the <code>NS</code> capability
which stops SM from doing any byte swapping).
If you specify <code>SW</code> it takes preference over any other instructions
about byte swapping and forces byte-swapping for 2 byte (short) data,
and byte-and-word swapping for 4 byte (int) data.
If <code>x0</code> and <code>x1</code>, or <code>y0</code> and <code>y1</code> are omitted,
the range of
values on the appropriate axis is taken to be 0 to nx-1 (or ny-1).
You can override these values with the <code>IMAGE</code> command.
The values of <code>X0</code> (and so on) can be obtained directly using
<code>DEFINE X0 IMAGE</code>; Other values can be specified in <tt>`filecap'</tt>,
for example a filecap entry <code>:aa#24:</code> specifies that
<code>DEFINE aa IMAGE</code> should recover the (floating-point) number stored
at byte offset 24. Because of the way that filecap files work, you are
restricted to two-character names.
If you are using FITS files, all the keywords from the header are
available, but you should remember that SM is case sensitive.

</p>
<p>
For example, suppose I wrote a file using the Unix f77 compiler, with
some code that looked like:

</p><pre>        integer *4 nx,ny,arr(10,20)
c
        nx = 10
        ny = 20
        write(8) nx,ny
        write(8) arr
</pre>

<p>
(Omitting opening unit 8 as an unformatted file, and filling
the array with data). Then I could read it in SM by defining
<code>file_type</code>
to be unix_int. The filecap entry indicates that the length of the header
is to be obtained from unix (in fact from the file, it'll be the
record length of the header), as is the record length.
Both the start-of-record (RS) and end-of-record (RE) gaps are 4 by
long (they in fact contain the record length, but you needn't know that).
The number of x-records is at zero offset in the file,
and y-records is at offset 4. In other words, allowing for FS being 0 and
RS being 4,
nx occupies bytes 4-7 in the file, and ny 8-11.
The data is taken to be 4-byte integers (integer*4 to fortran).
In fact, the first record consists of only the values of
nx and ny, so the record length of the first record is 8 by, and part
of an equivalent filecap entry would be

</p><pre>:FS#4:HS#12:
</pre>

<p>
where I have interpreted RS as FS, and added the RE onto the end of
the header length HS. If I had written the data out line-by-line in a
do loop, the file type would still be unix_int, but the record length
actually used by SM in reading the file would be different (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN36">Image</a>).

</p>
<p>
As another example, I use an image processing system called Wolf that used
to use files with the arcane structure of 200 bytes of header, then
the x- and y-size of the file, given as ints, then more header up to a
total offset of 1024 bytes from the start of the file, then the data
written as short integers. I could write a header with code that looked
somewhat like (omitting all error checking):

</p><pre>        int fd,i;
        int xs = 20,ys = 10;
        short arr[10][20];
        ...
        lseek(fd,200L,0);
        write(fd,(char *)&amp;xs,sizeof(int);
        write(fd,(char *)&amp;ys,sizeof(int);
        lseek(fd,1024L,0);
        for(i = 0;i &lt; ys;i++) write(fd,(char *)arr[i],xs*sizeof(short));
</pre>

<p>
The corresponding filecap entry is

</p><pre>wolf|Wolf-IfA files:\
        :HS#1024:nx#200:ny#204:DA=short:
</pre>

<p>
which is pretty simple really.

</p>


<h2><a name="SEC59" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC59">Termcap -- A Terminal Database</a></h2>
<p>
<a name="IDX675"></a>
<a name="IDX676"></a>
Termcap is a Unix idea, that makes it possible to write software that
runs on a wide range of different terminals. The implementation that
SM uses contains no Unix source code. The idea is similar to
graphcap or filecap -- each property of the terminal is given as a
field in a file. For example, the string to clear to end of line is
called <code>ce</code>, and for ansi terminals is given as <code>ce=<kbd>control-[</kbd>[K</code>. The
format for termcap files is described under
`graphcap', which is identical. Our termcap is identical to the Unix
one, so for details see section 5 of the Unix manual. The file to use
as a termcap file is specified as <code>termcap</code> in your <tt>`.sm'</tt>
file, or as the environment variable <code>TERMCAP</code> (logical variable
to VMS). If SM can't open <code>TERMCAP</code> as a file, it is
taken to be the value of the entry for your terminal. If it doesn't
begin with a colon, it is treated like a termcap file, and searched
for the desired terminal. If it does begin with a colon, it is simply
taken to be the termcap entry to use.
A <code>TERMCAP</code>
variable takes precedence over an entry in your <tt>`.sm'</tt> file. As for
graphcap, a list of termcap files can be specified, to be searched in order.

</p>
<p>
A full termcap entry can be pretty long, but fortunately SM
only uses a small subset. (The rest are needed by full scale screen
editors, but we haven't written one.) In particular we use:
</p><dl compact="compact">

<dt><code>ce (Clear End)</code>
</dt><dd>
Delete to end of line
</dd><dt><code>ch (Cursor Horizontal)</code>
</dt><dd>
Move cursor within line
</dd><dt><code>cm (Cursor Movement)</code>
</dt><dd>
Move cursor around screen
</dd><dt><code>cn (ColumNs)</code>
</dt><dd>
Number of columns on screen
</dd><dt><code>dc (Delete Character)</code>
</dt><dd>
Delete character under cursor
</dd><dt><code>is (InitialiSe)</code>
</dt><dd>
Initialise terminal
</dd><dt><code>ks (Keypad Start)</code>
</dt><dd>
Initialise Keypad
</dd><dt><code>ks (Keypad End)</code>
</dt><dd>
Undo Keypad Initialisation
</dd><dt><code>kd (Kursor Down)</code>
</dt><dd>
Move cursor down one character
</dd><dt><code>kl (Kursor Left)</code>
</dt><dd>
Move cursor left one character
</dd><dt><code>kr (Kursor Right)</code>
</dt><dd>
Move cursor right one character
</dd><dt><code>ku (Kursor Up)</code>
</dt><dd>
Move cursor up one character
</dd><dt><code>k1 (Key 1)</code>
</dt><dd>
Key sequence emitted by PF1 key (also <code>k2</code>, <code>k3</code>, and <code>k4</code>)
</dd><dt><code>li (Lines)</code>
</dt><dd>
Number of lines on screen
</dd><dt><code>pc (Pad Character)</code>
</dt><dd>
Pad character, if not NIL
</dd></dl>
<p>
All of these are strings except <code>co</code> and <code>li</code> which expect
numbers, and <code>pc</code> which expects a single character.
The editor uses all of these except <code>co</code>, although the
<code>k</code> ones are only provided as a convenience to you, mapping the
arrow keys. In fact, these arrow keys may supersede desired bindings
such as <kbd>control-K</kbd> to delete to end of line (e.g.   on a televideo 912). If
this happens, use the <code>EDIT</code> or <code>READ EDIT</code> commands to fix
things up.

</p>
<p>
The cursor addressing strings <code>ch</code> and <code>cm</code> use a variant of
the C printf %. Consider the string as a function, with a stack on
which are pushed first the desired column, and then the desired line
(so the line is on top).
The possible % formats operate on the stack, and pop it after output.
</p><dl compact="compact">

<dt><code>d</code>
</dt><dd>
As in printf, zero origin
</dd><dt><code>2</code>
</dt><dd>
Like %2d
</dd><dt><code>3</code>
</dt><dd>
Like %3d
</dd><dt><code>.</code>
</dt><dd>
Like %c
</dd><dt><code>+x</code>
</dt><dd>
Add x to value, then `%.'
</dd><dt><code>&gt;xy</code>
</dt><dd>
If value &gt; x add y (no output)
</dd><dt><code>r</code>
</dt><dd>
Interchange line and column (no output)
</dd><dt><code>i</code>
</dt><dd>
Increment line and column by 1 (no output)
</dd><dt><code>%</code>
</dt><dd>
Output a single %
</dd></dl>
<p>
We do not support <code>%n</code>, <code>%B</code>, or <code>%D</code> out of pure laziness.
A couple of examples might help. To go to (5,60) a vt100 expects to receive
the string <code><kbd>control-[</kbd>[5;60H</code>, so the termcap entry reads
<code>:cm=\E[%i%d;%dH:</code>. We need the <code>%i</code> to go to one-indexed
coordinates, and the <code>escape</code> is written <code>\E</code>. The <code>:</code>'s delimit
the termcap entry. A Televideo 912
expects to be given first <code><kbd>control-[</kbd>=</code>, then
the coordinates as characters, where ` ' is 0, `!'
is 1, and so forth through the ascii character set. To convert a given
number to this form we add ` ', so the termcap entry is
<code>:cm=\E=%+ %+ :</code>.

</p>
<p>
If an entry begins with a number, it gives the number of milliseconds
of padding that the terminal requires (it is optionally followed by an
*, which we can and do ignore). If the terminal requires a pad character
that is not simply ascii <code>NIL</code> it should be given as <code>pc</code>, so
to use `a' as a pad character specify <code>:pc#97:</code>. The
baudrate is taken to be 9600, unless you specify it as the <code>ttybaud</code>
variable in your <tt>`.sm'</tt> file. We have never yet seen SM
have any trouble with padding, so we wouldn't worry about any of this
if we were you.
<a name="IDX677"></a>
<a name="IDX678"></a>

</p>
<p>
You might wonder why we need both <code>ch</code> and <code>cm</code>. The simple
answer is that we don't, but that we do want one of them. Because <code>cm</code> moves the cursor to a specific line, its use requires that
SM remember which line you are on which can be tough what with
switching to and from graphics mode. We therefore assume that you are
on the last line of the terminal, as set by <code>li</code> or explicitly by
the <code>TERMTYPE</code> command. If you provided <code>ch</code> this problem
wouldn't arise but many terminals don't support such a capability and
we have to code around this deficiency. To summarise: use <code>ch</code> if
you can, failing that use <code>cm</code>.

</p>
<p>
There is a problem with using the last line of the screen as the
SM command line, and this is that some terminals use the same
screen for graphics as for text, and your graph will merrily scroll
away as you type. The graphcap <code>GD</code> (Graphics Disable) command can
be set to take you to the top of the screen, but <code>cm</code> won't keep
you there. Your only chance is to disable cursor motion, either by
setting
<code>ch</code> to `disabled', or by specifying a negative screen size to
<code>TERMTYPE</code> which has the same effect. You can still use the
editor, but it'll be slower. If you still have trouble, try
<code>TERMTYPE dumb</code>, which really is a bit brain damaged, or
<code>TERMTYPE none</code> which disables the editor entirely.
<a name="IDX679"></a>
<a name="IDX680"></a>

</p>


<h2><a name="SEC60" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC60">New Devices and New Machines</a></h2>


<h3><a name="SEC61" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC61">Adding New Devices</a></h3>

<p>
As we have discussed extensively (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC37">The Stdgraph Graphics Kernel</a>), most plotting devices can
be accommodated within the framework of stdgraph/graphcap without
writing a line of C; raster devices can use the raster device driver.
Sometimes, however, this is not possible and you
must write a real driver. An example would be making SM run
native under X11; running under a terminal emulator can be done
with graphcap.

</p>
<p>
If you do make any changes, write any new drivers, or modify graphcap
(except trivially) <em>please</em> send us copies of your modifications.

</p>
<p>
Let us assume that you really do need a new driver, how do you go
about it?
<a name="IDX681"></a>
SM communicates with devices solely through a graphcap entry,
some external variables
(defined in sm.h) and a structure called
<code>DEVICES</code> which is defined in <code>devices.h</code> and declared in
<code>plotsub/devices.c</code>.

</p>
<p>
When you issue a <code>DEVICE devname args</code>
command, the stdgraph driver is called with the string <code>devname args</code>,
and it opens the graphcap entry for <code>devname</code>. If it finds an entry
of the form <code>:DV=driver:</code> it tries to find a hardcoded device driver
called <code>"driver"</code> (you'll see in a moment where the names come
from). If it can find such a driver it calls its setup function (to
be defined in a moment) with <code>args</code> as an argument.
<a name="DOCF35" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT35">(35)</a>
<a name="IDX682"></a>
Your device
driver is now in charge, and no more stdgraph routines are called
until your device is closed; after you return from your close function
stdgraph's close function is called to close the graphcap descriptor.
What do you have to remember from this paragraph? That you need a
graphcap entry, if only a trivial one along the lines of

</p><pre>my_device|all_mine:DV=my_driver:
</pre>

<p>
which associates the driver <code>my_driver</code> with the device referred
to as either <code>my_device</code> or <code>all_mine</code>.  Because stdgraph's
<code>stg_open</code> and <code>stg_close</code> functions are called around your
device code
the standard graphcap support for <code>OW</code>, <code>IF</code>, <code>DC</code>, <code>OF</code>,
<code>SY</code>, and <code>CW</code> is automatically provided if you want it; see
the imagen
driver and graphcap entries for an example.  You might also want to
remember that you can directly access any graphcap entry for your
device from within your driver, using the functions <code>ttygets</code>,
<code>ttygetr</code>, <code>ttygeti</code>, and <code>ttygetb</code>.

</p>
<p>
The current definition of <code>DEVICES</code> looks like this:

</p><pre>typedef struct {             /* output device dependent functions */
   char d_name[40];           /* name of device */
   int (*dev_setup)();        /* initialisation  */
   void (*dev_enable)(),      /* enable graphics */
   void (*dev_line)(),        /* draw a line from x1, y1 to x2, y2 */
   void (*dev_reloc)(),       /* relocate current position */
   void (*dev_draw)(),        /* draw a line from current pos to x,y  */
   int (*dev_char)(),         /* hardware characters  */
   int (*dev_ltype)(),        /* hardware line type */
   int (*dev_lweight)(),      /* hardware line weight */
   void (*dev_erase)(),       /* erase graphics screen  */
   void (*dev_idle)(),        /* switch from graph to alpha mode */
   int (*dev_cursor)(),       /* cursor display */
   void (*dev_close)(),       /* close device */
   int (*dev_dot)(),          /* draw a single pixel dot */
   int (*dev_fill_pt)(),      /* draw a filled point */
   int (*dev_fill_polygon)(), /* draw a filled polygon */
   void (*dev_ctype)(),       /* set colour of line */
   int (*dev_set_ctype)(),    /* set possible colours of lines */
   void (*dev_gflush)();      /* flush graphics */
   void (*dev_page)();        /* start a new page */
   void (*dev_redraw)();      /* redraw the screen, if need be */
} DEVICES;   
</pre>

<p>
<em>Note that this is the DEVICES structure at the time of writing;
be sure to see that it is still correct when you write your driver!</em>
To add a new device to SM, all you have to do is to write functions
to fill as many of the slots in <code>DEVICES</code> as possible, add their
definitions to <tt>`sm_declare.h'</tt>, then add an
element to the array devices[] in devices.c. After recompiling, SM will
recognise your device by the name <code>d_name</code> that you gave it in devices[].
Traditionally the functions have the
same name as those given above with the <code>dev</code> replaced by some
mnemonic for your new device. You should surround both your driver and
the entry in devices[] with #ifdef's so that all I have to do to
totally lose your device is to not #define it to the compiler. In writing
your device you may want to use graphcap to give it various pieces
of information. This can be done; see the imagen driver for an example.

</p>
<p>
You should include the file <tt>`sm_declare.h'</tt> (which automatically
includes <tt>`options.h'</tt>) which provides declarations for all SM functions
(including prototypes if the compiler supports them), and you should add
your own declarations to this file.

</p>
<p>
If you don't provide some of the functions, SM will try to
emulate them in its software. For example, of your ltype function returns
-1, then we will chop your lines for you. There are a set of functions
for <code>nodevice</code> that have the correct types, you can use them for
functions that you don't want to provide (e.g. if you don't support
<code>dev_ltype</code> you can use <code>no_ltype</code>).
Some of the routines, e.g.  dev_char
are sometimes passed NULL arguments to inquire if they can provide
particular capabilities. In the following paragraphs we discuss all
the functions, their arguments, what they do, and what they return.

</p>
<p>
All coordinates are given in screen units, where
the device is 32768 pixels along a side.

</p>
<dl compact="compact">

<dt><code>dev_setup(str) (char *str;)</code>
</dt><dd>
Open the plotting device. Str
contains the rest of the command line, so if the <code>DEVICE</code>
command was <code>DEVICE newdev abcde zyxwvut</code>, setup will be passed
<code>abcde zyxwvut</code>. If the device can't be opened for some reason
setup should return -1, otherwise 0. Setup has a number of
book-keeping responsibilities: setting the value of termout to 1 if
the device is a terminal, otherwise 0; setting the value of ldef to
the maximum spacing between lines if they are to appear as one
thick line rather than a set of parallel ones, (used if we have to
emulate <code>LWEIGHT</code>); setting the variables xscreen_to_pix and
yscreen_to_pix to give the conversion from SCREEN to device coordinates;
calling default_ctype with the name of the default
colour for lines (e.g. <code>default_ctype("white")</code>). There is no need
to look in the <tt>`.sm'</tt> file for a <code>foreground</code> entry, this is
done for you (by set_dev()) after dev_setup returns, but you should
deal with any <code>background</code> entry if you feel so inclined.
There is a function parse_color
that converts a colour name into r, g, and b values (see the sunwindows
setup function for an example of its use) that may help.
Note that you should not call <code>stg_setup</code> -- this was done for you
automatically before your setup function was called. No return value.

</dd><dt><code>dev_enable()</code>
</dt><dd>
Enable plotting on the device. For a graphics
terminal this means switching from alpha to graphics mode, but may
well not be required for other devices. No arguments, no return value.

</dd><dt><code>dev_line(x1,y1,x2,y2) (int x1, y1, x2, y2;)</code>
</dt><dd>
Draw a line from (x1,y1) to (x2,y2). No return value.

</dd><dt><code>dev_reloc(x,y) (int x,y;)</code>
</dt><dd>
Move the plot marker to (x,y). No return value.

</dd><dt><code>dev_draw(x,y) (int x,y;)</code>
</dt><dd>
Draw a line from the current plot marker
to (x,y) which becomes the new plot marker. No return value.

</dd><dt><code>dev_char(str,x,y) (char *str; int x,y;)</code>
</dt><dd>
Write the string at
the position (x,y). The position given is just to the left of the
first character, at about the height of the centre of a capital letter.
Return 0 if you support hardware characters, otherwise -1 in which
case we'll use the software character set instead.
If str is NULL, this is just an enquiry as to whether the device
supports a hardware character set. Char is also called (with NULL) whenever the
value of expand or angle is changed, to allow you to adjust the sizes
of cheight and cwidth (the height and width of a character in SCREEN
units) for a hardware character set, as
the sizes of hardware sets can be very different from the SM fonts.
You should only
change cheight and cwidth if we are really going to use your hardware
characters (expand == 1, angle == 0).

</dd><dt><code>dev_ltype(i) (int i;)</code>
</dt><dd>
Set the <code>LTYPE</code> to be i, as in the
interactive command.
Return 0 if you support the ltype asked for, otherwise -1. If you can't support
a linetype, make sure that you are drawing solid lines, so that
SM can emulate it for you. <code>LTYPE</code> 10 is special, it is
generated by the <code>LTYPE ERASE</code> command, and asks you to delete lines
as they are drawn, <code>LTYPE 11</code> is used to indicate the end of <code>LTYPE ERASE</code> mode.

</dd><dt><code>dev_lweight(lw) (real lw;)</code>
</dt><dd>
Set the <code>LWEIGHT</code> to be lw, as in the interactive command. Lines
with <code>lweight</code> 0 should be the natural thickness of a line on your
device, higher <code>lweight</code> lines are usually drawn with a thickness
of <code>LDEF*lweight</code> in SCREEN coordinates.  Return 0 if you support
the lweight asked for, otherwise -1.

</dd><dt><code>dev_erase()</code>
</dt><dd>
Erase the screen. No return value.

</dd><dt><code>dev_idle()</code>
</dt><dd>
Return to alpha mode, the opposite of dev_enable(). No return value.

</dd><dt><code>dev_cursor(x,y) (int *x,*y)</code>
</dt><dd>
Find the current position of
the cursor, if there is one. If there is, the return value is the
character struck by the user, otherwise return -1. If your device
has a mouse, you should try to make the buttons correspond to `e',
`p', and `q' from left to right. If you only have one button, `p' is
probably the best choice.

</dd><dt><code>dev_close()</code>
</dt><dd>
Close the device, the opposite of dev_open().
Note that you should not call <code>stg_close</code> -- this is done for you
automatically. No return value.

</dd><dt><code>dev_dot(x,y) (int x,y)</code>
</dt><dd>
Draw a dot at (x,y), (i.e.  a real dot, not like the <code>DOT</code> command).
You'll have to do the move to (x,y)
yourself. Return 0 if you can draw dots, otherwise -1.

</dd><dt><code>dev_fill_pt(n) (int n;)</code>
</dt><dd>
Draw a filled point at the current
position. This is the routine that draws <code>PTYPE n 3</code> points.
Remember to allow for <code>EXPAND</code> and  <code>ANGLE</code>.
Return 0 if you can draw the point, otherwise -1;

</dd><dt><code>dev_fill_polygon(n) (int style; float *x, *y; int n;)</code>
</dt><dd>
Draw a filled polygon defined by <code>x</code> and <code>y</code> (a total of <code>n</code>)
points) in the style <code>style</code> (0: filled; all other values are currently
undefined). Return 0 if you can fill polygons in the desired style,
otherwise -1. You may get queries with on <code>style</code> with <code>n == 0</code>.

</dd><dt><code>dev_ctype(r,g,b) (int r,g,b;)</code>
</dt><dd>
Set the current line colour.
The interpretation of (r,g,b) depends on whether you have a dev_set_ctype
function. If you don't, then r, g, and b are the red, green, and blue
intensities in the range 0-255. If you do, then r is an index into the array
defined by set_ctype and g and b are irrelevant.
No return value.

</dd><dt><code>dev_set_ctype(col,n) (COLOR *col; int n;)</code>
</dt><dd>
Define a set of colours to be accessed by set_ctype. Col is an array
of n elements, each of which consists of 3 unsigned chars (COLOR is
defined in sm.h) corresponding to red, green, and blue in the range 0-255.
Ctype will be used to access this array to change colours.
Return 0 if you do support set_ctype, otherwise -1.
If col is NULL this is just an enquiry. If you are asked for more colours
than you are prepared to support, you should scale the request in a user
transparent way (e.g. if she wants 256 colours, and you are only giving her 128,
you should arrange that dev_ctype divides her requests by 2 so it looks as
if she got all 256).

</dd><dt><code>dev_gflush()</code>
</dt><dd>
Flush graphics, update graphics on screen. No return value.

</dd><dt><code>dev_page()</code>
</dt><dd>
Start a new page. If your device produces hardcopy
you should print the current page and start a new one; if you are writing
a window system driver you probably should simply raise the window so
that it is visible. No return value.

</dd><dt><code>dev_redraw(fildes) (int fd)</code>
</dt><dd>
Redraw the screen, but only if it needs it. This
function is called by <code>get1char()</code> before it tries to read a
character from SM's standard input (file descriptor <code>fd</code>).
It is intended for the use of drivers that need to keep an
eye on `their' window. For example, the Silicon Graphics driver needs
to redraw a window every time that it is moved. Such device drivers
will probably want to poll <code>fildes</code> (e.g. using <code>select()</code>)
to see that there really <em>is</em> input before returning; look at
the <code>sgi</code> or <code>x11</code> driver if you want an example.
No return value.
</dd></dl>

<p>
If you are still confused, look at some of the hardware drivers that
are already available.

</p>


<h3><a name="SEC62" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC62">Porting to New Machines</a></h3>
<p>
<a name="IDX683"></a>

</p>
<p>
Porting to new Unix machines should be relatively simple. If the
machine runs BSD Unix the only changes that should be necessary are
to the exception handler routines in main.c, to reflect the error
conditions signalled by your new machine. For a Sys V Unix, you'll have
to edit <tt>`options.h'</tt> to define <code>SYS_V</code>.
Otherwise, your only
problems should be hidden bugs which flourish in new architectures.

</p>
<p>
Otherwise there isn't all that much that I can tell you. SM
runs on Unix (BSD and SysV) and VMS machines, and the places where the
code is #ifdef'd
for those operating systems is your best bet for places where there
are machine dependencies. That said, there are a few obvious problem areas.

</p>
<p>
First consider get1char, which is the routine that reads terminal
input. It has to be able to get one character a time from the
terminal, and not interpret control characters. This is obviously
operating system dependent (CBREAK under 4.3BSD, PASSALL under VMS, ...).
Get1char expects to be passed <kbd>control-A</kbd> to start operations, and EOF to
end them. Anything else means `return a character please'. The
terminal output functions used by stdgraph are also machine dependent,
for example they use QIO calls under VMS.

</p>
<p>
As mentioned above, the exception handlers try to interpret the
exceptions that they receive and this may require a little
modification in main.c.

</p>
<p>
Hardcopy devices need the system() system call to send commands to the
operating system, and if you don't have one you are in trouble.

</p>
<p>
In a few places SM needs to make assumptions about how file
names are put together, and these will need changing. On a similar
note, some operating systems (e.g.  VMS) are very picky about opening
files and you may have to be careful. Note the use of the <code>DT</code>
graphcap capability to signal particular requirements to the programme.

</p>
<p>
A machine that didn't use ascii would be rather a nuisance as makeyyl
assumes that the characters for A-Z are contiguous, and although this
could be easily fixed I am not sure that other problems wouldn't arise.

</p>
<p>
A final rather horrifying thought is that Bison might not compile on a
machine that doesn't have YACC as an alternative. I don't know how to
fix that, you'd just have to
hope for the best, or else run Bison/YACC on a different machine and copy
over control.c.

</p>


<h2><a name="SEC63" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC63">The System Macro Libraries</a></h2>

<p>
<a name="IDX684"></a>
<a name="IDX685"></a>
This appendix describes the collection of useful macros, written by a variety
of people, that are to be found in the default macro directory, i.e.
the directory pointed to by the <code>macro</code> entry in your <tt>`.sm'</tt> file. If ever you write a useful (or simply clever) macro, why
not send it to us for inclusion in the next version of SM?

</p>
<p>
The macros are arranged in a number of files which may be read using the
<code>load</code> macro. For example, to load the file <code>fonts</code> type
<code>load fonts</code>. To forget a set of definitions, use <code>unload</code>.
Under Unix, there is a macro <code>lsm</code> that can be used to list the
contents of macro libraries, e.g. <code>lsm utils</code>. It is more-or-less
complete depending on the value of <code>VERBOSE</code>, just like <code>LIST MACRO</code>.

</p>
<p>
The list that follows gives the name and a one-line synopsis of all the macros
in the default files as of the date of this manual.  The full text of any macro
may be examined via the <code>help &lt;macroname&gt;</code> command in SM; the
default files may be printed for those who desire a hardcopy.

</p>
<p>
file <tt>`abbrev'</tt> in directory <tt>`macro'</tt>
(This is a file of all unambiguous abbreviations of keywords. It is created
using the shell script <tt>`abbrev'</tt> in the main SM directory. Its use may
interfere with cunning macros, and is not recommended).

</p>
<p>
file <tt>`cover'</tt> in directory <tt>`macro'</tt>

</p><pre><a name="IDX686"></a>cover       # draw the cover
</pre>

<p>
 
</p><p>
file <tt>`default'</tt> in directory <tt>`macro'</tt>

</p><pre><a name="IDX687"></a>batch       ## run the history buffer, but don't delete from history list
<a name="IDX688"></a>bell        ## ring terminal bell
<a name="IDX689"></a>calc        ## evaluate an expression
<a name="IDX690"></a>cd          ## change directories
<a name="IDX691"></a>compatible  ## define macros to be compatible with Mongo
<a name="IDX692"></a>declare     ## declare a vector $1: declare name size
<a name="IDX693"></a>del         ## delete last command from history list
<a name="IDX694"></a>del1        ## don't put command on history list
<a name="IDX695"></a>echo        ## write to terminal
<a name="IDX696"></a>ed          ## edit a macro, or the previous one if no argument
<a name="IDX697"></a>edit_all    ## edit history buffer
<a name="IDX698"></a>emacs_all   ## edit the history list using an external editor.
emacs_hist  ## edit the history list using an external editor.
<a name="IDX699"></a>error_handler ## Handle <kbd>control-C</kbd> interrupts
<a name="IDX700"></a>execute     # read and execute an SM file of commands (1 per line)
<a name="IDX701"></a>extend_history # Extend history buffer to be of size $1
<a name="IDX702"></a>for         ## Repeat a macro while a condition is true, like C's for(;;). See also while
<a name="IDX703"></a>gripe       ## complain to Robert (Unix only)
h           ## get help
<a name="IDX704"></a>head        ## print the top of the current data (or other) file
<a name="IDX705"></a>hm          ## help with the last macro edited
<a name="IDX706"></a>hv          ## help with variable
<a name="IDX707"></a>insert      ## insert text after line $1
<a name="IDX708"></a>load        ## load macros in default directory
<a name="IDX709"></a>load2       ## load macros in (second) default directory
<a name="IDX710"></a>ls          ## list macros
<a name="IDX711"></a>lsm         ## list macros in a file in default macro directory
<a name="IDX712"></a>lsv         ## list variables
<a name="IDX713"></a>q           ## check, then quit
re          ## macro read
<a name="IDX714"></a>reset_ctype # Reset the default ctypes (except "default")
<a name="IDX715"></a>sav         ## save to a file $1, don't save from files `$mfiles'
<a name="IDX716"></a>show        ## show current values of various things
<a name="IDX717"></a>startup     ## macro invoked upon startup
<a name="IDX718"></a>undef       ## undefine a variable
<a name="IDX719"></a>undo        ## undo [macro] : undo (i.e. erase lines drawn by) macro $1
<a name="IDX720"></a>unload      ## forget macros from a file
<a name="IDX721"></a>unset       # delete a vector
v           ## set verbosity
wr          ## macro write
</pre>

<p>
 
</p><p>
file <tt>`demos'</tt> in directory <tt>`macro'</tt>

</p><pre>square      # sum the Fourier series for a square wave, using $1 terms
colours     # draw a circle in a number of colours until ^C stops it
crings      # draw a set of coloured circles
<a name="IDX722"></a>crings2     # draw a set of coloured circles using 256 shades of yellow
<a name="IDX723"></a>gauss_convolve # convolve 2 Gaussians with sigmas $1 and $2
<a name="IDX724"></a>grey_sincos # draw a grey scale image of a sin(x)cos(y) surface
scribble    # use cursor to draw a line, and then shade the interior
shading     # draw an ammonite
<a name="IDX725"></a>sundial     # draw a sundial, allowing for the analemma
</pre>

<p>
 
</p><p>
file <tt>`fonts'</tt> in directory <tt>`macro'</tt>

</p><pre><a name="IDX726"></a>fonts       # draw the font table
<a name="IDX727"></a>TeX_defs    # draw the "TeX" definitions
<a name="IDX728"></a>make_char   # help create a new character
</pre>

<p>
file <tt>`fourier'</tt> in directory <tt>`macro'</tt>

</p><pre>#
# Macros to make dealing with complex numbers for FFT's easier
# Assumes that complex vector `name' is represented by two vectors
# called name_r and name_i
#
<a name="IDX729"></a>fft         # Direct FFT: fft name name
ifft        # Inverse FFT: ifft name name
cadd        # Add complex numbers: $1 = $2 + $3
cdiv        # Divide complex numbers: $1 = $2/$3
cmod        # Modulus: $1 = |$2|
cmult       # Multiply complex numbers: $1 = $2*$3
csub        # Subtract complex numbers: $1 = $2 - $3
imag        # Imaginary part: $1 = Im($2)
real        # Real part: $1 = Re($2)
vcentre     # shift a vector so that its 0th element appears in the middle
vcenter     # an alias for vcentre
</pre>

<p>
file <tt>`images'</tt> in directory <tt>`macro'</tt>

</p><pre><a name="IDX730"></a>entropy # Find entropy of an image
<a name="IDX731"></a>hist_equalise # Histogram equalise an image
<a name="IDX732"></a>gamma       # Gamma correct an image
</pre>

<p>
file <tt>`irregular'</tt> in directory <tt>`macro'</tt>
These macros were written by Gabor Toth, to whom many thanks. They enable
you to define an SM IMAGE from 3 vectors, (x,y) and the value z

</p><pre><a name="IDX733"></a>irregular_image # Set IMAGE from 3 vectors (x,y) and z
<a name="IDX734"></a>trigrid     # Interpolate to the regular grid
<a name="IDX735"></a>trigridtry  # Demonstrate the use of trigrid
</pre>

<p>
file <tt>`math'</tt> in directory <tt>`macro'</tt>

</p><pre>#
# Written by Daniel Pfenniger (PFENNIGER@obs.unige.ch)
# `A&amp;S' is Abramowitz &amp; Stegun
#
<a name="IDX736"></a>J0          # Bessel func. J0(|x|), A&amp;S, 9.4.1,.3
<a name="IDX737"></a>Y0          # Bessel func. Y0(|x|), |x|&gt;0, A&amp;S, 9.4.2-3
<a name="IDX738"></a>J1          # Bessel func. J1(|x|), A&amp;S, 9.4.4,.6
<a name="IDX739"></a>Y1          # Bessel func. Y1(|x|), |x|&gt;0, A&amp;S, 9.4.5-6
<a name="IDX740"></a>I0          # Modified Bessel func. I0(|x|), A&amp;S, 9.8.1-2
<a name="IDX741"></a>I1          # Modified Bessel func. I1(|x|), A&amp;S, 9.8.3-4
<a name="IDX742"></a>K0          # Modified Bessel func. K0(|x|), |x|&gt;0, A&amp;S, 9.8.5-6
<a name="IDX743"></a>K1          # Modified Bessel func. K1(|x|), |x|&gt;0, A&amp;S, 9.8.7-8
<a name="IDX744"></a>K           # Complete elliptic integral K(m), 0&lt;=m&lt;1, A&amp;S 17.3.34
<a name="IDX745"></a>E           # Complete elliptic integral E(m), 0&lt;=m&lt;=1, A&amp;S 17.3.36
<a name="IDX746"></a>fresnel     # Calculate the Fresnel integrals C, S, and F
</pre>

<p>
file <tt>`matrix'</tt> in directory <tt>`macro'</tt>

</p><pre><a name="IDX747"></a>matrix       # Introduction to matrix utilities
<a name="IDX748"></a>mdeclare     # declare $1 to be a $2x$2 square matrix	
<a name="IDX749"></a>mdimen       # print matrix $1's dimension
<a name="IDX750"></a>mprint       # print the matrix $1  (given as $1_0 $1_1 etc -- see minv)
<a name="IDX751"></a>madd         # set matrix $1 equal to $2+$3
<a name="IDX752"></a>minv         # Quick matrix inversion, done in place.
<a name="IDX753"></a>mset         # set matrix $1 equal to $2
<a name="IDX754"></a>mmult        # set matrix $1 equal to $2*$3
<a name="IDX755"></a>mmult_c      # set matrix $1 equal to $2*$3 where $3 is a scalar
<a name="IDX756"></a>mmult_v      # set vector $1 equal to $2*$3 where $3 is a vector
<a name="IDX757"></a>mmult_vT     # set vector $1 equal to $2^T*$3 where $2 is a vector
<a name="IDX758"></a>mtrans         # set matrix $1 equal to $2^T
<a name="IDX759"></a>mprint       # print the vector $1
</pre>

<p>
file <tt>`mongo'</tt> in directory <tt>`macro'</tt>
(omitting those that are simply abbreviations, like <code>ang</code>)

</p><pre><a name="IDX760"></a>da          ## set data file
<a name="IDX761"></a>dev         ## set device
dra         ## draw, accepting expressions
<a name="IDX762"></a>ecolumn     ## define vector error_col as error vector
<a name="IDX763"></a>end         ## quit, not on history
<a name="IDX764"></a>era         ## erase screen, not on history
<a name="IDX765"></a>lis         ## list history, not on history
hard        ## make a hardcopy of what you type (or get by history)
<a name="IDX766"></a>hardcopy    ## close the old device and set dev type to 0
<a name="IDX767"></a>hcopy       ## hcopy [printer] [l1] [l2]: Make hardcopy of playback buffer
<a name="IDX768"></a>hmacro      ## hmacro [macro] [printer]: make hardcopy of `macro' on `printer'
<a name="IDX769"></a>identification ## write an id to the top right hand corner of screen
<a name="IDX770"></a>input       ## execute an Mongo file
<a name="IDX771"></a>mongo       # make SM resemble Mongo as closely as possible
pcolumn     ## set point column (Mongo)
playback    ## define "all" from buffer, and run it
<a name="IDX772"></a>read_all    ## read a macro file, putting `all' onto the history buffer
<a name="IDX773"></a>read_hist   ## read history from a file
<a name="IDX774"></a>read_old    ## read an Mongo file onto the history buffer
rel         ## relocate, accepting expressions
<a name="IDX775"></a>save_all    ## write the playback list to a file (use sav instead)
terminal    ## device
<a name="IDX776"></a>toplabel    ## put label at top of plot
<a name="IDX777"></a>xcolumn     ## read a column into vector x (Mongo)
<a name="IDX778"></a>xlogarithm  ## take log of vector x (Mongo)
<a name="IDX779"></a>ycolumn     ## read a column into y
<a name="IDX780"></a>ylogarithm  ## take log of y
</pre>

<p>
 
</p><p>
file <tt>`project'</tt> in directory <tt>`macro'</tt>
Miscellaneous projections (e.g. equal area). Contributed by Michael Strauss.

</p><pre><a name="IDX781"></a>aitoff          #convert l and b to x y in Aitoff coordinates
<a name="IDX782"></a>aitoff1         # Convert l and b to x y in reverse Aitoff coordinates
<a name="IDX783"></a>aitoffdec       # Draw a line of constant declination in an Aitoff plot
<a name="IDX784"></a>aitoffdec1      # Draw a line of constant declination in a reverse Aitoff plot
<a name="IDX785"></a>aitoffgrid      # Put up equal area grid in Aitoff
<a name="IDX786"></a>aitoffgrid1     # Puts up equal area grid in Aitoff. Reverse sense
<a name="IDX787"></a>calc_lb         # Calculates r, l and b given x, y, and z
<a name="IDX788"></a>circle_exclude  # After circleplot, draws regions excluded in latitude
<a name="IDX789"></a>circlelabel     # Draw axes for a redshift circleplot
<a name="IDX790"></a>circleplot      # Plot redshift points; requires circlelabel
<a name="IDX791"></a>eqgal           # Usage: ra dec l b; Convert (ra, dec) to (l,b). 
<a name="IDX792"></a>galeq           # Usage: galeq l b ra dec. Convert (l,b) to (ra, dec)
<a name="IDX793"></a>galgrid         # Puts up equal area grid
<a name="IDX794"></a>galplot         # Usage: galplot ra dec l b
<a name="IDX795"></a>galpoints       # Plot points on an equal area grid; galpoints l b
<a name="IDX796"></a>gstrans         # Convert supergalactic to galactic coordinates
<a name="IDX797"></a>hemiconvert     # Convert from l b to x y for hemisphere plotting
<a name="IDX798"></a>hemidec         # Draw a line of constant declination on a pair of
<a name="IDX799"></a>hemiplot        # Sky plot in two hemispheres, equal area
<a name="IDX800"></a>invaitoff       # Convert x y in Aitoff coordinates to l, b
<a name="IDX801"></a>pielabel        # Draw axes for a redshift pieplot
<a name="IDX802"></a>pieplot         # Plot redshift points; requires pielabel
<a name="IDX803"></a>radtick         # Put tick marks on a radial axis
<a name="IDX804"></a>sgtrans         # Convert galactic to supergalactic coordinates
</pre>

<p>
file <tt>`stats'</tt> in directory <tt>`macro'</tt>

</p><pre><a name="IDX805"></a>cgauss      # evaluate a cumulated Gaussian distribution : N($mean,$sig)
<a name="IDX806"></a>cuniform    # evaluate a cumulated uniform distribution, $mean,$sig
<a name="IDX807"></a>chisq       # Return chi^2 distribution of vector $1 with $2 dof 
<a name="IDX808"></a>draw_KS     # Draw a cumulated curve, for looking at KS statistics
<a name="IDX809"></a>erfc        # calculate complementary error function erfc($1)
<a name="IDX810"></a>factorial   # Use Stirling's formula to calculate a factorial ($1)!
<a name="IDX811"></a>gauss       # evaluate a Gaussian : N($mean,$sig)
<a name="IDX812"></a>gaussdev    # return a N(0,1) random vector
<a name="IDX813"></a>linfit      # linear least squares fit for any number of parameters
<a name="IDX814"></a>log_fac     # Use Stirling's formula to calculate a log factorial.
<a name="IDX815"></a>lsq         # do a least squares fit to a set of vectors
<a name="IDX816"></a>lsq2        # do a least squares fit to a set of vectors, errors in x and y
<a name="IDX817"></a>prob_chisq  # probability of getting a given value of chi^2
<a name="IDX818"></a>prob_KS     # probability of getting a given value of the K-S statistic
<a name="IDX819"></a>prob_wilc   # return probability in $$2 that x exceeds $1 from Wilcoxon
<a name="IDX820"></a>rxy         # find Pearson Correlation Coefficient for two vectors 
<a name="IDX821"></a>smirnov1    # calculate 1 sided Kolmogorov-Smirnov statistic for vector
<a name="IDX822"></a>smirnov2    # calculate 2 sided Kolmogorov-Smirnov statistic for vectors
<a name="IDX823"></a>spear       # calculate Spearman rank correlation coefficient for 2 vectors
<a name="IDX824"></a>stats       # stats vector mean sigma kurtosis : calculate $mean $sigma etc
<a name="IDX825"></a>stats2      # stats vector weights mean sigma kurtosis
<a name="IDX826"></a>stats_med   # stats_med vector median SIQR : calc $median $SIQR from vector
<a name="IDX827"></a>wilcoxon    # calculate Wilcoxon statistic for 2 vectors
<a name="IDX828"></a>wlsq        # do a weighted least squares fit to a set of vectors
</pre>

<p>
file <tt>`trigd'</tt> in directory <tt>`macro'</tt>
Equivalents for all SM trig functions, taking degree arguments. Names
add an extra `d' (e.g. sind)

</p>
<p>
file <tt>`utils'</tt> in directory <tt>`macro'</tt>

</p><pre>alpha_poi   # alpha_poi x y z. Like poi x y, but use z as labels for points
<a name="IDX829"></a>arc         # the arclength along the curve ($1,$2), e.g. set v=arc(x,y)
<a name="IDX830"></a>arrow       # use the cursor to define an arrow.
<a name="IDX831"></a>barhist     # draw a bar histogram
<a name="IDX832"></a>boxit       # use the cursor to define a box, and draw it
<a name="IDX833"></a>circle      # draw a circle, centre ($1,$2) radius $3
<a name="IDX834"></a>cumulate    # find the cumulative distribution of $1 in $2
<a name="IDX835"></a>draw_arrow  # draw an arrow from ($1,$2) to ($3,$4)
<a name="IDX836"></a>draw_box    # draw a box, defined by two corners
<a name="IDX837"></a>error_x     # draw x-error bars: error x y size
<a name="IDX838"></a>error_y     # draw y-error bars: error x y size
get_hist    # get_hist input output-x output-y base top width
<a name="IDX839"></a>gauss       # evaluate a Gaussian : N($mean,$sig)
<a name="IDX840"></a>get         # syntax: get i j.  Read a column from a file
<a name="IDX841"></a>glevels     # Set grey levels. Usage: glevels expr
<a name="IDX842"></a>greyscale   # Draw a grey-scale image.
            #                    Usage: greyscale [npx npy maxweight dmargin]
<a name="IDX843"></a>info        # Get help about a command from SM's info files
<a name="IDX844"></a>interp      # Linearily interpolate $3 into ($1,$2), giving $4
<a name="IDX845"></a>interp2     # Linearily interpolate $3 into ($1,$2), giving $4
<a name="IDX846"></a>is_file     # Return true if file $1 exists
<a name="IDX847"></a>is_macro    # Return true if $1 is a macro
<a name="IDX848"></a>is_set      # define variable $$1 if the $3'rd bit is set in $2
<a name="IDX849"></a>is_vector   # Return true if $1 is a vector
<a name="IDX850"></a>logerr      # syntax: logerr x y error, where y is logged, and error isn't
<a name="IDX851"></a>mconcat     # Concatenate 2 macros, optionally renaming result
<a name="IDX852"></a>number      # convert a string vector to an arithmetic one
<a name="IDX853"></a>pairs       # pairs x1 y1 x2 y2. connect (x1,y1) to (x2,y2)
<a name="IDX854"></a>polar       # draw a circle as an `axis' for polar coordinates
<a name="IDX855"></a>pmatrix     # print the matrix $1
<a name="IDX856"></a>puts	    # Draw a line of text, then move to the start of the next line
<a name="IDX857"></a>qminv       # Quick matrix inversion, done in place
<a name="IDX858"></a>repeated    # Return an array that is true for repeated elements in $1
<a name="IDX859"></a>reverse     # reverse the order of a vector
<a name="IDX860"></a>save_vec    # put the definition of a vector onto the history list
<a name="IDX861"></a>set_window  # cycle through all available windows
<a name="IDX862"></a>shade_box   # shade a box, spacing $1, defined by two corners
shed        # shade region between x y and x2 y2 with n lines
<a name="IDX863"></a>simp        # Simpson's rule integration: simp answer x y
<a name="IDX864"></a>smooth      # boxcar smooth a vector
<a name="IDX865"></a>smooth2     # smooth a vector with a given filter
<a name="IDX866"></a>smooth3     # smooth a vector with a given filter omitting points
<a name="IDX867"></a>2dhistogram # convert the current image to a 2-d histogram
<a name="IDX868"></a>thin        # create a "thinned" version of a vector for plotting points
<a name="IDX869"></a>thin2       # "thin" the end of a vector
<a name="IDX870"></a>thin3       # "thin" the central portion of a vector
<a name="IDX871"></a>uniq        # Remove duplicate elements of $1, e.g. u = uniq(x)
<a name="IDX872"></a>upper       # define a variable giving an `upper limit' symbol
<a name="IDX873"></a>vecminmax   # find the minimum and maximum of a vector
<a name="IDX874"></a>vfield      # plot a vector field: vfield x y len angle
<a name="IDX875"></a>vfield2      # plot a vector field, vfield x y len angle (len in x-axis units)
<a name="IDX876"></a>vfield3      # plot a vector field: vfield x y len angle (len in y-axis units)
<a name="IDX877"></a>vfield4      # Vector field at points x, y; components vx vy
<a name="IDX878"></a>vfield5      # Vector field at points x, y; components vx vy scaled by f
</pre>



<h2><a name="SEC64" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC64">Tips for Mongo Users</a></h2>


<h3><a name="SEC65" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC65">Differences from Mongo</a></h3>
<p>
SM differs in a number of ways from Mongo, and these fall
into three groups: those which are enhancements, those which are
generalisations, and those which are simply incompatibilities. We do not feel
that there is a fourth group for
degradations.  For those users of Mongo intimidated by change, we note that
in most cases it is possible to ignore the enhancements
by using a macro presented in the next section. This macro redefines
commands to reproduce the old syntax; for example
<code>limits</code> is defined to mean <code>LIMITS x y</code>. It is also possible to read
Mongo files using the <code>READ OLD</code> command, and the macros
<code>input</code> and <code>read_old</code> based upon it. The following list
of enhancements in not complete; See the distribution notes from the
current release of SM.

</p>
<p>
Enhancements:

</p><pre>  Any number of vectors may be defined.
  Vectors may be manipulated arithmetically.
  Vectors are named.
  Vectors may be defined from the keyboard using <code>DO</code> loops or expressions.
  Vectors may be defined using the cursor.
  Any vector may be used for plotting.
  Any vector may be used for the <code>PTYPE</code> or <code>ERRORBAR</code> commands.
  A history feature is implemented.
  The playback buffer may be edited.
  Macros may be defined from the keyboard, and edited.
  A <code>DO</code> construct is available.
  A <code>FOREACH</code> construct is available.
  Character strings may be read from a file and used freely as labels or names.
  Data may be read from rows as well as columns in files.
  Only those parts of a vector satisfying a logical condition need be plotted.
  Vectors may be sorted or fit with splines.
  Macros exist for doing least square fit to sets of points,constructing
  cumulative distributions and histograms, drawing circles, and shading regions.
  All devices have the same range of device coordinates, 0-32767.
  The entire SM environment may be saved for later resumption with <code>SAVE</code>
  and <code>RESTORE</code>.
  The special variable <code>$date</code> expands to the current date and time.
  You can define private point types.
</pre>

<p>
There are also a few incompatibilities:

</p><pre>  <code>DEFINE</code> is used to define <em>variables</em>; <em>macros</em> are defined
  using <code>MACRO</code>.
  Macro arguments must be declared, and are referred to as <code>$n</code>,
  not <code>&amp;n</code>.
  The form <code>LIMITS</code> is not supported (it's meaningless); use
  <code>LIMITS x y</code>, or the macro <code>lim</code>, mentioned above.
  (But note that <code>READ OLD</code> allows for these, and makes suitable changes.)
  <code>WINDOW</code> now takes 4 arguments.
</pre>



<h3><a name="SEC66" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC66">The READ OLD command</a></h3>
<p>
<code>READ OLD</code> reads a Mongo file, converts its contents to a form
acceptable to SM, and defines them as a macro.
Any macro definition (i.e. from a line beginning <code>def</code> to
a line beginning <code>end</code>) is converted to the SM form (i.e.
<tt>`$s'</tt> not <tt>`&amp;s'</tt>) and defined.  The commands CONNECT,
HISTOGRAM, LIMITS, and POINTS are converted to LIMITS x y, and so
forth. ERRORBAR, ECOLUMN, and WINDOWS are also converted. READ OLD
will fail if the Mongo file contains abbreviations such as xc for XCOLUMN,
then your only hope is to define the same abbreviations. In many cases this
will have already been done, for instance <code>xc</code> expands to <code>read x </code>.
Comments (beginning !) are optionally converted to standard
SM
# comments (depending on how the file <tt>`read_old.c'</tt> was compiled.)

</p>
<p>
Note that it is advisable to convert these old Mongo macro files to
SM macros, to enable you to take advantage of SM's
features. You can do this by simply using READ OLD to read them into
SM, and then MACRO WRITE or SAVE to write the converted macro out to
disk.

</p>
<p>
There is also a macro equivalent of the old <code>INPUT</code> command.

</p>

<pre>input     1     ## read and execute a Mongo (not SM) file
                READ OLD _temp $1
                _temp
                MACRO _temp DELETE
</pre>



<h3><a name="SEC67" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC67">The compatibility macro</a></h3>

<p>
This version of compatibility is more complete than in pre-version 2
SM, it also conflicts more strongly with normal SM operations.
<a name="IDX879"></a>

</p>
<p>
The macro <code>compatibility</code> defines mimics for the Mongo commands
which assume that the only vectors are <code>x</code> and <code>y</code>. We
strongly recommend that you do <em>not</em> use this macro! If you want
to use it anyway, commands like <code>limits alpha beta</code> will give
syntax errors. You can turn compatibility mode off again with <code>compatibility 0</code>. The macro itself is a little complicated, it turns
off the special meaning of (e.g.) <code>limits</code>, and replaces it with a
macro that reproduces the old behaviour, in this case <code>LIMITS x
y</code>. The new definitions are in the file <tt>`compatible'</tt> in the
default macro directory, as specified in your <tt>`.sm'</tt> file. At
the time of writing, the commands <code>connect</code>, <code>errorbar</code>, <code>histogram</code>, <code>limits</code>, <code>list</code>, <code>points</code>, <code>read</code>, and
<code>window</code> are redefined to reproduce the old syntax. In addition,
<code>help</code> is defined to not appear on your history buffer, and <code>define</code> is defined to create macros interactively. You might also be
interested in other redefinitions of commands (e.g. <code>list</code> to mean
list the playback buffer), if so look at `overloading' in the index.
It should be clear
that this set of definitions could thoroughly confuse SM if
you try to take advantage of its features; in the realm of
compatibility mode, it is strictly <em>caveat emptor</em>.

</p>

<pre>compatible 11   ## define macros to be compatible with Mongo
                # If the argument is non-zero or omitted, 
                # compatibility mode is turned on.
                # note that some of these make it hard to use regular SM!
                if($?1 == 0) {
                   compatible 1
                   RETURN
                }
                if($1 == 0) { 
                   MACRO DELETE "$!macro"compatible
                }
                FOREACH w { connect define errorbar help histogram limits \
                       list points read window write } {
                   OVERLOAD $w $1
                }
                if($1) {
                   MACRO READ "$!macro"compatible
                }
                #               So newline will end IF statement
</pre>



<h2><a name="SEC68" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC68">SM's Fonts</a></h2>
<p>
<a name="IDX880"></a>
<a name="IDX881"></a>
<a name="IDX882"></a>
These are a sub-set of the well-known Hershey fonts<a name="DOCF36" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT36">(36)</a>
and the available characters are listed in the following table, which
were generated from within SM by saying <code>load fonts fonts</code>.

</p>
<p>
For details on SM's implementation of TeX and the `traditional' style
see the section in the
main body of this manual (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC14">Drawing Labels and SM's TeX Emulation</a>).

</p>
<p>
The characters in a font are specified using a programme <code>read_fonts</code>
which you can use to make binary font files from the list of
Hershey characters, using an index file to specify what character
should go where. The binary fonts file also specifies which TeX
`definitions' are available (e.g. <code>\alpha</code>). The first 4 bytes
of the file are an integer (in binary) that specifies the format of
the file; when the format is changed in an incompatible way this number
if changed and you will have to rebuild your font files (`make fonts').

</p>
<p>
The default font table is
illustrated at the end of this appendix. Which font file you want to
use is specified as the <code>fonts</code> entry in your
<tt>`.sm'</tt> file.<a name="DOCF37" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#FOOT37">(37)</a>. 
<a name="IDX883"></a>
<a name="IDX884"></a>
The <code>fonts.bin</code> fonts have been cleaned up a bit for version 2.0
of SM, although the
order of characters in the greek and roman fonts is unchanged. There
is a new font, `Old English' or \o or \oe, and a good number of new
characters are provided. Neither of these fonts supports the `private'
fonts, that is there in case users desperately need something,
when they can make their own binary font file. For example, there is a
set of Hershey oriental fonts that can be used to help SM write Japanese
(see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC69">Using SM to write Japanese</a>).

</p>
<p>
The complete list of (occidental) Hershey
characters is given in a file called <code>hershey_oc.dat</code>, and is in
the public domain. Each character is specified by a number in the
first 5 columns, then a number of strokes in the next 3, then pairs of
letters in the remaining columns up to 72, and in as many 72 character
lines as are needed. (Annoyingly, if a line consists of exactly 72
characters, the next must be left blank).
Each pair of characters consists of a coordinate,
with the origin at (R,R), and the y axis pointing <em>down</em>.
A ` ' indicates that the next point is a move, otherwise just
connect the dots. The very first pair is different, as it specifies
the left and right spacing for the character. If this isn't clear, try
drawing a few characters on graph paper, character 2001 (roman A) for example.
There are a few characters that have
traditionally been available in Mongo that are not in the Hershey set,
these have been added to the end of the <tt>`hershey_oc.dat'</tt> file, plus a
few that we thought deserved adding.

</p>
<p>
If you want to create your own characters, the macro <code>make_char</code> in
<tt>`fonts'</tt> (i.e. <code>load fonts make_char</code>) might help. It uses the
cursor to make a string that is (nearly) in the correct form for
inclusion in <tt>`hershey_oc.dat'</tt>

</p>
<p>
The programme <code>read_fonts</code> reads this file,
<a name="IDX885"></a>
an `index' file that specifies the characters to be put into the
fonts, and a list of TeX definitions. The index file consists of
character numbers, or ranges 
consisting of two numbers separated by a minus sign. Comments go from
the character # to end of line. Each font consists of 96 characters
in ascii order, and fonts appear in the index in the order
rm, gr, sc, ti, oe, and then the various private fonts (privateA, privateB,
..., privateG.).
<a name="IDX886"></a>
You can also use <code>cat_fonts</code> to concatenate
binary font files prepared with <code>read_fonts</code>.

</p>
<p>
The format of the TeX definition file
is that each definition has a line to itself, lines starting with a
# are comments. A line consists of a name, some whitespace, the number
of arguments (optional, defaults to zero), the name
of the font to use, a single white-space character, and the value of
the definition to the end of the line; you can continue onto another line
by putting a <code>\</code> at the end of the line. You can use any of the normal
font specifications, or <code>cu</code> which means use the current font.

</p>
<p>
For example

</p><pre>alpha        gr a
alsoalpha  0 cu \gr a
alphatoo   1 gr \#1a
</pre>

<p>
defines <code>\alpha</code> the conventional way as the character <code>a</code>
in the greek font, then defines <code>alsoalpha</code> in a less efficient
way (by specifying the current font, then explicitly switching to
greek), then defines <code>alphatoo</code> as a large
, used as <code>\alphatoo5</code>. There's no reason
why your definitions can't be reasonably complicated, see for example
the definition of <code>\TeX</code>.

</p>
<p>
If the
number of arguments is given as -1 the TeX symbol will be interpreted as
an alias for the specified font, for example the TeX definition file begins

</p><pre>katakana -1 privateA
hiragana -1 privateB
</pre>

<p>
to make <code>\katakana</code> change to the <code>privateA</code> font.

</p>
<p>
The main Makefile prepares your binary font file for you. There is also
a programme <code>cat_fonts</code> that can be used to concatenate two or more
binary fonts files; an example is given in the section on Japanese fonts
(section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC69">Using SM to write Japanese</a>).

</p>

<p>
It is also possible to
build SM fonts for other languages:

</p><ul>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC69">Japanese</a>: Using SM to write Japanese
</li></ul>



<h2><a name="SEC69" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC69">Using SM to write Japanese</a></h2>

<p>
SM is currently able to use either katakana or hiragana fonts, but no kanji
are yet supported. The order of characters in the fonts is likely to change,
based on the desires of the users. Please let me know what you want.

</p>
<p>
As distributed, the Japanese font tables aren't built. To make them, say
<code>make jfonts.bin</code> in the toplevel SM directory, and ensure that your
<tt>`.sm'</tt> file sets <code>fonts</code> correctly. The Japanese characters are
available as <code>\hiragana</code> and <code>\katakana</code>. You can list the characters
available with <code>load fonts jTeX_fonts</code>.

</p>
<p>
One question is whether <code>\katakana 2</code> should print an Arabic (western)
or a Japanese two; I am open to suggestions.

</p>
<p>
There are a variety of kanji characters present, but no easy way to
select them. If someone would like to donate a table of the
correspondence between some accepted ascii encoding and the available
characters, I will ensure that the character encoded as <code>AB</code> os
available as (say) <code>\kanjiAB</code>, and provide a programme to
generate such codes from the output of at least one popular word
processor, expecting the user to cut-and-paste the result.  Of course,
it'd be quicker if you did it for me!

</p>


<h1><a name="SEC70" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC70">General Index</a></h1>

<p>
There is a separate index for graphcap capabilities, see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC47">Index to Graphcap Capabilities</a>.

</p>
<p>
</p><h2>.</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX39">.sm</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX378">.sm concatenating values with +</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX43">.sm omitting your ~/.sm</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX44">.sm search path</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX377">.sm stopping search for a variable with @</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX42">.sm using someone else's</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX340">.sm, background</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX223">.sm, default_font</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX306">.sm, default_font</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX84">.sm, defining variables</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX670">.sm, file_type</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX46">.sm, fonts</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX884">.sm, fonts</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX341">.sm, foreground</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX48">.sm, graphcap</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX51">.sm, help</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX108">.sm, history</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX66">.sm, history file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX128">.sm, history_char</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX52">.sm, macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX54">.sm, name</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX237">.sm, overload</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX231">.sm, printer</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX232">.sm, PRINTER</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX467">.sm, prompt</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX468">.sm, prompt2</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX111">.sm, remember_history_line</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX205">.sm, save_file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX140">.sm, SHELL</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX56">.sm, specified on command line</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX116">.sm, tabsize</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX151">.sm, tabsize</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX134">.sm, term</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX221">.sm, TeX_strings</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX15">.sm, traceback</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX677">.sm, ttybaud</a>
</li></dir>
<h2>2</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX668">2-dimensional graphics</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX313">2-dimensional graphics, contour</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX414">2-dimensional graphics, contour levels</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX295">2-dimensional graphics, cross section</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX371">2-dimensional graphics, dither</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX672">2-dimensional graphics, file format</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX669">2-dimensional graphics, file_type</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX402">2-dimensional graphics, image</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX406">2-dimensional graphics, manipulating</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX867">2dhistogram, 2-d histogram from image</a>
</li></dir>
<h2>3</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX360">3B1 device driver</a>
</li></dir>
<h2>a</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX546">abort, catching errors</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX544">aborting a command</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX256">aborting a plot</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX781">aitoff, convert l,b to Aitoff x,y</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX782">aitoff1, convert l,b to reverse Aitoff x,y</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX783">aitoffdec, Draw line of constant dec</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX784">aitoffdec1, draw line of constant dec</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX785">aitoffgrid, Aitoff equal area grid</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX786">aitoffgrid1, rev. Aitoff equal area grid</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX132">alphanumeric, see terminal</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX170">apropos, examples</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX829">arc, arclength along curve</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX291">arithmetic operators</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX830">arrow, draw arrow with cursor</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX472">ascii labels</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX300">axes, drawing</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX304">axes, drawing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX305">axes, font used</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX393">axes, grid</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX391">axes, label format</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX541">axes, logarithmic</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX540">axes, tick spacing</a>
</li></dir>
<h2>b</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX831">barhist, draw bar histogram</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX687">batch, run the history buffer</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX67">batch, running SM in</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX688">bell, ring bell</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX123">bindings, names of operators</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX296">binning, see histogram</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX569">bison's copyright notice</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX347">borland graphics</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX832">boxit, draw box with cursor</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX186">break, exiting while loops</a>
</li></dir>
<h2>c</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX657">C interface to SM</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX486">caching the read pointer</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX530">caching the read pointer</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX689">calc, evaluate an expression</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX787">calc_lb, find r, l, b given x, y, z</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX656">calling SM</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX666">calling SM, 2-D example</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX664">calling SM, 2-D function definitions</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX661">calling SM, example</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX663">calling SM, function definitions</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX660">calling SM, Libraries</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX38">case sensitivity</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX886">cat_fonts</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX690">cd, change directories</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX805">cgauss, cumulated Gaussian</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX142">changing directory</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX309">changing directory</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX120">changing key bindings</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX234">changing meanings of commands</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX383">character size</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX807">chisq, return chi^2 distribution of vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX833">circle, draw a circle</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX788">circle_exclude, draw excluded regions</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX789">circlelabel, Draw axes for a circleplot</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX790">circleplot, redshift points in circleplot</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX555">classifying strings</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX642">color, graphcap entry</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX318">color, see also ctype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX316">color, used in plotting</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX641">colour, graphcap entry</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX317">colour, see also ctype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX315">colour, used in plotting</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX397">command history</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX650">command line, -f and -u options ignored</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX64">command line, commands</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX55">command line, environment file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX68">command line, logfile</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX62">command line, macro files</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX70">command line, no startup macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX41">command line, other user</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX69">command line, quiet</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX57">command line, specifying .sm file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX71">command line, stupid</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX75">command line, suppress echo</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX72">command line, verbose</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX73">command line, version number</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX479">comments in data files</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX161">comments in macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX172">comments, in macro files</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX879">compatibility with Mongo</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX691">compatible, macros compatible with Mongo</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX210">concatenate</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX293">concatenate</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX26">continuing long lines</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX686">cover, draw the cover</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX722">ctype, example of setting 256 colours</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX321">ctype, getting values and names</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX834">cumulate, find cumulative distribution</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX806">cuniform, cumulated uniform distribution</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX143">current directory</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX310">current directory</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX638">cursor, graphcap</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX241">customising SM</a>
</li></dir>
<h2>d</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX760">da, set data file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX692">declare, declare a vector $1</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX682">default arguments for DEVICE</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX379">default_font</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX693">del, delete last command</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX694">del1, don't save on history</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX163">delete, macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX761">dev, set device</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX646">device, adding new ones</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX681">device, adding new ones</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX346">device, borland</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX345">device, nodevice</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX348">device, postscript</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX338">device, saving output to a file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX350">device, sgi</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX352">device, stdgraph</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX357">device, sunview</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX355">device, sunwindows</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX363">device, Unix PC</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX364">device, Xwindows</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX549">diagnostics, verbose</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX183">do loops</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX184">do, avoiding do loops</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX576">do, foreach, and if, implementation</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX665">double precision</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX29">double quote</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX835">draw_arrow, draw an arrow</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX836">draw_box, draw a box</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX808">draw_KS, Draw a cumulated curve</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX301">drawing ticks <em>outside</em> the box</a>
</li></dir>
<h2>e</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX745">E, Complete elliptic integral</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX695">echo, write to terminal</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX762">ecolumn, make error_col error vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX696">ed, edit a macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX115">edit, bindings</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX119">edit, bindings</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX127">edit, bindings</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX114">edit, commands</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX537">edit, cursor being weird</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX181">edit, editing a macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX118">edit, escaping</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX113">edit, history</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX124">edit, names of operators</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX678">edit, padding</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX536">edit, size of screen</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX130">edit, termtype</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX533">edit, termtype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX697">edit_all, edit history buffer</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX698">emacs_all, edit history w. system editor.</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX763">end, quit</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX730">entropy, find entropy of an image</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX40">environment file, see .sm</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX791">eqgal, convert (ra, dec) to (l,b).</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX764">era, erase screen</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX442">erase, erasing lines</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX809">erfc, calculate erfc</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX699">error_handler, Handle interrupts</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX837">error_x, draw x-error bars</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX838">error_y, draw y-error bars</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX10">errors, handler for</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX667">example, calling 2-D SM</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX662">example, calling SM</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX171">examples, apropos</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX3">examples, basic</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX674">examples, filecap</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX239">examples, macros</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX249">examples, macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX4">examples, parabola</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX700">execute, read and execute commands</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX475">exiting SM, quit</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX440">expand, line style</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX701">extend_history, Extend history buffer</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX109">extending history buffer</a>
</li></dir>
<h2>f</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX810">factorial, calculate a factorial</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX729">fft, see macro file fourier</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX671">file_type</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX673">filecap, definition</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX825">find mean sigma ...</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX403">FITS, file_type</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX572">floats as words</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX47">fonts, .sm</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX883">fonts, .sm</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX880">fonts, available characters</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX881">fonts, choice</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX726">fonts, draw the font table</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX882">fonts, hardware character sets</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX702">for, C's for(;;) (see also while)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX188">foreach loops</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX389">foreach, element in a vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX658">fortran interface to SM</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX746">fresnel, Fresnel integrals</a>
</li></dir>
<h2>g</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX792">galeq, Convert (l,b) to (ra, dec)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX793">galgrid, Puts up equal area grid</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX794">galplot, Usage: galplot ra dec l b</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX795">galpoints, points on an equal area grid</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX732">gamma, gamma correct an image</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX839">gauss, evaluate a Gaussian</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX811">gauss, evaluate Gaussian</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX723">gauss_convolve, convolve 2 Gaussians</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX812">gaussdev, make N(0,1) variate</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX840">get, Read column from file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX323">GIN terminators</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX639">GIN terminators</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX841">glevels, Set grey levels</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX252">glossary</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX247">good advice</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX505">good ideas</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX568">grammar tokens</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX577">grammar, examples</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX81">grammar, variables</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX578">grammar, verbose debugging</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX49">graphcap, .sm</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX354">graphcap, adding a local device</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX654">graphcap, compiling</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX579">graphcap, description</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX582">graphcap, entering nul</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX655">graphcap, index</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX644">graphcap, modifying an entry</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX353">graphcap, overriding on command line</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX581">graphcap, overriding with private file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX647">graphcap, raster devices</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX580">graphcap, search path</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX645">graphcap, writing a new entry</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX724">grey_sincos, draw a grey scale image</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX842">greyscale, Draw grey-scale image.</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX703">gripe, complain to Robert</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX796">gstrans, supergalactic to galactic coords</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX559">gutters between windows</a>
</li></dir>
<h2>h</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX12">handler, see errors</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX230">hardcopy</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX766">hardcopy, close old device</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX6">hardcopy, example</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX453">hardcopy, using a metafile</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX767">hcopy, hardcopy of playback buffer</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX704">head, print the top of a file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX194">help</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX260">help (see also apropos)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX50">help, .sm</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX148">help, macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX196">help, variable</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX198">help, vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX797">hemiconvert, l b to x y for hemisphere</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX798">hemidec, line of dec on hemispheres</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX799">hemiplot, equal area plot, two hemispheres</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX731">hist_equalise, histogram equalise an image</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX250">histogram, binned from vector</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX297">histogram, binned from vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX129">history, changing character</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX177">history, converting to a macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX104">history, deleting commands</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX112">history, editor</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX110">history, extending buffer</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX100">history, introduction</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX101">history, listing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX103">history, listing backwards</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX107">history, number remembered</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX102">history, re-using commands</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX179">history, reading from a macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX705">hm, help with edited macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX768">hmacro, hardcopy of macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX706">hv, help with variable</a>
</li></dir>
<h2>i</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX326">I/O commands, data</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX740">I0, Modified Bessel function</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX741">I1, Modified Bessel function</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX769">identification, write id to plot</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX190">if statements</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX405">IMAGE, converting too and from vectors</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX410">IMAGE, defining header values</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX409">IMAGE, headers</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX407">IMAGE, manipulating</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX408">IMAGE, writing out</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX404">images, made from vectors.</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX843">info, help from info</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX58">initialisation, see startup</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX570">input character processing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX770">input, execute an Mongo file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX707">insert, insert text after line</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX482">integer vectors, reading</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX302">internal variable, label_offset</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX333">internal variables, accessing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX258">internal variables, angle</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX264">internal variables, aspect</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX320">internal variables, ctype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX334">internal variables, date</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX141">internal variables, exit_status</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX385">internal variables, expand</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX416">internal variables, fx1, fx2, fy1, fy2</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX434">internal variables, gx1, gx2, gy1, gy2</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX422">internal variables, listing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX443">internal variables, ltype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX446">internal variables, lweight</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX265">internal variables, nx</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX266">internal variables, ny</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX470">internal variables, ptype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX226">internal variables, sdepth sheight slength</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX489">internal variables, uxp,uyp</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX551">internal variables, verbose</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX490">internal variables, xp,yp</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX844">interp, linearily interpolate</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX845">interp2, linearily interpolate</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX18">interrupts</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX800">invaitoff, convert Aitoff x, y to l, b</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX733">irregular_image, Set IMAGE from x,y and z</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX846">is_file, does file exist?</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX847">is_macro, is a name a macro?</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX848">is_set, is a bit set?</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX849">is_vector, is a name a vector?</a>
</li></dir>
<h2>j</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX736">J0, Bessel function</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX738">J1, Bessel function</a>
</li></dir>
<h2>k</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX744">K, Complete elliptic integral</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX742">K0, Modified Bessel function</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX743">K1, Modified Bessel function</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX121">key bindings, changing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX182">key, defining keyboard macro</a>
</li></dir>
<h2>l</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX584">labels partly in different fonts</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX263">labels, aspect ratio</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX399">labels, identification</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX229">labels, partly in different fonts</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX344">landscape plots</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX342">line drawing on a new device</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX319">line drawing, colours</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX439">line drawing, line style</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX445">line drawing, line weight</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX813">linfit, least squares fit for n parameters</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX765">lis, list history</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX91">listing variables</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX122">listing, key bindings</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX147">listing, macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX218">listing, vectors</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX708">load, load macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX709">load2, load user macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX329">local, variables</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX426">local, variables and vectors</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX500">local, vectors</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX814">log_fac, calculate a log factorial</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX542">logarithmic, axes</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX5">logarithmic, getting nice axes</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX850">logerr, logarithmic error bars</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX27">long lines, continuing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX193">loops</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX106">lost commands</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX246">lost commands</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX710">ls, list macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX711">lsm, list macros in a default file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX815">lsq, least squares fit</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX816">lsq2, least squares fit</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX712">lsv, list variables</a>
</li></dir>
<h2>m</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX449">macro, variable number of arguments</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX53">macros, .sm</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX149">macros, arguments</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX160">macros, comments</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX150">macros, defining</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX162">macros, deletion</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX152">macros, disk format</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX180">macros, editing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX157">macros, error handler</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX11">macros, error_handler</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX245">macros, examples</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX248">macros, examples</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX176">macros, from history list</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX145">macros, help</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX164">macros, help</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX575">macros, implementation</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX144">macros, introduction</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX685">macros, libraries</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX146">macros, listing</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX165">macros, listing</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX421">macros, listing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX156">macros, not found</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX166">macros, not listing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX155">macros, read rest of line</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX167">macros, reading from disk</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX493">macros, returning from</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX7">macros, saving</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX201">macros, saving to disk</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX191">macros, tail recursion</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX178">macros, to history list</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX16">macros, traceback</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX175">macros, undefining sets</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX153">macros, usage</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX684">macros, useful</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX154">macros, variable number of arguments</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX173">macros, writing to disk</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX751">madd, add matrices</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX728">make_char, help create new char</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX747">matrix, Introduction to matrix utilities</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX851">mconcat, Concatenate 2 macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX748">mdeclare, declare a square matrix</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX749">mdimen, print a matrix's dimension</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX452">Metafiles</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX487">metafiles, playing back.</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX752">minv, invert a matrix</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX754">mmult, multiply a matrix by a matrix</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX755">mmult_c, multiply a matrix by a constant</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX756">mmult_v, multiply a matrix by a vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX757">mmult_vT, multiply vector^T by a matrix</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX643">modifying a graphcap entry</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX771">mongo, make SM resemble Mongo</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX640">mouse buttons</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX750">mprint, print a matrix</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX753">mset, set a matrix equal to another</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX758">mtrans, transpose a matrix</a>
</li></dir>
<h2>n</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX211">number, as a string</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX852">number, convert strings to numbers</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX571">numbers as words</a>
</li></dir>
<h2>o</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX233">overload</a>
</li></dir>
<h2>p</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX195">paging through lists</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX853">pairs, connect (x1,y1) to (x2,y2)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX206">panic save file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX253">parenthesised expression</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX574">peculiarities of the grammar</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX801">pielabel, Draw axes for a redshift pieplot</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX802">pieplot, Plot redshifts in pieplot</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX448">plot macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX562">plot macros, writing to history list</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX433">plot size, how to change</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX557">plot size, plot window</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX255">plot, aborting</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX337">plotting devices, see device</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX855">pmatrix, print the matrix $1</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX459">points, plotting</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX384">points, size</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX854">polar, draw `axis' for polar coords</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX683">porting to new machines</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX343">portrait plots</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX349">postscript graphics</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX294">precedence of arithmetical operators</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX526">precedence of string operators</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX437">precedence, logical operators</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX243">private initialisation</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX817">prob_chisq, probabilities for chi^2</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX818">prob_KS, probabilities for K-S</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX819">prob_wilc, probability for Wilcoxon</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX74">prompt, suppressing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX856">puts, Draw a line of text</a>
</li></dir>
<h2>q</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX713">q, check, then quit</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX857">qminv, Quick matrix inversion</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX8">quit</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX34">quoting, "double quotes"</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX33">quoting, 'single quotes'</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX35">quoting, &lt;angle brackets&gt;</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX36">quoting, {curly brackets}</a>
</li></dir>
<h2>r</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX803">radtick, put tick marks on a radial axis</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX502">Random numbers, setting seed</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX651">raster, adding new devices</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX648">raster, graphcap support</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX652">raster, writing data in hex</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX649">rasterise, description</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX653">RD=hex</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX168">read, macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX772">read_all, read file including history</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX885">read_fonts</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX773">read_hist, read history from file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX774">read_old, read an Mongo file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX98">reading named vectors</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX484">reading vectors from many columns</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX858">repeated, find repeated elements</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX1">Reporting Bugs</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX2">Requesting Features</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX714">reset_ctype, Reset the default ctypes</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX204">restore</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX859">reverse, reverse a vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX820">rxy, Pearson Correlation Coefficient</a>
</li></dir>
<h2>s</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX715">sav, save to a file $1</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX200">save</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX775">save_all, write history to file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX485">save_read_ptr</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX529">save_read_ptr</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX860">save_vec, save a vector on history</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX339">saving device output to a file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX441">scaling, line style</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX427">scope, restriction for variables</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX428">scope, restriction for vectors</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX501">scope, restriction for vectors</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX133">screen, see terminal</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX680">scrolling, graph disappears off screen</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX861">set_window, cycle through all WINDOWs</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX351">sgi graphics</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX804">sgtrans, galactic to supergalactic coords</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX510">shade surprises</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX862">shade_box, shade a box</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX509">shading regions</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX139">shell escape</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX716">show, show current values</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX863">simp, Simpson integration</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX31">single quote</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX821">smirnov1, 1 sided K-S statistic</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX822">smirnov2, 2 sided K-S statistic</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX864">smooth, boxcar smooth</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX865">smooth2, smooth a vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX866">smooth3, smooth a vector (omitting points)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX45">SMPATH variable</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX558">spacing between windows</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX823">spear, Spearman correlation coefficient</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX480">special characters, !</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX30">special characters, "</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX23">special characters, #</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX478">special characters, #</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX22">special characters, $</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX32">special characters, '</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX251">special characters, []</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX25">special characters, \</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX24">special characters, ^</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX28">special characters, arithmetic</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX460">special symbols, plotting</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX169">startup macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX61">startup, command line</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX59">startup, <code>default</code> macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX65">startup, history file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX60">startup, macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX244">startup, private macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX717">startup, startup macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX238">startup, system initialisation macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX242">startup2, private startup macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX824">stats, calculate mean sigma ...</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX826">stats_med, find median SIQR</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX523">string operators</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX331">string vectors into variables</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX506">string vectors, declaring</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX436">string vectors, if tests</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX471">string vectors, ptypes</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX483">string vectors, reading</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX507">string vectors, setting elements</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX573">strings, preserving quotes</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX465">strings, printing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX565">strings, printing formatted</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX324">sun cursor</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX359">sun, device drivers</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX725">sundial, draw a sundial</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX358">sunview graphics</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX356">sunwindows graphics</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX13">syntax error</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX545">syntax error, deliberate</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX550">syntax error, tracking down</a>
</li></dir>
<h2>t</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX531">table, formats</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX676">termcap, description of file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX534">termcap, used by termtype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX675">terminals, description for SM</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX136">terminals, graph scrolling off screen</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX535">terminals, setting terminal type</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX135">terminals, specifying screen size</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX131">termtype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX227">TeX, caveats</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX224">TeX, definitions</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX225">TeX, extensions</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX222">TeX, using in labels</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX727">TeX_defs, draw "TeX" defs</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX262">text plotting, aspect ratio</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX868">thin, make sparse version of a vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX869">thin2, "thin" the end of a vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX870">thin3, "thin" central portion of a vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX776">toplabel, put label at top of plot</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX17">traceback on error</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX734">trigrid, Interpolate to the regular grid</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX735">trigridtry, Demonstrate the use of trigrid</a>
</li></dir>
<h2>u</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX718">undef, undefine a variable</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX330">undefining variables</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX719">undo, erase lines</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX871">uniq, remove duplicates from a vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX361">Unix-PC device driver</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX720">unload, forget macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX721">unset, delete a vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX362">upc device driver</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX872">upper, get `upper limit' symbol</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX37">uppercase, making SM understand</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX547">user abort, catching</a>
</li></dir>
<h2>v</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX78">variables from keyboard</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX86">variables, accessing internal</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX332">variables, accessing internal</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX96">variables, are not vectors</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX94">variables, concatenation</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX328">variables, defining</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX82">variables, deletion</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX93">variables, forcing expansion</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX85">variables, from .sm</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX89">variables, from data files</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX88">variables, from internal values</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX197">variables, help</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX76">variables, introduction</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX90">variables, listing</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX420">variables, listing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX99">variables, local</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX424">variables, local</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX240">variables, mlist</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX202">variables, saving to disk</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX83">variables, special values</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX77">variables, syntax</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX159">variables, temporary</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX87">variables, testing if defined</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX80">variables, use</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX92">variables, within double quotes</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX873">vecminmax, min. and max. of vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX386">vector field</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX97">vectors, are not variables</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX292">vectors, arithmetic</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX214">vectors, assignment</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX212">vectors, concatenating</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX216">vectors, conditional assignment</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX525">vectors, converting string to arithmetic</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX215">vectors, declaring</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX498">vectors, defining</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX208">vectors, examples</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX298">vectors, extract histogram</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX199">vectors, help</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX217">vectors, help</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX207">vectors, introduction</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX219">vectors, listing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX425">vectors, local</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX499">vectors, local</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX213">vectors, macro as function</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX209">vectors, operators</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX462">vectors, printing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX203">vectors, saving to disk</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX513">vectors, sorting</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX481">vectors, specifying types</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX515">vectors, spline fitting</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX524">vectors, string</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX79">verbose, variables</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX874">vfield, plot a vector field</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX875">vfield2, plot a vector field (x-units)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX876">vfield3, plot a vector field (y-units)</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX877">vfield4, Vector field vx vy at x, y</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX878">vfield5, Scaled Vector field vx vy at x, y</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX138">VMS, DCL escape</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX63">VMS, foreign command</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX19">VMS, keybindings</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX125">VMS, keybindings</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX659">VMS, names of callable functions</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX21">VMS, quotas</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX20">VMS, spawned processes</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX759">vprint, print a vector (like mprint)</a>
</li></dir>
<h2>w</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX538">weird, alpha cursor being</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX679">weird, alpha cursor being</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX137">weird, behaviour of alpha cursor</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX117">weird, behaviour of keys</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX126">weird, behaviour of keys</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX228">weird, Can't enter superscripts</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX9">weird, can't get prompt</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX95">weird, can't get prompt</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX235">weird, commands misbehave</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX236">weird, commands redefined</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX189">weird, delete in foreach</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX583">weird, graphcap eats a \377</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX431">weird, local vector doesn't exist</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX504">weird, local vector doesn't exist</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX494">weird, losing ends of macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX495">weird, losing hardcopies</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX158">weird, lost arguments to macros</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX105">weird, lost commands</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX450">weird, variable number of macro arguments</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX417">weird, won't plot log axes</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX430">weird, wrong local variable</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX429">weird, wrong local vector</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX503">weird, wrong local vector</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX14">weird, wrong macro in message</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX185">while loops</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX192">while loops</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX187">while loops, exiting</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX827">wilcoxon, Wilcoxon statistic</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX828">wlsq, weighted least squares</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX174">write, macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX563">write, to a file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX564">write, to the terminal</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX463">writing vectors to a file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX464">writing vectors to the screen</a>
</li></dir>
<h2>x</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX369">X10, device driver</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX368">X11, device driver</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX777">xcolumn, read a column into x</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX778">xlogarithm, take log of x</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX366">xwindows device drivers</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX367">Xwindows device drivers</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX365">Xwindows graphics</a>
</li></dir>
<h2>y</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX737">Y0, Bessel function</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX739">Y1, Bessel function</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX779">ycolumn, read a column into y</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX780">ylogarithm, take log of vector y</a>
</li></dir>

<p></p>


<h1><a name="SEC71" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#TOC71">Command Index</a></h1>

<p>
</p><h2>?</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX267">?:</a>
</li></dir>
<h2>a</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX254">Abort</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX268">Abs</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX269">Acos</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX257">Angle</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX259">Apropos</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX270">Arithmetic</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX271">Asin</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX261">Aspect</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX272">Atan</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX273">Atan2</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX516">Atof</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX299">Axis</a>
</li></dir>
<h2>b</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX303">Box</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX307">Break</a>
</li></dir>
<h2>c</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX308">Chdir</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX274">Concat</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX311">Connect</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX312">Contour</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX275">Cos</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX314">Ctype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX322">Cursor</a>
</li></dir>
<h2>d</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX325">Data</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX327">define</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX335">Delete</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX336">Device</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX276">Dimen</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX370">Dither</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX372">Do</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX373">Dot</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX374">Draw</a>
</li></dir>
<h2>e</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX375">Edit</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX376">Environment Variables</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX380">Erase</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX381">Errorbar</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX277">Exp</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX382">Expand</a>
</li></dir>
<h2>f</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX387">FFT</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX278">Float</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX388">Foreach</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX390">Format</a>
</li></dir>
<h2>g</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX279">Gamma</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX392">Grid</a>
</li></dir>
<h2>h</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX394">Help</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX280">Histogram</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX395">Histogram</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX396">History</a>
</li></dir>
<h2>i</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX398">Identification</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX400">If</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX281">Image</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX401">Image</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX517">Index</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX282">Int</a>
</li></dir>
<h2>k</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX411">Key</a>
</li></dir>
<h2>l</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX412">Label</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX455">Label format</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX518">Length</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX413">Levels</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX283">Lg</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX418">Lines</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX419">Listing</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX284">Ln</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX423">local</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX432">Location</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX435">Logical operators</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX438">Ltype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX444">Lweight</a>
</li></dir>
<h2>m</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX447">Macro</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX451">Meta</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX454">Minmax</a>
</li></dir>
<h2>o</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX456">Overload</a>
</li></dir>
<h2>p</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX457">Page</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX415">Plot limits</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX469">Point style</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX458">Points</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX461">Print</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX466">Prompt</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX473">Putlabel</a>
</li></dir>
<h2>q</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX474">Quit</a>
</li></dir>
<h2>r</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX285">Random</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX476">Range</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX477">Read</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX491">Reading from a file</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX488">Relocate</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX492">Return</a>
</li></dir>
<h2>s</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX496">Save</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX497">Set</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX508">Shade</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX511">Show</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX286">Sin</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX512">Sort</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX514">Spline</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX519">Sprintf</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX287">Sqrt</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX288">String</a>, <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX520">String</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX521">Strlen</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX522">Substr</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX289">Sum</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX527">Surface</a>
</li></dir>
<h2>t</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX528">Table</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX290">Tan</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX532">Termtype</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX220">TeX strings</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX539">Ticksize</a>
</li></dir>
<h2>u</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX543">User</a>
</li></dir>
<h2>v</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX548">Verbose</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX552">Version</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX553">Viewpoint</a>
</li></dir>
<h2>w</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX554">Whatis</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX560">While</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX556">Window</a>
</li><li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX561">Write</a>
</li></dir>
<h2>x</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX566">Xlabel</a>
</li></dir>
<h2>y</h2>
<dir>
<li><a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#IDX567">Ylabel</a>
</li></dir>

<p></p>

<p></p><hr><p>
</p><h1>Footnotes</h1>
<h3><a name="FOOT1" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF1">(1)</a></h3>
<p>There is a macro <code>era</code> defined as <code>DELETE
HISTORY ERASE</code> that wouldn't have appeared on the list in the first place,
similarly <code>lis</code> is like <code>HISTORY</code> but won't appear on the list
of commands. As an alternative, you can use the macro <code>set_overload</code>
to make lowercase <code>erase</code> the same as <code>DELETE HISTORY erase</code>,
along with a 
number of other changes. This could be confusing for neophytes!
See "overloading"
</p><h3><a name="FOOT2" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF2">(2)</a></h3>
<p>It is usually easier to use SM's editor to
create macros, try <code>ed square</code> or read on.
</p><h3><a name="FOOT3" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF3">(3)</a></h3>
<p>or <code>q</code>
which is a macro defined as <code>DELETE
HISTORY QUIT</code>. This will exit SM just the same, but the <code>
quit</code> won't appear on your history list, waiting to be playedback
accidently. Actually, <code>q</code> will query you before quitting
</p><h3><a name="FOOT4" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF4">(4)</a></h3>
<p>If you are using VMS, you may prefer to use
<kbd>control-Y</kbd> as your 
interrupt character. A suitable set of key definitions is in a file called
<code>maps_vms.dat</code> in the top SM directory. It may be read 
with the <code>READ EDIT</code> command (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC7">Changing Key-Bindings</a>), and this may be done
automatically in your
<code>startup</code> macro by the variable <code>edit</code> in your
<tt>`.sm'</tt> file.
</p><h3><a name="FOOT5" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF5">(5)</a></h3>
<p>In fact you can rebind any character to
replace <kbd>^</kbd>, see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC6">Command History</a>
</p><h3><a name="FOOT6" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF6">(6)</a></h3>
<p>Under VMS, SM must have been installed as
a foreign command for this to work, and it must <em>not</em> have been linked
with the debugger
</p><h3><a name="FOOT7" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF7">(7)</a></h3>
<p>Occasionally a &lt;CR&gt; is required by SM, so
putting two commands on one line will give a syntax error. The cause is the
way that the grammar is written (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC31">The Command Interpreter</a>),
the fix is either to use two lines, or else to
put an explicit carriage return at the appropriate point with a \n
</p><h3><a name="FOOT8" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF8">(8)</a></h3>
<p> <code>^^</code> and <code>^$</code> really do get back the
last command typed, even if it isn't on the history list. If you
want the last remembered command, use up-arrow or <code>^P</code>
</p><h3><a name="FOOT9" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF9">(9)</a></h3>
<p>The first of these commands in a 
SM session may be
rather slow under VMS, as we have to spawn a subprocess.
</p><h3><a name="FOOT10" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF10">(10)</a></h3>
<p>Unfortunately, this is
currently not available to VMS users
</p><h3><a name="FOOT11" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF11">(11)</a></h3>
<p>unless you have been playing with <code>OVERLOAD</code>
</p><h3><a name="FOOT12" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF12">(12)</a></h3>
<p>More accurately,
by specifying two or more digits; see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN48">Macro</a> for more details and examples
</p><h3><a name="FOOT13" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF13">(13)</a></h3>
<p>usually; this may not be available on
Unix System V and VMS systems.
</p><h3><a name="FOOT14" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF14">(14)</a></h3>
<p>you might prefer to
use the macro <code>ed</code> which
is equivalent to <code>MACRO EDIT</code>, but doesn't appear on the history
list and, if invoked without a macro name, will edit the same macro as
last time. In addition, you can list the current macro with <code>hm</code>.
</p><h3><a name="FOOT15" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF15">(15)</a></h3>
<p>This was the only way before the days of WHILE loops (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SYN82">While</a>),
and as the technique is interesting, we've kept this section in the manual
</p><h3><a name="FOOT16" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF16">(16)</a></h3>
<p>well, to be honest the
LOCAL command's a recent addition to SM so there are lots of macros out there
that don't do this
</p><h3><a name="FOOT17" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF17">(17)</a></h3>
<p>Actually, if the environment
(VMS: logical) <tt>`.sm'</tt> variable <code>PRINTER</code> is defined the macros pretend
that <em>it</em> was the first argument, so you can simply type <code>hcopy</code>.
</p><h3><a name="FOOT18" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF18">(18)</a></h3>
<p>The {} turn off all
expansions, so <code>hi</code> is defined to be
<code>&lt;"$!('Hello')" World&gt;</code>. The statement defining <code>hello</code> then becomes
<code>DEFINE hello &lt;"$!('Hello')" World&gt;</code>, and the `!' ensures that the
expression <code>'Hello'</code> is evaluated and substituted; <code>'Hello'</code> is
a string valued vector, admittedly with only one element, so it evaluates to
the five characters `Hello' and the statement becomes
<code>DEFINE hello &lt;Hello World&gt;</code> which means that <code>hello</code> is defined
as <code>Hello World</code>. Apart from being a red herring, the colons are only
there to make it easy to see which variable expands to what.
</p><h3><a name="FOOT19" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF19">(19)</a></h3>
<p>Due to a VMS RTL bug, this command is not
available on all VMS systems.
</p><h3><a name="FOOT20" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF20">(20)</a></h3>
<p>This isn't actually the preferred way to create
a postscript file; it's better to use a specialised device such as
<code>postfile</code> (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">Device</a>), or at least to say
<code>device postscript ":SY=mv $F foo.ps:"</code> (see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC29">Device</a>).
</p><h3><a name="FOOT21" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF21">(21)</a></h3>
<p>See discussion of double quotes in see section <a href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#SEC26">What Quotes What When</a> if you want to
know why.
</p><h3><a name="FOOT22" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF22">(22)</a></h3>
<p>You are not allowed to use commas in such a list,
so <code>set x={1, 2, 3, 4 }</code> makes <code>x</code> a string vector; but
<code>set x=atof(x)</code> soon fixes that (or say <code>set x=atof({1, 2, 3, 4 })</code>
in the first place). You can use <code>index</code> and
<code>substr</code> to achieve the same result for truly string-valued vectors.
</p><h3><a name="FOOT23" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF23">(23)</a></h3>
<p>you can often do better with a <code>?:</code> or
<code>SET WORD[expr] = expr</code> command
</p><h3><a name="FOOT24" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF24">(24)</a></h3>
<p>The grammar is actually specified using YACC, see S.C. Johnson
<em>YACC: Yet Another Compiler Compiler</em>, Computing Science Technical
Report
No. 32, 1975, AT&amp;T Bell laboratories, Murray Hill, NJ07974. This report is
reprinted in section 2b of the UNIX manual, and is rather difficult reading
at first. We do not in fact use the AT&amp;T code, which is proprietary, but
rather a public domain compiler-compiler called Bison written by the
Free Software Foundation.

</p><h3><a name="FOOT25" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF25">(25)</a></h3>
<p>Specifying <code>-s</code> on the command line bypasses all
of this, and makes SM read input one line at a time.
</p><h3><a name="FOOT26" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF26">(26)</a></h3>
<p>i.e. tokens that have been recognised, typically keywords
</p><h3><a name="FOOT27" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF27">(27)</a></h3>
<p>Graphics I/O Design, Doug Tody, March 1985.
NOAO (Kitt Peak)
</p><h3><a name="FOOT28" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF28">(28)</a></h3>
<p>Actually, SM always
uses cursor 1
</p><h3><a name="FOOT29" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF29">(29)</a></h3>
<p>In counting characters for jumps, the ; is at
character 0 and combinations such as ^N count as one character
</p><h3><a name="FOOT30" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF30">(30)</a></h3>
<p>If the RC string
is given as <code>prompt</code>, then you will be prompted for the key you would
have hit, and the (x,y) position the cursor would have been at, if the
terminal that you were using could support a cursor.
</p><h3><a name="FOOT31" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF31">(31)</a></h3>
<p>In looking for the graphcap file, any environment file
or search path specified on the SM command line with a <code>-f</code> or <code>-u</code>
flag is ignored.

</p><h3><a name="FOOT32" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF32">(32)</a></h3>
<p>Under Unix
the loader can often distinguish fortran from C, so you may <em>not</em>
need the `f' -- <code>call sm_limits(0.0,1.0,0.0,1.0)</code>
</p><h3><a name="FOOT33" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF33">(33)</a></h3>
<p>in fact they will be read from a macro
or the command line without prompting if they are available; try
<code>define file_type no_header image file \n 10 20</code>
</p><h3><a name="FOOT34" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF34">(34)</a></h3>
<p>
The usual reference is Wells, D.C., et al. Astron. Astroph. Suppl, <b>44</b>
363 (1981), although FITS is in fact becoming a national standard in the US
</p><h3><a name="FOOT35" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF35">(35)</a></h3>
<p>If the <code>DV</code> entry contains an embedded space, only the
first word is used to choose a device; the rest is treated as if it
was typed as part of a DEVICE command. For example,
if the graphcap file contains the entry
<code>svga4|svgalib, mode 4:DV=svgalib -m 4:</code>,
the command <code>DEVICE svga4</code> is
equivalent to <code>DEVICE svga -m 4</code>.
</p><h3><a name="FOOT36" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF36">(36)</a></h3>
<p>created by
Dr. A. V. Hershey at the U. S. National
Bureau of Standards and illustrated in National Bureau of Standards
publication NBS SP-24. The format used in the hershey_oc.dat file was
originally due to James Hurt at Cognition, Inc., 900 Technology Park Drive,
Billerica, MA 01821. It may be converted to any format <em>except</em>
the format distributed by the U. S. NTIS (whatever it may be). We have
to tell you all this for copyright reasons, but as distributed the
fonts are in the public domain.
</p><h3><a name="FOOT37" href="http://www.cfht.hawaii.edu/%7Emorrison/home/sm.html#DOCF37">(37)</a></h3>
<p>It's possible to resurrect the font table used by
pre-2.0 versions of SM, using the index file
<tt>`old_font_index'</tt>
</p><p></p><hr><p>
This document was generated on 7 May 2002 using the
<a href="http://wwwcn.cern.ch/dci/texi2html/">%M%</a>
translator version %I%.</p>


<div id="xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd"></div></body></html>